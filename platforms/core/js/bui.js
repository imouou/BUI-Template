/* @preserve 
 * @name: BUI v1.6.2  
 * @detail: BUI 是一个免费的UI交互框架, 用于快速定制开发WebApp,微信,混合移动应用(Bingotouch,Link,Dcloud,Apicloud,Appcan等).
 * @site: http://www.easybui.com/ 
 * Copyright © 2017-2020 BUI. All Rights Reserved. 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";window.libs=window.Zepto||window.jQuery||{},window.bui={},window.router={},function(e){e.debug=!0,e.hasRouter=!1,e.isWebapp,e.currentPlatform="",e.log=!0,e.trace=!1,e.native={},e.config={},e.config.namespace="bui",e.config.classNamePrefix=e.config.namespace+"-",e.config.version="1.6.2",e.config.versionCode=20200426,e.version=e.config.version,e.versionCode=e.config.versionCode,e.config.viewport={zoom:!0,create:!0},e.config.init={auto:!0},e.config.ready={},e.config.ajax={},e.config.get={},e.config.put={},e.config.delete={},e.config.post={},e.config.back={},e.config.load={},e.config.getPageParams={},e.config.refresh={},e.config.run={},e.config.checkVersion={},e.config.component={auto:!0},e.config.dialog={},e.config.confirm={},e.config.alert={},e.config.hint={},e.config.prompt={},e.config.loading={},e.config.mask={},e.config.list={},e.config.listview={},e.config.scroll={},e.config.pullrefresh={},e.config.select={},e.config.sidebar={},e.config.slide={},e.config.actionsheet={},e.config.dropdown={},e.config.accordion={},e.config.stepbar={},e.config.rating={},e.config.number={},e.config.file={},e.config.fileselect={},e.config.upload={},e.config.download={},e.config.swipe={},e.config.router={},e.config.loader={},e.config.loader.define={},e.config.loader.load={},e.config.loader.component={},e.config.store={},e.config.floor={}}(window.bui);var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},r=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};!function(t,n){t.prefix=function(e){return t.config.classNamePrefix+e},t.showLog=function(n,i){i=i||"";var r="";"object"==(void 0===n?"undefined":e(n))&&"message"in n&&"name"in n?r=n.message+":"+n.name+"&&stack:"+n.stack:"string"==typeof n&&(r=n),t.log&&console.error(i+" "+r),t.trace&&console.trace&&console.trace()},t.guid=function(e){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(e=void 0===e?"bui":e||"")+t().substr(e.length)+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.swipeDirection=function(e,t,n,i){var r=t-e,a=i-n,o=Math.abs(r),l=Math.abs(a);return!(o<9&&l<9)&&(o/l>3?r>0?"swiperight":"swipeleft":a>0?"swipedown":"swipeup")},t.obj=function(i,r){var a=null;r=r||null;var o=t.hasRouter?router.currentPage()||"html":"html";o=r||o;var l=n(o),c=/^(\d)/,u=/^[a-zA-z]/,s=/^\[.+\]$/,d=/^#\d/,f=/^\.\d/,p="string"==typeof i,h=/^(html|head|body|header|main|footer|ul|li|section|dt|dd|div|span|img|article|i|strong|input|textarea|select|h1|h2|h3|h4|h5|h6|p|view|component|components)$/gi;if("object"===(void 0===i?"undefined":e(i)))return a=n(i);if(p&&c.test(i))return a=l.find("[id='"+i+"']");if(p&&u.test(i)){var g=h.test(i)||s.test(i)?i:"#"+i;return a=l.find(g)}return d.test(i)?a=l.find("[id='"+i.substr(1)+"']"):f.test(i)?a=l.find("[class='"+i.substr(1)+"']"):i&&(a=l.find(i)),a},t.$=t.obj,t.objId=function(e){return t.obj(e,"html")},t.selector=function(e){return void 0===e?this:n(e,this)},t.widget=function(e){return e&&e in this?this[e]:this},t.option=function(e,i){if("object"!==t.typeof(e)&&void 0===i)return"string"==typeof e?this.config[e]:this.config;if("id"==e)return t.showLog("不允许修改控件的ID参数"),this;if(e&&"object"===t.typeof(e)){var r=n.extend(this.config,e);return this.init(r)}if(this.config.hasOwnProperty(e)){var a={};a[e]=i;var r=n.extend(this.config,a);return this.init(r)}return this}}(window.bui||{},window.libs),function(t,n){t.emitter=function(){function n(){this.handle=Object.create(null)}return n.prototype.on=function(e,n,i){return"function"==typeof n?(i=n,n=this):(i=i,n=n||this),n.handle=n.handle||{},t.unit.stringToArray(e).forEach(function(e,t){void 0===n.handle[e]&&(n.handle[e]=[]),n.handle[e].push(i)}),n},n.prototype.off=function(n,i,r){"function"==typeof i?(r=i,i=this):"function"==typeof r?(r=r,i=i||this):i=this;var a=t.typeof(n);if(void 0===n)i.handle=Object.create(null);else if("string"===a&&"function"==typeof r){var o=i.handle[n]||[];t.array.remove(o,r)}else if("string"===a||"array"===a){"object"!==e(i.handle)&&(i.handle={});var l=t.unit.stringToArray(n);l.forEach(function(e,t){i.handle[e]=[]})}return i},n.prototype.one=function(e,t){function n(){t&&t.apply(i,arguments),i.off(e,n)}var i=this;return this.on(e,n),this},n.prototype.wait=function(e,n){var i=this,r=t.unit.stringToArray(e),a=[],o=!0;return r.forEach(function(e,t){i.on(e,function(e){a[t]=e,a.length===r.length&&o&&(n&&n.apply(i,a),o=!1)})}),this},n.prototype.trigger=function(e){try{if(this.handle[arguments[0]]instanceof Array){var t=this.handle[arguments[0]],n=[].slice.apply(arguments);n.shift();for(var i=0,r=t.length;i<r;i++)t[i]&&t[i].apply(this.self||this,n)}}catch(e){}return this},n.prototype.notify=function(){try{for(var e in this.handle)if(this.handle[e]instanceof Array)for(var t=this.handle[e],n=0,i=t.length;n<i;n++)t[n]&&t[n].apply(this.self||this)}catch(e){}return this},function(e){return new n}}();var i=t.emitter();t.on=i.on,t.off=i.off,t.trigger=i.trigger,t.one=i.one}(window.bui||{},window.libs),function(t,n){t.store=function(r){function a(e){function i(e){var t=0;for(t=0;t<e.length;t++){var a=e[t];a.beforeMount&&se.beforeMounts.push(a.beforeMount),a.beforeCompile&&se.beforeCompiles.push(a.beforeCompile),a.beforeUpdate&&se.beforeUpdates.push(a.beforeUpdate),a.updated&&se.updateds.push(a.updated),a.compiled&&se.compileds.push(a.compiled),a.mounted&&se.mounteds.push(a.mounted),a.beforeDestroy&&se.beforeDestroys.push(a.beforeDestroy),a.destroyed&&se.destroyeds.push(a.destroyed),r=n.extend(!0,o,a),a.mixins&&a.mixins.length&&t<e.length-1&&i(a.mixins)}}var r=null,a=e&&e.extends?[e.extends]:[];t.array.merge(se.mixins,a,e.mixins||[],[e]);var o=n.extend(!0,{},se,t.config.store);return i(se.mixins),r=n.extend(!0,se,r)}function o(){Ne=t.hasRouter?router.$:n;var i=Ne(de.el);Ce="object"===e(de.el)?n(de.el):i.length?i:n(de.el),Re=Ce&&Ce.parent(),Ae=Ce&&Ce.children(),We.$el=Ce,We.$parent=Re,We.$children=Ae,We.$data=fe;for(var r in me)me[r]=me[r].bind(We);return We.$methods=me,me&&h(),ve&&g(),le.call(We,"beforemount"),de.beforeMounts.forEach(function(e,t){e.call(We)}),Z(fe),c(),ye&&u(),he&&p(),be?de.needCompile&&router&&router.on("complete",function(e){de.needView?j({id:Ce,compiled:function(){de.needCompile&&m(),Ue&&de.mounteds.forEach(function(t,n){t.call(We,e)})}}):(de.needCompile&&m(),Ue&&de.mounteds.forEach(function(t,n){t.call(We,e)})),He=n.extend(!0,{},fe),ke=!1,Oe=!0,le.call(We,"mounted",e),Ue=!1,Fe=[]}):(Ue||oe(),xe&&l(),de.needView?j({id:Ce,compiled:function(){de.needCompile&&m(),de.mounteds.forEach(function(e,t){e.call(We)})}}):(de.needCompile&&m(),de.mounteds.forEach(function(e,t){e.call(We)})),He=n.extend(!0,{},fe),ke=!1,Oe=!0,Fe=[],le.call(We,"mounted"),Ue=!1),this}function l(){var e=Ce.html();return e=y(e),Ce.html(e),this}function c(){for(var e in fe)!function(e){Object.defineProperty(We,e,{configurable:!0,get:function(){$e&&console.log("1. module getting "+e,Fe),!ke&&Oe?(ke=!0,Oe=!1,Fe=[]):(ke=!1,Oe=!1);var t=fe[e];return Array.isArray(t)&&Se.target&&(Le[e]=[],Le[e].push(Se.target)),t},set:function(t){$e&&console.log("2. module setting "+e,Fe),Fe=[],fe[e]=t,He[e]=t}})}(e)}function u(){try{Object.keys(ye).forEach(function(e,t){f(e,ye[e])})}catch(e){t.showLog(e)}}function s(e){return re("nexttick",function(n){try{e&&e.call(We,n)}catch(n){t.showLog(n)}}),this}function d(e,n){var i="nexttick-"+e;return je.hasOwnProperty(i)?this:(je[i]=n,re("nexttick",function(n){if(n.keyname===e)try{Ie[e].pop(),0==Ie[e].length&&je[i]&&je[i].call(We,n)}catch(n){t.showLog(n)}}),this)}function f(e,n){return re(e,function(e){try{var i=[e.value,e.preValue||"",e];if("init"!==e.action){var r=n;switch(t.typeof(r)){case"function":r.apply(We,i);break;case"array":r.forEach(function(e,t){e.apply(We,i)});break;case"string":new Function(r+"("+e.value+","+(e.preValue||"")+")")();break;default:r.apply(We,i)}}}catch(e){t.showLog(e)}}),this}function p(){try{Object.keys(he).forEach(function(e){if(fe.hasOwnProperty(e))return void t.showLog("不能跟data的键值相同:"+e);var n=he[e];Object.defineProperty(We,e,{get:function(){var t,i="function"==typeof n?n.bind(this):n.get.bind(this);return Se.target=function(){var t=i();le(e,{target:null,value:t,action:"set",keyname:e,param:[],origin:He}),Se.target=null,Fe=[]},t=i(),Se.target=null,Fe=[],t},set:n&&"object"===t.typeof(n)?n.set||function(){}:function(){}})})}catch(e){t.showLog(e)}}function h(){try{Object.keys(me).forEach(function(e){if(fe.hasOwnProperty(e))return void t.showLog("不能跟data的键值相同:"+e);Object.defineProperty(We,e,{get:function(){return me[e].bind(this)},set:function(){}})})}catch(e){t.showLog(e)}}function g(){try{Object.keys(ve).forEach(function(e){if(fe.hasOwnProperty(e))return void t.showLog("不能跟data的键值相同:"+e);Object.defineProperty(We,e,{get:function(){return ve[e].bind(this)},set:function(){}})})}catch(e){t.showLog(e)}}function m(i){try{var r=null,a=null;void 0===i?(r=Ce,a=de):"string"==typeof i?(r=Ne(i),a=de):i&&"object"===(void 0===i?"undefined":e(i))&&(r=Ne(i)||n(i),a=n.extend(!0,{},de,i));var o=!0;if(a.beforeCompiles.forEach(function(e,t){if(!1===(o=e.call(We,a)))return!1}),!1===o)return Fe=[],!1;if(T(r),w(r),a.needComponent)return loader.components({id:r,compiled:function(){k(r),L(r),O(r),De=!0,v(),Fe=[],a.compileds.forEach(function(e,t){e.call(We,a)})}}),this;k(r),L(r),O(r),De=!0,v(),Fe=[],a.compileds.forEach(function(e,t){e.call(We,a)})}catch(e){t.showLog(e)}return this}function v(){return Ce.find("[ref]").each(function(){var e=this.getAttribute("ref"),n=Pe.hasOwnProperty(e),i=null;n&&"htmldivelement"===t.typeof(Pe[e])?(i=[Pe[e]],i.push(this),Pe[e]=i):n&&"array"===t.typeof(Pe[e])?Pe[e].push(this):Pe[e]=this}),this}function y(e){try{var i=this,r="string"==typeof e?e:"",a=new RegExp("{{[\\s]?"+pe+ge+"(.*?)}}","mg");return r=r.replace(a,function(e,r){var a=r.split(pe+ge);""===n.trim(a[0])&&a.shift();var o=a.length>0&&t.unit.getKeyValue(a.join("."),He)||"";return"function"==typeof o?o.call(i):o})}catch(e){t.showLog(e)}}function b(e,n){var i=void 0;if(qe&&qe.hasOwnProperty(e))i=qe[e];else{if(void 0===(i=t.unit.getKeyValue(e,n)))return void($e&&console.warn("请检查 "+e+" 在bui.store scope:"+pe+" 中有没有声明定义"));qe[e]=i}return i}function w(e){try{var n=e,i=[],r=n[0]&&n[0].outerHTML||n.html()||"",a=r.match(ze)||[],o=t.array.uniq(a);o.length&&o.forEach(function(e,r){var a=n.find("["+e+"*="+pe+"]");a.length<1&&(a=n.closest("["+e+"*="+pe+"]")),a.length&&a.each(function(n,r){var a=this,o="",l=J.call(this,""+e),c=l[0]&&l[0].keyname||"",u=c.indexOf(".length"),s=u>-1?c.substr(0,u):c,d=l[0]&&l[0].param;b(s,We);var f=J.call(this,"b-linked");if(f.length&&f.forEach(function(e,n){re(e.keyname,function(e){le(c,{target:null,value:t.unit.getKeyValue(c,We),action:"set",keyname:c,param:d,origin:He})})}),"b-show"===e)switch(l[0]&&l[0].rule){case"!":o="b-hide";break;default:o="b-show"}else o=e;if(be){var p=t.array.compare(Be[o],s);!p&&Be[o].push(s),!p&&re(s,Me[o].bind(a))}else!Ue&&0===n&&oe(s),re(s,Me[o].bind(a));t.array.compare(i,s)||i.push(s),Fe=[],ke=!1,Oe=!0})}),x(i)}catch(e){t.showLog(e)}}function x(e){e.forEach(function(e,t){le(e,{target:null,action:"init",value:qe[e],param:null,keyname:e,origin:He}),Fe=[]})}function k(e){function i(e){var n=e.target.value,i=J.call(this,"b-model"),r=i[0]&&i[0].keyname||"";if(""===r)return t.showLog("b-model的值不能为空"),!1;ee(r,n),Fe=[],e.stopPropagation()}function r(e){try{var n=this,i=this.getAttribute("value")||this.checked,r=this.getAttribute("type"),a=J.call(this,"b-model"),l=a[0].keyname,c=null,u=this.getAttribute("check-value"),s=this.getAttribute("uncheck-value"),d=this.getAttribute("check"),f=this.getAttribute("uncheck");(d||f||u||s)&&(i=this.checked?u||this.value||d:s||f||""),c=b(l,We);var p=/\{.+\}$/g,h=p.test(i),g=h?null:o.find('[type="checkbox"][b-model="'+pe+"."+l+'"][value="'+i+'"],\n                [type="radio"][b-model="'+pe+"."+l+'"][value="'+i+'"]');switch(r){case"checkbox":this.checked&&(c&&"array"===t.typeof(c)?!t.array.compare(c,i)&&t.unit.getKeyValue(l,We).push(i):ee(l,i),this.checked=!0),this.checked||(c&&"array"===t.typeof(c)?t.array.remove(t.unit.getKeyValue(l,We),i):ee(l,i),this.checked=!1),g&&g.each(function(e,t){this.checked=n.checked});break;case"radio":default:ee(l,i)}Fe=[],e.stopPropagation()}catch(e){t.showLog(e)}}function a(e){try{var i=n(this).val(),r=(this.selectedIndex,this.multiple),a=J.call(this,"b-model"),o=a[0].keyname,l=null;switch(l=b(o,We),r){case!0:"array"!==t.typeof(l)&&t.showLog(o+"的类型必须为数组"),i.splice(0,0,0,i.length+1),l.splice.apply(l,i);break;default:ee(o,i)}Fe=[],e.stopPropagation()}catch(e){t.showLog(e)}}var o=e,l='[type="text"][b-model*='+pe+'],\n                                [type="search"][b-model*='+pe+'],\n                                [type="password"][b-model*='+pe+'],\n                                [type="url"][b-model*='+pe+'],\n                                [type="number"][b-model*='+pe+'],\n                                [type="email"][b-model*='+pe+'],\n                                [type="range"][b-model*='+pe+'],\n                                [type="tel"][b-model*='+pe+"],\n                                textarea[b-model*="+pe+"]";if("input"===de.modelEvent){var c=!1;o.off("input compositionstart compositionend",l).on(we,l,function(e){c||i.call(e.target,e)}).on("compositionstart",l,function(e){c=!0,e.stopPropagation()}).on("compositionend",l,function(e){c=!1,i.call(e.target,e),e.stopPropagation()})}else o.off(we,l).on(we,l,i);var u='[type="checkbox"][b-model*='+pe+'],\n                                [type="radio"][b-model*='+pe+"]";o.off("change",u).on("change",u,r);var s="select[b-model*="+pe+"]";o.off("change",s).on("change",s,a)}function O(e){e.off("change","[b-checked*="+pe+"]").on("change","[b-checked*="+pe+"]",function(e){var t=this.checked;ee(J.call(this,"b-checked")[0].keyname,t),Fe=[],e.stopPropagation()})}function L(e){var t=e;t.off("click.bui","[b-click*="+pe+"]").on("click.bui","[b-click*="+pe+"]",function(e){var t=I.call(this,e,"b-click");if(!1===t)return!1;void 0===t&&e.stopPropagation()}),t.off("touchstart","[b-touchstart*="+pe+"]").on("touchstart","[b-touchstart*="+pe+"]",function(e){if(!1===I.call(this,e,"b-touchstart"))return!1}),t.off("touchmove","[b-touchmove*="+pe+"]").on("touchmove","[b-touchmove*="+pe+"]",function(e){if(!1===I.call(this,e,"b-touchmove"))return!1}),t.off("touchend","[b-touchend*="+pe+"]").on("touchend","[b-touchend*="+pe+"]",function(e){if(!1===I.call(this,e,"b-touchend"))return!1}),t.off("focus","[b-focus*="+pe+"]").on("focus","[b-focus*="+pe+"]",function(e){if(!1===I.call(this,e,"b-focus"))return!1}),t.off("change","[b-change*="+pe+"]").on("change","[b-change*="+pe+"]",function(e){if(!1===I.call(this,e,"b-change"))return!1}),t.off("blur","[b-blur*="+pe+"]").on("blur","[b-blur*="+pe+"]",function(e){if(!1===I.call(this,e,"b-blur"))return!1}),t.off("submit","[b-submit*="+pe+"]").on("submit","[b-submit*="+pe+"]",function(e){if(!1===I.call(this,e,"b-submit"))return!1})}function I(e,n){var i=J.call(this,n),r=i[0].keyname,a=i[0].param,o=null;a.push(e);try{o=b(r,We);var l="function"==typeof o&&o.apply(We,a);return Fe=[],le(r,{target:this,value:o,action:"set",keyname:r,param:a,origin:He}),l}catch(e){t.showLog(e)}}function j(e){loader.views({id:e.id,loaded:function(e){m(e.el)},compiled:e.compiled})}function T(e){var n=e,i=n.find("[b-template*="+pe+"]"),r=[];if(Ie={},i.length)try{i.each(function(e,n){var i=this,a=Ne(i),o=J.call(this,"b-template"),l=o[0].keyname,c=o[0].param,u=pe+ge;c[0]||console.error('b-template 没有找到数据源, 格式为: b-template="page.template(page.sources)"');var s="string"==typeof c[0]&&c[0].replace(new RegExp(u),"")||"",d=a.attr("b-command"),f=d||"html",p=a.attr("b-children")||a.children()[0]&&a.children()[0].tagName;b(s,We);be&&oe(s),Ie.hasOwnProperty(s)?Ie[s].push(s):Ie[s]=[s],re(s,function(e){try{var n,i=e.param;switch(e.action){case"push":case"unshift":n=i;break;case"splice":n=i.slice(2)||"";break;default:n=e.value}if(ve&&ve.hasOwnProperty(l)){c=c.map(function(e,t){if("string"==typeof e&&0==e.indexOf(pe+ge)&&t>0){return b(e.replace(new RegExp(u),""),He)}return e}),c[0]=n;var r=void 0!==n&&"undefined"!==n&&ve[l]&&ve[l].apply(We,c);void 0===r&&(r="",t.showLog(l+"模板方法需要返回内容，例如：return html;")),be&&(a=Ne('[b-template*="'+(u+s)+'"]'));var o=e.preValue||[];0==o.length&&a.empty();var d=p?a.children(p):a.children(),h=d,g=i&&i.length||0,m=null;switch(Ue=!0,e.action){case"push":if(a.append(r),d=a.children(p),g&&g==d.length)w(d);else if(g>1)for(var v=h.length,y=v;y<d.length;y++)m=d.eq(v+y-1),w(m);else m=d.last(),w(m);break;case"unshift":if(a.prepend(r),d=a.children(p),g&&g==d.length)w(d);else if(g>1)for(var y=0;y<g;y++)m=d.eq(y),w(m);else m=d.first(),w(m);break;case"pop":d.last().remove(),d=a.children(p),m=d.last(),w(m);break;case"shift":d.first().remove(),d=a.children(p),m=d.first(),w(m);break;case"length":break;case"splice":var x=parseInt(i[0]),k=parseInt(i[1]);k>=o.length&&(a.empty(),d=a.children(p));var O=d.length,L=O>0;if(0==k)if(L&&O-1>=x){d.eq(x).before(r),d=a.children(p);for(var y=0;y<n.length;y++)m=d.eq(x+y),w(m)}else{a.append(r),d=a.children(p);for(var y=0;y<n.length;y++)m=d.eq(O+y),w(m)}else if(k>0){if(void 0!==i[2])if(L&&O-1>=x){d.eq(x).before(r),d=a.children(p);for(var y=0;y<n.length;y++)m=d.eq(x+y),w(m)}else{a.append(r),d=a.children(p);for(var y=0;y<n.length;y++)m=d.eq(O+y),w(m)}for(var y=0;y<k;y++)d.eq(x+n.length+y).remove()}break;case"reverse":case"sort":a.html(r),w(a);break;default:a[f](r),w(a)}le.call(We,"nexttick",e)}else t.showLog("找不到对应的模板,请检查下 scope:"+pe+" 的templates是否存在"+l,"bui.store")}catch(e){t.showLog(e)}}),t.array.compare(r,s)||r.push(s),Fe=[]}),x(r)}catch(e){t.showLog(e)}}function P(e){var n=E.call(this,e,"b-text"),i="",r=t.typeof(e.value),a=n.attr("b-text"),o=J.call(this,"b-text"),l=(o[0].keyname,o[0].param);switch(r){case"array":i=S(e,a);break;case"function":i=e.value.apply(We,l);break;default:i=e.value}n.text(i),Fe=[]}function E(e,t){var i=pe+ge+e.keyname;return be?n("["+t+'="'+i+'"]'):Ne(this)}function S(e,t){return t.indexOf(".length")>-1?e.value.length||0:e.value instanceof Array?e.value.join(","):e.value}function N(e){var n=E.call(this,e,"b-html"),i="",r=t.typeof(e.value),a=n.attr("b-html"),o=J.call(this,"b-html"),l=(o[0].keyname,o[0].param);switch(r){case"array":i=S(e,a);break;case"function":i=e.value.apply(We,l);break;default:i=e.value}n.html(i),Fe=[]}function C(e){var t=E.call(this,e,"b-value");be?t.each(function(t,n){R.call(this,e)}):R.call(t[0],e),Fe=[]}function R(e){var n=this.getAttribute("type"),i=this.value,r=this,a=this.getAttribute("b-value");switch(n){case"radio":i==e.value?this.checked=!0:this.checked=!1;break;case"checkbox":"array"===t.typeof(e.value)&&e.value.forEach(function(e,t){i==e&&(r.checked=!0)});break;default:this.value=S(e,a)}}function A(e){var t=E.call(this,e,"b-model");be?t.each(function(t,n){F.call(this,e)}):F.call(t[0],e)}function F(e){var t=this.getAttribute("type"),i=this.value,r=(e.param,this);if("SELECT"===this.nodeName&&this.multiple)return void(e.value.length>1?e.value.forEach(function(e,t){"string"==typeof e?n(r).find("option[value="+e+"]").attr("selected",!0):n(r).find("option[value="+e.value+"]").attr("selected",!0)}):this.value=e.value[0]);switch(t){case"radio":i==e.value?this.checked=!0:this.checked=!1;break;case"checkbox":if(i&&e.value instanceof Array)switch(e.action){case"push":case"unshift":e.param.filter(function(e,t){if(i===e)return void(r.checked=!0)});break;case"pop":case"shift":e.param.filter(function(e,t){i===e&&(r.checked=!1)});break;case"splice":var a=e.param,o=parseInt(a[1]),l=a.slice(2);0==o?l.forEach(function(e,t){i===e&&(r.checked=!0)}):o>0&&(e.preValue.forEach(function(t,n){n<=e.param[1]&&(r.checked=!1)}),e.value.forEach(function(e,t){i===e&&(r.checked=!0)}));break;case"length":break;default:e.value.filter(function(e,t){i==e&&(r.checked=!0)})}else e.value===i||!this.checked===e.value?this.checked=!0:this.checked=!1;break;default:if(event&&event.target&&"INPUT"===event.target.nodeName)break;this.value=e.value}Fe=[]}function D(e){var t=E.call(this,e,"b-show");e.value?this.removeAttribute("style"):t.css("display","none"),Fe=[]}function U(e){var t="!"+pe+ge+e.keyname,i=be?n('[b-show="'+t+'"]'):Ne(this);e.value?i.css("display","none"):i.css("display","block")}function H(e){this.checked=!!e.value,Fe=[]}function V(t){var n=E.call(this,t,"b-bind"),i=this,r=t.keyname,a=t.value;if("object"===(void 0===a?"undefined":e(a))){for(var o in a)!function(e){re(r+"."+e,function(n){$(E.call(i,t,"b-bind"),e,n.value)}),$(n,e,a[e])}(o)}else{var l="string"==typeof r&&r.split(".");$(n,l[l.length-1],a)}}function $(t,n,i){switch(n){case"disabled":i?t.attr(n,i):t.removeAttr(n);break;case"checked":t.prop(n,i);break;default:var r="object"===(void 0===i?"undefined":e(i))?JSON.stringify(i):i;t.attr(n,r)}Fe=[]}function z(e){var t=E.call(this,e,"b-src");t.attr("src",e.value),Fe=[]}function M(e){var t=E.call(this,e,"b-id");t.attr("id",e.value),Fe=[]}function B(e){var t=E.call(this,e,"b-href");t.attr("href",e.value),Fe=[]}function q(t){var n=E.call(this,t,"b-style"),i=this;if("object"===e(t.value)){for(var r in t.value)!function(e){re(t.keyname+"."+e,function(n){E.call(i,t,"b-style").css(e,n.value)}),n.css(t.value)}(r)}else n.css(t.keyname,t.value);Fe=[]}function W(n){var i=E.call(this,n,"b-class"),r=this;this.classList;if("object"===e(n.value))if("array"===t.typeof(n.value))i.attr("class",""),n.value.forEach(function(e,t){!i.hasClass(e)&&i.addClass(e)});else{for(var a in n.value)!function(e){var t=n.value[e],a=n.preValue&&n.preValue[e]||"";re(n.keyname+"."+e,function(t){_(E.call(r,n,"b-class"),e,t.value)}),_(i,e,t,a)}(a)}else{var o="string"==typeof n.keyname&&n.keyname.split(".");_(i,o[o.length-1],n.value,n.preValue)}Fe=[]}function _(e,t,n,i){"boolean"==typeof n?(n&&e.addClass(t),!n&&e.removeClass(t)):"string"==typeof n?(be&&e.removeClass(n),i&&e.removeClass(i),n&&!e.hasClass(n)&&e.addClass(n),void 0!==i&&""===n&&e.removeClass(i)):(Boolean(n)&&e.addClass(t),!Boolean(n)&&e.removeClass(t))}function J(e){var n=[],i=this,r=this.getAttribute(e)||"",a=r.indexOf("&")>-1?r.split("&"):r&&[r]||[];try{a.forEach(function(t,r){var a={},o=K.call(i,t,e);a.scope=pe,a.rule=o.rule,a.keyname=o.name,a.param=o.param,a.eventType=o.eventType,a.eventProperty=o.eventProperty,n.push(a)})}catch(e){t.showLog("参数处理出错")}return n}function K(e,i){try{var r=/([^\(|\)]+)/g,a=e?e.match(r):[],o="",l="",c=null,u=[],s=null,d=this,f="",p=n(d).attr("b-target"),h=p?n(d).parents(p)[0]||d:d,g="",m="";if(c=a[0]&&a[0].indexOf(pe+ge)>-1?a[0].split(pe+ge):[pe,a[0]],f=c[0].split(pe),f=f[0]||f[1]||"",o=pe,l=c[1]||"",l.indexOf("$index")>-1){var v=n(h).index();l=l.replace("$index",v)}else if(l.indexOf("$id")>-1){var y=h.id;l=l.replace("$id",y)}else if(l.indexOf("$parentIndex")>-1){var b=n(h).parent().index();l=l.replace("$parentIndex",b)}if(void 0!==a[1]){var w=a[1]||"";try{var x=/\{.+\}$/g,k=/\[.+\]$/g,O=/(\"(.*?)\".*?)|(\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14})|(^((https|http|ftp|rtsp|mms)?:\/\/)[^\,]+)|([a-zA-Z0-9][-a-zA-Z0-9\._]{0,62})|(\{.+\})|(\[.+])|([$\w\.]+)|([\d\.]+)|([\u4e00-\u9fa5|\w|\d]+)/g,L=w?w.match(O):[];u=L.map(function(e,r){var a=e.replace(/^\"|\"$/g,""),o=n(h).attr("b-target"),l=o?n(h).parents(o)[0]||h:h;switch(e){case"$this":a=l;break;case"$index":a=n(l).index();break;case"$parentIndex":a=n(l).parent().index();break;case"$parent":a=l.parentNode;break;case"$children":a=n(l).children();break;case"$id":a=l.id;break;case"$text":a=l.textContent;break;case"$value":a=l.value;break;case"$html":a=l.innerHTML}if("b-template"!==i){var c=pe+ge;t.unit.startWithStr(a,c)&&(a=t.unit.getKeyValue(a.split(c)[1],We))}return x.test(e)||k.test(e)?JSON.parse(e):a})}catch(e){t.showLog(e,"getArguments"),u=[]}}void 0!==a[2]&&(s=a[2].indexOf(".")>-1?a[2].split("."):[a[2]],g=s[0],m=s[1]||"")}catch(n){t.showLog("参数格式错误:"+e)}return{scope:o,rule:f,name:l,param:u,eventType:g,eventProperty:m}}function Z(e,t){return Q(e,t)}function Q(e,n){function i(e,n){var i=e[n];if(i instanceof Array?Y(i,n):X(e,n),i&&"object"===t.typeof(i))return Z(i)}if(n&&"array"===t.typeof(n))if(n.length>1){var r=n.pop(),a=t.unit.getKeyValue(n.join("."),e);i(a,r)}else i(e,n[0]);else Object.keys(e).forEach(function(t){i(e,t)})}function X(e,n){var i=e[n],r="function"==typeof i?i.call(We):i,a=[];Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:function(e){return $e&&console.log("3. data getting "+n+":",r),Ee.target=this,(ke||!ke&&Oe)&&Fe.push(n),Se.target&&a.push(Se.target),r},set:function(e){if(e===r)return Fe=[],Te=!1,ke=!1,Oe=!0,!0;Ee.target===this&&(Fe=[]),Ee.target=this,(!Oe||!ke&&Oe)&&Fe.push(n);var i=Fe.join(".");!Te&&le.call(We,"beforeupdate",{action:"set",value:e,preValue:r,keyname:i,origin:He}),!Te&&de.beforeUpdates.forEach(function(t,n){t.call(We,{action:"set",value:e,preValue:r,keyname:i,origin:He})}),$e&&console.log("4. data setting "+i,e);var o=t.unit.getKeyValue(i,He);return r=e,a.forEach(function(e){return e()}),!Te&&le(i,{action:"set",value:r,preValue:o,keyname:i,origin:He}),t.unit.setKeyValue(i,r,He),r instanceof Array?Z(fe,Fe):"object"===t.typeof(r)&&(de.deep&&Z(e),r&&Object.keys(r).forEach(function(e,t){var i=n+"."+e;Fe=[],le(i,{target:null,value:r[e],preValue:o&&o[e],action:"set",keyname:i,origin:He})})),!Te&&le.call(We,"updated",{action:"set",value:r,preValue:o,keyname:i,origin:He}),!Te&&de.updateds.forEach(function(e,t){e.call(We,{action:"set",value:r,preValue:o,keyname:i,origin:He})}),Fe=[],Te=!1,ke=!1,Oe=!0,!0}})}function Y(e,n){var i=[],r=Array.prototype,a=Object.create(r);return["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(e){var o=r[e];Object.defineProperty(a,e,{enumerable:!0,configurable:!0,value:function(r){var a=[].concat(Array.prototype.slice.call(arguments));le.call(We,"beforeupdate",{target:null,action:e,param:a,value:this,prevValue:[],keyname:n,origin:He}),i.push(n),fe.hasOwnProperty(n)||i.unshift(Fe.join("."));var l=i.join("."),c=this.slice(0),u=o.apply(this,a);switch($e&&console.log("5. "+l+" action "+e+" "),e){case"pop":case"shift":a=[u]}t.unit.setKeyValue(l,this,He);var s=Ce.find('[b-template*="'+pe+"."+l+'"]');return le(l,{target:s,action:e,param:a,value:this,preValue:c,keyname:n,origin:He}),Le[i[0]]&&"array"===t.typeof(Le[i[0]])&&Le[i[0]].forEach(function(e){return e()}),i=[],Fe=[],ke=!1,Oe=!0,le.call(We,"updated",{target:s,action:e,param:a,value:this,preValue:c,keyname:n,origin:He}),de.updateds.forEach(function(t,i){t.call(We,{target:s,action:e,param:a,value:this,preValue:c,keyname:n,origin:He})}),u}})}),a.$index=function(e,n){return t.array.index(this,e,n)},a.$include=function(e,n){return t.array.compare(this,e,n)},a.$empty=function(){return t.array.empty(this)},a.$replace=function(e){return t.array.replace(this,e)},a.$merge=function(){var e;return(e=t.array).merge.apply(e,[this].concat(Array.prototype.slice.call(arguments)))},a.$get=function(e,n){return t.array.get(this,e,n)},a.$set=function(e,n,i){return t.array.set(this,e,n,i)},a.$delete=function(e,n){return t.array.delete(this,e,n)},e.__proto__=a,e}function G(e){if(void 0===e)return He=He;if("string"==typeof e){var n=t.unit.getKeyValue(e,He);return Fe=[],n}return He}function ee(r,a){var o="string"==typeof r,l=[],c=null;if(Fe=[],o&&void 0!==a){var u,s;$e&&console.log("set "+r+" "),Te=!0,le.call(We,"beforeupdate",(u={action:"set",target:null,value:c,preValue:d},i(u,"action","set"),i(u,"keyname",r),i(u,"origin",He),u)),de.beforeUpdates.forEach(function(e,t){var n;e.call(We,(n={action:"set",target:null,value:c,preValue:d},i(n,"action","set"),i(n,"keyname",r),i(n,"origin",He),n))});var d=t.unit.getKeyValue(r,He);a&&"object"===t.typeof(a)?(c=n.extend(!0,{},a),l.push(r),Object.keys(a).forEach(function(e,t){var n=r+"."+e;le.call(We,n,{target:null,value:a[e],preValue:d,action:"set",keyname:n,origin:He})})):c=a,t.unit.setKeyValue(r,a,fe),t.unit.setKeyValue(r,c,He),Ve[r]=c,le.call(We,r,{target:null,value:c,preValue:d,action:"set",keyname:r,origin:He}),le.call(We,"updated",(s={action:"set",target:null,value:c,preValue:d},i(s,"action","set"),i(s,"keyname",r),i(s,"origin",He),s)),de.updateds.forEach(function(e,t){var n;e.call(We,(n={action:"set",target:null,value:c,preValue:d},i(n,"action","set"),i(n,"keyname",r),i(n,"origin",He),n))}),"object"===(void 0===a?"undefined":e(a))&&(a instanceof Array?Z(fe,r.split(ge)):Z(a)),Fe=[]}else r&&"object"===t.typeof(r)&&(He=n.extend(!0,{},He,r),ie(r));return He}function te(e,n){return"string"==typeof e&&(t.unit.delKey(e,He),n&&n.call(We,e)),He}function ne(e,t){return te(e,function(t){le(e)}),He}function ie(e,n){for(var i in e){var r=void 0===n?i:n+i,a=e[i];le(r,{target:null,value:a,preValue:He[i]||"undefined",action:"set",param:null,keyname:r,origin:He}),a&&"object"===t.typeof(a)&&ie(a,i+".")}}function re(e,n){var i="";return i=e&&"array"===t.typeof(e)?e.map(function(e,t){return pe+ge+e}):pe+ge+e,Ee.on.call(We,i,n),this}function ae(e,t){return je.hasOwnProperty(e)?this:(re(e,t),je[e]=t,this)}function oe(e,t){if(e){var n=pe+ge+e;Ee.off.call(We,n,t)}else We.handle={};return this}function le(e){var t=pe+ge+e;return $e&&console.warn(t,"trigger"),arguments[0]=t,Ee.trigger.apply(We,arguments),ke=!1,Oe=!0,this}function ce(){return Fe=[],ke=!1,Oe=!0,Te=!1,this}function ue(){return Fe=[],de.beforeDestroys.forEach(function(e,t){e.call(We)}),ke=!1,Oe=!0,Te=!1,oe(),de.beforeMounts=[],de.beforeCompiles=[],de.compileds=[],de.mounteds=[],de.beforeUpdates=[],de.updateds=[],de.destroyeds.forEach(function(e,t){e.call(We)}),this}var se={el:null,scope:"",data:null,extends:null,mixins:[],beforeMounts:[],beforeCompiles:[],compileds:[],beforeUpdates:[],mounteds:[],updateds:[],beforeDestroys:[],destroyeds:[],computed:null,methods:null,watch:null,templates:null,beforeMount:null,mounted:null,beforeCompile:null,compiled:null,beforeUpdate:null,updated:null,beforeDestroy:null,destroyed:null,isPublic:!1,modelEvent:"input",scopeSplit:".",delayInput:200,needStatic:!1,needView:!0,needComponent:!1,needCompile:!0,needNative:!1,deep:!0,log:!1,autoinit:!0},de=null;de=a(r);var fe=de.data,pe=de.scope||t.guid(),he=de.computed,ge=de.scopeSplit,me=de.methods,ve=de.templates,ye=de.watch||se.watch,be=(de.delayInput,de.isPublic),we=de.modelEvent,xe=de.needStatic,ke=!1,Oe=!0,Le={},Ie={},je={},Te=!1,Pe={},Ee=t.emitter(),Se={target:null};de.el?de.el=de.el:de.el=be?"body":".bui-page";var Ne=null,Ce=null,Re=null,Ae=null,Fe=[],De=!1,Ue=!0,He=fe,Ve={},$e=void 0===de.log?se.log:de.log,ze=/b-text|b-html|b-value|b-show|b-hide|b-checked|b-src|b-href|b-bind|b-style|b-class|b-model/gim,Me={"b-text":P,"b-html":N,"b-value":C,"b-show":D,"b-hide":U,"b-checked":H,"b-bind":V,"b-src":z,"b-id":M,"b-href":B,"b-class":W,"b-model":A,"b-style":q},Be={"b-text":[],"b-html":[],"b-value":[],"b-show":[],"b-hide":[],"b-checked":[],"b-bind":[],"b-src":[],"b-href":[],"b-class":[],"b-model":[],"b-style":[]},qe={},We=(n.extend(!0,{},fe,me,ye,he,ve),{$methods:me,$refs:Pe,mixin:a,$options:de,$templates:ve,config:de,watch:f,nextTick:s,oneTick:d,get:G,set:ee,delete:ne,del:ne,observer:Z,compile:m,$mount:m,compileHtml:y,clearKey:ce,destroy:ue,init:o,on:re,off:oe,one:ae,trigger:le,emitter:Ee});try{de.autoinit&&o()}catch(e){t.showLog(e)}return We}}(window.bui||{},window.libs),function(e,t){function n(n,i){function r(t){var n=i||750,r=document.head.parentNode,a=t||(h/n*100).toFixed(2);return s=a||48,e.config.viewport.zoom&&(r.style.fontSize=s+"px"),
e.trigger.call(e,"viewportinit"),this}function a(e){return h||t("body").width()||t("#bui-router").width()||t(".bui-page").width()}function o(e){return g||t("body").height()||t("#bui-router").height()||t(".bui-page").height()}function l(e){return m}function c(e){return v}function u(e){return p}e.trigger.call(e,"viewportbefore");var s,d=document.querySelector("meta[name=viewport]"),f="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no",p=window.devicePixelRatio,h=document.documentElement.clientWidth,g=document.documentElement.clientHeight,m=parseInt(h)*parseInt(p),v=parseInt(g)*parseInt(p);if(h=h>g?g+24:h,d)e.config.viewport.create&&(d.content=f);else{var y=document.createElement("meta");y.name="viewport",y.content=f;var b=document.head;e.config.viewport.create&&b.appendChild(y),y=null}var w=[240,320,360,375,384,393,412,414,435,480,512,540,768,1024,1536,2048,2732,534,854,750],x=[32,42.67,48,50,51.2,52.4,54.93,55.2,58,64,68.27,60,60,60,60,60,60,60,60,60],k=e.array.index(w,document.documentElement.clientWidth);return k>-1&&void 0===n?s=x[k]:r(n),{width:a,height:o,fontSize:s,screenWidth:l,screenHeight:c,ratio:u,init:r}}e.viewport=n}(window.bui||{},window.libs),function(t,n){t.loader=function(i){function r(e){return e=e||{},B=n.extend({},B,e),this}function o(t){if(void 0===t)return K;if("object"===(void 0===t?"undefined":e(t))&&("modules"in t||"baseUrl"in t))K=n.extend(!0,{},K,t),Z=K.modules;else if("object"===(void 0===t?"undefined":e(t))&&"moduleName"in t){var i=s(t);Z[t.moduleName]=i||{},K=n.extend(!1,K,{modules:Z}),Z=K.modules}return K}function l(e){if("string"==typeof e)return K.modules[e]||null}function c(e,n){return n&&"object"===t.typeof(n)&&(n.moduleName=e,o(n)),this}function u(e,t){var n=e,i=t.lastIndexOf("/"),r=t.substr(0,i);return e.indexOf("../")>-1?(e=e.replace(/\..\//g,function(e){var t=r.lastIndexOf("/");return r=r.substr(0,t),""}),n=r?r+"/"+e:e):e.indexOf("./")>-1&&(n=r+"/"+e.replace(/\.\//g,"")),n}function s(e){var t={id:"",moduleName:"",template:"",data:null,depend:[],script:"",style:[],isDefined:!1,isLoaded:!1,beforeCreate:null,created:null,beforeLoad:null,loaded:null,show:null,beforeDestroy:null,destroyed:null,exports:{},dependExports:[]},i={};return e.moduleName in Z&&(i=Z[e.moduleName]),n.extend(!0,{},t,i,e)}function d(e){B.log&&console.log("destroy "+e);var i="string"==typeof e?Z[e]:null;if(i){i.beforeDestroy&&i.beforeDestroy.call(i);var r=n('script[name="'+e+'"]').attr("src");W=t.array.remove(W,r),n('script[name="'+e+'"]').remove(),delete K.modules[e],Z=K.modules,i.destroyed&&i.destroyed.call(i)}}function f(e,i,r){var a={moduleName:"",template:"",path:"",data:null,depend:[],beforeCreate:null,created:null,beforeLoad:null,loaded:null,hide:null,show:null,beforeDestroy:null,destroyed:null},l={},c="";try{var s=h().name?h():p(),d=s.name}catch(e){}var f=[],m=[];if(void 0===e)return t.showLog("define第1个参数不能为空"),this;"function"==typeof e?(r=e,c=d,i=[]):"object"===t.typeof(e)?(c=d,i=e.depend||[],r=e.loaded,l=n.extend(!0,{},a,e)):"array"===t.typeof(e)?(r=i,i=e,c=d):"function"==typeof i?(c=e,r=i,i=[]):(c=e,i=i,r=r);var v=c in Z?Z[c].script||s.src:s.src;if(B.log&&console.log("define "+c),i.length)for(var y=0;y<i.length;y++){var b=i[y],w=b.indexOf("./")>-1?u(b,v):b;if(w.indexOf(".css")>-1)w.indexOf("css!")>-1?m.push(w.substr(4)):m.push(w);else{var x=w.indexOf(".js");x>-1&&(w=w.substr(0,x)),f.push(w),w in Z||o({moduleName:w})}}if("string"==typeof c&&"function"==typeof r){var k=function(){var e=[g,Z[d]&&Z[d].exports,Z[d]],t=[];f.length&&f.forEach(function(e,n){Z[e]&&t.push(Z[e].exports)});var n=t.concat(e);return r&&r.apply(this,n)};l=e&&"object"===t.typeof(e)?n.extend(!0,{},a,Z[c],t.config.loader.define,e):n.extend(!0,{},a,Z[c],t.config.loader.define),l.moduleName=c,l.depend=f,l.style=m,l.script=v,l.path=v.substr(0,v.lastIndexOf("/")+1),l.loaded=k,l.isDefined=!0,o(l)}else t.showLog("define "+c+"模块的参数格式不对");return this}function p(e){var t=window.location.pathname,n=t.indexOf(".html"),i="",r="";return n>-1?(i=t.substr(1,n),r=i+".js"):(i=t.substr(1),r=i+".js"),{name:i,src:r}}function h(){var e,t,i=window.location.href,r=[],o=document.currentScript;if(i.indexOf("#")>-1?r=i.split("#"):r.push(i),z=r[0].replace("/index.html","")+"/",o)return e=o.src.replace(z,""),t=o.getAttribute("name")||e.substr("0",e.indexOf(B.scriptSuffix)),{name:t,src:e};try{a()}catch(e){var l=e.stack||e.sourceURL||e.stacktrace||"",c=l.split(/[@ ]/g).pop(),u=c.replace(/(:\d+)?:\d+$/i,""),u=u.replace(new RegExp(z,"g"),"");return o=n('script[src="'+u+'"]')[0],t=o?o.getAttribute("name"):u.replace(B.scriptSuffix,""),{name:t,src:u}}}function g(e,n){B.log&&console.log("require "+e);if(e&&"string"==typeof e){if(e.indexOf(".css")>-1)return S(e,n);if(e.indexOf(".html")>-1)return S(e,n);e=[e]}if(n&&"function"!=typeof n)return t.showLog("require第2个参数格式为function","bui.loader.require"),this;try{e=e.map(function(e,n){return t.unit.resolvePath(e)}),m(e,n)}catch(e){t.showLog(e,"bui.loader.require")}return this}function m(e,n){function i(e,n){function a(e,t){var r=Z[e];return r&&(r.isDefined=!0),!1!==(r&&r.beforeLoad&&r.beforeLoad.call(r,r.depend))&&(r&&r.depend&&r.depend.length?void i(r.depend,n):void(t==o.length-1&&n&&n.apply(r)))}e=e||[],Z=K.modules;var o=t.array.uniq(e);o.length>1&&o.forEach(function(e,t){var n=Z[e];n&&1==n.isLoaded&&o.splice(t,1)}),o.forEach(function(e,i){var l=Z[e];if(Z[e]&&Z[e].style&&Z[e]&&Z[e].style.length&&A(Z[e].style),t.array.compare(r,e)||r.unshift(e),l&&l.isLoaded){if(!1===(l&&l.beforeLoad&&l.beforeLoad.call(l,l.depend)))return!1;i==o.length-1&&(n&&n.apply(l),r=[])}else if(l&&l.loaded){var c=Z[e].beforeCreate&&Z[e].beforeCreate.call(Z[e]);if(!1===c)return!1;Z[e].created&&Z[e].created.call(Z[e]),a(e,i)}else R(e,function(){var t=Z[e];if(!1===(t&&t.beforeCreate&&t.beforeCreate.call(Z[e])))return!1;t&&t.style&&t.style.length&&A(t.style),t&&t.created&&t.created.call(Z[e]),a(e,i)},function(){i==o.length-1&&(n&&n.apply(null),r=[])})})}var r=[];i(e,function(){if(y(r)){var t=[];e.forEach(function(i,r){v(i),t.push(Z[i]&&Z[i].exports),r===e.length-1&&n&&n.apply(Q,t||[])})}})}function v(e){Z=K.modules;var n="string"==typeof e?Z[e]||{}:e,i=n.depend||[],r=null,a=[];n.dependExports=[];try{if(i.length)for(var o=0;o<i.length;o++){var l=i[o],c=Z[l];c.isLoaded?a[o]=c.exports:a[o]=v(c)||c.exports,c.exports=a[o],n.dependExports.push(a[o]),c.isLoaded=!0}r=n.isLoaded?n.exports:n.loaded&&n.loaded.apply(n,a),n.exports=r||Z[n.moduleName]&&Z[n.moduleName].exports,n.isLoaded=!0,$(n.moduleName,n,n.exports),B.log&&console.log("execute "+n.moduleName)}catch(e){t.showLog(e,"bui.loader.execute")}return r}function y(e){var t=!0,n=e||[];if(Z=K.modules,n.length)n.forEach(function(e,n){var i=Z[e];i&&!1===i.isDefined&&(t=!1)});else for(var i in Z)Z[i]&&!1===Z[i].isDefined&&(t=!1);return t}function b(e){var n=!0,i=[];if(Z=K.modules,"string"==typeof e){e.indexOf(",")>-1?i=e.split(","):i.push(e)}else e&&"array"===t.typeof(e)&&(i=e||[]);if(i.length)i.forEach(function(e,t){Z.hasOwnProperty(e)||(n=!1),Z[e]&&!1===Z[e].isLoaded&&(n=!1)});else for(var r in Z)Z[r]&&!1===Z[r].isLoaded&&(n=!1);return n}function w(e){var i=n.extend(!0,{id:"",cacheHtml:!1,cache:!1,url:"",script:"",param:null,beforeLoad:null,loaded:null},t.config.loader.load,e);if(!i.id)return void t.showLog("id不能为空");if(!i.url)return void t.showLog("url不能为空");if(!1===("function"==typeof i.beforeLoad?i.beforeLoad.call(Q):i.beforeLoad))return this;var r=E(i.url);if(i.script){var a=i.script.indexOf(".js");r.module=i.script.substr(0,a)}var l="string"==typeof i.id&&(i.id.indexOf("#")>-1||i.id.indexOf(".")>-1)?i.id.substr(1):i.id;i.id=l,i.name=r.module,i.url=r.url,o({id:l,moduleName:r.module}),t.history.getLast().currentComponent=l,t.history.setComponent({id:i.id,name:i.name,url:i.url,param:i.param||null});var c=o().modules[i.name];if(c&&"function"==typeof c.template)return!i.cacheHtml&&t.obj(i.id).html(u),x(i),this;if(i.cacheHtml)return x(i),this;if("function"==typeof r.url){var u=r.url(i)||"";return!i.cacheHtml&&t.obj(i.id).html(u),x(i),this}return S(r.url,function(e){!i.cacheHtml&&t.obj(i.id).html(e),x(i)},function(e){i.onFail&&i.onFail.call(this,r)}),this}function x(e){var n=o().modules[e.name];if(!1===(n.beforeLoad&&n.beforeLoad.call(n,n.depend)))return!1;if(n.isLoaded&&"function"==typeof n.loaded&&!e.cache){n.id=e.id,n.exports=n.loaded&&n.loaded.call(n,n.exports);var i={id:e.id,name:e.name,url:e.url,param:e.param||null,exports:n.exports||{}};return t.history.setComponent(i),e.loaded&&e.loaded.call(n,n.exports),$(e.id,i),Q}t.checkLoad(e.name);g(e.name,function(i){var r={id:e.id,name:e.name,url:e.url,param:e.param||null,exports:i||{}};t.history.setComponent(r),e.loaded&&e.loaded.call(n,i),$(e.id,r)})}function k(i){var r=n.extend(!0,{id:"",isSelf:!0,deepComponent:B.deepComponent,cache:!1,cacheHtml:!1,delay:!0,param:null,beforeLoad:null,loaded:null,compiled:null},t.config.loader.component,i),a=null;a=""===r.id?t.$(B.componentTag):r.isSelf?t.$(r.id):t.$(r.id).find(B.componentTag);for(var l=[],c=[],u=[],s=[],d=o().modules,f=0;f<a.length;f++){var p=a[f],h=t.guid();!p.id&&p.setAttribute("id",h);var g=d[O],m=t.unit.getAttributes(p),v=m.parentId=r&&r.id||t.history.getLast().id||"bui-page",y=t.$(v).parents("component"),b=r.isSelf?y[0]&&y[0].id:r.id;"array"===t.typeof(v)?b=r.isSelf?y&&y[0].id:v[0].id:"object"==e(m.parentId)&&t.typeof(m.parentId).indexOf("element")>-1&&(b=r.isSelf?y[0]&&y[0].id:v.id);var x=b&&t.history.getComponent(b,"name");if(x)m.parentId=b,m.parentName=x;else{var k=t.history.getLast();m.parentId=k.id,m.parentName=k.name}var O=m.name||p.getAttribute("name"),I="true"===m.rendered||r.cacheHtml;if(O&&(!m.delay||!r.delay)){m=n.extend(!0,{},m,r.param);var j=p.innerHTML,T=g&&g.template?g.template:O+".html",P=g&&g.script?g.script:O+".js";g&&"function"==typeof g.template?l.push({id:p.id,el:p,name:O,cacheHtml:I,cache:r.cache,deepComponent:r.deepComponent,template:g.template.call(g)||"",url:T,srcript:P,slot:j,param:m}):(u.push(T),s.push(P),c.push({id:p.id,el:p,name:O,cacheHtml:I,cache:r.cache,deepComponent:r.deepComponent,url:T,srcript:P,slot:j,param:m}))}}return l.length&&(l.forEach(function(e,t){w({id:e.id,url:e.url,param:e.param||null,cacheHtml:e.cacheHtml,cache:e.cache,beforeLoad:r.beforeLoad})}),r.data=l,L(r)),c.length?(N(t.array.merge(u,s),function(e){!function t(n){var i=c[n];return n==c.length?(r.data=c,L(r),this):i?(i.template=e[n],void w({id:i.id,url:i.url,param:i.param||null,cacheHtml:i.cacheHtml,cache:i.cache,beforeLoad:r.beforeLoad,loaded:function(e){t(n+1)},onFail:function(){t(n+1)}})):this}(0)}),this):(r.compiled&&r.compiled(r.data),$("componentcompiled",r.data),!1)}function O(e){return k(n.extend(!0,{id:"",isSelf:!1,deepComponent:B.deepComponent,cache:!1,cacheHtml:!1,beforeLoad:null,loaded:null,compiled:null},e)),this}function L(e){for(var n=0;n<e.data.length;n++){var i=e.data[n];new RegExp("<"+B.viewTag+".+name=","gi").test(i.template)&&T({id:i.id});var r=new RegExp("<"+B.componentTag+".+name=","gi");new RegExp("<"+B.componentTag+'.+name="'+i.name+'"',"gi").test(i.template)?t.showLog("请检查代码, <"+B.componentTag+' name="'+i.name+'"></'+B.componentTag+">的模板里面存在循环嵌套"):(e.deepComponent&&r.test(i.template)&&O({id:i.id}),e.loaded&&e.loaded(i),$("componentloaded",i))}e.compiled&&e.compiled(e.data),$("componentcompiled",e.data)}function I(e){for(var i=n.extend(!0,{id:"",deepView:B.deepView,deepComponent:B.deepComponent,delay:!1,param:null,beforeLoad:null,loaded:null,compiled:null},e),r=t.$(i.id),a=0;a<r.length;a++){var o=r[a],l=o&&o.getAttribute("delay"),c=o&&o.tagName.toLowerCase();"true"===l&&("true"===l&&c===B.componentTag?(i.isSelf=!0,i.id=o,o.setAttribute("delay","false"),k(i)):"true"===l&&c===B.viewTag?(i.isSelf=!0,i.id=o,o.removeAttribute("delay"),P(i)):(i.isSelf=!1,c=n(o).find('[delay="true"]')[0]&&n(o).find('[delay="true"]')[0].tagName.toLowerCase(),n(o).find('[delay="true"]').removeAttr("delay"),c===B.componentTag&&k(i),c===B.viewTag&&P(i)))}return this}function j(e){for(var i=0;i<e.data.length;i++){var r=e.data[i];if(!r.cacheHtml){r.el.innerHTML=r.template;var a=new RegExp("<"+B.componentTag+".+name","gi");new RegExp("<"+B.componentTag+'.+name="'+r.name+'"',"gi");a.test(r.template)&&O({id:r.id});var o=new RegExp("<"+B.viewTag+'.+name="'+r.name+'"',"gi"),l=new RegExp("<"+B.viewTag+'.+name="'+r.name+'"',"gi");if(l.test(r.template)){t.showLog("请检查代码, <"+B.viewTag+' name="'+r.name+'"></'+B.viewTag+">的模板里面存在循环嵌套");continue}e.deepView&&o.test(r.template)&&!l.test(r.template)&&T({id:n(r.el)})}e.loaded&&e.loaded(r),$("viewloaded",r)}e.compiled&&e.compiled(e.data),$("viewcompiled",e.data)}function T(e){return P(n.extend(!0,{id:"",isSelf:!1,deepView:B.deepView,loaded:null,compiled:null},e)),this}function P(e){var i=n.extend(!0,{id:"",isSelf:!0,deepView:B.deepView,loaded:null,compiled:null},e),r=null;r=""===i.id?t.$(B.viewTag):i.isSelf?t.$(i.id):t.$(i.id).find(B.viewTag);for(var a=[],o=[],l=loader.map().modules,c=0;c<r.length;c++){var u=r[c],s=u.getAttribute("name"),d=u.getAttribute("delay"),f=l[s],p="true"===u.getAttribute("rendered"),h=t.guid();if(!u.id&&u.setAttribute("id",h),"true"!==d){var g=u.innerHTML,m=f&&f.template?f.template:s+".html";f&&"function"==typeof f.template?o.push({id:u.id,el:u,name:s,cacheHtml:p,template:f.template.call(f)||"",url:m,slot:g}):a.push({id:u.id,el:u,name:s,cacheHtml:p,url:m,slot:g})}}return o.length&&(o.forEach(function(e,t){e.el.innerHTML=e.template}),i.data=o,j(i)),function e(t){if(t==a.length)return i.data=a,void j(i);a[t]&&C(a[t].url,function(n){a[t].template=n,e(t+1)},function(n){a[t].template="",e(t+1)})}(0),this}function E(e){var t=Z,n={},i=e.indexOf(".html");return i>-1?(n.url=e,n.module=e.substr(0,i)):(n.url=t[e].template||e+".html",n.module=e),n}function S(e,i,r){return new Promise(function(a,o){if("string"==typeof e)e=t.unit.resolvePath(e),e.indexOf(".css")>-1?(i&&i(e),F(e).then(function(t){a(e)})):e.indexOf(".html")>-1||e.indexOf(".htm")>-1?C(e).then(function(e){if("function"!=typeof i)return n(i).html(e),r&&r(e),void a(e);i&&i(e),a(e)},function(e){r&&r(e),o(e)}):R(e).then(function(e){i&&i(e),a(e)},function(e){r&&r(e),o(e)});else if(e&&"array"===t.typeof(e)){var l=e.map(function(e,n){return e=t.unit.resolvePath(e),e.indexOf(".css")>-1?F(e):e.indexOf(".html")>-1||e.indexOf(".htm")>-1?C(e):R(e)});Promise.all(l).then(function(e){i&&i(e),a(e)},function(e){r&&r(e),o(e)})}})}function N(e,n,i){return new Promise(function(r,a){if("string"==typeof e)S(e,n,i);else if(e&&"array"===t.typeof(e)){var o=[];!function i(a){if(a==e.length)return n&&n(o),void r(o);var l=t.unit.resolvePath(e[a]);return l.indexOf(".css")>-1?F(l):l.indexOf(".html")>-1||l.indexOf(".htm")>-1?C(l,function(e){o.push(e),i(a+1)},function(e){i(a+1)}):R(l,function(e){o.push(e),i(a+1)},function(e){i(a+1)})}(0)}})}function C(e,n,i){return new Promise(function(r,a){var o="function"==typeof n;if(e=t.hasRouter?e:t.unit.relativePath(e,B.relativePath),J.hasOwnProperty(e))return o?n&&n.call(Q,J[e],200):"string"==typeof n&&t.$(n).html(J[e]),r(J[e],200),this;"string"==typeof e&&bui.ajax({baseUrl:B.baseUrl,url:e,dataType:"html",contentType:"text/html;charset=UTF-8",mimeType:"html",processData:!1,needNative:B.needNative,data:null,success:function(a,l,c){J[e]=a,o?n&&n.call(Q,a,l,c):"string"==typeof n&&(t.$(n).html(a),i&&i.call(Q,a,l,c)),r(a,l)},error:function(e,t,n){o&&i&&i.call(Q,e,t,n),a(e,t,n)}})})}function R(e,i,r){return new Promise(function(a,o){var l,c=this;if(Z=K.modules,void 0===e||""==e)return r&&r.call(c,e),o(e),this;if(e in Z)l=e,e=Z[e].script||l+B.scriptSuffix;else{var u=e.indexOf(B.scriptSuffix);u>-1?(e=e,l=e.substr(0,u)):(l=e,e+=B.scriptSuffix)}e=t.hasRouter?e:t.unit.relativePath(e,B.relativePath);var s=document.createElement("script")||{},d=B.cache?"":"?t="+(new Date).getTime(),f=e.indexOf("http://")>-1||e.indexOf("https://")>-1;s.type="text/javascript",s.async=!1,s.src=f?e+d:K.baseUrl+e+d,s.setAttribute("name",l),s.onload=function(){B.log&&console.log("create "+e),i&&i(e),a(e)},s.onerror=function(t){B.log&&console.log("createError "+e),r&&r(e),o(e)};var p=t.array.index(W,e);return Z[l]&&Z[l].isDefined?(i&&i(e),a(e)):(p>-1&&Z.hasOwnProperty(l)&&n('script[name="'+l+'"]').remove(),document.body&&document.body.appendChild(s),B.cache&&W.push(e)),s=null,this})}function A(e){return new Promise(function(n,i){e.length;if("array"===t.typeof(e)){var r=e.map(function(e){return F(e)});return Promise.all(r)}return F(e)})}function F(e){return new Promise(function(n,i){if("string"!=typeof e)return void t.showLog(e+"的格式不正确");if(t.array.index(_,e)<0){var r=t.hasRouter?e:t.unit.relativePath(e,B.relativePath),a=document.createElement("link")||{};a.href=r+(B.cache?"":"?t="+(new Date).getTime()),a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),document.head&&document.head.appendChild(a),a=null,_.push(e)}n(e)})}function D(e,n){var i=t.history.getLast("id"),r=arguments;return t.unit.stringToArray(e).forEach(function(e,t){r[0]=i+"-"+e,q.on.apply(Q,r)}),this}function U(e,t){return q.one.apply(Q,arguments),this}function H(e,t){return q.wait.apply(Q,arguments),this}function V(e,n){var i=t.history.getLast("id"),r=arguments;return t.unit.stringToArray(e).forEach(function(e,t){r[0]=i+"-"+e,q.off.apply(Q,r)}),this}function $(e){Q.self=this==window||this==Q?null:this;var n=t.history.getLast("id");arguments[0]=n+"-"+e,q.trigger.apply(Q,arguments)}var z,M={cache:!0,log:!1,baseUrl:"",relativePath:"pages",needNative:!1,deepView:!1,viewTag:"view",componentTag:"component",deepComponent:!0,scriptSuffix:".js"},B=n.extend({},M,t.config.loader,i),q=t.emitter(),W=[],_=[],J={},K={baseUrl:"",modules:{}},Z={},Q={init:r,define:f,require:g,destroy:d,map:o,import:S,importSync:N,importHtml:C,load:w,checkLoad:b,components:O,component:k,delay:I,views:T,view:P,get:l,set:c,one:U,wait:H,on:D,off:V,trigger:$};return Q},window.loader=t.loader(),t.define=loader.define,t.require=loader.require,t.map=loader.map,t.import=loader.import,t.checkLoad=loader.checkLoad,t.checkDefine=loader.checkDefine}(window.bui||{},window.libs),function(e,t){e.toggle=function(n){function i(t){if(t=t||v,b=!1,!t.id)return void e.showLog("toggle id不能为空","bui.toggle");x=e.objId(t.id),v=m.config=t,g=x.attr("class")||"";var n=t.effect,i=t.inOrder?e.array.index(w.hideInOrder,n):e.array.index(w.hide,n),r=n&&(e.array.index(w.show,n)>-1?e.array.index(w.show,n):i);return L=!(x[0]&&"none"==x[0].style.display||"none"==x.css("display")),r<0?(h=w.show[0],p=t.inOrder?w.hideInOrder[0]:w.hide[0]):(h=w.show[r],p=t.inOrder?w.hideInOrder[r]:w.hide[r]),this}function r(){return L}function a(t,n){if(!b)return x=e.objId(v.id),!(!k&&!O)&&(k=!1,"function"==typeof t?(t=t,n=n||h||""):(n=t||h||"",t=null),x[0]&&"none"==x[0].style.display&&x.css("display",y),x.addClass("animated "+n),"showIn"==n||"showOut"==n||"none"==n?(v.revert&&x.removeClass("animated "+n),t&&t.call(m,this),L=!0,k=!0):x.one("webkitAnimationEnd",function(){try{!L&&x.css("display",y),v.revert&&x.removeClass("animated "+n),t&&t.call(m,this),L=!0,k=!0}catch(t){e.showLog(t,"toggle show method")}}),this)}function o(t,n){if(!b&&(x=e.objId(v.id),k||O))return O=!1,"function"==typeof t?(t=t,n=n||p||""):(n=t||p||"",t=null),x.css("display",y).addClass("animated "+n),"showIn"==n||"showOut"==n||"none"==n?(x.css("display","none"),v.revert&&x.removeClass("animated "+n),t&&t.call(m,this),L=!1,O=!0):x.one("webkitAnimationEnd",function(){try{x.css("display","none"),v.revert&&x.removeClass("animated "+n),t&&t.call(m,this),L=!1,O=!0}catch(t){e.showLog(t,"toggle hide method")}}),this}function l(){return x.remove(),this}function c(e){var e=1==e;x&&(x.off(),e&&x.remove()),b=!0}function u(t){var n={};return e.widget.call(n,t)}function s(t,n){return e.option.call(m,t,n)}var d={id:"",effect:"fadeIn",useBox:!1,revert:!0,inOrder:!1};if("string"==typeof n){var f=n||"";n={},n.id=f}var p,h,g,m={show:a,hide:o,remove:l,isShow:r,destroy:c,widget:u,option:s,config:v,init:i},v=m.config=t.extend(!0,{},d,n),y=v.useBox?"-webkit-box":"block",b=!1,w={show:["fadeIn","fadeInLeft","fadeInRight","fadeInDown","fadeInUp","fadeInLeftBig","fadeInRightBig","fadeInUpBig","fadeInDownBig","zoomIn","bounceIn","rotateIn","rollIn","flipInX","flipInY","lightSpeedIn","showIn","slideInRight","slideInLeft","coverInLeft","coverInRight","zoomSlideInLeft","zoomSlideInRight","pushInLeft","pushInRight"],hide:["fadeOut","fadeOutLeft","fadeOutRight","fadeOutUp","fadeOutDown","fadeOutLeftBig","fadeOutRightBig","fadeOutDownBig","fadeOutUpBig","zoomOut","bounceOut","rotateOut","rollOut","flipOutX","flipOutY","lightSpeedOut","showOut","slideOutRight","slideOutLeft","coverOutLeft","coverOutRight","zoomSlideOutLeft","zoomSlideOutRight","pushOutLeft","pushOutRight"],hideInOrder:["fadeOut","fadeOutRight","fadeOutLeft","fadeOutDown","fadeOutUp","fadeOutRightBig","fadeOutLeftBig","fadeOutUpBig","fadeOutDownBig","zoomOut","bounceOut","rotateOut","rollOut","flipOutX","flipOutY","lightSpeedOut","showOut","slideOutLeft","slideOutRight","coverOutRight","coverOutLeft","zoomSlideOutRight","zoomSlideOutLeft","pushOutRight","pushOutLeft"]},x=null,k=!0,O=!0,L=!1;return v.id&&i(v),m}}(window.bui||{},window.libs),function(t,n){t.unit={},t.unit.remToPx=function(e){var t=window&&window.viewport&&window.viewport.fontSize||100,e=(parseFloat(e)*t).toFixed(2);return e},t.unit.pxToRem=function(e){var t=window&&window.viewport&&window.viewport.fontSize||100,e=(parseFloat(e)/t).toFixed(2);return e},t.unit.pxToRemZoom=function(e){var e=(parseFloat(e)/100).toFixed(2);return e},t.unit.debounce=function(e,t,n){var i;return function(){var r=n||this,a=arguments,o=function(){i=null,e.apply(r,a)};clearTimeout(i),i=setTimeout(o,t)}},t.unit.throttle=function(e,t,n){t||(t=250);var i,r;return function(){var a=n||this,o=+new Date,l=arguments;i&&o<i+t?(clearTimeout(r),r=setTimeout(function(){i=o,e.apply(a,l)},t)):(i=o,e.apply(a,l))}},t.unit.startWithCss=function(e){var t=new RegExp("^\\.|^#");return"string"==typeof e&&t.test(e)},t.unit.startWithStr=function(e,t){var n=new RegExp("^"+t);return"string"==typeof e&&n.test(e)},t.unit.startWithId=function(e){var t=new RegExp("^#");return"string"==typeof e&&t.test(e)},t.unit.startWithClass=function(e){var t=new RegExp("^\\.");return"string"==typeof e&&t.test(e)},t.unit.endWithImage=function(e){var t=new RegExp("(.png|.jpg|.gif)$");return"string"==typeof e&&t.test(e)},t.unit.tel=function(e){var n,e=String(e),i="tel:";return 0==e.indexOf("+")&&(i="wtai://wp/mc;"),n=e,window.location.href=i+n,t},t.unit.sms=function(e,n){var i=navigator.userAgent,r=/(iPhone|iPad|iOS)/i.test(i),a=r?"&":"?";return window.location.href="sms:"+e+a+"body="+n,t},t.unit.mailto=function(e){var e="email"in e?e:{};return"string"==typeof e.email&&e.email.indexOf("@")>0?window.location.href="mailto:"+e.email+"?subject="+(e.subject||"")+"&body="+(e.body||"")+"&cc="+(e.cc||""):t.showLog(email+"格式不正确"),t},t.unit.openExtral=function(e){var n=[],i="",e=String(e);if(e.indexOf("mailto:")>=0)if(n=e.split("mailto:"),i=n[1],i.indexOf("?")>-1){var r=i.split("?"),a=t.unit.keyStringToObject(r[1]);a.email=r[0],t.unit.mailto(a)}else t.unit.mailto({email:i});if(e.indexOf("tel:")>=0&&(n=e.split("tel:"),i=parseInt(n[1]),t.unit.tel(i)),e.indexOf("sms:")>=0)if(n=e.split("sms:"),i=n[1],e.indexOf("=")>=0){var o=e.split("="),l=o[1];t.unit.sms(i,l)}else t.unit.sms(i);return t},t.unit.objectToKeyString=function(e,t){var n="";for(var i in e){n+="&"+i+"="+(t?encodeURIComponent(e[i]):e[i])}return n.substr(1)},t.unit.keyStringToObject=function(e,n){var i,r={},a=[];try{for(a=e.split("&"),i=0;i<a.length;i++){var o=n?decodeURIComponent(a[i].split("=")[1]):a[i].split("=")[1];r[a[i].split("=")[0]]=o}}catch(e){t.showLog(e)}return r},t.unit.checkTargetInclude=function(e,t){var i=t,r=[];if(i.indexOf(",")>-1){r=i.split(",");var a,o=r.length;for(a=0;a<o;a++){var l=r[a];l.indexOf(".")>-1&&(r[a]=l.substr(1))}}else i.indexOf(".")>-1?r[0]=i.substr(1):r[0]=i;var c,u=r.length;for(c=0;c<u;c++)if(n(e).hasClass(r[c]))return!0;return!1},t.unit.jsonToString=function(n){function i(n){if(n&&"object"===t.typeof(n)){for(var i in n){var r=n[i];"object"===(void 0===r?"undefined":e(r))&&(n[i]=JSON.stringify(r))}return n}}function r(n){if(n&&"array"===t.typeof(n))return n.forEach(function(t,i){"object"===(void 0===t?"undefined":e(t))&&(n[i]=JSON.stringify(t))}),n}return"object"===(void 0===n?"undefined":e(n))?function(e){function n(e,n){var a=e[n];return a&&"object"===t.typeof(a)?e[n]=i(a):a&&"array"===t.typeof(a)?e[n]=r(a):e[n]=a,e[n]}var a;if("object"===t.typeof(e)){for(var o in e)e[o]=n(e,o);a=JSON.stringify(e)}else"array"===t.typeof(e)?(e.forEach(function(t,i){e[i]=n(e,i)}),a=JSON.stringify(e)):a=e;return a}(n):n},t.unit.stringToJson=function(n){function i(n){var r,a;try{if(r="object"===(void 0===n?"undefined":e(n))?n:JSON.parse(n),"array"===t.typeof(r))r.forEach(function(e,t){r[t]=i(e)});else if("object"===t.typeof(r))for(var o in r){var l=r[o];r[o]=i(l)}a=r}catch(e){a=n}return a}return n&&i(n)},t.unit.stringToArray=function(e){var n=t.typeof(e);return"array"===n?e:"string"===n&&e.indexOf(",")>-1?e.split(","):[e]},t.unit.setKeyValue=function(e,t,n){function i(e,n){if(r.length)return i(r.shift(),n[e]||{});n[e]=t}var r=e&&e.indexOf(".")>-1?e.split("."):[e];return i(r.shift(),n)},t.unit.getKeyValue=function(e,t){function n(e,t){var r=t[e];if(r&&"string"==typeof r&&r.indexOf("{")>-1&&r.indexOf("}")>-1)try{t[e]=JSON.parse(r)}catch(n){t[e]=r}return void 0!==r&&i.length?n(i.shift(),r):r}var i=e&&e.indexOf(".")>-1?e.split("."):[e];return n(i.shift(),t)},t.unit.getKeyObj=function(e,t){function n(e,t){var r=t[e];return!r instanceof Array&&r instanceof Object?n(i.shift(),r):r}var i=e&&e.indexOf(".")>-1?e.split("."):[e];return n(i.shift(),t)},t.unit.delKey=function(e,t){function n(e,r){return i.length?n(i.shift(),r[e]):(delete r[e],t)}var i=e&&e.indexOf(".")>-1?e.split("."):[e];return n(i.shift(),t)},t.unit.calcHeight=function(e,t){var i=n(e);i[0]&&(i[0].style.height="calc(100% - "+t+")")},t.unit.resolvePath=function(e){if(!t.hasRouter)return e;e=e||"";var n=e,i=router&&router.history&&router.history.getLast()||{url:n},r=i.url||"",a=r.lastIndexOf("/"),o=r.substr(0,a);return e.indexOf("../")>-1?(e=e.replace(/\..\//g,function(e){var t=o.lastIndexOf("/");return o=o.substr(0,t),""}),n=o?o+"/"+e:e):e.indexOf("./")>-1&&(n=o+"/"+e.replace(/\.\//g,"")),n},t.unit.filterField=function(n,i){var r={};if("object"===(void 0===i?"undefined":e(i))){var a="object"===t.typeof(n),o="object"===t.typeof(i),l="array"===t.typeof(n),c="array"===t.typeof(i);if(a){if(o)for(var u in i)r[u]=i[u]?n[i[u]]:n[u];else c&&i.forEach(function(e,t){r[e]=n[e]});return r}return l?(r=[],c?n.forEach(function(e,t){var n={};i.forEach(function(t,i){n[t]=e[t]}),r.push(n)}):o&&n.forEach(function(e,t){var n={};for(var a in i)n[a]=i[a]?e[i[a]]:e[a];r.push(n)}),r):void 0}},t.unit.fixZero=function(e){return e<10?"0"+e:e},t.unit.getAttributes=function(n){if("object"!==(void 0===n?"undefined":e(n)))return null;var i={},r=/\{.+\}$/g,a=/\[.+\]$/g;return n.attributes&&Object.keys(n.attributes).forEach(function(e,o){var l=n.attributes[e],c=l.value;if(r.test(c)||a.test(c))try{c=JSON.parse(c)}catch(e){c=c,t.showLog(e)}i[l.name]=c}),i},t.unit.resolvePathname=function(e,t){t=t||0;var n=e.lastIndexOf("/"),i=e.substring(t,n);return i.indexOf("/")>-1?i.split("/"):[i]},t.unit.relativeUrl=function(e,t){var n=[];return t.length>=e.length?t.forEach(function(t,i){var r=e[i];r&&t===r||(r&&t!==r?(n.unshift(".."),n.push(t)):n.push(t))}):e.forEach(function(e,i){var r=t[i];r&&e===r||(r&&e!==r?(n.unshift(".."),n.push(r)):n.unshift(".."))}),n},t.unit.relativePath=function(e,n){n=n||"pages";var i=window.location.href,r=i.indexOf(n),a=e&&e.indexOf("/")>-1?e.split("/"):[e],o=[];if(r<0){var l=window.location.pathname.toLocaleLowerCase(),c=l.indexOf("www"),u=l.indexOf("src"),s=l.indexOf("dist");if(c>-1){var d=t.unit.resolvePathname(l,c+4);o=t.unit.relativeUrl(d,a)}else if(s>-1){var f=t.unit.resolvePathname(l,s+5);o=t.unit.relativeUrl(f,a)}else{if(!(u>-1))return 0==e.indexOf("/")?e.replace("/",""):e;var p=t.unit.resolvePathname(l,u+4);o=t.unit.relativeUrl(p,a)}}else{var h=t.unit.resolvePathname(i,r);o=t.unit.relativeUrl(h,a)}return o.join("/")}}(window.bui||{},window.libs),function(t,n){t.history=function(){var i=[],r={};r.get=function(e,n){if(void 0===e)return i;var r=n||"name"||"pid";return t.array.get(i,e,r)},r.getLast=function(e){var t=i.length-1,n=i[t]||{};return e?n[e]:n},r.getPrev=function(e){var t=i.length-2,n=i[t]||{};return e?n[e]:n},r.getParams=function(e){var t=this.getLast(),n={};switch(e){case"page":n=this.getPageParam()||n;break;case"part":case"component":n=this.getComponentParam()||n;break;case"url":n=t.param||bui.getUrlParams();break;default:n=this.getComponentParam(e)||this.getPageParam(e)||t.param||bui.getUrlParams()}return n},r.setComponent=function(e){return this.getLast().component[e.id]=e,e},r.getComponentParam=function(e){var t=this.getLast(),n=e||t.currentComponent;return n&&t.component[n]&&t.component[n].param||null},r.getComponent=function(e,n){if(void 0===e)return void t.showLog("必须传component id才能获取实例");n=n||"exports";var i=this.getLast();return i.component[e]&&i.component[e][n]||null},r.getParentComponent=function(){var e=this.getComponentParam();return this.getComponent(e.parentId)||this.getLast("exports")},r.getParentParams=function(){var e=this.getComponentParam();return this.getParams(e.parentId)||this.getLast("param")||null},r.getPage=function(e,n){if(void 0===e)return void t.showLog("必须传page id 或者 模块名才能获取实例");n=n||"exports";var i=this.getLast(),r=null,a=i.page;if(a.hasOwnProperty(e))r=a[e]&&a[e][n]||{};else if(e)for(var o=Object.keys(a),l=0;l<o.length;l++){var c=a[o[l]]||{};if(c.name===e)return c[n]}else{var u=i.currentPage;r=a[u]&&a[u][n]||{}}return r},r.getPageDialog=function(e){if(void 0===e)return void t.showLog("必须传page id才能获取对话框信息");var n=this.getLast();return n.page[e]&&n.page[e].dialog||null},r.setPage=function(t){var n=this.getLast();return"object"!==(void 0===t?"undefined":e(t))?t:t&&t.hasOwnProperty("id")?(n.page[t.id]=t,t):void 0},r.getPageParam=function(e){var t=this.getLast(),n=e||t.currentPage;return n&&t.page[n]&&t.page[n].param||null},r.add=function(e){var r=n.extend(!0,{id:"",name:"",url:"",replace:!1,syncHistory:!0,param:{},part:{},page:{},toggle:null,effect:"push"},e),a=i;if(e.toggle){var o=n.extend(!0,{},r,e);r.toggle=null,a.push(o)}else a.push(r);var l=window.location.origin+window.location.pathname+"#"+r.name,c=t.setUrlParams(l,r.param);return r.syncHistory&&"pushState"in window.history&&window.history.pushState(r,null,c),a},r.replace=function(e){var e=n.extend(!0,{id:"",name:"",url:"",replace:!1,syncHistory:!0,param:{},part:{},page:{},toggle:null,effect:"push"},opts),r=i,a=r.length-1,o=window.location.origin+window.location.pathname+"#"+e.name,l=t.setUrlParams(o,e.param);if(a>-1){if(opts.toggle){var c=n.extend(!0,{},e,opts);e.toggle=null,r.splice(a,1,c)}else r.splice(a,1,e);e.syncHistory&&"replaceState"in window.history&&window.history.replaceState(e,null,l)}return r},r.refresh=function(){if(t.hasRouter){var e=r.getLast(),i=loader.get(e.name);loader.import(e.url,function(r){n("#"+e.id).html(r),t.config.init.auto&&t.init(),router.config.needView&&loader.views(),i.loaded(),router.config.needComponent&&loader.components()})}else window.location.reload(!0)},r.removeNext=function(e){var n=i,r=e.index;if(parseInt(r)<0)return t.showLog("index 必须大于或者等于0"),n;var a=n.length-r;n.splice(r,a);var o=this.getLast(),l=window.location.origin+window.location.pathname+"#"+o.name,c=t.setUrlParams(l,o.param);return e.syncHistory&&"replaceState"in window.history&&window.history.replaceState(o.param,null,c),n},r.removeLast=function(e){var t=i,n=t.length-1;return this.removeNext({index:n,syncHistory:!1!==e})},r.check=function(e){var n=i;return t.array.compare(n,e,"name")||t.array.compare(n,e,"url")||t.array.compare(n,e,"id")},r.checkComponent=function(e){var n=this.getLast(),i=Object.keys(n.component);return t.array.compare(i,e)},r.checkPage=function(e,t){t=t||"id";for(var n=this.getLast(),i=Object.keys(n.page),r=0;r<i.length;r++){var a=i[r],o=n.page[a]
;if(o.name===e||o.id===e)return!0}return!1},r.epmty=function(e){return i=[]};var a=function(e){e=e&&e.replace(window.location.origin,"")||window.location.pathname;var n=e.indexOf(".html"),i=e.indexOf("?"),r="",a="",o="",l=null,c=loader.map().modules;if(i>-1){var u=e.substr(i+1);l=t.unit.keyStringToObject(u,!0)}return n>-1?(r=0==e.indexOf("/")?e.substr(1,n-1):e.substr(0,n-1),a=r+".html",o=r+".js"):(r=e,a=c[r]&&c[r].template||"",o=c[r]&&c[r].script||""),{pid:r,name:r,url:a,src:o,param:l}};return function(){var e=a(window.location.href),n=t.guid();document.body.id=n,i.push({id:t.guid(),pid:e.pid,name:e.pid,url:e.url,src:e.src,param:e.param,page:{},component:{}})}(),r}()}(window.bui||{},window.libs),function(t,n){t.router=function(i){function r(e){if(we.store=e.store||null,delete e.store,e=n.extend(!0,{},q,t.config.router,e),q=we.config=e,ye=!0,"pages/main/main.html"===e.indexModule.template&&"pages/main/main.js"===e.indexModule.script||(he=loader.map(e.indexModule)),ne&&"effect"in e&&ge.forEach(function(t,n){t.effect=e.effect}),!e.id)return t.showLog("id 不能为空","bui.router.init"),!1;if($=t.objId(e.id),M=bui.mask({appendTo:$,opacity:0,autoClose:!1}),z=t.loading({display:"block",width:30,height:30,opacity:0}),J=$.children(".bui-router-main"),X=e.width||window&&window.viewport&&window.viewport.width()||document.documentElement.clientWidth||"100%",Y=e.height||window&&window.viewport&&window.viewport.height()||document.documentElement.clientHeight||"100%",!J.length){var i=P(e);$.html(i),J=$.children(".bui-router-main")}return(e.width>0||String(e.width).indexOf("%")>-1)&&J.width(e.width),(e.height>0||String(e.height).indexOf("%")>-1)&&J.height(e.height),Q||l(e),F.call(this,"init",{target:$[0]}),we}function a(e){var e=e||{};return e.width=e.width||q.width,e.height=e.height||q.height,window.viewport=bui.viewport(),X=e.width||window&&window.viewport&&window.viewport.width()||document.documentElement.clientWidth||"100%",Y=e.height||window&&window.viewport&&window.viewport.height()||document.documentElement.clientHeight||"100%",J.css({width:X,height:Y}),F.call(this,"resize",{target:ge[ge.length-1]}),this}function o(){var e=ve.get("hasCache",0);Boolean(e)&&q.reloadCache?fe.load():u(),se=!0}function l(e){return o(),window.addEventListener("beforeunload",function(e){q.reloadCache&&fe.save(),F.call(_,"beforeunload",{target:ge[ge.length-1]})}),e.hash?(window.addEventListener("hashchange",function(e){var n=s(),i=""==n.pid||"undefined"==n.pid?"main":n.pid,r=t.array.index(ge,i,"pid");r>-1?(m({index:-(ge.length-r-1)}),F.call(_,"popstate",{type:"back",prevTarget:ge[r-1],target:ge[r]})):(f({url:i,param:n.param,replace:!0}),F.call(_,"popstate",{type:"load",prevTarget:ge[ge.length-2],target:ge[ge.length-1]}))}),this):(q.syncHistory&&"pushState"in window.history&&window.addEventListener("popstate",function(e){var n=s(),i=""==n.pid?q.indexModule.moduleName:n.pid,r=y(i);t.array.index(ge,i,"pid")>-1?(m({index:r,param:n.param}),F.call(_,"popstate",{type:"back",prevTarget:ge[r-1],target:ge[r]})):(f({url:i,param:n.param}),F.call(_,"popstate",{type:"load",prevTarget:ge[ge.length-2],target:ge[ge.length-1]}))}),this)}function c(e){var t=window.location.href,n=t.indexOf(q.hashPrefix),n=n>-1?n:0,i=n>-1?t.substr(0,n):t;f({url:q.errorPage||i,param:{error:e}}),F.call(we,"error",{target:e,status:404})}function u(e){try{var n=s();if(n.pid){if(n.pid.indexOf("http://")>-1||n.pid.indexOf("https://")>-1)return void f({url:n.pid,param:n.param,iframe:!0});f({url:n.pid,param:n.param})}else f({url:q.indexModule.moduleName,param:n.param||{}})}catch(e){t.showLog(e,"bui.router.loadUrl")}}function s(e){function t(t,n){for(var i=t&&t.substr(n+1),r=i&&i.split("&"),a=0;a<r.length;a++){var o=e?decodeURIComponent(r[a].split("=")[1]):r[a].split("=")[1];s[r[a].split("=")[0]]=o}}var n=window.location.hash||window.location.search,i=window.location.search,r=i&&i.indexOf("?"),e=0!=e,a=n&&n.indexOf("?"),o=a>-1?n&&n.substr(1,a-1):window.location.hash.substr(1),l=o&&o.indexOf(q.pageSuffix),c=l>-1?o.substr(0,l):o,u=l>-1?o:o+q.pageSuffix,s={};return a>-1&&(t(i,r),t(n,a)),{pid:c,url:u,param:s}}function d(e){var i=n.Deferred(),r=function(n,r){return b(n.url,function(i){var a=t.guid(),o=g(n.url),l=o.pid,c=(S({id:a,content:i,pid:l}),[]);fe.add(l,{id:a,pid:l,template:i}),c.push(l),n.style&&"array"===t.typeof(n.style)?n.style.forEach(function(e,t){c.push(e)}):n.style&&"string"===t.typeof(n.style)&&c.push(n.style),n.script&&"array"===t.typeof(n.script)?n.script.forEach(function(e,t){c.push(e)}):n.script&&"string"===t.typeof(n.script)&&c.push(n.script),loader.import(c,function(){F.call(we,"preloadafter",{prevTarget:null,target:null}),r&&r(e)},function(){F.call(we,"preloadafter",{prevTarget:null,target:null}),r&&r(e)})},function(e){t.showLog(n.url+"请求失败"),i.reject(n.url)}),i.promise()};return e&&"object"===t.typeof(e)?"url"in e&&r(e,function(){i.resolve(e)}):e&&"array"===t.typeof(e)&&e.forEach(function(t,n){n==e.length-1?"url"in t&&r(t,function(){i.resolve(e)}):"url"in t&&r(t)}),i}function f(i){function r(n,i,r,a){if(M&&M.hide(),m.progress&&z&&z.hide(),oe.removeLast(),v.reject(n),"object"===(void 0===i?"undefined":e(i)))return t.showLog("找不到页面"+n,"bui.router.load"),q.errorPage&&f(n),!1}function a(e){te||P in ae?(R.exports=ae[P],s({pid:P}),ue&&l(),e&&e(),q.needComponent&&loader.components()):(loader.checkLoad(P)?(s({pid:P}),q.needComponent&&loader.components(),e&&e()):loader.require(P,function(n){try{if(m.firstAnimate&&m.progress&&z&&z.hide(),ae[P]=n||null,R.exports=n,v.resolve(n),G||m.firstAnimate||m.replace){var i=loader.get(P);i&&i.show&&i.show({type:"firstload",target:R})}e&&e(),m.loaded&&m.loaded({prevTarget:y,target:R}),m.callback&&m.callback({prevTarget:y,target:R}),q.needComponent&&loader.components()}catch(e){t.showLog(e,"bui.router.load"),v.reject()}}),F.call(we,"complete",{prevTarget:y,target:R}))}function o(){W=t.objId(D.id);var e=W&&W.find(".bui-page");e&&e.length&&m.autoInit&&t.init({id:e,height:Y})}function l(e){W=t.objId(k),j(),T();try{if(G||te||m.replace||m.part){!m.firstAnimate&&m.progress&&z&&z.hide(),e&&e(),M&&M.hide(),W&&W.css("zIndex",5);var n=oe.getLast(),i="pageshow-"+n.pid;F.call(we,"pageshow",{type:"load",target:oe.getLast()}),F.call(we,i,{type:"load",target:oe.getLast()})}else K&&K.hide(),Z&&Z.show(function(){!m.firstAnimate&&m.progress&&z&&z.hide(),e&&e(),W&&W.css("zIndex",5),M&&M.hide();var t=ge[ge.length-2]||{},n=oe.getLast(),i=loader.get(n.pid),r=t&&t.pid&&loader.get(t.pid)||null,a="pageshow-"+n.pid,o="pagehide-"+t.pid;F.call(we,o,{type:"load",target:ge[ge.length-2]}),F.call(we,a,{type:"load",target:oe.getLast()}),F.call(we,"pagehide",{type:"load",target:ge[ge.length-2]}),F.call(we,"pageshow",{type:"load",target:oe.getLast()}),r&&r.hide&&r.hide({type:"load",target:ge[ge.length-2]}),i&&i.show&&i.show({type:"load",target:oe.getLast()})})}catch(e){t.showLog(e,"bui.router.doAnimate")}}function u(e){var n="";if(we.store&&(e=we.store.compileHtml(e)),m.part)n=N({content:e}),m.id?O.html(n):t.showLog("id 不能为空","router.loadPart");else if(m.replace){var i=oe.getLast();O=ge.length?t.objId(i.id):J,i.pid=P,i.url=C,i.param=w;t.array.index(ge,P,"pid");n=P in le?fe.get(P,"template"):N({content:e}),O.html(n).attr("data-page",P)}else te||(n=S({id:k,content:e,pid:P}),J&&J.attr("data-main",k).append(n));return q.needView&&loader.views({compiled:function(){we.store&&!we.store.config.isPublic&&we.store.config.needCompile&&we.store.compile("#"+k)}}),!we.store||q.needView||we.store.config.isPublic||we.store.config.needCompile&&we.store.compile("#"+k),n}function s(e){var t=e||oe.getLast(),n=me[t.pid]&&me[t.pid]||{},i=n.loaded,r=i&&i.apply(n,n.dependExports)||n.exports;ae[t.pid]=r||null,n.exports=r,te&&F.call(we,"refresh",{prevTarget:y,target:t}),M&&M.hide(),q.progress&&z&&z.hide(),v.resolve(r),te=!1,G=!1}function d(){var e=ge[ge.length-2]||null,t=oe.getLast();G&&!m.part&&(F.call(we,"firstload",{prevTarget:e,target:t}),G=!1),m.part?F.call(we,"loadpart",{prevTarget:e,target:t}):F.call(we,"load",{prevTarget:e,target:t})}function f(e){c(e)}var p={id:"",url:"",param:{},effect:"",command:"html",path:q.path,firstAnimate:q.firstAnimate,progress:q.progress,reload:q.reload,autoInit:q.autoInit,needView:q.needView,needComponent:q.needComponent,replace:!1,iframe:!1,decode:!1,part:!1,cache:q.cache,callback:null,beforeLoad:q.beforeLoad,loaded:q.loaded},m=n.extend(!0,{},p,i),v=n.Deferred(),y=oe.getLast()||null;ge[ge.length-2];m.url.indexOf("./")>-1&&(m.url=h(m.url,y)),m.path&&(m.path="/"==m.path[m.path.length-1]?m.path:m.path+"/"),m.url=m.url in me||m.iframe||m.url.indexOf("http:")>-1?m.url:m.path+m.url,document.activeElement.blur();var w=null,x={};m.id=(m.id&&m.id.indexOf("#")>-1?m.id.substr(1):m.id)||"";var k=m.replace?y.id:m.id||t.guid(),O=t.objId(k);if(!m.url)return t.showLog("url 不能为空","bui.router.load"),v.promise();if(m.url=m.decode?decodeURIComponent(m.url):m.url,m.url.indexOf("tel:")>=0||m.url.indexOf("mailto:")>=0||m.url.indexOf("sms:")>=0)return t.unit.openExtral(m.url),v.promise();if(m.url&&m.url.indexOf("?")>-1){var L=m.url.split("?");x=t.unit.keyStringToObject(L[1]),m.url=L[0]}w=n.extend(!0,{},x,m.param),"undefined"==m.url&&(m.url="main"),m.iframe=Boolean(m.iframe);var I=g(m.url),P=I.pid,C=m.iframe?m.url:I.url,R={id:k,pid:P,name:P,url:"function"==typeof C?m.url:C,replace:m.replace,param:w,component:{},page:{},toggle:null,exports:{},effect:i.effect||q.effect,syncHistory:q.syncHistory};ie=m.part?y:R,M&&M.show(),m.progress&&z&&z.show(),loader.map({moduleName:P,id:k});loader.get(R.pid);if(ge.length&&m.effect){var A=ge.length-1;ge[A].effect=m.effect}!te&&!m.part&&!m.replace&&oe.add(R),m.replace&&oe.replace(R);var D=R,U="function"==typeof m.beforeLoad?m.beforeLoad.call(we,{prevTarget:y,target:R}):m.beforeLoad;if(F.call(we,"loadbefore",{prevTarget:y,target:R}),F.call(we,"beforeload",{prevTarget:y,target:R}),!1===U)return G=!1,this;if(m.part&&(t.history.setComponent({id:k,pid:P,url:C,param:w}),D.currentComponent=k,ge.splice(ge.length-1,1,D)),m.part||(de=R),P in le)!function(e){u(fe.get(e.pid,"template")),e.part?s(e):(o(),!te&&l(function(){e.progress&&z&&z.hide()}),s(e))}({pid:P,progress:m.progress,part:m.part}),F.call(we,"complete",{prevTarget:y,target:R}),m.loaded&&m.loaded({prevTarget:y,target:R}),m.callback&&m.callback({prevTarget:y,target:R}),q.needComponent&&loader.components();else{if(m.iframe)return function(e){var t=E({id:e.id,pid:e.pid,url:e.url,param:e.param});J&&J.attr("data-main",e.id).append(t),l(function(){m.progress&&z&&z.hide()})}({id:k,pid:P,url:m.url,param:w}),v.promise();if(m.part)return function(){b(C,function(e,n,i){t.objId(k)[m.command](e),a(d),m.cache&&fe.add(P,{id:k,pid:P,template:e}),M&&M.hide(),m.progress&&z&&z.hide()},function(e,t,n){r(C,e,t,n),F.call(we,"loadfail",e,t,n)})}(),v.promise();!function(){b(C,function(t,n,i){return"object"===(void 0===t?"undefined":e(t))?(r(C,t,n,i),!1):(u(t),m.cache&&fe.add(P,{id:k,pid:P,template:t}),o(),m.firstAnimate?void l(function(){a(d),m.progress&&z&&z.hide(),pe.add(P,{id:k,pid:P,param:w})}):(l(function(){m.progress&&z&&z.hide()}),a(d),pe.add(P,{id:k,pid:P,param:w}),void 0))},function(e,t,n){r(C,e,t,n),F.call(we,"loadfail",e,t,n)})}()}return v.promise()}function p(e){var t={id:"",url:"",command:"html",param:{},part:!0};return f(n.extend(!0,{},t,e)).promise()}function h(e,t){var n=e,i=t.url.lastIndexOf("/"),r=t.url.substr(0,i);return e.indexOf("../")>-1?(e=e.replace(/\..\//g,function(e){var t=r.lastIndexOf("/");return r=r.substr(0,t),""}),n=r?r+"/"+e:e):e.indexOf("./")>-1&&(n=r+"/"+e.replace(/\.\//g,"")),n}function g(e){var t="",n=e;he=loader.map(),me=he.modules;var i=n.indexOf(q.pageSuffix);return i>-1?(t=n,n=t.substr(0,i),me.hasOwnProperty(n)&&(t=me[n]&&me[n].template||t||"")):(n=n,t=me[n]&&me[n].template||n+q.pageSuffix||""),{pid:n,url:t}}function m(e){var i=this,r={};"function"==typeof e?r.callback=e:r=e||{};var a=n.extend(!0,{index:-1,name:"",beforeBack:q.beforeBack,callback:null,loaded:q.loaded},r),o=parseInt(a.index),l=ge.length;if(he=loader.map(),me=he.modules,o>0)return void t.showLog("index 参数只能是负数","bui.router.back");var c=oe.getLast(),u=l-1,s=c.toggle;if(s)return s.hide(),void j();var d="function"==typeof a.beforeBack?a.beforeBack.call(we,{prevTarget:null,target:c}):r.beforeBack;F.call(we,"beforeback",{prevTarget:null,target:c});var f=loader.get(c.pid);return f&&f.beforeDestroy&&f.beforeDestroy(),!1===d?this:(a.name&&(o=y(a.name)),Math.abs(o)>u&&(o=-u),l>1&&ee&&(o<-1&&T(o),ee=!1,r.effect&&(K.option({effect:r.effect}),Z.option({effect:r.effect})),K&&K.show(),Z&&Z.hide(function(){var e=l+o;I(e),oe.removeNext(e),T();var n=j(),r=n.pid;t.objId(n.id).css("zIndex",5),function(){var e={};e=ae[r]||{};var t=loader.get(n.pid);a.callback&&a.callback.call(i,e,n),a.backed&&a.backed.call(we,{prevTarget:c,target:n}),F.call(we,"back",{prevTarget:c,target:n}),de=n;var o="pageshow-"+n.pid,l="pagehide-"+c.pid;f&&f.hide&&f.hide({type:"back",target:c}),t&&t.show&&t.show({type:"back",target:n}),F.call(we,l,{type:"back",target:c}),F.call(we,o,{type:"back",target:n}),F.call(we,"pageshow",{type:"back",target:n}),F.call(we,"pagehide",{type:"back",target:c}),f&&f.destroyed&&f.destroyed(),ee=!0}()})),this)}function v(e){return"string"==typeof e&&"main"!==e?(loader.destroy(e),fe.del(e),e in ae&&delete ae[e]):t.showLog("参数只能是字符串"),this}function y(e){var n,i=t.array.indexs(ge,e,"pid"),r=i.length;if(r){var a=-(ge.length-i[r-1]-1);n=0==a?-1:a}else n=-1;return n}function b(e,n,i){if("string"==typeof e){var r=null;e.indexOf(".js")>-1&&(r=loader.get(de.pid))&&r.beforeCreate&&r.beforeCreate(),loader.importHtml(e,function(e,t,i){""===e&&F.call(we,"fail",e,t,i),n&&n(e,t,i),F.call(we,"success",e,t,i),r&&r.created&&r.created()},function(e,t,n){i&&i(e,t,n),F.call(we,"fail",e,t,n)})}else if("function"==typeof e){var a=e&&e();n&&n(a,200,{}),F.call(we,"success",a,200,{})}else t.showLog("url 不能为空","bui.router.requestUrl")}function w(){var e=ge.length-1,n=ge[e],i=ge.length>1?ge[ge.length-2]:null;return t.history.refresh(),F.call(we,"refresh",{prevTarget:i,target:n}),this}function x(e){return e=e||{},f({url:e.url||"",param:e.param||{},replace:!0}),this}function k(){return oe.getLast().param}function O(e){return t.history.getComponentParam(e)}function L(e){var t;return e&&(t=e in ae),t}function I(e){J.children().each(function(t,i){t>=e&&n(i).remove()})}function j(){var e=oe.getLast(),n=e.id||"",i=e.effect||q.effect;return n&&(F.call(we,"beforepageshow",{target:e}),Z=null,Z=t.toggle({id:document.getElementById(n),effect:re[i]&&re[i].inRight||""}),J&&J.attr("data-main",n)),e}function T(e){e=e||-1;var n=ge.length+e-1,i=ge[n],r=i&&i.id||"",a=i&&i.effect||q.effect;return r&&(F.call(we,"beforepagehide",{target:i}),K=null,K=t.toggle({id:document.getElementById(r),effect:re[a]&&re[a].inLeft||""})),i}function P(e){e=e||{};var t="";String(X).indexOf("%"),String(Y).indexOf("%");return t+='<div class="bui-router-main">',t+="</div>"}function E(e){var n=e.param?t.setUrlParams(e.url,e.param):e.url,i="",r=t.platform.isIos()?'scrolling="no"':"";return i+='<div id="'+e.id+'" class="bui-router-item bui-router-fixiframe" data-page="'+e.pid+'">',i+='<iframe class="bui-router-iframe" src="'+n+'" '+r+"></iframe>",i+="</div>"}function S(e){var t="";return t+='<div id="'+e.id+'" class="bui-router-item" data-page="'+e.pid+'">',t+=e.content||"",t+="</div>"}function N(e){var t="";return t+=e.content}function C(e,n){return ne=!0,t.option.call(we,e,n)}function R(e,n){return t.on.apply(we,arguments),this}function A(e,n){return t.off.apply(we,arguments),this}function F(e){we.self=this==window||this==we?null:this,t.trigger.apply(we,arguments)}function D(){return oe.getLast()}function U(){var e=oe.getLast();return document.getElementById(e.id)}function H(e){return oe.getLast().id}function V(i){var r=oe.getLast(),a=t.objId(r.id),o="object"===(void 0===i?"undefined":e(i))?n(i):a.find(".bui-page");return o.length&&t.init({id:o,height:Y}),this}var $,z,M,B={id:"",progress:!1,syncHistory:!0,autoInit:!0,firstAnimate:!1,path:"",indexModule:{moduleName:"main",template:"pages/main/main.html",script:"pages/main/main.js"},errorPage:"",hash:!1,cache:!0,reloadCache:!1,reload:!1,needNative:!1,needView:!1,needComponent:!0,useScroll:".bui-scroll-x",beforeBack:null,beforeLoad:null,loaded:null,store:null,width:0,height:0,async:!0,effect:"push",hashPrefix:"#",scriptSuffix:".js",pageSuffix:".html"},q=n.extend({},B,t.config.router,i),W=null,_=this,J=null,K=null,Z=null,Q=!1,X="",Y="",G=!0,ee=!0,te=!1,ne=!1,ie=null,re={none:{inRight:"showIn",inLeft:"showIn"},fadein:{inRight:"fadeIn",inLeft:"fadeIn"},fadeinslide:{inRight:"fadeInRight",inLeft:"fadeInLeft"},slide:{inRight:"slideInRight",inLeft:"slideInLeft"},push:{inRight:"pushInRight",inLeft:"pushInLeft"},zoom:{inRight:"zoomIn",inLeft:"zoomIn"},cover:{inRight:"coverInRight",inLeft:"coverInLeft"},zoomslide:{inRight:"zoomSlideInRight",inLeft:"zoomSlideInLeft"},fadeinslideback:{inRight:"fadeInLeft",inLeft:"fadeInRight"},slideback:{inRight:"slideInLeft",inLeft:"slideInRight"},pushback:{inRight:"pushInLeft",inLeft:"pushInRight"},coverback:{inRight:"coverInLeft",inLeft:"coverInRight"},zoomslideback:{inRight:"zoomSlideInLeft",inLeft:"zoomSlideInRight"}},ae={},oe={},le={},ce={},ue=!1,se=!1,de={},fe={},pe={},he=loader.map(q.indexModule),ge=t.history.epmty(),me=he.modules,ve=t.storage({local:!1}),ye=!1;t.hasRouter=!0,oe.get=function(){return ge},oe.add=function(e){if(e=e||{},e.toggle){var i=n.extend(!0,{},e);e.toggle=null,ge.push(i)}else ge.push(e);var r=window.location.origin+window.location.pathname+"#"+e.pid,a=t.setUrlParams(r,e.param);return G?void(q.syncHistory&&"replaceState"in window.history&&window.history.replaceState(e,null,a)):(q.syncHistory&&"pushState"in window.history&&window.history.pushState(e,null,a),ge)},oe.prepend=function(e){e=e||{};var n=window.location.origin+window.location.pathname+"#"+e.pid;t.setUrlParams(n,e.param);return ge.unshift(e),ge},oe.replace=function(e){e=e||{};var n=ge.length-1,i=window.location.origin+window.location.pathname+"#"+e.pid,r=t.setUrlParams(i,e.param);return n>-1&&(ge.splice(n,1,e),q.syncHistory&&"replaceState"in window.history&&window.history.replaceState(e,null,r)),ge},oe.getLast=function(e){var t=ge.length-1,n=ge[t]||{};return e?n[e]:n},oe.removeNext=function(e){var n=ge.length-e;ge.splice(e,n);var i=oe.getLast(),r=window.location.origin+window.location.pathname+"#"+i.pid,a=t.setUrlParams(r,i.param);q.syncHistory&&"replaceState"in window.history&&window.history.replaceState(i.param,null,a)},oe.removeLast=function(){var e=ge.length-1;oe.removeNext(e)},oe.checkLoad=function(e){return t.array.compare(ge,e,"pid")||t.array.compare(ge,e,"url")||t.array.compare(ge,e,"id")},fe.add=function(e,t){return le[e]=t||{},le[e]},fe.del=function(e){delete le[e]},fe.get=function(e,t){if(t){return(le[e]||{})[t]}return le[e]},fe.save=function(){if(ge.length>1){var e=$.html();ve.set("cacheHtml",e),ve.set("cacheHistory",ge),ve.set("hasCache","true")}},fe.load=function(){var e=ve.get("cacheHtml",0),n=ve.get("cacheHistory",0),i=[];if(n.length>1){$.html(e),J=$.children(".bui-router-main");m({name:s().pid});try{n.forEach(function(e,t){var n="string"==typeof e?JSON.parse(e):e;i.push(n)});var r=i[i.length-1];de=r,loader.require(r.pid,function(e){ae[r.pid]=e||null}),R("back",function(e){loader.require(e.target.pid,function(t){ae[e.target.pid]=t||null})})}catch(e){t.showLog(e)}ge=i,j(),T(),G=!1,ue=!0,fe.clear()}},fe.clear=function(){ve.remove("cacheHistory"),ve.remove("cacheHtml"),ve.remove("hasCache")},pe.add=function(e,t){return ce[e]=t||{},ce[e]},pe.get=function(e,t){if(t){return(ce[e]||{})[t]}return ce[e]};var be=function(e){var n=oe.getLast(),i=document.getElementById(n.id)||document;return t.obj(e,i)},we={init:r,option:C,config:q,data:{},on:R,off:A,trigger:F,load:f,resize:a,destroy:v,loadPart:p,replace:x,refresh:w,back:m,isLoad:L,$:be,currentId:H,currentPage:U,currentModule:D,getPageParams:k,getPartParams:O,getHistory:oe.get,preload:d,initScroll:V,history:{get:oe.get,check:oe.checkLoad,getLast:oe.getLast,add:oe.add,removeLast:oe.removeLast,replace:oe.replace}};return we}}(window.bui||{},window.libs),function(i,r){var a=function(){function a(e){t(this,a),this._default={log:!1,hasLife:!0,onBeforeInit:null,onInited:null},this._plugin=e||{name:"",depend:null,config:null,param:null,callback:null};var n=i.config.hasOwnProperty(this._plugin.name)?i.config[this._plugin.name]:null;this.config=r.extend(!0,{},this._default,n,this._plugin.config,this._plugin.param),this.initStatus=!1,this.reinitStatus=!1,this.widgets=Object.create(null),this.init()}return n(a,[{key:"widget",value:function(e){return e&&e in this.widgets?this.widgets[e]:this.widgets}},{key:"init",value:function(e){var t=this,n=e||null;t.config=r.extend(!0,this.config,n);var i=t.config,a=i.hasLife&&i.onBeforeInit&&i.onBeforeInit.call(t,i);return i.log&&console.log(t._plugin.name+" before init"),!1===a?t:(t._plugin.callback&&t._plugin.callback.call(t,i),i.log&&console.log(t._plugin.name+" init"),i.hasLife&&i.onInited&&i.onInited.call(t,i),i.log&&console.log(t._plugin.name+" after inited"),this.initStatus=!0,t)}},{key:"reinit",value:function(){return this.destroy(),this.init(),this.config.log&&console.log(this._plugin.name+" reinit"),this}},{key:"destroy",value:function(e){return this.beforeDestroy&&this.beforeDestroy(),this.beforeDestroy=null,this.widgets={},this.off(),this.initStatus=!1,e&&e.call(this),this.config.log&&console.log(this._plugin.name+" destroyed"),this}},{key:"prefix",value:function(e){return i.config.classNamePrefix+e}},{key:"showLog",value:function(t,n){n=n||"";var r="";return"object"==(void 0===t?"undefined":e(t))&&"message"in t&&"name"in t?r=t.message+":"+t.name+"&&stack:"+t.stack:"string"==typeof t&&(r=t),i.log&&console.error(n+" "+r),i.trace&&console.trace&&console.trace(),this}},{key:"option",value:function(e,t){if("object"!==i.typeof(e)&&void 0===t)return"string"==typeof e?this.config[e]:this.config;var n=this;if("id"==e)return i.showLog("不允许修改控件的ID参数"),this;if(e&&"object"===i.typeof(e)){var a=r.extend(this.config,e);return n&&n.init(a)}if(this.config.hasOwnProperty(e)){var o={};o[e]=t;var l=r.extend(this.config,o);return n&&n.init(l)}return this}},{key:"emitter",get:function(){return i.emitter()}},{key:"on",get:function(){return this.emitter.on}},{key:"off",get:function(){return this.emitter.off}},{key:"trigger",get:function(){return this.emitter.trigger}}]),a}();i.extend=function(e){var r=function(){function r(e){t(this,r),this.init(e)}return n(r,[{key:"init",value:function(t){var n=t.name;return this.checkName(n)?(i[n]=function(t){return e.param=t,new a(e)},this):this}},{key:"checkName",value:function(e){return e?!i.hasOwnProperty(e)||(console.warn("已有相同名为"+e+"的插件或方法,请重新换个名称注册."),!1):(console.warn("插件名字不能为空"),!1)}}]),r}();new r(e)}}(window.bui||{},window.libs);!function(e,t){t={exports:{}},e(t,t.exports),t.exports}(function(t){!function(n,r){var a;n.extend({name:"page",config:(a={id:"",url:"",param:null,script:"",appendTo:"",className:"bui-dialog-page",effect:"",pageSuffix:".html",height:0,width:0,iframe:!1,openFirst:!0,closeFirst:!1,autoClose:!1,needRemove:!1,useBox:!0,syncHistory:!1,title:"",buttons:null,mask:!1,life:!0,scroll:!1,needView:!1,needComponent:!0,cache:!0,close:!1,autoload:!0,fullscreen:!0},i(a,"effect","fadeInRight"),i(a,"onError",null),i(a,"beforeClose",null),i(a,"closed",null),i(a,"beforeOpen",null),i(a,"opened",null),i(a,"beforeLoad",null),i(a,"loaded",null),a),callback:function(i){function a(e){var t=loader.map().modules[h.module]||{};if(t.hide&&u.life){var i=n.hasRouter?n.history.getLast():{};t.hide({type:"page",target:i})}"function"==typeof e&&e.call(c,t),u.closed&&u.closed.call(c,t)}function o(e,i){var r=n.history.getLast(),a=f[e];if(u.cache&&d)return!u.openFirst&&p.open(),"function"==typeof i&&i.call(c,a.exports),c;if(n.history.setPage({id:p.config.id,name:e,url:u.url,dialog:p,param:u.param}),"function"==typeof a.loaded){var o=a.loaded&&a.loaded.call(t,a.exports);n.history.setPage({id:p.config.id,name:e,url:u.url,dialog:p,exports:o,param:u.param});var l=loader.map().modules[e]||{};return l.show&&u.life&&l.show({type:"page",target:r}),"function"==typeof i&&i.call(c,o),c.compile({id:p.config.id}),u.opened&&u.opened.call(c,o),!u.openFirst&&p.open(),this}loader.require(e,function(t){var a=loader.map().modules[e]||{};n.history.setPage({id:p.config.id,name:e,url:u.url,dialog:p,exports:t,param:u.param}),a.show&&u.life&&a.show({type:"page",target:r}),"function"==typeof i&&i.call(c,t),c.compile({id:p.config.id}),u.opened&&u.opened.call(c,t)}),d=!0}function l(e){var t=loader.map().modules,n={},i=e.indexOf(u.pageSuffix);return i>-1?(n.url=e,n.module=e.substr(0,i)):(n.url=t[e].template,n.module=e),n}var c=this,u=c.config,s="body"==c.appendTo?r:n.obj,d=!1,f=loader.map().modules||{},p=c.widgets.dialog=n.dialog({autoinit:!1,needRemove:i.needRemove}),h=null;c.init=function(t){var i=r.extend(!0,{},c.config,t);if(i.iframe){var o=n.platform.isIos()?'scrolling="no"':"";return i.content='<iframe class="bui-router-iframe" src="'+i.url+'" '+o+" ></iframe>",p.create(i),i.autoload&&p.open(),c}if(i.onClose=function(){n.hasRouter&&i.syncHistory&&bui.back(),a()},h=l(i.url),i.script){var u=i.script.indexOf(".js");h.module=i.script.substr(0,u)}return!1===(i.beforeLoad&&i.beforeLoad.call(c,h))?this:(loader.import(h.url,function(t){if("object"===(void 0===t?"undefined":e(t)))return void(i.onError&&i.onError.call(c,t));i.id?(p.init(i),s(i.id).html(t)):(i.content=t,p.create(i)),i.autoload&&c.open(),i.loaded&&i.loaded.call(c,h)}),c)},c.compile=function(e){var t=r.extend(!0,{id:p.config.id,cacheHtml:!1,cache:!1},e);t.needView&&loader.views(t),t.needComponent&&loader.components(t)},c.toggle=function(e,t){return c.isOpen()?c.close(t):c.open(e),c},c.isOpen=p.isOpen,c.close=function(e){return!1===(i.beforeClose&&u.beforeClose.call(c))?this:(n.hasRouter&&u.syncHistory&&n.history.removeLast(u.syncHistory),u.closeFirst?(p.close(function(){c.trigger("close"),a(e)}),c):(a(e),p.close(),c.trigger("close"),c))},c.remove=function(e){return p.remove(e),c.trigger("remove"),c},c.open=function(e){if(!1===(u.beforeOpen&&u.beforeOpen.call(c)))return this;if(u.iframe)return p.open(e),c;var t={hide:c.close,show:c.open};return n.hasRouter&&u.syncHistory&&n.history.add({id:p.config.id,name:h.module,url:u.url,replace:!1,param:u.param||{},part:{},page:{},effect:"push",toggle:t,syncHistory:u.syncHistory}),loader.map({moduleName:h.module,id:p.config.id}),n.history.getLast().currentPage=p.config.id,u.openFirst?(p.open(function(){c.trigger("open"),o(h.module,e)}),c):(o(h.module,e),c.trigger("open"),c)},c.init(u)}})}(window.bui||{},window.libs)});!function(t,n){t.setUrlParams=function(n,i,r){var r=0!=r,i="object"==(void 0===i?"undefined":e(i))?i:{},a=t.unit.objectToKeyString(i,r);return""==a?n:n+"?"+a},t.getUrlParams=function(e){var e=0!=e,n=window.location.href,i=n.indexOf("?"),r={};if(i>-1){var a=n.substr(i+1);r=t.unit.keyStringToObject(a,e)}return r},t.getUrlParam=function(e){var t=window.location.href,n=new RegExp("(^|&|.)"+e+"=([^&]*)(&|$)","i"),i=t.substr(1).match(n);return null!=i?decodeURIComponent(i[2]):null},t.typeof=function(e){var t=Object.prototype.toString.call(e).slice(8,-1);return t=t.toLowerCase()},t.setting=function(n,i){return"string"==typeof n&&"object"===(void 0===i?"undefined":e(i))?t.config[n]=i:"string"==typeof n&&void 0===i?t.config[n]:t.config}}(window.bui||{},window.libs),function(e,t){e.array={},e.array.index=e.inArray=function(e,t,n){var i,r;e instanceof Array?(i=e||[],r=t):(i=t||[],r=e);for(var a=0;a<i.length;a++){var o=i[a];if((o&&o[n]||o)===r)return parseInt(a)}return-1},e.array.compare=e.compareArray=function(e,t,n){var i,r;e instanceof Array?(i=e||[],r=t):(i=t||[],r=e);for(var a=0;a<i.length;a++){var o=i[a];if((o&&o[n]||o)===r)return!0}return!1},e.array.remove=e.removeArray=function(t,n,i){var r,a;return t instanceof Array?(r=t||[],a=n):(r=n||[],a=t||[]),e.array.delete(r,a,i),r},e.array.filter=e.filterArray=function(t,n,i){var r,a;t instanceof Array?(r=t||[],a=n):(r=n||[],a=t);var o=[];for(var l in r)try{var c=r[l]&&r[l][i]||r[l];new RegExp(a).test(c)&&o.push(r[l])}catch(t){e.showLog(t)}return o},e.array.indexs=e.indexArray=function(e,t,n){var i,r;e instanceof Array?(i=e||[],r=t):(i=t||[],r=e);var a=[];for(var o in i){(i[o]&&i[o][n]||i[o])===r&&a.push(+o)}return a},e.array.excess=e.excessArray=function(e,t,n){var i;e instanceof Array?i=e||[]:i=t||[];var r={},a=[];for(var o in i)try{var l=i[o]&&i[o][n]||i[o];r[l]!==l&&(r[l]=l,a.push(i[o]))}catch(e){}return a},e.array.uniq=function(t,n){for(var i=[],r=0;r<t.length;r++){var a=void 0===n,o=t[r],l=a?o:o[n]||o;e.array.index(i,l,n)<0&&i.push(o)}return i},e.array.copy=e.copyArray=function(t,n,i){var r=[];if(n=n||0,i=i||t&&t.length,!t||"array"===e.typeof(t)){t.forEach(function(e,t){r.push(e)});return r.splice(n,i)||[]}},e.array.empty=function(t){if(!t||"array"===e.typeof(t))return t.splice(0,t.length)},e.array.replace=function(t,n){if(!(t&&"array"!==e.typeof(t)||n&&"array"!==e.typeof(n))){var i=[0,t.length].concat(n);return t.splice.apply(t,i)}},e.array.merge=function(t){var n;if(!t||"array"===e.typeof(t)){var i=arguments,a=i.length-1,o=i[a];if("string"==typeof o&&i.length>1){for(var l,c=a,u=[],s=0;s<c;s++)!function(e){var n=Array.prototype.slice.call(i[e],0);t.forEach(function(e,t){var i=e[o]||e;n instanceof Array&&n.forEach(function(t,r){var a=t[o]||t;if(i===a){for(var l in t)e[l]=t[l];n.splice(r,1)}})}),u.push(n)}(s);return(l=e.array).merge.apply(l,[t].concat(u))}var d=(n=[t.length,0]).concat.apply(n,r(Array.prototype.slice.call(arguments,1)));return t.splice.apply(t,d),t}},e.array.get=function(t,n,i){if(!t||"array"===e.typeof(t)){for(var r,a=null,o=0;o<t.length;o++){a=t[o];(a&&a[i]||a)===n&&(r=a)}return r}},e.array.getAll=function(e,t,n){var e=e||[],i=[],r=null;for(var a in e)try{r=e[a];var o=r&&r[n]||r;t&&t instanceof Array?t.forEach(function(e,t){o===e&&i.push(r)}):o===t&&i.push(r)}catch(e){}return i},e.array.set=function(t,n,i,r){if(!t||"array"===e.typeof(t)){for(var a=/\d/.test(n),o=0;o<t.length;o++){var l=t[o],c=void 0===r?l:l[r]||l;if(a?o===n:c===n){if(r){if(i&&"object"===e.typeof(i))for(var u in i)l[u]=i[u];else l[r]=i;t.splice(o,1,l)}else t.splice(o,1,i);return t}}return t}},e.array.setAll=function(t,n,i,r){if(!t||"array"===e.typeof(t))return t.filter(function(a,o){var l=void 0===r?a:a[r]||a;if(o==n||l===n)if(r){if(i&&"object"===e.typeof(i))for(var c in i)a[c]=i[c];else a[r]=i;t.splice(o,1,a)}else t.splice(o,1,i)}),t},e.array.delete=function(t,n,i){function r(e){for(var n=0,r=0;r<o.length;r++){var l=r-n,c=t.length!==o.length,u=c?t[l]||{}:t[r]||{};(void 0!==i?u[i]||u:u)===e&&(c?t.splice(l,1):t.splice(r,1),a.push(r),++n)}}if(!t||"array"===e.typeof(t)){var a=[],o=e.array.copy(t);return n&&"array"===e.typeof(n)?n.forEach(function(e,t){r(void 0!==i?e[i]||e:e)}):r(n),a}},e.array.deleteIndex=function(t,n){if(!t||"array"===e.typeof(t)){var i=[];return n&&"array"===e.typeof(n)?n.forEach(function(n,r){i.push(t[n]),e.array.remove(t,t[n])}):(i.push(t[n]),e.array.remove(t,t[n])),i}}}(window.bui||{},window.libs),function(t,n){t.storage=function(n){function i(e,n,i){e=s+e;var r=1==c?null:h.getItem(e),a=[],o="",l=i?n[i]:n;if(null===r){a.push(n),o=JSON.stringify(a);try{h.setItem(e,o)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}else{var u=JSON.parse(r);if(i?t.array.compare(u,l,i):t.array.compare(u,l)){t.array.remove(u,l,i),u[p](n);try{o=JSON.stringify(u),h.setItem(e,o)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}else{u[p](n),u.length>c&&0!=c&&u.pop();try{o=JSON.stringify(u),h.setItem(e,o)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}}return this}function r(e,n,i){e=s+e;var r,a=h.getItem(e)||"";try{r=d?a&&t.unit.stringToJson(a):a&&JSON.parse(a)}catch(e){r=a,t.showLog(e.name+": "+e.message,"bui.storage.get")}if("number"==typeof n&&i)r=r&&r[n]&&r[n][i]||void 0;else if("string"==typeof n){var o=t.array.index(r,n,i);r=r&&r[o]}else r="number"==typeof n?r&&r[n]||void 0:r;return r}function a(e,n,i){
if("string"!=typeof(e=s+e))return void t.showLog("要删除的字段名只能是字符串","bui.storage.remove");var a=r(e)||[];if("number"==typeof n){var o="number"==typeof i?i:o;a.splice(n,o);try{var l=JSON.stringify(a)||"";h.setItem(e,l)}catch(e){t.showLog(e.name+": "+e.message,"bui.storage.remove")}}else if("string"==typeof n){var c=t.array.remove(a,n,i);try{var l=JSON.stringify(c)||"";h.setItem(e,l)}catch(e){t.showLog(e.name+": "+e.message,"bui.storage.remove")}}else h.removeItem(e);return this}function o(){if(s)for(var e=0;e<localStorage.length;e++){var t=localStorage.key(e);0===t.indexOf(s)&&h.removeItem(t)}else h.clear();return this}function l(e){for(var t={},n=parseInt(e)||0,i=0;i<localStorage.length;i++){var r=localStorage.key(i);r.substr(s.length);if(s&&0===r.indexOf(s))try{var a=JSON.parse(h.getItem(r));t[r]=void 0!==e?a[n]:a}catch(e){t[r]=h.getItem(r)}if(""===s)try{t[r]=JSON.parse(h.getItem(r))}catch(e){t[r]=h.getItem(r)}}return t}var c=1,u=!0,s="",d=!1,f=!0;"number"==typeof n||"string"==typeof n?c=0==parseInt(n)?0:parseInt(n)||1:"object"===(void 0===n?"undefined":e(n))&&(c=n&&0==n.size?0:n.size||1,f=!n||0!=n.local,u=!n||0!=n.reverse,d=!(!n||1!=n.deep),s=n.prefix||"");var p=u?"push":"unshift",h=f?localStorage:sessionStorage;return{get:r,getAll:l,set:i,remove:a,clear:o}}}(window.bui||{},window.libs),function(e,t){e.platform=function(){function e(e){return/Windows NT/i.test(u)}function t(){return/Macintosh/i.test(u)}function n(e){return/(Android|Linux)/i.test(u)}function i(e){return/(iPhone)/i.test(u)}function r(e){var t=!1;return 3==window.devicePixelRatio&&375==document.documentElement.clientWidth&&812==document.documentElement.clientHeight&&(t=!0),t}function a(e){return/(iPad)/i.test(u)}function o(e){return/(iPhone|iPad|iOS)/i.test(u)}function l(e){return/(micromessenger)/i.test(u)}function c(e){return/(crosswalk)/i.test(u)}var u=navigator.userAgent;return{isAndroid:n,isIphone:i,isIpad:a,isIos:o,isWeiXin:l,isBingotouch:c,isMac:t,isIphoneX:r,isWindow:e}}()}(window.bui||{},window.libs),function(e,t){e.date={},e.date.format=function(e,t){if(null==e)return"";var n=this.convert(e);t=t||"yyyy-MM-dd";var i={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in i)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return t},e.date.convert=function(e){return e&&e.constructor==Date?e:e&&"string"==typeof e?(e=e.replace(/[-|年|月|日|号]/gim,"/").replace(/[时|分|秒|小时|分钟]/gim,":").replace(/^(\d{4}\/\d+?)($|\s)/,function(e,t){return t+"/1"}).replace(/^(\d{1,2}\/\d{1,2}?)($|\s)/,function(e,t){return(new Date).getFullYear()+"/"+t}),new Date(e)):"number"==typeof e?new Date(e):new Date},e.date.after=function(e,t,n){var t=t||1,i=this.convert(e),r=i.getTime(),a=1e3*t*3600*24,o=r+a;return this.format(o,n||"yyyy-MM-dd")},e.date.afterTime=function(e,t,n){var i=t||30,r=this.format(new Date,"yyyy/MM/dd")+" "+e,a=new Date(r),o=a.getTime(),l=1e3*i*60,c=o+l;return this.format(c,n||"hh:mm")},e.date.count=function(t,n,i){var r,a;switch(i){case"number":r=t,a=n;break;case"hour":var o=this.format(new Date,"yyyy/MM/dd"),l=o+" "+t,c=this.convert(l),u=o+" "+n,s=this.convert(u);r=c.getTime(),a=s.getTime();break;case"date":default:r=this.convert(t).getTime(),a=this.convert(n).getTime()}var d=r-a;d=Math.abs(d);var f=parseInt(d/1e3/3600/24,10),p=parseInt(d/1e3/3600%24,10),h=parseInt(d/1e3/60%60,10),g=parseInt(d/1e3%60,10);return{value:d,day:f,hour:p,minute:h,second:g,tip:f+"天 "+e.unit.fixZero(p)+":"+e.unit.fixZero(h)+":"+e.unit.fixZero(g)}},e.date.toWeek=function(e,t){var n=this.convert(e),i=null;switch(t){case 1:i=["周日","周一","周二","周三","周四","周五","周六"];break;default:i=t||["星期天","星期一","星期二","星期三","星期四","星期五","星期六"]}return i[n.getDay()]}}(window.bui||{},window.libs),function(t,n){t.ajax=function(i){function r(e){var t=function(t,n,i){var r=null;if("string"==typeof t&&"json"==e.dataType)try{r=JSON.parse(t)}catch(e){r=t}else r=t||{};r=e.transformResponse?e.transformResponse.call(a,r)||r:r,u&&u(r,n,i),a.resolve(r,n,i)},i=function(t,n,i){var r;if("string"==typeof t&&"json"==e.dataType)try{r=JSON.parse(t)}catch(e){r=t}else r=t||{};s&&s(r,n,i),a.reject(r,n,i)};e.success=t,e.error=i;var r=e.type&&e.type.toUpperCase();e.type=r||e.method.toUpperCase(),o=n.ajax(e)}var a=n.Deferred(),o=null,l={baseUrl:"",data:{},method:"GET",dataType:"json",timeout:6e4,headers:{},processData:!0,mimeType:"none",cache:!0,async:!0,needJsonString:!1,contentType:null,localData:null,transformRequest:null,transformResponse:null,native:!0,needNative:!1},c=n.extend(!0,{},l,t.config.ajax,i),u=c.success,s=c.fail||c.error;null===c.contentType&&"GET"==c.method?c.contentType="text/html;charset=UTF-8":null===c.contentType&&"POST"==c.method?c.contentType="application/x-www-form-urlencoded":c.contentType=c.contentType;"object"===(void 0===i?"undefined":e(i))&&void 0!==i.needNative?i.needNative:t.isWebapp;if(c.needJsonString)try{c.data="object"===e(c.data)?JSON.stringify(c.data):c.data}catch(e){c.data=c.data}if(c.data=c.transformRequest?c.transformRequest.call(a,c.data)||c.data:c.data,!c.url)return t.showLog("url不能为空","bui.ajax"),a;if(c.url.indexOf("://")>-1?c.url=c.url:c.url.indexOf("./")>-1||c.url.indexOf("../")>-1?c.url=bui.unit.resolvePath(c.url):c.url=c.baseUrl+c.url,c.proxy){var d=c.url.indexOf(c.proxy),f=d>-1?d+1:-1;c.url=c.url.substr(f)}if(a.abort=function(){o&&o.abort()},c.localData)return c.localData=c.transformResponse?c.transformResponse.call(a,c.localData)||c.localData:c.localData,u&&u(c.localData,200),a.resolve(c.localData,200),a;if(c.needNative){if(void 0===t.native.ajax)return r(c),a;try{a=t.native.ajax&&t.native.ajax(c)||a}catch(e){}}else r(c);return a},t.get=function(e,i,r){var a={};a.method="GET",a.url=e,a.data=i||{};var o=null,l=r&&r[0];return o=r&&"array"===t.typeof(r)&&"object"==t.typeof(l)?n.extend(!0,{},t.config.get,a,l):a,bui.ajax(o)},t.post=function(i,r,a){var o={};o.method="POST",o.contentType="application/x-www-form-urlencoded",o.url=i,o.data=r||{};var l=null,c=a&&a[0];return l=a&&"array"===t.typeof(a)&&"object"==t.typeof(c)?n.extend(!0,{},t.config.post,o,c):o,l.contentType.indexOf("application/json")>-1&&(l.data="object"===e(l.data)?JSON.stringify(l.data):l.data),bui.ajax(l)},t.put=function(i,r,a){var o={};o.method="PUT",o.contentType="application/json",o.url=i,o.data=r||{};var l=null,c=a&&a[0];return l=a&&"array"===t.typeof(a)&&"object"==t.typeof(c)?n.extend(!0,{},t.config.put,o,c):o,l.contentType.indexOf("application/json")>-1&&(l.data="object"===e(l.data)?JSON.stringify(l.data):l.data),bui.ajax(l)},t.delete=function(i,r,a){var o={};o.method="DELETE",o.contentType="application/json",o.url=i,o.data=r||{};var l=null,c=a&&a[0];return l=a&&"array"===t.typeof(a)&&"object"==t.typeof(c)?n.extend(!0,{},t.config.delete,o,c):o,l.contentType.indexOf("application/json")>-1&&(l.data="object"===e(l.data)?JSON.stringify(l.data):l.data),bui.ajax(l)},t.all=function(e){var i=null;return i=e&&"array"===t.typeof(e)?e:Array.prototype.slice.apply(arguments),n.when.apply(null,i)}}(window.bui||{},window.libs),function(e,t){e.load=function(n){var i,r={url:"",param:{},reload:!1,replace:!1,native:!0,needNative:!1},a=t.extend(!0,{},r,e.config.load,n),o={},l=a.url;if(!a.url)return void e.showLog("url 不能为空!","bui.load:web");if(document.activeElement.blur(),l.indexOf("tel:")>=0||l.indexOf("mailto:")>=0||l.indexOf("sms:")>=0)return void e.unit.openExtral(l);if(l&&l.indexOf("?")>-1){var c=l.split("?");o=e.unit.keyStringToObject(c[1]),a.url=c[0]}try{var u="string"==typeof a.param&&JSON.parse(a.param)||a.param||{};a.param=t.extend(!0,{},o,u)}catch(t){return void e.showLog("param 参数值必须是一个{}对象","bui.load:web")}if(n&&n.needNative)return void(e.native.load&&e.native.load(a));if(i=e.setUrlParams(a.url,a.param),a.reload&&e.isWebapp)return void(window.location.href=i);if(a.reload&&!e.isWebapp)return void(e.native.load&&e.native.load(a));if(a.replace&&!("load"in window.router))return void window.location.replace(i);if("load"in window.router)window.router.load(a);else if(a.native&&e.isWebapp||!a.native&&!e.isWebapp)window.location.href=i;else{if(void 0===e.native.load)return void(window.location.href=i);e.native.load&&e.native.load(a)}}}(window.bui||{},window.libs),function(t,n){t.getPageParams=function(i){var r=n.Deferred(),a={callback:null,native:!0,needNative:!1};i=i||{};var o=n.extend(!0,{},a,t.config.getPageParams);"function"==typeof i?o.callback=i:i&&"object"===t.typeof(i)&&(o=n.extend(!0,{},a,t.config.getPageParams,i));"object"===(void 0===i?"undefined":e(i))&&void 0!==i.needNative?i.needNative:t.isWebapp;if(i&&i.needNative)return r=t.native.getPageParams&&t.native.getPageParams(o)||r;if("getPageParams"in window.router){var l=window.router.getPageParams&&window.router.getPageParams()||t.getUrlParams();o.callback&&o.callback(l),r.resolve(l)}else if(o.native&&t.isWebapp||!o.native&&!t.isWebapp){var c=t.getUrlParams();o.callback&&o.callback(c),r.resolve(c)}else{if(void 0===t.native.getPageParams){var c=t.getUrlParams();return o.callback&&o.callback(c),r.resolve(c),r}r=t.native.getPageParams&&t.native.getPageParams(o)||r}return r}}(window.bui||{},window.libs),function(t,n){t.back=function(i){function r(){var e=t.hasRouter&&t.history.getPrev()||{},n=e.exports||{};window.history.go(a.index),f&&clearTimeout(f),a.delay&&a.callback?f=setTimeout(function(){t.hasRouter?a.callback.call(router,n):a.callback.call(t,{})},500):a.callback&&a.callback()}var a,o={index:-1,name:"",delay:!0,native:!0,beforeBack:!0,callback:null};"function"==typeof i?(o.callback=i,a=n.extend(!0,{},o,t.config.back)):a=i&&"object"===t.typeof(i)?n.extend(!0,{},o,t.config.back,i):n.extend(!0,{},o,t.config.back);var l=("object"===(void 0===i?"undefined":e(i))&&void 0!==i.needNative?i.needNative:t.isWebapp,t.hasRouter?router.history&&router.history.getLast()||null:null);if(!1!==("function"==typeof a.beforeBack?a.beforeBack.call(this,{prevTarget:null,target:l}):a.beforeBack)){if(i&&i.needNative)return void(t.native.back&&t.native.back(a));if("back"in window.router)if(window.router.config.syncHistory){var c=t.history.get(),u=c.length-1;if(a.name){var s=t.array.indexs(c,a.name,"name"),d=s.length;a.index=d?-(c.length-s[d-1]-1):-1}if(Math.abs(a.index)>=c.length&&(a.index=-u),Math.abs(a.index)>=window.history.length&&window.router.config.hash&&(a.index=window.router.config.reloadCache?-u:-(window.history.length-1)),0==a.index&&(a.index=-1),window.router.config.hash&&!window.router.config.reloadCache)return void r();c.length>1&&r()}else window.router.back&&window.router.back(a);else if(a.native&&t.isWebapp||!a.native&&!t.isWebapp)r();else{if(void 0===t.native.back)return void r();t.native.back&&t.native.back(a)}var f=null}}}(window.bui||{},window.libs),function(e,t){e.refresh=e.history.refresh}(window.bui||{},window.libs),function(t,n){t.run=function(i){var r={},a={id:"",name:"",data:null,onFail:null,native:!0,needNative:!0};"string"==typeof i?r.id=i:i&&"object"===t.typeof(i)&&(r=n.extend(!0,{},a,t.config.run,i));var o=String(r.id);"object"===(void 0===i?"undefined":e(i))&&void 0!==i.needNative?i.needNative:t.isWebapp;if(i.needNative)t.native.run&&t.native.run(r);else if(o.indexOf("http://")>-1||o.indexOf("https://")>-1){var l=t.setUrlParams(r.id,r.data);if(t.platform.isIos())return void(window.location.href=l);var c=window.open("","_blank")||window.open("","_newtab");c.location.href=l}}}(window.bui||{},window.libs),function(t,n){t.fileselect=function(i){function r(e){var i=n.extend(!0,O,e);switch(O.appendTo=i.appendTo||(t.hasRouter?router.currentPage()||"body":"body"),i.mediaType){case"allmedeia":S="*";break;case"picture":case"image":S="image/*";break;case"video":S="video/*";break;case"audio":S="audio/*";break;default:S=i.mediaType}return P=[],C=new Image,R=new FileReader,A=document.createElement("canvas"),F=A.getContext("2d"),E?(f(),N||a(i)):x=t.native.fileselect&&t.native.fileselect.call(this,e,{module:I})||{},this}function a(e){return w.on("change",function(e){var n=this.files;if(!(n.length<1)){n.length>1&&t.showLog("一次只能选一张图片","bui.fileselect:web");var i=n[0];j=i;var r={name:i.name,data:i,type:i.type,size:i.size};if(P.push(r),T.needCompress){T.data=i,T.mimeType=T.mimeType?T.mimeType:i.type;o(T)}else T.onSuccess&&T.onSuccess.call(L,i,P);this.value=""}}),N=!0,this}function o(i){var r=n.extend(!0,{destinationType:"file",data:null,mimeType:"",quality:.8,width:800,height:800,needCompress:!0,needChangeData:!1,onSuccess:null,onFail:null},O,i);C.onload=function(){var e=this.width,n=this.height,i=null,a=r.width,o=r.height,c=e,u=n;r.needCompress&&(e>a||n>o)&&(e/n>a/o?(c=a,u=Math.round(a*(n/e))):(u=o,c=Math.round(o*(e/n)))),A.width=c,A.height=u,F.clearRect(0,0,c,u),F.drawImage(C,0,0,c,u);var f=A.toDataURL(r.mimeType||r.data&&r.data.type||"image/jpeg",r.quality),p=l(r.data.name)||"";switch(r.destinationType){case"file":i=s(f,p);break;case"blob":i=d(f);break;case"data":i=f}if(r.needChangeData){j=i;var h=t.array.index(P,r.data.name,"name");h>-1&&(P[h].data=i,i.size&&(P[h].size=i.size),i.type&&(P[h].type=i.type))}return r.onSuccess&&r.onSuccess.call(L,i,P),i},C.onerror=function(){r.onFail&&r.onFail.call(L,C.src)},R.onload=function(e){C.src=e.target.result};try{var a=r.data&&r.data.type||"";a="object"===(void 0===a?"undefined":e(a))?a.type||"":a||"",r.data&&0==a.indexOf("image")&&R.readAsDataURL(i.data)}catch(e){t.showLog(e)}}function l(e){return e.indexOf(".png")>-1||e.indexOf(".jpg")>-1||e.indexOf(".gif")>-1||e.indexOf(".jpeg")>-1?e.substr(0,e.lastIndexOf(".")):e}function c(e){j=null;var i=n.extend(!0,{needChangeData:!0,needCompress:!1,name:"resize.jpg"},O,e);return T=i,T.mimeType=e.mimeType?e.mimeType:"",E?(e.from?"picture"===e.from||"photo"===e.from||"savephoto"===e.from?w.removeAttr("capture"):w.attr("capture",e.from):w.removeAttr("capture"),t.platform.isIos()&&"function"==typeof FastClick?w[0].dispatchEvent(new Event("click")):w.trigger("click")):x.add(i),this}function u(e){var i=n.extend(!0,{needCompress:!1,destinationType:"data",mimeType:"",needChangeData:!1},e);if(i.data=i.data||j,i.mimeType=e.mimeType?e.mimeType:i.data&&i.data.type||"image/jpeg",E)try{o(i)}catch(e){t.showLog(e)}else x.toBase64(i);return this}function s(e,n){try{n=n||"file";for(var i=e.split(","),r=i[0].match(/:(.*?);/)||[],a=r[1]||"image/jpeg",o=a.split("/")[1],l=atob(i[1]),c=l.length,u=new Uint8Array(c);c--;)u[c]=l.charCodeAt(c);return new File([u],n+"."+o,{type:a})}catch(e){t.showLog(e)}}function d(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],i=atob(t[1]),r=i.length,a=new Uint8Array(r);r--;)a[r]=i.charCodeAt(r);return new Blob([a],{type:n})}function f(){if(void 0==w){b=bui.guid();var e=O.from?'capture="'+O.from+'"':"",t='<input type="file" accept="'+S+'" name="uploadFiles" id="'+b+'" '+e+' style="display:none"/>';n(O.appendTo).append(t),w=n("#"+b)||n('input[name="uploadFiles"]')}}function p(e,n){var n=n||"name";if(!E)return P=x.remove(e,n);if("string"==typeof e){P.length&&t.array.remove(P,e,n);var i=P.length?P[P.length-1].data:null;return j=i,w[0].value="",P}return this}function h(){return P=[],j=null,E?w[0].value="":x.clear(),P}function g(){return P=E?P:x.data()}function m(){return j=E?j:x.value()}function v(){return E?P[P.length-1].name:x.value().name}function y(){return E?P.length-1:x.data().length-1}var b,w,x,k={native:!0,needNative:!1,needCompress:!1,appendTo:"",quality:.8,from:"camera",width:800,height:800,duration:10,onSuccess:null,onFail:null,mediaType:"picture"},O=n.extend(!0,{},k,t.config.fileselect,i),L=this,I={add:c,remove:p,clear:h,value:m,data:g,toFile:s,toBase64:u,resize:o,toBlob:d,currentIndex:y,currentName:v,init:r},j=null,T=null,P=[],E="object"===(void 0===i?"undefined":e(i))&&void 0!==i.needNative?!i.needNative:t.isWebapp,S="*",N=!1,C=null,R=null,A=null,F=null;return r(O),I}}(bui||{},libs),function(t,n){t.file=function(i){function r(e){return b=t.fileselect(e),m=a(e),!e.needNative&&(v=o({root:!0,create:!0})),this}function a(e){function i(e){var t="";try{switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:t="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:t="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:t="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:t="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:t="INVALID_STATE_ERR";break;default:t="Unknown Error"}}catch(e){}var n={msg:t};r.reject(n)}var r=n.Deferred();return e.needNative?w=t.native.file&&t.native.file(e,{fileselect:b,module:O})||{}:(h="bui.app",g=window,y=1024*parseInt(L.size)*1024,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,navigator.webkitPersistentStorage&&navigator.webkitPersistentStorage.requestQuota(y,function(e){window.requestFileSystem(window.PERSISTENT,e,function(e){r.resolve(e)},i)})),r}function o(e){var t={folderName:h,root:!1,create:!1,msg:"",param:{create:!1,exclusive:!1},onSuccess:null,onFail:null},i=n.extend({},t,e),r="";if(i.create?(r="创建 ",i.param.create=!0):(r="获取 ",i.param.create=!1),L.needNative)w.getFolder(i);else{var a=l(i.folderName);a=i.root?a:h+"/"+a,m.done(function(e){e.root.getDirectory(a,i.param,function(t){i.onSuccess&&i.onSuccess.call(O,t,e)},function(e){var t={msg:r+a+" 文件夹失败"};i.onFail&&i.onFail.call(O,t)})}).fail(function(e){var t={msg:"文件系统还没准备好."};i.onFail&&i.onFail.call(O,t)})}return this}function l(e){var t;return"."==e[0]||"/"==e[0]||" "==e[0]?(t=e.slice(1),l(t)):"."!=e[0]&&"/"!=e[0]&&" "!=e[0]?e:void 0}function c(e){return e&&e.indexOf("/")>-1?e.slice(e.lastIndexOf("/")+1,e.indexOf("?")>-1?e.indexOf("?"):void 0):e}function u(e){var t={fileName:"",folderName:"",root:!1,create:!1,param:{create:!1,exclusive:!1},onSuccess:null,onFail:null},i=n.extend({},t,e),r="";if(i.create?(r="创建 ",i.param.create=!0):(r="获取 ",i.param.create=!1),!i.fileName||i.fileName.indexOf(".")<0)return void(i.onFail&&i.onFail());if(L.needNative)w.getFile(i);else{var a=c(i.fileName);o({root:i.root,folderName:i.folderName,create:!0,onSuccess:function(e,t){var n=e.name==h?e.name+"/"+a:h+"/"+e.name+"/"+a;t.root.getFile(n,i.param,function(e){x=e,i.onSuccess&&i.onSuccess.call(O,e,t)},function(e){var t={msg:r+a+" 文件失败"};i.onFail&&i.onFail.call(O,t)})},onFail:function(e){i.onFail&&i.onFail(e)}})}return this}function s(e){var t=n.extend(!0,{},e);return L.needNative?w.removeFolder(t):o({root:t.root,folderName:t.folderName,create:t.create,onSuccess:function(e,n){e.removeRecursively(function(){t.onSuccess&&t.onSuccess.call(O,e,n)},function(n){var i={msg:"删除 "+t.folderName+" 文件失败"};t.onFail&&t.onFail.call(O,i,e)})},onFail:function(e){var n={msg:"删除 "+t.folderName+" 文件失败"};t.onFail&&t.onFail.call(O,n)}}),this}function d(e){var t=n.extend(!0,{},e);return L.needNative?w.removeFile(t):u({root:t.root,create:t.create,folderName:t.folderName,fileName:t.fileName,onSuccess:function(e,n){e.remove(function(){t.onSuccess&&t.onSuccess.call(O,e,n)},function(n){var i={msg:"删除 "+t.fileName+" 文件失败"};t.onFail&&t.onFail.call(O,i,e)})},onFail:function(e){var n={msg:"删除 "+t.fileName+" 文件失败"};t.onFail&&t.onFail.call(O,n)}}),this}function f(e){var n=e||{};if(n.url)return L.needNative?w.open(n):t.showLog("web暂不支持open方法","bui.file.open:web"),this}function p(e){return b.toBase64(e),this}var h,g,m,v,y,b,w,x,k={size:10,native:!0,needNative:!1},O={getFolder:o,removeFolder:s,getFile:u,getFileName:c,removeFile:d,toBase64:p,open:f,init:r},L=O.config=n.extend(!0,{},k,t.config.file,i);"object"===(void 0===i?"undefined":e(i))&&void 0!==i.needNative?i.needNative:t.isWebapp;return r(L),O}}(window.bui||{},window.libs),function(t,n){t.upload=function(i){function r(e){return x=t.loading({display:"block",width:30,height:30,opacity:0,autoClose:e.autoClose,callback:e.onMask}),k=t.fileselect.call(N,{native:e.native,needNative:e.needNative,from:e.from,mediaType:e.mediaType}),e&&e.needNative&&(L=t.native.upload&&t.native.upload(e,{loading:x,fileselect:k,module:N})||{}),e.data?(d(e),this):this}function a(e){return k.resize(e),this}function o(e){return e.onSuccess=e.onSuccess?e.onSuccess.bind(N):null,e.onFail=e.onFail?e.onFail.bind(N):null,k.add(e),this}function l(e,t){var n=s(),i=n.length;return i<1?this:(/\d/.test(e)&&e.indexOf(".")<0?k.remove(n[e].name,t):"string"==typeof e?k.remove(e,t):k.remove(n[i-1].name,t),this)}function c(){return k.clear(),this}function u(e){return k.toBase64(e),this}function s(){return k.data()}function d(e){var t=n.extend(!0,{},E,e);if(j=t.url,I=k.value(),C=t.showProgress,I){if(C&&x.show(),t&&t.needNative)return L.start(t)||S;var i=t.data,r=new FormData;r.append(t.fileKey,I);for(var a in i)t.fileKey===a&&r.delete(a),r.append(a,i[a]);return t.data=r,h(t)}}function f(e){var t=n.extend(!0,{needFileinfo:!1},E,e),i=t[t.fileKey]||k.data();return null===t.data&&(t.data={}),i.forEach(function(e,n){!function(e){if(t.data[t.fileKey]=i[e].data,t.needFileinfo)for(var n in i[e])"data"!==n&&(t.data[n]=i[e][n]);d(t)}(n)}),S}function p(e){return E&&E.needNative?L.stop(e):(x&&x.stop(),O&&O.abort(),e&&e.call(N,x,O)),this}function h(e){var t=e.onSuccess,i=e.onFail;return O=n.ajax({url:j,type:e.method,data:e.data,cache:e.cache,headers:e.headers,dataType:e.dataType,contentType:e.contentType,processData:e.processData,timeout:e.timeout,xhr:function(){var e=n.ajaxSettings.xhr();if(g&&e.upload)return e.upload.addEventListener("progress",g,!1),e},success:function(e){v(),t&&t.call(N,e),S.resolve(e)},error:function(e,t,n){v(),i&&i.call(N,e,t),S.reject(e,t,n)}}),S}function g(e){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,window.requestAnimationFrame(function(){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);T=t.toString()+"%",t<100?m(T):v(),R&&R.call(N,T)}})}function m(e){return C&&x&&x.show({text:e}),this}function v(){return x&&x.stop(),this}function y(){return k.currentName()}function b(){return k.currentIndex()}function w(e){var n={loading:x,fileselect:k,ajax:O};return t.widget.call(n,e)}var x,k,O,L,I,j,T,P={url:"",data:null,headers:{},showProgress:!0,timeout:6e4,contentType:!1,processData:!1,autoClose:!0,native:!0,needNative:!1,method:"POST",fileKey:"file",dataType:"json",mediaType:"picture",from:"picture",onProgress:null,onMask:function(){p()},onSuccess:null,onFail:null},E=n.extend(!0,{},P,t.config.upload,i),S=n.Deferred(),N={init:r,add:o,remove:l,resize:a,currentIndex:b,currentName:y,clear:c,data:s,start:d,startAll:f,stop:p,toBase64:u,widget:w},C=E.showProgress,R=E.onProgress;"object"===(void 0===i?"undefined":e(i))&&void 0!==i.needNative?i.needNative:t.isWebapp;return r(E),N}}(window.bui||{},window.libs),function(t,n){t.download=function(i){function r(e){return S=e.showProgress&&t.loading({display:"block",width:30,height:30,opacity:0,callback:function(){s()}}),v=t.file({native:e.native,needNative:e.needNative}),e.needNative?y=t.native.download&&t.native.download(e,{file:v,loading:S,module:L})||{}:function(e){v.getFolder({folderName:e.folderName,create:!1,onSuccess:function(e,t){w=e.fullPath},onFail:function(t){v.getFolder({folderName:e.folderName,create:!0,onSuccess:function(e,t){w=e.fullPath},onFail:function(e){E&&E.call(L,e)}})}}),e.url&&a(e)}(e),this}function a(e){var t=n.extend(!0,{},I,e);b=t.needEncode?encodeURI(t.url):t.url,P=t.onProgress,T=t.showProgress,T&&S&&S.show({text:"0%"}),x=w+"/"+(e.fileName||v.getFileName(t.url)),t.needNative?y.start(t):(t.cache=!1,t.contentType=!1,t.processData=!1,m=n.ajax({url:b,type:t.method,data:t.data,cache:t.cache,headers:t.headers,contentType:t.contentType,processData:t.processData,timeout:t.timeout,xhr:function(){var e=n.ajaxSettings.xhr();if(d&&e)return e.addEventListener("progress",d,!1),e},success:function(n){var i=e.fileName||v.getFileName(t.url);v.getFile({fileName:i,folderName:t.folderName,create:!0,onSuccess:function(e,n){t.onSuccess&&t.onSuccess.call(L,e.fullPath,n)}})},fail:function(e){p(),t.onFail&&t.onFail.call(L,e)}}))}function o(e){var t=n.extend(!0,{autoDown:!0},I,e),i=e.fileName||v.getFileName(t.url);v.getFile({fileName:i,folderName:t.folderName,onSuccess:function(e,n){t.onSuccess&&t.onSuccess.call(L,e.fullPath||e,e,n)},onFail:function(e){t.autoDown=a(t)}})}function l(e){return e.fileName?(e.folderName=e.folderName||I.folderName,v.removeFile(e),this):(t.showLog("请告诉我们你要删除哪个文件, fileName "),this)}function c(e){return e.folderName=e.folderName||I.folderName,v.removeFolder(e),this}function u(e){return v.open(e),this}function s(e){j?(p(),m&&m.abort(),N&&window.cancelAnimationFrame(N)):y.stop(),e&&e.call(L,S,m)}function d(e){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,N=window.requestAnimationFrame(function(){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);k=t.toString()+"%",t<100?f(k):p(),P&&P.call(L,k)}})}function f(e){T&&S&&S.show({text:e})}function p(){T&&S&&S.stop()}function h(e){return v.toBase64(e),this}function g(e){var n={loading:S,file:v,ajax:m};return t.widget.call(n,e)}var m,v,y,b,w,x,k,O={url:"",data:{},headers:{},method:"GET",showProgress:!0,timeout:6e4,fileName:"",folderName:"download",native:!0,needNative:!0,onProgress:null,onSuccess:null,onFail:null},L={open:u,getFile:o,removeFile:l,removeFolder:c,start:a,stop:s,toBase64:h,init:r,widget:g},I=L.config=n.extend(!0,{},O,t.config.download,i),j="object"===(void 0===i?"undefined":e(i))&&void 0!==i.needNative?!i.needNative:t.isWebapp,T=I.showProgress,P=I.onProgress,E=I.onFail,S=null,N=null;return r(I),L}}(window.bui||{},window.libs),function(e,t){e.currentPlatform="webapp",e.on("pagereadybefore",function(){e.platform.isWindow()||e.platform.isMac()?window.viewport=e.viewport(40):window.viewport=e.viewport(),e.config.init.auto&&e.init(),!e.hasRouter&&e.config.component.auto&&loader.components({id:"body"})}),e.webready=function(n){t(document).ready(function(){e.trigger.call(e,"pagereadybefore"),n&&n.call(e),e.trigger.call(e,"pageready")})},e.ready=function(n){e.isWebapp=void 0===e.isWebapp?e.debug:e.isWebapp;var i=t.Deferred();if(e.isWebapp)t(document).ready(function(){e.trigger.call(e,"pagereadybefore"),n&&n.call(e),e.trigger.call(e,"pageready"),i.resolve()});else{if(void 0===e.native.ready)return e.showLog("当前 bui.isWebapp = false; 但bui.js为webapp版本,不支持原生方法,请使用 buijs update -p xxx, 更换bui.js为对应xxx平台版本;"),e.webready(n),i;i=e.native.ready&&e.native.ready(n)||i}return i}}(window.bui||{},window.libs),function(e,t){e.mask=function(n){function i(n){T=!1;var i=t.extend(!0,b,x,n);return i.onBeforeInit&&i.onBeforeInit.call(w,i),i.appendTo=i.appendTo||"body",L=e.objId(i.appendTo),x=w.config=i,v=L.css("position"),i.autoTrigger&&o(i),I=e.objId(i.id),i.onInited&&i.onInited.call(w,i),this}function r(e){var t=function(t){e.callback&&e.callback.call(w,t),e.autoClose&&u(),t.stopPropagation()};I.off("click.bui").on("click.bui",t),j=!0}function a(t){var n=t.background?t.background:"rgba(0,0,0,"+t.opacity+")",i="";return i+='<div id="'+O+'" class="'+e.prefix("mask")+" "+t.className+'" style="background:'+n+";z-index:"+t.zIndex+'"></div>'}function o(n){if(!T){var i=t.extend(!0,{},b,x,n),o=a(i);return I=e.objId(O),I&&I.length?I.css("display","block"):(L.append(o).css("position","relative"),I=e.objId(O)),y=!0,m.call(w,"show"),j||r(i),this}}function l(){if(!T)return I&&I.remove(),I=null,L.css("position",v||"static"),y=!1,j=!1,m.call(w,"hide"),this}function c(t){if(!T)return I=e.objId(O),I&&I.length?(I.css("display","block"),L.css("position","relative"),y=!0):o(x),m.call(w,"show"),this}function u(){if(!T)return I&&I.css("display","none"),L.css("position","relative"),y=!1,m.call(w,"hide"),this}function s(){return y}function d(e){l(),L&&L.off("click.mask"),g("show"),g("hide"),T=!0}function f(t){var n={};return e.widget.call(n,t)}function p(t,n){return e.option.call(w,t,n)}function h(t,n){return e.on.apply(w,arguments),this}function g(t,n){return e.off.apply(w,arguments),this}function m(t){w.self=this==window||this==w?null:this,e.trigger.apply(w,arguments)}var v,y,b={id:"",appendTo:"",className:"",opacity:.3,background:"",zIndex:100,autoTrigger:!1,autoClose:!1,onBeforeInit:null,onInited:null,callback:null},w={handle:{},on:h,off:g,hide:u,show:c,isShow:s,remove:l,destroy:d,widget:f,option:p,config:x,init:i},x=w.config=t.extend(!0,{},b,e.config.mask,n),k=e.guid(),O=x.id?x.id.indexOf("#")>-1?x.id.substring(1):x.id:k,L=(t("body"),e.objId(x.appendTo)),I=null,j=!1,T=!1;return i(x),w}}(window.bui||{},window.libs),function(e,t){e.loading=function(n){function i(i){N=!1;var r=t.extend(!0,{},I,i);return r.onBeforeInit&&r.onBeforeInit.call(L,n),r.appendTo=r.appendTo||"body",j=t(r.appendTo),I=L.config=r,r.autoTrigger&&E.length<1&&o(r),E=e.objId(T),r.onInited&&r.onInited.call(L,r),this}function r(e){var t=e||I,n=function(e){t.callback&&t.callback.call(L,e),e.stopPropagation()};return j.off("click.bui","#"+T).on("click.bui","#"+T,n),S=!0,this}function a(t){t=t||{};var n=t.text,i=j.width()||document.documentElement.clientWidth,r=n&&"block"==t.display?parseInt(t.height)+30:parseInt(t.height),a=-i/2,o=-r/2,l="block"==t.display?e.prefix("loading-block"):e.prefix("loading-inline"),c="";return c+='<div id="'+T+'" class="'+e.prefix("loading")+" "+l+'" style="width:'+i+"px;height:"+r+"px;line-height:"+r+"px;margin-left:"+a+"px;margin-top:"+o+"px;"+(t.zIndex?"z-index:"+t.zIndex:"")+'" >',t.onlyText||(c+='<div class="'+e.prefix("loading-cell")+'" style="width:'+parseFloat(t.width)+"px;height:"+parseFloat(t.height)+'px;"></div>'),c+='<div class="'+e.prefix("loading-text")+'">'+t.text+"</div>",c+="</div>",t&&t.template?t.template.call(L,t):c}function o(n){if(!N){var i=t.extend(!0,{},I,n);if(E=e.objId(T),k=E.children(".bui-loading-cell"),E.hasClass("bui-loading-pause"))E.removeClass("bui-loading-pause"),w.call(this,"start");else{E.length&&E.remove();var o=a(i);j.append(o),D&&D.show(),w.call(this,"show")}return i.timeout&&(R&&clearTimeout(R),R=setTimeout(function(){d()},i.timeout)),S||r(i),C=!0,this}}function l(t){if(!N){E=e.objId(T),x=E.children(".bui-loading-text");return void 0===t?x&&x.text():(x&&x.html(t),this)}}function c(){if(!N)return E=e.objId(T),k=E.children(".bui-loading-cell"),k.css("display","inline-block"),E.removeClass("bui-loading-pause"),this}function u(){if(!N)return E=e.objId(T),k=E.children(".bui-loading-cell"),k.css("display","none"),E.addClass("bui-loading-pause"),this}function s(){return C}function d(){if(!N)return E=e.objId(T),E&&E.remove(),E=null,D&&D.remove(),S=!1,C=!1,w.call(this,"remove"),w.call(this,"hide"),this}function f(){if(!N)return E&&E.addClass("bui-loading-pause"),w.call(this,"pause"),this}function p(n){var i=n||{};if(!N){var r=t.extend(!0,I,i);return E=e.objId(r.id),E&&E.length?(l(r.text),E[0].style.display="-webkit-box",D&&D.show(),w.call(this,"show")):o(r),I.timeout&&(R&&clearTimeout(R),R=setTimeout(function(e){h()},I.timeout)),C=!0,this}}function h(){if(!N)return E=e.objId(T),I.appendTo?(E.css("display","none"),D&&D.hide()):E&&E.length&&(E.css("display","none"),D&&D.hide()),C=!1,w.call(this,"hide"),this}function g(e){var e=1==e;d(),j&&j.off("click.bui"),b("show"),b("hide"),b("start"),b("stop"),b("pause"),b("remove"),D&&D.destroy(e),N=!0}function m(t){var n={mask:D||{}};return e.widget.call(n,t)}function v(t,n){return e.option.call(L,t,n)}function y(t,n){return e.on.apply(L,arguments),this}function b(t,n){return e.off.apply(L,arguments),this}function w(t){L.self=this==window||this==L?null:this,e.trigger.apply(L,arguments)}var x,k,O={appendTo:"",width:30,height:30,text:"",onlyText:!1,mask:!0,zIndex:"",autoTrigger:!1,autoClose:!0,timeout:0,opacity:0,display:"block",template:null,onBeforeInit:null,onInited:null,callback:null},L={handle:{},on:y,off:b,start:o,stop:d,isLoading:s,pause:f,text:l,showRing:c,hideRing:u,show:p,hide:h,destroy:g,widget:m,option:v,config:I,init:i},I=L.config=t.extend(!0,{},O,e.config.loading,n),j=(t("body"),null),T=e.guid(),P=T+"-mask",E=e.objId(T),S=!1,N=!1,C=!1,R=null;I.id=T;var A=I.callback;I.callback=function(e){I.autoClose&&d(),A&&A.call(L,e)};var F=t.extend(!0,{},I,{id:P}),D=I.mask?e.mask(F):null;return i(I),L}}(window.bui||{},window.libs),function(e,t){
e.init=function(n){var i,r={id:".bui-page",height:0,header:"header",main:"main",footer:"footer",reduceRem:0};if("object"==e.typeof(n))i=t.extend({},r,e.config.init,n);else{var a={};a.height=n,i=t.extend({},r,a)}var o=i.height||document.documentElement.clientHeight||t("body").height()||t("#bui-router").height()||t(".bui-page").height();if(!(e.obj(i.main).length<1)){try{var l=e.obj(i.id),c=i.header.indexOf("#")>-1?e.obj(i.header)[0]:l.children(i.header)[0],u=i.footer.indexOf("#")>-1?e.obj(i.footer)[0]:l.children(i.footer)[0],s=i.main.indexOf("#")>-1?e.obj(i.main):l.children(i.main),d=c?c.offsetHeight:0,f=u?u.offsetHeight:0,p=i.reduceRem>0?e.unit.remToPx(i.reduceRem):0,h=o-d-f-p;if(parseInt(h)>0)s.height(h);else{var g=d+f+p+"px";e.unit.calcHeight(s,g)}}catch(t){e.showLog(t,"bui.init")}return h}},window.addEventListener?window.addEventListener("load",function(t){e.trigger.call(e,"onload")},!1):window.attachEvent("onload",function(t){e.trigger.call(e,"onload")}),t(document).ready(function(){e.isWebapp=void 0===e.isWebapp?e.debug:e.isWebapp,e.trigger.call(e,"pagebefore"),"function"==typeof FastClick&&FastClick.attach(document.body),e.trigger.call(e,"pageinit")});try{var n="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"",i=n.replace(/hidden/i,"visibilitychange"),r=function(t){document[n]?e.trigger.call(e,"pagehide",t):e.trigger.call(e,"pageshow",t)};document.addEventListener(i,r)}catch(e){}try{navigator.control.gesture(!1),navigator.control.longpressMenu(!1)}catch(e){}}(window.bui||{},window.libs)});
