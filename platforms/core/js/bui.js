function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/* @preserve 
 * @name: BUI v1.6.5  
 * @detail: BUI 是一个免费的UI交互框架, 用于快速定制开发WebApp,微信,混合移动应用(Bingotouch,Link,Dcloud,Apicloud,Appcan等).
 * @site: http://www.easybui.com/ 
 * Copyright © 2017-2021 BUI. All Rights Reserved. 
 */!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e,t,n;window.libs=window.Zepto||window.jQuery||{},window.bui={},window.router={},(e=window.bui).debug=!0,e.hasRouter=!1,e.nativeRouter=!1,e.isWebapp,e.currentPlatform="",e.log=!0,e.trace=!1,e.native={},e.config={},e.config.namespace="bui",e.config.classNamePrefix=e.config.namespace+"-",e.config.version="1.6.5",e.config.versionCode=20210511,e.version=e.config.version,e.versionCode=e.config.versionCode,e.config.icon={close:"icon-close",minus:"icon-minus",plus:"icon-plus",search:"icon-search",remove:"icon-removefill"},e.config.viewport={zoom:!0,create:!0},e.config.init={auto:!0},e.config.ready={},e.config.ajax={},e.config.get={},e.config.put={},e.config.delete={},e.config.post={},e.config.back={},e.config.load={},e.config.getPageParams={},e.config.refresh={},e.config.run={},e.config.checkVersion={},e.config.component={auto:!0},e.config.dialog={},e.config.confirm={},e.config.alert={},e.config.hint={},e.config.prompt={},e.config.loading={},e.config.mask={},e.config.list={},e.config.listview={},e.config.scroll={},e.config.pullrefresh={},e.config.select={},e.config.sidebar={},e.config.slide={},e.config.actionsheet={},e.config.dropdown={},e.config.accordion={},e.config.stepbar={},e.config.rating={},e.config.number={},e.config.file={},e.config.fileselect={},e.config.upload={},e.config.download={},e.config.swipe={},e.config.router={},e.config.loader={},e.config.loader.define={},e.config.loader.load={},e.config.loader.component={},e.config.store={},e.config.floor={},function(e,t){e.prefix=function(t){return e.config.classNamePrefix+t},e.showLog=function(t,n){n=n||"";var r="";"object"==_typeof(t)&&"message"in t&&"name"in t?r=t.message+":"+t.name+"&&stack:"+t.stack:"string"==typeof t&&(r=t),e.log&&console.error(n+" "+r),e.trace&&console.trace&&console.trace(),e.trigger("catcherror",t,n)},e.guid=function(e){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(e=void 0===e?"bui":e||"")+t().substr(e.length)+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.swipeDirection=function(e,t,n,r){var a=t-e,i=r-n,o=Math.abs(a),l=Math.abs(i);return!(o<9&&l<9)&&(o/l>3?a>0?"swiperight":"swipeleft":i>0?"swipedown":"swipeup")},e.obj=function(n,r){var a=null;r=r||null;var i=e.hasRouter&&router.currentPage()||"html",o=t(i=r||i),l="string"==typeof n;if("object"===_typeof(n))return a=t(n);if(l&&/^(\d)/.test(n))return a=o.find("[id='"+n+"']");if(l&&/^[a-zA-z]/.test(n)){var c=/^(html|head|body|header|main|footer|ul|li|section|dt|dd|div|span|img|article|i|strong|input|textarea|select|h1|h2|h3|h4|h5|h6|p|view|component|components|iframe)$/gi.test(n)||/^\[.+\]$/.test(n)||n.indexOf("[")>-1?n:"#"+n;return a=o.find(c)}return/^#\d/.test(n)?a=o.find("[id='"+n.substr(1)+"']"):/^\.\d/.test(n)?a=o.find("[class='"+n.substr(1)+"']"):n&&(a=o.find(n)),a},e.$=e.obj,e.objId=function(t){return e.obj(t,"html")},e.selector=function(e){return void 0===e?this:t(e,this)},e.widget=function(e){return e&&e in this?this[e]:this},e.option=function(n,r){if("object"!==e.typeof(n)&&void 0===r)return"string"==typeof n?this.config[n]:this.config;if("id"==n)return e.showLog("不允许修改控件的ID参数"),this;if(n&&"object"===e.typeof(n)){var a=t.extend(this.config,n);return this.init(a)}if(this.config.hasOwnProperty(n)){var i={};i[n]=r;a=t.extend(this.config,i);return this.init(a)}return this}}(window.bui||{},window.libs),function(e,t){e.emitter=function(){function t(){this.handle=Object.create(null)}return t.prototype.on=function(t,n,r){return"function"==typeof n?(r=n,n=this):(r=r,n=n||this),n.handle=n.handle||{},e.unit.stringToArray(t).forEach((function(e,t){void 0===n.handle[e]&&(n.handle[e]=[]),n.handle[e].push(r)})),n},t.prototype.off=function(t,n,r){"function"==typeof n?(r=n,n=this):"function"==typeof r?(r=r,n=n||this):n=this;var a=e.typeof(t);if(void 0===t)n.handle=Object.create(null);else if("string"===a&&"function"==typeof r){var i=n.handle[t]||[];e.array.remove(i,r)}else if("string"===a||"array"===a){"object"!==_typeof(n.handle)&&(n.handle={}),e.unit.stringToArray(t).forEach((function(e,t){n.handle[e]=[]}))}return n},t.prototype.one=function(e,t){var n=this;return this.on(e,(function r(){t&&t.apply(n,arguments),n.off(e,r)})),this},t.prototype.wait=function(t,n){var r=this,a=e.unit.stringToArray(t),i=[],o=!0;return a.forEach((function(t,l){r.on(t,(function(t){i[l]=t,i.length===a.length&&o&&(a.forEach((function(t,n){i[n]=e.history.getLast().component[t]||{}})),n&&n.apply(r,i),o=!1)}))})),this},t.prototype.waited=function(t,n){var r=this,a=e.unit.stringToArray(t),i=[],o=!0;return a.forEach((function(t,l){r.on(t,(function(t){i[l]=t.exports||t,i.length===a.length&&o&&(a.forEach((function(t,n){var r=e.history.getLast().component[t];i[n]=r?r.exports:{}})),n&&n.apply(r,i),o=!1)}))})),this},t.prototype.trigger=function(e){try{if(this.handle[arguments[0]]instanceof Array){var t=this.handle[arguments[0]],n=[].slice.apply(arguments);n.shift();for(var r=0,a=t.length;r<a;r++)t[r]&&t[r].apply(this.self||this,n)}}catch(e){}return this},t.prototype.notify=function(){try{for(var e in this.handle)if(this.handle[e]instanceof Array)for(var t=this.handle[e],n=0,r=t.length;n<r;n++)t[n]&&t[n].apply(this.self||this)}catch(e){}return this},function(e){return new t}}();var n=e.emitter();e.on=n.on,e.off=n.off,e.trigger=n.trigger,e.one=n.one}(window.bui||{}),function(e,t){e.store=function(n){var r={el:null,scope:"",data:null,extends:null,mixins:[],beforeMounts:[],beforeCompiles:[],compileds:[],beforeUpdates:[],mounteds:[],updateds:[],beforeDestroys:[],destroyeds:[],computed:null,methods:null,watch:null,templates:null,beforeMount:null,mounted:null,beforeCompile:null,compiled:null,beforeUpdate:null,updated:null,beforeDestroy:null,destroyed:null,isPublic:!1,modelEvent:"input",scopeSplit:".",paramSplit:"|",delayInput:200,needStatic:!1,needView:!0,needComponent:!1,needCompile:!0,needNative:!1,deep:!0,log:!1,autoinit:!0},a=null;function i(n){var a=null,i=n&&n.extends?[n.extends]:[];e.array.merge(r.mixins,i,n.mixins||[],[n]);var o=t.extend(!0,{},r,e.config.store);return function e(n){var i=0;for(i=0;i<n.length;i++){var l=n[i];l.beforeMount&&r.beforeMounts.push(l.beforeMount),l.beforeCompile&&r.beforeCompiles.push(l.beforeCompile),l.beforeUpdate&&r.beforeUpdates.push(l.beforeUpdate),l.updated&&r.updateds.push(l.updated),l.compiled&&r.compileds.push(l.compiled),l.mounted&&r.mounteds.push(l.mounted),l.beforeDestroy&&r.beforeDestroys.push(l.beforeDestroy),l.destroyed&&r.destroyeds.push(l.destroyed),a=t.extend(!0,o,l),l.mixins&&l.mixins.length&&i<n.length-1&&e(l.mixins)}}(r.mixins),a=t.extend(!0,r,a)}var o="function"==typeof(a=i(n)).data?a.data.call(V):a.data,l=a.scope||e.guid(),c=a.computed,s=a.scopeSplit,u=a.methods,d=a.templates,f=a.watch||r.watch;a.delayInput;var p,h=a.isPublic,g=a.modelEvent,m=a.needStatic,v="",y=!1,b=!0,w={},x={},k={},O=!1,L={},P=e.emitter(),I={target:null};a.el?a.el=a.el:a.el=h?"body":".bui-page",p=a.el,v=0==p.indexOf(".")||0==p.indexOf("#")?p.substr(1):p;var j=null,S=null,T=null,E=null,N=[],C=!0,R=o,A=void 0===a.log?r.log:a.log,_=/b-text|b-html|b-value|b-show|b-hide|b-checked|b-src|b-href|b-bind|b-style|b-class|b-model|b-id|b-data|b-title|b-visible/gim,F={"b-text":function(t){var n="b-text",r=re.call(this,t,n),a=ne.call(this,n),i="",o=e.typeof(t.value),l=r.attr(n),c=se.call(this,n);c[0].keyname;var s=c[0].param;switch(o){case"array":i=ae(t,l);break;case"function":i=t.value.apply(V,s);break;default:i=t.value}i=a?!i:i,r.text(i),N=[]},"b-html":function(t){var n="b-html",r=re.call(this,t,n),a=ne.call(this,n),i="",o=e.typeof(t.value),l=r.attr(n),c=se.call(this,n);c[0].keyname;var s=c[0].param;switch(o){case"array":i=ae(t,l);break;case"function":i=t.value.apply(V,s);break;default:i=t.value}i=a?!i:i,r.html(i),N=[]},"b-value":function(e){var t=re.call(this,e,"b-value");h?t.each((function(t,n){ie.call(this,e)})):ie.call(t[0],e);N=[]},"b-show":function(e){var t=re.call(this,e,"b-show");void 0!==e.value&&1==Boolean(e.value)?this.removeAttribute("style"):void 0!==e.value&&0==Boolean(e.value)&&t.css("display","none");N=[]},"b-visible":function(e){var t=re.call(this,e,"b-visible");void 0!==e.value&&1==Boolean(e.value)?this.removeAttribute("style"):void 0!==e.value&&0==Boolean(e.value)&&t.css("visibility","hidden");N=[]},"b-hide":function(e){var n="!"+l+s+e.keyname,r=h?t('[b-show="'.concat(n,'"]')):j(this);void 0!==e.value&&1==Boolean(e.value)?r.css("display","none"):void 0!==e.value&&0==Boolean(e.value)&&r.removeAttr("style")},"b-checked":function(e){this.checked=!!e.value,N=[]},"b-bind":function(e){var t=re.call(this,e,"b-bind"),n=this,r=e.keyname,a=e.value;if("object"===_typeof(a)){var i=function(i){ve(r+"."+i,(function(t){le(re.call(n,e,"b-bind"),i,t.value)})),le(t,i,a[i])};for(var o in a)i(o)}else{var l="string"==typeof r&&r.split("."),c=l[l.length-1];le(t,c,a)}},"b-src":function(e){re.call(this,e,"b-src").attr("src",e.value),N=[]},"b-title":function(e){re.call(this,e,"b-title").attr("title",e.value),N=[]},"b-data":function(e){re.call(this,e,"b-data").attr("data",e.value),N=[]},"b-id":function(e){re.call(this,e,"b-id").attr("id",e.value),N=[]},"b-href":function(e){re.call(this,e,"b-href").attr("href",e.value),N=[]},"b-class":function(n){var r=re.call(this,n,"b-class"),a=this;this.classList;var i=n.keyname||"";if("object"===_typeof(n.value))if("array"===e.typeof(n.value)){n.value.length||r.attr("class",""),n.value.forEach((function(e,t){!r.hasClass(e)&&r.addClass(e)}));var o=i.indexOf(".$index");o>-1?ve(i.substr(0,o)+"."+t(r).index(),(function(e){var t=re.call(a,n,"b-class");ce(t,e.value[t.index()],e.value)})):ve(i,(function(e){var t=re.call(a,n,"b-class");ce(t,e.value[t.index()],e.value)}))}else{var l=function(e){var t=n.value[e],o=n.preValue&&n.preValue[e]||"";ve(i+"."+e,(function(t){ce(re.call(a,n,"b-class"),e,t.value)})),ce(r,e,t,o)};for(var c in n.value)l(c)}else if("function"==typeof n.value){var s=se.call(this,"b-class"),u=s[0].keyname,d=s[0].param,f=n.value.apply(V,d);ce(r,u,f,n.preValue)}else{var p="string"==typeof n.keyname&&n.keyname.split("."),h=p[p.length-1];ce(r,h,n.value,n.preValue)}N=[]},"b-model":function(e){var t=re.call(this,e,"b-model");h?t.each((function(t,n){oe.call(this,e)})):oe.call(t[0],e)},"b-style":function(e){var t=re.call(this,e,"b-style"),n=this;if("object"===_typeof(e.value)){var r=function(r){ve(e.keyname+"."+r,(function(t){re.call(n,e,"b-style").css(r,t.value)})),t.css(e.value)};for(var a in e.value)r(a)}else t.css(e.keyname,e.value);N=[]}},D={"b-text":[],"b-html":[],"b-value":[],"b-show":[],"b-hide":[],"b-checked":[],"b-bind":[],"b-src":[],"b-title":[],"b-data":[],"b-id":[],"b-href":[],"b-class":[],"b-model":[],"b-style":[]},$={},U=t.extend(!0,{},o,u,f,c,d),V={$methods:u,$refs:L,mixin:i,$options:a,$templates:d,config:a,watch:B,nextTick:function(t){return ve("nexttick",(function(n){try{t&&t.call(V,n)}catch(n){e.showLog(n)}})),this},oneTick:function(t,n){var r="nexttick-"+t;if(k.hasOwnProperty(r))return this;return k[r]=n,ve("nexttick",(function(n){if(n.keyname===t)try{x[t].pop(),0==x[t].length&&k[r]&&k[r].call(V,n)}catch(n){e.showLog(n)}})),this},get:function(t){if(void 0===t)return R=R;if("string"==typeof t){var n=e.unit.getKeyValue(t,R);return N=[],n}return R},set:he,delete:ge,del:ge,observer:de,compile:z,$mount:z,compileHtml:K,clearKey:function(){return N=[],y=!1,b=!0,O=!1,this},destroy:function(){return N=[],a.beforeDestroys.forEach((function(e,t){e.call(V)})),y=!1,b=!0,O=!1,be(),a.beforeMounts=[],a.beforeCompiles=[],a.compileds=[],a.mounteds=[],a.beforeUpdates=[],a.updateds=[],a.destroyeds.forEach((function(e,t){e.call(V)})),this},init:H,connect:function(t,n,r){if("object"!==_typeof(t)||!t.hasOwnProperty("$refs"))return V;var a=this;if("string"==typeof n){pe(t,n);var i=e.unit.getKeyValue(n,a.$data);"object"===e.typeof(i)?d(n,i,r||n):u(r||n,i,n)}else for(var o=Object.keys(R),l=0;l<o.length;l++){var c=o[l];if(e.array.compare(fe,c,"field"))break;if(pe(t,c),t.$data.hasOwnProperty(c)){t.$data[c];var s=a.$data[c];"object"===e.typeof(s)?d(c,s):u(c,s)}}function u(n,r,a){"array"===e.typeof(r)?t[n].$replace(r):t.set(n,r);var i=null;a&&(i=B(a,(function(r){"array"===e.typeof(r)?t[n].$replace(r):t.set(n,r)}))),n&&(i=B(n,(function(r){"array"===e.typeof(r)?t[n].$replace(r):t.set(n,r)})));var o=e.array.index(fe,n,"field");(o<0||fe[o]&&t.$options.el!==fe[o].el)&&fe.push({field:a||n,el:t.$options.el,disconnect:i})}function d(n,i,o){for(var l,c=Object.keys(i),s=function(i){var o=c[i],l=n+"."+o,s=void 0===r,u=s||""==r?o:r+"."+o;pe(t,l);var f=e.unit.getKeyValue(l,a.$data);s?t.set(l,f):t.set(u,f);var p=B(l,(function(e){void 0!==r?t.set(u,e):t.set(l,e)}));((d=e.array.index(fe,l,"field"))<0||fe[d]&&t.$options.el!==fe[d].el)&&fe.push({field:l,el:t.$options.el,disconnect:p})},u=0;u<c.length;u++){var d;s(u)}t.trigger.call(t,o||n,(_defineProperty(l={action:"set",target:null,value:R[n],preValue:null},"action","set"),_defineProperty(l,"keyname",n),_defineProperty(l,"origin",R),l))}return V},disconnect:function(t){if("string"==typeof t){var n=e.array.get(fe,t,"field");n&&n.disconnect()}else fe.forEach((function(e,t){e.disconnect()}));return V},on:ve,off:be,one:ye,trigger:we,emitter:P};try{a.autoinit&&H()}catch(t){e.showLog(t)}function H(){var n,r=(j=e.hasRouter?router.$:t)(a.el);for(var i in S="object"===_typeof(a.el)?t(a.el):r.length?r:t(a.el),T=S&&S.parent(),E=S&&S.children(),V.$el=S,V.$parent=T,V.$children=E,V.$data=o,u)u[i]=u[i].bind(V);return V.$methods=u,u&&function(){try{Object.keys(u).forEach((function(t){o.hasOwnProperty(t)?e.showLog("不能跟data的键值相同:"+t):Object.defineProperty(V,t,{get:function(){return u[t].bind(this)},set:function(){}})}))}catch(t){e.showLog(t)}}(),d&&function(){try{Object.keys(d).forEach((function(t){o.hasOwnProperty(t)?e.showLog("不能跟data的键值相同:"+t):Object.defineProperty(V,t,{get:function(){return d[t].bind(this)},set:function(){}})}))}catch(t){e.showLog(t)}}(),we.call(V,"beforemount"),a.beforeMounts.forEach((function(e,t){e.call(V)})),de(o),function(){var e=function(e){Object.defineProperty(V,e,{configurable:!0,get:function(){A&&console.log("1. module getting ".concat(e),N),this===V||!y&&b?(y=!0,b=!1,N=[]):(y=!1,b=!1);var t=o[e];return Array.isArray(t)&&I.target&&(w[e]=[],w[e].push(I.target)),t},set:function(t){A&&console.log("2. module setting ".concat(e),N),N=[],o[e]=t,R[e]=t}})};for(var t in o)e(t)}(),f&&function(t){try{M(t)}catch(t){e.showLog(t)}}(f),c&&function(){try{Object.keys(c).forEach((function(t){if(o.hasOwnProperty(t))e.showLog("不能跟data的键值相同:"+t);else{var n=c[t];Object.defineProperty(V,t,{get:function(){var e,r="function"==typeof n?n.bind(this):n.get.bind(this);return I.target&&(w[t]=[],w[t].push(I.target)),I.target=function(){var e=r();w[t]&&w[t].forEach((function(e){return e()})),we(t,{target:null,value:e,action:"set",keyname:t,param:[],origin:R}),I.target=null,N=[]},e=r(),I.target=null,N=[],e},set:n&&"object"===e.typeof(n)&&n.set||function(){}})}}))}catch(t){e.showLog(t)}}(),h?a.needCompile&&router&&router.on("complete",(function(e){a.needCompile&&z(),C&&a.mounteds.forEach((function(t,n){t.call(V,e)})),R=t.extend(!0,{},o),y=!1,b=!0,we.call(V,"mounted",e),C=!1,N=[]})):(C||be(),m&&(n=K(n=S.html()),S.html(n)),a.needView?function(e){loader.views({id:e.id,loaded:function(e){z(e.el)},compiled:e.compiled})}({id:S,compiled:function(){a.needCompile&&z(),a.mounteds.forEach((function(e,t){e.call(V)}))}}):(a.needCompile&&z(),a.mounteds.forEach((function(e,t){e.call(V)}))),R=t.extend(!0,{},o),y=!1,b=!0,N=[],we.call(V,"mounted"),C=!1),this}function M(t,n,r){t=t||f;try{var a=Object.keys(t),i=[];a.forEach((function(a,l){var c=r||("object"===_typeof(t[a])?t[a].handler:t[a]);i.push(a),n&&i.unshift(n);var s=i.join("."),u=t[a];if("object"===e.typeof(u)){var d=u.deep?Object.keys(o[a]):Object.keys(t[a]),f=e.unit.getKeyValue(a,o);d.forEach((function(t,n){var r=s+"."+t,a=f[t];"object"===e.typeof(a)&&M(a,r,c),B(r,c),i=[]})),u.immediate&&u.handler&&u.handler.call(V,o[a],R[a])}B(s,c),i=[]}))}catch(t){e.showLog(t)}}function B(t,n){var r=function(t){try{var r=[t.value,t.preValue||"",t];if("init"!==t.action){var a=n;switch(e.typeof(a)){case"function":a.apply(V,r);break;case"array":a.forEach((function(e,t){e.apply(V,r)}));break;case"string":new Function(a+"(".concat(t.value,",").concat(t.preValue||"",")"))();break;default:a.apply(V,r)}}}catch(t){e.showLog(t)}};return ve(t,r),be.bind(this,t,r)}function z(n){try{var r=null,i=null;void 0===n?(r=S,i=a):"string"==typeof n?(r=j(n),i=a):n&&"object"===_typeof(n)&&(r=j(n)||t(n),i=t.extend(!0,{},a,n));var o=!0;if(i.beforeCompiles.forEach((function(e,t){if(!1===(o=e.call(V,i)))return!1})),!1===o)return N=[],!1;if(ee(r),J({el:r,action:"first"}),function(t){var n=t,r=n.find("[b-watch*=".concat(l,"]")),a=n.find("[b-one*=".concat(l,"]"));if(r.length)try{te(r,"b-watch",ve)}catch(t){e.showLog(t)}if(a.length)try{te(a,"b-one",ye)}catch(t){e.showLog(t)}}(r),i.needComponent)return loader.components({id:r,compiled:function(){Y(r),Q(r),Z(r),!0,q(),N=[],i.compileds.forEach((function(e,t){e.call(V,i)}))}}),this;Y(r),Q(r),Z(r),!0,q(),N=[],i.compileds.forEach((function(e,t){e.call(V,i)}))}catch(t){e.showLog(t)}return this}function q(){return S.find("[ref]").each((function(){var t=this.getAttribute("ref"),n=L.hasOwnProperty(t),r=null;n&&"htmldivelement"===e.typeof(L[t])?((r=[L[t]]).push(this),L[t]=r):n&&"array"===e.typeof(L[t])?L[t].push(this):L[t]=this})),this}function K(n){try{var r=this,a="string"==typeof n?n:"",i=new RegExp("{{[\\s]?"+l+s+"(.*?)}}","mg");return a=a.replace(i,(function(n,a){var i=a.split(l+s);""===t.trim(i[0])&&i.shift();var o=i.length>0&&e.unit.getKeyValue(i.join("."),R)||"";return"function"==typeof o?o.call(r):o}))}catch(t){e.showLog(t)}}function W(t,n){var r;return $&&$.hasOwnProperty(t)?r=$[t]:(void 0===(r=e.unit.getKeyValue(t,n))&&A&&console.warn("请检查 ".concat(t," 在bui.store scope:").concat(l," 中有没有声明定义")),$[t]=r),r}function J(n){var r=1==n.replace;try{var a="object"===e.typeof(n)?n.el:n,i=[],o=(a.prop("outerHTML")||a.html()||"").match(_)||[],c=e.array.uniq(o);c.length&&c.forEach((function(o,c){var u=a.find("[".concat(o,"*=").concat(l,"]"));u.length<1&&(u=a.closest("[".concat(o,"*=").concat(l,"]"))),u.length&&u.each((function(c,u){var d=this,f="",p=se.call(this,"".concat(o)),g=p[0]&&p[0].keyname||"",m=g.indexOf(".length"),v=m>-1?g.substr(0,m):g,w=p[0]&&p[0].param;W(v,V);var x=se.call(this,"b-linked");if(x.length&&x.forEach((function(t,n){ve(t.keyname,(function(t){we(g,{target:null,value:e.unit.getKeyValue(g,V),action:"set",keyname:g,param:w,origin:R})}))})),"b-show"===o)switch(p[0]&&p[0].rule){case"!":f="b-hide";break;default:f="b-show"}else f=o;if(h){var k=e.array.compare(D[f],v);!k&&D[f].push(v),!k&&ve(v,F[f].bind(d))}else{var O=function(r){try{if(P.indexOf("$index")>-1){var i=v.match(/([0-9]+)/g),l=i[i.length-1],c=a.find("[".concat(o,'="').concat(L,'"]')),s=c.attr("b-target");c.each((function(e,n){s=t(n).attr("b-target")}));var u=s?a.find(s).eq(l):null,p=arguments;return void(s&&u&&u.length?(u.find("[".concat(o,'="').concat(L,'"]')).each((function(e,t){var n=t||d;F[f].apply(n,p)})),u.closest("[".concat(o,'="').concat(L,'"]')).each((function(e,t){var n=t||d;F[f].apply(n,p)}))):(c.each((function(e,t){var r=t||d;e!=l||"first"!==n.action?"first"!==n.action&&F[f].apply(r,p):F[f].apply(r,p)})),a.closest("[".concat(o,'="').concat(L,'"]')).each((function(e,t){var n=t||d;F[f].apply(n,p)}))))}F[f].apply(d,arguments)}catch(t){e.showLog(t)}};!C&&0===c&&be(v,O),r&&be(v,O);var L=this.getAttribute(o)||"",P=L.replace(l+s,"");ve(v,O.bind(d))}e.array.compare(i,v)||i.push(v),N=[],y=!1,b=!0}))})),X(i,n)}catch(t){e.showLog(t)}}function X(t,n){t.forEach((function(t,r){var a=e.unit.getKeyValue(t,V);we(t,{target:null,action:"object"===e.typeof(n)&&n.action||"init",value:a,param:null,keyname:t,origin:R}),N=[]}))}function Y(n){var r=n,i='[type="text"][b-model*='.concat(l,'],\n                                [type="search"][b-model*=').concat(l,'],\n                                [type="password"][b-model*=').concat(l,'],\n                                [type="url"][b-model*=').concat(l,'],\n                                [type="number"][b-model*=').concat(l,'],\n                                [type="email"][b-model*=').concat(l,'],\n                                [type="range"][b-model*=').concat(l,'],\n                                [type="tel"][b-model*=').concat(l,"],\n                                textarea[b-model*=").concat(l,"]");if("input"===a.modelEvent){var o=!1;r.off("input compositionstart compositionend",i).on(g,i,(function(e){o||c.call(e.target,e)})).on("compositionstart",i,(function(e){o=!0,e.stopPropagation()})).on("compositionend",i,(function(e){o=!1,c.call(e.target,e),e.stopPropagation()}))}else r.off(g,i).on(g,i,c);function c(t){var n=t.target.value,r=se.call(this,"b-model"),a=r[0]&&r[0].keyname||"";if(""===a)return e.showLog("b-model的值不能为空"),!1;he(a,n),N=[],t.stopPropagation()}var s='[type="checkbox"][b-model*='.concat(l,'],\n                                [type="radio"][b-model*=').concat(l,"]");r.off("change",s).on("change",s,(function(t){try{var n,a=this,i=this.getAttribute("value")||this.checked,o=this.getAttribute("type"),c=se.call(this,"b-model")[0].keyname,s=this.getAttribute("check-value"),u=this.getAttribute("uncheck-value"),d=this.getAttribute("check"),f=this.getAttribute("uncheck");(d||f||s||u)&&(i=this.checked?s||this.value||d:u||f||""),n=W(c,V);var p=/\{.+\}$/g.test(i)?null:r.find('[type="checkbox"][b-model="'.concat(l+"."+c,'"][value="').concat(i,'"],\n                [type="radio"][b-model="').concat(l+"."+c,'"][value="').concat(i,'"]'));switch(o){case"checkbox":this.checked&&(n&&"array"===e.typeof(n)?!e.array.compare(n,i)&&e.unit.getKeyValue(c,V).push(i):he(c,i),this.checked=!0),this.checked||(n&&"array"===e.typeof(n)?e.array.remove(e.unit.getKeyValue(c,V),i):he(c,i),this.checked=!1),p&&p.each((function(e,t){this.checked=a.checked}));break;case"radio":default:he(c,i)}N=[],t.stopPropagation()}catch(t){e.showLog(t)}}));var u="select[b-model*=".concat(l,"]");r.off("change",u).on("change",u,(function(n){try{var r=t(this).val(),a=(this.selectedIndex,this.multiple),i=se.call(this,"b-model")[0].keyname,o=null;switch(o=W(i,V),a){case!0:"array"!==e.typeof(o)&&e.showLog("".concat(i,"的类型必须为数组")),r.splice(0,0,0,r.length+1),o.splice.apply(o,r);break;default:he(i,r)}N=[],n.stopPropagation()}catch(n){e.showLog(n)}}))}function Z(e){e.off("change","[b-checked*=".concat(l,"]")).on("change","[b-checked*=".concat(l,"]"),(function(e){var t=this.checked;he(se.call(this,"b-checked")[0].keyname,t),N=[],e.stopPropagation()}))}function Q(e){var t=e;["b-click","b-mousedown","b-mouseover","b-mouseup","b-touchstart","b-touchmove","b-touchend","b-submit","b-change","b-scroll","b-keydown","b-keyup","b-keypress","b-focus","b-blur"].forEach((function(e,n){var r=e.substr(2);t.off(r,"[".concat(e,"*=").concat(l,"]")).on(r,"[".concat(e,"*=").concat(l,"]"),(function(t){var n=G.call(this,t,e);if(!1===n)return!1;void 0===n&&t.stopPropagation()}))}))}function G(t,n){var r=se.call(this,n),a=r[0].keyname,i=r[0].param,o=null;i.push(t);try{var l="function"==typeof(o=W(a,V))&&o.apply(V,i);return N=[],we(a,{target:this,value:o,action:"set",keyname:a,param:i,origin:R}),l}catch(t){e.showLog(t)}}function ee(t){var n=t.find("[b-template*=".concat(l,"]")),r=[];if(x={},n.length)try{n.each((function(t,n){var a=j(this),i=se.call(this,"b-template"),o=i[0].keyname,c=i[0].param,u=l+s;c[0]||console.error('b-template 没有找到数据源, 格式为: b-template="page.template(page.sources)"');var f="string"==typeof c[0]&&c[0].replace(new RegExp(u),"")||"",p=a.attr("b-command")||"html",g=a.attr("b-children")||a.children()[0]&&a.children()[0].tagName;W(f,V);h&&be(f),x.hasOwnProperty(f)?x[f].push(f):x[f]=[f],ve(f,(function(t){try{var n,r=t.param;switch(t.action){case"push":case"unshift":n=r;break;case"splice":n=r.slice(2)||"";break;default:n=t.value}if(d&&d.hasOwnProperty(o)){(c=c.map((function(e,t){return"string"==typeof e&&0==e.indexOf(l+s)&&t>0?W(e.replace(new RegExp(u),""),R):e})))[0]=n;var i=void 0!==n&&"undefined"!==n&&d[o]&&d[o].apply(V,c);void 0===i&&(i="",e.showLog("".concat(o,"模板方法需要返回内容，例如：return html;"))),h&&(a=j('[b-template*="'.concat(u+f,'"]')));var m=t.preValue||[];0==m.length&&"html"==p&&a.empty();var v=g?a.children(g):a.children(),y=v,b=r&&r.length||0;switch(C=!0,t.action){case"push":if(a.append(i),v=a.children(g),b&&b==v.length)J({el:v,action:"push"});else if(b>1)for(var w=y.length,x=w;x<v.length;x++)J({el:v.eq(w+x-1),action:"push"});else J({el:v.last(),action:"push"});break;case"unshift":if(a.prepend(i),v=a.children(g),b&&b==v.length)J({el:v,action:"unshift"});else if(b>1)for(x=0;x<b;x++)J({el:v.eq(x),action:"unshift"});else J({el:v.first(),action:"unshift"});break;case"pop":v.last().remove(),J({el:(v=a.children(g)).last(),action:"pop"});break;case"shift":v.first().remove(),J({el:(v=a.children(g)).first(),action:"shift"});break;case"length":break;case"splice":var k=parseInt(r[0]),O=parseInt(r[1]);O>=m.length&&(a.empty(),v=a.children(g));var L=v.length,P=L>0,I=!1;if(0==O)if(P&&L-1>=k){v.eq(k).before(i),v=a.children(g);for(x=0;x<n.length;x++)J({el:v.eq(k+x),action:"splice"})}else{a.append(i),v=a.children(g);for(x=0;x<n.length;x++)J({el:v.eq(L+x),action:"splice"})}else if(O>0){if(r[1]-r[0]>=t.origin[t.keyname].length&&(I=!0),void 0!==r[2])if(P&&L-1>=k){v.eq(k).before(i),v=a.children(g);for(x=0;x<n.length;x++)J({el:v.eq(k+x),action:"splice",replace:I})}else{a.append(i),v=a.children(g);for(x=0;x<n.length;x++)J({el:v.eq(L+x),action:"splice",replace:I})}var S=0;switch(p){case"append":S=v.length-t.preValue.length||0;break;case"prepend":case"html":default:S=0}for(x=0;x<O;x++)v.eq(k+n.length+x+S).remove();i&&!t.value.length&&a.html(i)}break;case"reverse":case"sort":a.html(i),J({el:a,action:t.action});break;default:a[p](i)}!function(t){("string"==typeof t?e.$(t).find("component"):t.find("component")).each((function(e,t){loader.component({id:t})}))}(a),a.find("[b-template*=".concat(l,"]")).length?ee(a):we.call(V,"nexttick",t)}else e.showLog("找不到对应的模板,请检查下 scope:".concat(l," 的templates是否存在").concat(o),"bui.store")}catch(t){e.showLog(t)}})),e.array.compare(r,f)||r.push(f),N=[]})),X(r)}catch(t){e.showLog(t)}}function te(e,t,n){e.each((function(e,r){j(this);var a=se.call(this,t);a[0].keyname;var i=a[0].param,o=l+s;i[0]||console.error("".concat(t," 没有找到数据源, 格式为: ").concat(t,'="page.doit(page.sources)"')),W("string"==typeof i[0]&&i[0].replace(new RegExp(o),"")||"",V);var c=this;function u(e){var n=se.call(c,t),r=n[0].keyname,a=n[0].param;a.push(e),U[r].apply(V,a)}a[0].paramKeyname.forEach((function(e,t){n(e,u)}))}))}function ne(e){return 0==this.getAttribute(e).indexOf("!")}function re(e,n){var r=l+s+e.keyname;return h?t("[".concat(n,'="').concat(r,'"]')):j(this)}function ae(e,t){return t.indexOf(".length")>-1?e.value.length||0:e.value instanceof Array?e.value.join(","):e.value}function ie(t){var n=this.getAttribute("type"),r=this.value,a=this,i=this.getAttribute("b-value");switch(n){case"radio":r==t.value?this.checked=!0:this.checked=!1;break;case"checkbox":"array"===e.typeof(t.value)&&t.value.forEach((function(e,t){r==e&&(a.checked=!0)}));break;default:this.value=ae(t,i)}}function oe(e){var n=this.getAttribute("type"),r=this.value;e.param;var a=this;if("SELECT"===this.nodeName&&this.multiple)e.value.length>1?e.value.forEach((function(e,n){"string"==typeof e?t(a).find("option[value=".concat(e,"]")).attr("selected",!0):t(a).find("option[value=".concat(e.value,"]")).attr("selected",!0)})):this.value=e.value[0];else{switch(n){case"radio":r==e.value?this.checked=!0:this.checked=!1;break;case"checkbox":if(r&&e.value instanceof Array)switch(e.action){case"push":case"unshift":e.param&&e.param.filter((function(e,t){r!==e||(a.checked=!0)}));break;case"pop":case"shift":e.param&&e.param.filter((function(e,t){r===e&&(a.checked=!1)}));break;case"splice":var i=e.param,o=i&&i[1]&&parseInt(i[1]),l=i&&i.slice(2);0==o?l.forEach((function(e,t){r===e&&(a.checked=!0)})):o>0&&(e.preValue.forEach((function(t,n){n<=e.param[1]&&(a.checked=!1)})),e.value.forEach((function(e,t){r===e&&(a.checked=!0)})));break;case"length":break;default:e.value.filter((function(e,t){r==e&&(a.checked=!0)}))}else e.value===r||1==e.value?this.checked=!0:this.checked=!1;break;default:if(event&&event.target&&"INPUT"===event.target.nodeName)break;this.value=e.value}N=[]}}function le(e,t,n){switch(t){case"disabled":n?e.attr(t,n):e.removeAttr(t);break;case"checked":e.prop(t,n);break;default:var r="object"===_typeof(n)?JSON.stringify(n):n;e.attr(t,r)}N=[]}function ce(e,t,n,r){"boolean"==typeof n?(n&&e.addClass(t),!n&&e.removeClass(t)):"string"==typeof n?(h&&e.removeClass(n),r&&e.removeClass(r),n&&!e.hasClass(n)&&e.addClass(n),void 0!==r&&""===n&&e.removeClass(r)):(Boolean(n)&&e.addClass(t),!Boolean(n)&&e.removeClass(t))}function se(t){var n=[],r=this,i=this.getAttribute(t)||"",o=i.indexOf(a.paramSplit)>-1?i.split(a.paramSplit):i&&[i]||[];try{o.forEach((function(e,a){var i={},o=ue.call(r,e,t);i.scope=l,i.rule=o.rule,i.keyname=o.name,i.param=o.param,i.paramKeyname=o.paramKeyname,i.eventType=o.eventType,i.eventProperty=o.eventProperty,n.push(i)}))}catch(t){e.showLog("参数处理出错")}return n}function ue(n,r){try{var a=n?n.match(/([^\(|\)]+)/g):[],i=[],o="",c="",u=null,d=[],f=null,p=this,h="",g=(P=t(p).attr("b-target"))&&t(p).parents(P)[0]||p,m=null,v="",y="";if(h=(h=(u=a[0]&&a[0].indexOf(l+s)>-1?a[0].split(l+s):[l,a[0]])[0].split(l))[0]||h[1]||"",o=l,(c=u[1]||"").indexOf("$index")>-1){var b=t(g).index();c=c.replace("$index",b)}else if(c.indexOf("$id")>-1){var w=g.id;c=c.replace("$id",w)}else if(c.indexOf("$parentIndex")>-1){var x=t(g).parent().index();c=c.replace("$parentIndex",x)}var k=null,O="";if(n.indexOf("$item")>-1||n.indexOf("$itemIndex")>-1||n.indexOf("$itemId")>-1){O=(k=t(p).closest("[b-template]"))?k.attr("b-children")||k.children()[0].nodeName:"";var L=(m=t(p).closest(O)).index();c=c.replace("$itemIndex",L)}if(void 0!==a[1]){var P,I=(P=t(g).attr("b-target"))&&t(g).closest(P)[0]||g,j=a[1].replace(/\$index/g,t(I).index())||"";try{var S=/\{.+\}$/g,T=/\[.+\]$/g,E=j?j.match(/(\'(.*?)\'.*?)|(\"(.*?)\".*?)|(\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14})|(^((https|http|ftp|rtsp|mms)?:\/\/)[^\,]+)|([a-zA-Z0-9][-a-zA-Z0-9\._]{0,62})|(\{.+\})|(\[.+])|([$\w\.]+)|([\d\.]+)|([\u4e00-\u9fa5|\w|\d]+)/g):[];a[1].split(",").forEach((function(e,n){e.indexOf(l+s)>-1&&i.push(e.replace(l+s,"").replace(/\$index/g,t(I).index()))})),d=E.map((function(n,a){var i=n.replace(/^\"|^\'|\"$|\'$/g,"");switch(n){case"$this":i=I;break;case"$index":i=t(I).index();break;case"$itemIndex":i=m.index();break;case"$itemId":i=m.attr("id");break;case"$itemText":i=m.text();break;case"$itemHtml":i=m.html();break;case"$item":i=m[0];break;case"$parentIndex":i=t(I).parent().index();break;case"$parent":i=I.parentNode;break;case"$children":i=t(I).children();break;case"$id":i=I.id;break;case"$text":i=I.textContent;break;case"$value":i=I.value;break;case"$html":i=I.innerHTML}if("b-template"!==r){var o=l+s;e.unit.startWithStr(i,o)&&(i=e.unit.getKeyValue(i.split(o)[1],V))}return i=/^\d+$/.test(i)&&i.length<17?parseFloat(i):i,S.test(n)||T.test(n)?JSON.parse(n):i}))}catch(t){e.showLog(t,"getArguments"),d=[]}}void 0!==a[2]&&(v=(f=a[2].indexOf(".")>-1?a[2].split("."):[a[2]])[0],y=f[1]||"")}catch(t){e.showLog("参数格式错误:"+n)}return{scope:o,rule:h,name:c,param:d,paramKeyname:i,eventType:v,eventProperty:y}}function de(t,n){if(!t||!t.hasOwnProperty("widget")||"function"!=typeof t.widget)return function(t,n){if(n&&"array"===e.typeof(n)){if(n.length>1){var r=n.pop();i(e.unit.getKeyValue(n.join("."),t),r)}else i(t,n[0]);return}function i(t,n){var r=t[n];if(r instanceof Array?function(t,n){var r=[],i=Array.prototype,c=Object.create(i);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(t){var s=i[t];Object.defineProperty(c,t,{enumerable:!0,configurable:!0,value:function(i){var c=Array.prototype.slice.call(arguments);we.call(V,"beforeupdate",{target:null,action:t,param:c,value:this,prevValue:[],keyname:n,origin:R}),r.push(n),o.hasOwnProperty(n)||r.unshift(N.join("."));var u=r.join("."),d=this.slice(0),f=s.apply(this,c);switch(A&&console.log("5. ".concat(u," action ").concat(t,", param:").concat(c," ")),t){case"pop":case"shift":c=[f]}e.unit.setKeyValue(u,this,R);var p=S.find('[b-template*="'.concat(l,".").concat(u,'"]'));return we(u,{target:p,action:t,param:c,value:this,preValue:d,keyname:n,origin:R}),w[r[0]]&&"array"===e.typeof(w[r[0]])&&w[r[0]].forEach((function(e){return e()})),r=[],N=[],y=!1,b=!0,we.call(V,"updated",{target:p,action:t,param:c,value:this,preValue:d,keyname:n,origin:R}),a.updateds.forEach((function(e,r){e.call(V,{target:p,action:t,param:c,value:this,preValue:d,keyname:n,origin:R})})),f}})})),c.$index=function(t,n){return e.array.index(this,t,n)},c.$include=function(t,n){return e.array.compare(this,t,n)},c.$filter=function(t,n){return e.array.filter(this,t,n)},c.$empty=function(){return e.array.empty(this)},c.$replace=function(t){return e.array.replace(this,t)},c.$merge=function(){var t;return(t=e.array).merge.apply(t,[this].concat(Array.prototype.slice.call(arguments)))},c.$get=function(t,n){return e.array.get(this,t,n)},c.$set=function(t,n,r){return e.array.set(this,t,n,r)},c.$delete=function(t,n){return e.array.delete(this,t,n)},c.$deleteIndex=function(t){return e.array.deleteIndex(this,t)},t.__proto__=c}(r,n):function(t,n){var r=t[n],i="function"==typeof r?r.call(V):r,l=[];Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:function(){return A&&console.log("3. data getting ".concat(n,":"),i),P.target=this,(y||!y&&b)&&N.push(n),I.target&&l.push(I.target),i},set:function(t){if(t===i)return N=[],O=!1,y=!1,b=!0,!0;P.target===this&&(N=[]),P.target=this,(!b||!y&&b)&&N.push(n);var r=N.join(".");!O&&we.call(V,"beforeupdate",{action:"set",value:t,preValue:i,keyname:r,origin:R}),!O&&a.beforeUpdates.forEach((function(e,n){e.call(V,{action:"set",value:t,preValue:i,keyname:r,origin:R})})),A&&console.log("4. data setting ".concat(r),t);var c=e.unit.getKeyValue(r,R);return i=t,l.forEach((function(e){return e()})),!O&&we(r,{action:"set",value:i,preValue:c,keyname:r,origin:R}),e.unit.setKeyValue(r,i,R),i instanceof Array?de(o,N):"object"===e.typeof(i)&&(a.deep&&de(t),i&&Object.keys(i).forEach((function(e,t){var r=n+"."+e;N=[],we(r,{target:null,value:i[e],preValue:c&&c[e],action:"set",keyname:r,origin:R})}))),!O&&we.call(V,"updated",{action:"set",value:i,preValue:c,keyname:r,origin:R}),!O&&a.updateds.forEach((function(e,t){e.call(V,{action:"set",value:i,preValue:c,keyname:r,origin:R})})),N=[],O=!1,y=!1,b=!0,!0}})}(t,n),r&&"object"===e.typeof(r))return de(r)}t&&Object.keys(t).forEach((function(e){i(t,e)}))}(t,n)}var fe=[];function pe(t,n){var r=e.array.index(fe,n,"field");return!!(r>-1&&fe[r]&&t.$options.el===fe[r].el)&&(fe[r].disconnect&&fe[r].disconnect(),!0)}function he(n,r){var i=null;if(N=[],"string"==typeof n&&void 0!==r){var l,c;A&&console.log("set ".concat(n," ")),O=!0,we.call(V,"beforeupdate",(_defineProperty(l={action:"set",target:null,value:i,preValue:u},"action","set"),_defineProperty(l,"keyname",n),_defineProperty(l,"origin",R),l)),a.beforeUpdates.forEach((function(e,t){var r;e.call(V,(_defineProperty(r={action:"set",target:null,value:i,preValue:u},"action","set"),_defineProperty(r,"keyname",n),_defineProperty(r,"origin",R),r))}));var u=e.unit.getKeyValue(n,R);r&&"object"===e.typeof(r)?(i=t.extend(!0,{},r),Object.keys(r).forEach((function(e,t){var a=n+"."+e;we.call(V,a,{target:null,value:r[e],preValue:u,action:"set",keyname:a,origin:R})}))):i=r,e.unit.setKeyValue(n,r,o),e.unit.setKeyValue(n,i,R),we.call(V,n,{target:null,value:i,preValue:u,action:"set",keyname:n,origin:R}),we.call(V,"updated",(_defineProperty(c={action:"set",target:null,value:i,preValue:u},"action","set"),_defineProperty(c,"keyname",n),_defineProperty(c,"origin",R),c)),a.updateds.forEach((function(e,t){var r;e.call(V,(_defineProperty(r={action:"set",target:null,value:i,preValue:u},"action","set"),_defineProperty(r,"keyname",n),_defineProperty(r,"origin",R),r))})),"object"===_typeof(r)&&(r instanceof Array?de(o,n.split(s)):de(r)),N=[]}else n&&"object"===e.typeof(n)&&(R=t.extend(!0,{},R,n),me(n));return R}function ge(t,n){return function(t,n){"string"==typeof t&&(e.unit.delKey(t,R),n&&n.call(V,t))}(t,(function(e){we(t)})),R}function me(t,n){for(var r in t){var a=void 0===n?r:n+r,i=t[r];we(a,{target:null,value:i,preValue:R[r]||"undefined",action:"set",param:null,keyname:a,origin:R}),i&&"object"===e.typeof(i)&&me(i,r+".")}}function ve(t,n){var r="";return r=t&&"array"===e.typeof(t)?t.map((function(e,t){return v+"_"+l+s+e})):v+"_"+l+s+t,P.on.call(V,r,n),this}function ye(e,t){return k.hasOwnProperty(e)||(ve(e,t),k[e]=t),this}function be(e,t){if(e){var n=v+"_"+l+s+e;P.off.call(V,n,t)}else V.handle={};return this}function we(e){var t=v+"_"+l+s+e;return A&&console.warn(t,"trigger"),arguments[0]=t,P.trigger.apply(V,arguments),y=!1,b=!0,this}return V}}(window.bui||{},window.libs),function(e,t){e.viewport=function(n,r){e.trigger.call(e,"viewportbefore");var a,i=document.querySelector("meta[name=viewport]"),o=window.devicePixelRatio,l=document.documentElement.clientWidth,c=document.documentElement.clientHeight,s=parseInt(l)*parseInt(o),u=parseInt(c)*parseInt(o);if(l=l>c?c+24:l,!i){var d=document.createElement("meta");d.name="viewport",d.content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no,viewport-fit=cover";var f=document.head;e.config.viewport.create&&f.appendChild(d),d=null}var p=e.array.index([240,320,360,375,384,393,412,414,435,480,512,540,768,1024,1536,2048,2732,534,854,750],document.documentElement.clientWidth);function h(t){var n=r||750,i=document.head.parentNode,o="number"==typeof t?t:(l/n*100).toFixed(2);return a=o||48,e.config.viewport.zoom&&(i.style.fontSize=a+"px"),e.trigger.call(e,"viewportinit"),this}return p>-1&&void 0===n?a=[32,42.67,48,50,51.2,52.4,54.93,55.2,58,64,68.27,60,60,60,60,60,60,60,60,60][p]:h(n),{width:function(e){return l||t("body").width()||t("#bui-router").width()||t(".bui-page").width()},height:function(e){return c||t("body").height()||t("#bui-router").height()||t(".bui-page").height()},fontSize:a,screenWidth:function(e){return s},screenHeight:function(e){return u},ratio:function(e){return o},init:h}}}(window.bui||{},window.libs),function(e,t){e.loader=function(n){var r,i=t.extend({},{cache:!0,log:!1,baseUrl:"",relativePath:"pages",needNative:!1,deepView:!1,viewTag:"view",componentTag:"component",deepComponent:!0,scriptSuffix:".js"},e.config.loader,n),o=e.emitter(),l=[],c=[],s={},u={baseUrl:"",modules:{},globals:{}},d={},f={init:function(e){return e=e||{},i=t.extend({},i,e),f.config=i,this},config:i,define:function(n,r,a){var o={moduleName:"",template:"",script:"",path:"",props:null,isComponent:!1,params:null,data:null,depend:[],beforeCreate:null,created:null,beforeLoad:null,loaded:null,hide:null,exports:null,show:null,beforeDestroy:null,destroyed:null},l={},c="";try{var s=v().name?v():function(e){var t=window.location.pathname,n=t.indexOf(".html"),r="",a="";a=n>-1?(r=t.substr(1,n))+".js":(r=t.substr(1))+".js";return{name:r,src:a}}(),f=s.name}catch(e){}var h=[];if(void 0===n)return e.showLog("define第1个参数不能为空"),this;"function"==typeof n?(a=n,c=f,r=[]):"object"===e.typeof(n)?(c=f,r=n.depend||[],a=n.loaded,l=t.extend(!0,{},o,n)):"array"===e.typeof(n)?(a=r,r=n,c=f):"function"==typeof r?(c=n,a=r,r=[]):(c=n,r=r,a=a);var g=d.hasOwnProperty(c)&&d[c].script||s.src,b=window.location.href.substr(0,window.location.href.indexOf("#")).replace("index.html","");g=g.replace(b,""),i.log&&console.log("define "+c),r.length&&(h=m(r,g));if("string"==typeof c&&"function"==typeof a){(l=n&&"object"===e.typeof(n)?t.extend(!0,{},o,d[c],e.config.loader.define,n):t.extend(!0,{},o,d[c],e.config.loader.define)).moduleName=c,l.depend=h,l.style=[],l.script=g,l.path=g.substr(0,g.lastIndexOf("/")+1),l.loaded=function(){var e=[y,d[f]&&d[f].exports,d[f],u.globals],t=[];h.length&&h.forEach((function(e,n){d[e]&&t.push(d[e].exports)}));var n=t.concat(e);return a&&a.apply(this,n)},l.isDefined=!0,p(l)}else e.showLog("define "+c+"模块的参数格式不对");return l},global:function(e){if("object"===_typeof(e))p({globals:e});else{if("function"!=typeof e)return p().globals;p({globals:e.call(f,u.globals)})}return f},require:y,destroy:function(n){i.log&&console.log("destroy "+n);var r="string"==typeof n?d[n]:null;if(r){r.beforeDestroy&&r.beforeDestroy.call(r);var a=t('script[name="'+n+'"]').attr("src");l=e.array.remove(l,a),t('script[name="'+n+'"]').remove(),delete u.modules[n],d=u.modules,r.destroyed&&r.destroyed.call(r)}},map:p,import:S,importCss:function(t,n){return new Promise((function(r,a){if("string"==typeof t){var o=e.hasRouter?t:e.unit.relativePath(t,i.relativePath),l=document.createElement("link")||{};l.href=o+(i.cache?"":"?t="+(new Date).getTime()),l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),n&&l.setAttribute("id",n),document.head&&document.head.appendChild(l),l=null,r(t,n)}else e.showLog(t+"的格式不正确")}))},importSync:T,importHtml:E,load:w,checkLoad:function(t){var n=!0,r=[];if(d=u.modules,"string"==typeof t){t.indexOf(",")>-1?r=t.split(","):r.push(t)}else t&&"array"===e.typeof(t)&&(r=t||[]);if(r.length)r.forEach((function(e,t){d.hasOwnProperty(e)||(n=!1),d[e]&&!1===d[e].isLoaded&&(n=!1)}));else for(var a in d)d[a]&&!1===d[a].isLoaded&&(n=!1);return n},components:O,component:k,delay:function(n){for(var r=t.extend(!0,{id:"",deepView:i.deepView,deepComponent:i.deepComponent,delay:!1,everytime:!1,param:null,beforeLoad:null,loaded:null,compiled:null},n),a=e.$(r.id),o=0;o<a.length;o++){var l=a[o],c=l&&l.getAttribute("delay"),s=l&&l.tagName.toLowerCase();("true"===c||r.everytime)&&("true"===c&&s===i.componentTag||r.everytime?(r.isSelf=!0,r.id=l,r.everytime?l.removeAttribute("delay"):l.setAttribute("delay","false"),k(r)):"true"===c&&s===i.viewTag||r.everytime?(r.isSelf=!0,r.id=l,l.removeAttribute("delay"),j(r)):(r.isSelf=!1,s=t(l).find('[delay="true"]')[0]&&t(l).find('[delay="true"]')[0].tagName.toLowerCase(),t(l).find('[delay="true"]').removeAttr("delay"),s===i.componentTag&&k(r),s===i.viewTag&&j(r)))}return this},views:I,view:j,get:function(e){if("string"==typeof e)return u.modules[e]||null},set:h,one:function(e,t){return o.one.apply(f,arguments),this},wait:function(e,t){return o.wait.apply(f,arguments),this},waited:function(e,t){return o.waited.apply(f,arguments),this},on:function(t,n){var r=e.history.getLast("id"),a=arguments,i=e.unit.stringToArray(t);return i.forEach((function(e,t){a[0]=r+"-"+e,o.on.apply(f,a)})),this},off:function(t,n){var r=e.history.getLast("id"),a=arguments,i=e.unit.stringToArray(t);return i.forEach((function(e,t){a[0]=r+"-"+e,o.off.apply(f,a)})),this},trigger:A};function p(n){if(void 0===n)return u;if("object"===_typeof(n)&&(n.hasOwnProperty("modules")||n.hasOwnProperty("baseUrl")||n.hasOwnProperty("globals")))u=t.extend(!0,{},u,n),d=u.modules;else if("object"===_typeof(n)&&n.hasOwnProperty("moduleName")){var r=function(n){var r={id:"",moduleName:"",template:"",data:null,props:null,isComponent:!1,params:null,depend:[],script:"",style:[],isDefined:!1,isLoaded:!1,beforeCreate:null,created:null,beforeLoad:null,loaded:null,show:null,hide:null,beforeDestroy:null,destroyed:null,path:"",exports:{},dependExports:[]},a={};d.hasOwnProperty(n.moduleName)&&(a=t.extend(!0,{},d[n.moduleName]));var i=t.extend(!0,{},r,a,n);n.props&&(i.props=n.props);return i.params=e.history.getParams("url"),i}(n);d[n.moduleName]=r||{},u=t.extend(!0,u,{modules:d}),d=u.modules}return u}function h(t,n){if(n&&"object"===e.typeof(n)){if(n.moduleName=t,n.hasOwnProperty("loaded")&&"function"==typeof n.loaded){var r=n.loaded;n.loaded=function(){d=u.modules;var e=n.moduleName,t=d[e].depend,a=[y,d[e]&&d[e].exports,d[e],u.globals],i=[];t.length&&t.forEach((function(e,t){d[e]&&i.push(d[e].exports)}));var o=i.concat(a);return r&&r.apply(this,o)},n.script=n.moduleName+".js",n.path=n.script.substr(0,n.script.lastIndexOf("/")+1)}n.depend&&n.depend.length&&(n.depend=m(n.depend,n.script)),p(n)}return this}function g(e,t){var n=e,r=t.lastIndexOf("/"),a=t.substr(0,r);return e.indexOf("../")>-1?(e=e.replace(/\..\//g,(function(e){var t=a.lastIndexOf("/");return a=a.substr(0,t),""})),n=a?a+"/"+e:e):e.indexOf("./")>-1&&(n=a+"/"+e.replace(/\.\//g,"")),n}function m(e,t){for(var n=[],r=0;r<e.length;r++){var a=e[r],i=a.indexOf("./")>-1?g(a,t):a;if(i.indexOf(".css")>-1)i.indexOf("css!")>-1?styles.push(i.substr(4)):styles.push(i);else{var o=i.indexOf(".js");o>-1&&(i=i.substr(0,o)),n.push(i),d.hasOwnProperty(i)||p({moduleName:i})}}return n}function v(){var e,n=window.location.href,o=[],l=document.currentScript;if(n.indexOf("#")>-1?o=n.split("#"):o.push(n),r=o[0].replace("/index.html","")+"/",l)return e=l.src.replace(r,""),{name:l.getAttribute("name")||e.substr("0",e.indexOf(i.scriptSuffix)),src:e};try{a()}catch(e){var c=(c=(e.stack||e.sourceURL||e.stacktrace||"").split(/[@ ]/g).pop().replace(/(:\d+)?:\d+$/i,"")).replace(new RegExp(r,"g"),"");return{name:(l=t('script[src="'+c+'"]')[0])?l.getAttribute("name"):c.replace(i.scriptSuffix,""),src:c}}}function y(t,n,r){if(i.log&&console.log("require "+t),r=1==r,"boolean"==typeof n&&(r=n,n=function(){}),t&&"string"==typeof t){if(t.indexOf(".css")>-1)return S(t,n);if(t.indexOf(".html")>-1)return S(t,n);t=[t]}if(n&&"function"!=typeof n&&"boolean"!=typeof n)return e.showLog("require第2个参数格式为函数或布尔值","bui.loader.require"),this;try{return function(t,n,r){var a=[];function o(t,n){t=t||[],d=u.modules;var r=e.array.uniq(t);r.length>1&&r.forEach((function(e,t){var n=d[e];(n&&1==n.isLoaded||n.loaded)&&r.splice(t,1)})),r.forEach((function(t,l){var c=d[t];if(d[t]&&d[t].style&&d[t]&&d[t].style.length&&C(d[t].style),e.array.compare(a,t)||a.unshift(t),c&&c.isLoaded){if(!1===(c&&c.beforeLoad&&c.beforeLoad.call(c,c.depend)))return!1;l==r.length-1&&(n&&n.apply(c),a=[])}else if(c&&c.loaded){if(s(t,l),!1===(d[t].beforeCreate&&d[t].beforeCreate.call(d[t])))return!1;d[t].created&&d[t].created.call(d[t])}else N(t,(function(){var e=d[t];if(!1===(e&&e.beforeCreate&&e.beforeCreate.call(d[t])))return!1;e&&e.style&&e.style.length&&C(e.style),e&&e.created&&e.created.call(d[t]),s(t,l)}),(function(){l==r.length-1&&(n&&n.apply(null),a=[])}));function s(e,t){var a=d[e];return a&&(a.isDefined=!0),a.id=c?c.id:"",a.props=c?c.props:{},!1!==(a&&a.beforeLoad&&a.beforeLoad.call(a,a.depend))&&(a&&a.depend&&a.depend.length?(i.log&&console.warn(a.moduleName+" depend:"),i.log&&console.log(a.depend),void o(a.depend,n)):void(t==r.length-1&&n&&n.apply(a)))}}))}return new Promise((function(l,c){o(t,(function(){if(function(e){var t=!0,n=e||[];if(d=u.modules,n.length)for(var r=0;r<n.length;r++){var a=n[r],o=d[a];if(o&&!1===o.isDefined)return t=!1,i.log&&console.warn("check defined false:"+o.moduleName),i.log&&console.warn("wait modules:"),i.log&&console.warn(n),t}else for(var l in d)if(d[l]&&!1===d[l].isDefined)return t=!1,i.log&&console.warn("check defined false:"+o.moduleName),t;return t}(a)){var o=[];t.forEach((function(a,i){h(a,{params:e.history.getParams("url")}),b(a,r),o.push(d[a]&&d[a].exports),i===t.length-1&&(n&&n.apply(f,o||[]),l.apply(f,o||[]))}))}}))}))}(t=t.map((function(t,n){return e.unit.resolvePath(t)})),n,r)}catch(t){e.showLog(t,"bui.loader.require")}return this}function b(t,n){d=u.modules;var r="string"==typeof t?d[t]||{}:t,a=r.depend||[],o=null,l=[];r.dependExports=[];try{if(a.length)for(var c=0;c<a.length;c++){var s=a[c],f=d[s];f.isLoaded?l[c]=f.exports:l[c]=b(f)||f.exports,f.exports=l[c],r.dependExports.push(l[c]),f.isLoaded=!0}o=r.isLoaded&&!r.isComponent||r.isLoaded&&!n?r.exports:r.loaded&&r.loaded.apply(r,l),r.exports=o||d[r.moduleName]&&d[r.moduleName].exports,r.isLoaded=!0,A(r.moduleName,r,r.exports),i.log&&console.log("execute "+r.moduleName)}catch(t){e.showLog(t,"bui.loader.execute")}return o}function w(n){var r=t.extend(!0,{id:"",cacheHtml:!1,cache:!1,url:"",script:"",param:null,template:null,beforeLoad:null,reload:!0,loaded:null},e.config.loader.load,n),a=t.Deferred();if(r.id){if(r.url){if(!1===("function"==typeof r.beforeLoad?r.beforeLoad.call(f):r.beforeLoad))return this;var i=function(e){var t=d,n={},r=e&&e.indexOf(".html");r>-1?(n.url=e,n.module=e.substr(0,r)):(n.url=t[e]&&t[e].template||e+".html",n.module=e);return n}(r.url);if(r.script){var o=r.script.indexOf(".js");i.module=r.script.substr(0,o)}var l="string"==typeof r.id&&(r.id.indexOf("#")>-1||r.id.indexOf(".")>-1)?r.id.substr(1):r.id;r.id=l,r.name=i.module,r.url=i.url,p({id:l,moduleName:i.module,props:r.param}),e.history.getLast().currentComponent=l,e.history.setComponent({id:r.id,name:r.name,url:r.url,param:r.param||null});var c=p().modules[r.name];if(c&&"function"==typeof c.template){var s=c.template.call(c)||"";return!r.cacheHtml&&e.obj(r.id).html(s),x(r),this}if(r.cacheHtml)return x(r),this;if("function"==typeof i.url){var u=i.url(r)||"";return!r.cacheHtml&&e.obj(r.id).html(u),x(r),this}return S(i.url,(function(t){!r.cacheHtml&&e.obj(r.id).html(t),x(r)}),(function(e){r.onFail&&r.onFail.call(this,i),a.reject.call(this,i)})),this}e.showLog("url不能为空")}else e.showLog("id不能为空")}function x(t){var n=p().modules[t.name];if(!1===(n.beforeLoad&&n.beforeLoad.call(n,n.depend)))return!1;if(h(t.name,{id:t.id,props:t.param||null,isComponent:!0}),n.isLoaded&&"function"==typeof n.loaded&&!t.cache){n.id=t.id,n.exports=n.loaded&&n.loaded.call(n,n.exports)||n.exports;var r={id:t.id,name:t.name,url:t.url,param:t.param||null,exports:n.exports||{}};return e.history.setComponent(r),window.store&&window.store.$mount&&window.store.$mount(t.id),t.loaded&&t.loaded.call(n,n.exports),A(t.id,r),f}e.checkLoad(t.name),y(t.name,(function(r){var a={id:t.id,name:t.name,url:t.url,param:t.param||null,exports:r||{}};e.history.setComponent(a),window.store&&window.store.$mount&&window.store.$mount(t.id),t.loaded&&t.loaded.call(n,r),A(t.id,a)}),t.reload)}function k(n){var r=t.extend(!0,{id:"",isSelf:!0,deepComponent:i.deepComponent,cache:!1,cacheHtml:!1,delay:!0,param:null,beforeLoad:null,loaded:null,compiled:null},e.config.loader.component,n),a=null;a=""===r.id?e.$(i.componentTag):r.isSelf?e.$(r.id):e.$(r.id).find(i.componentTag);for(var o=[],l=[],c=[],s=[],u=p().modules,d=0;d<a.length;d++){var f=a[d],h=e.guid();!f.id&&f.setAttribute("id",h);var g=e.unit.getAttributes(f),m=g.parentId=r&&r.id||e.history.getLast().id||"bui-page",v=e.$(m).parents("component"),y=r.isSelf?v[0]&&v[0].id:r.id;"array"===e.typeof(m)?y=r.isSelf?v&&v[0].id:m[0].id:"object"==_typeof(g.parentId)&&e.typeof(g.parentId).indexOf("element")>-1&&(y=r.isSelf?v[0]&&v[0].id:m.id);var b=y&&e.history.getComponent(y,"name");if(b)g.parentId=y,g.parentName=b;else{var x=e.history.getLast();g.parentId=x.id,g.parentName=x.name}var k=g.name||f.getAttribute("name"),O="true"===g.rendered||r.cacheHtml;if(k&&(!g.delay||!r.delay)){g=t.extend(!0,{},g,r.param);var P=u[k],I=f.innerHTML,j=P&&"string"==typeof P.template?P.template:k+".html",S=P&&P.script?P.script:k+".js";j=j||k+".html",P&&"function"==typeof P.template?o.push({id:f.id,el:f,name:k,cacheHtml:O,cache:r.cache,deepComponent:r.deepComponent,template:P.template||"",url:j,srcript:S,slot:I,param:g}):(c.push(j),s.push(S),l.push({id:f.id,el:f,name:k,cacheHtml:O,cache:r.cache,deepComponent:r.deepComponent,url:j,srcript:S,slot:I,param:g}))}}return o.length&&(o.forEach((function(e,t){w({id:e.id,url:e.url,param:e.param||null,template:e.template,cacheHtml:e.cacheHtml,cache:e.cache,beforeLoad:r.beforeLoad})})),r.data=o,L(r)),l.length?(T(e.array.merge(c,s),(function(e){!function t(n){var a=l[n];return n==l.length?(r.data=l,L(r),this):a?(a.template=e[n],void w({id:a.id,url:a.url,param:a.param||null,cacheHtml:a.cacheHtml,cache:a.cache,beforeLoad:r.beforeLoad,loaded:function(e){t(n+1)},onFail:function(){t(n+1)}})):this}(0)})),this):(r.compiled&&r.compiled(r.data),A("componentcompiled",r.data),!1)}function O(e){return k(t.extend(!0,{id:"",isSelf:!1,deepComponent:i.deepComponent,cache:!1,cacheHtml:!1,beforeLoad:null,loaded:null,compiled:null},e)),this}function L(t){for(var n=0;n<t.data.length;n++){var r=t.data[n];new RegExp("<".concat(i.viewTag,".+name="),"gi").test(r.template)&&I({id:r.id});var a=new RegExp("<".concat(i.componentTag,".+name="),"gi");new RegExp("<".concat(i.componentTag,'.+name="').concat(r.name,'"'),"gi").test(r.template)?e.showLog("请检查代码, <".concat(i.componentTag,' name="').concat(r.name,'"></').concat(i.componentTag,">的模板里面存在循环嵌套")):(t.deepComponent&&a.test(r.template)&&O({id:r.id}),t.loaded&&t.loaded(r),A("componentloaded",r))}t.compiled&&t.compiled(t.data),A("componentcompiled",t.data)}function P(n){for(var r=0;r<n.data.length;r++){var a=n.data[r];if(!a.cacheHtml){a.el.innerHTML=a.template;var o=new RegExp("<".concat(i.componentTag,".+name"),"gi");new RegExp("<".concat(i.componentTag,'.+name="').concat(a.name,'"'),"gi"),o.test(a.template)&&O({id:a.id});var l=new RegExp("<".concat(i.viewTag,'.+name="').concat(a.name,'"'),"gi"),c=new RegExp("<".concat(i.viewTag,'.+name="').concat(a.name,'"'),"gi");if(c.test(a.template)){e.showLog("请检查代码, <".concat(i.viewTag,' name="').concat(a.name,'"></').concat(i.viewTag,">的模板里面存在循环嵌套"));continue}n.deepView&&l.test(a.template)&&!c.test(a.template)&&I({id:t(a.el)})}n.loaded&&n.loaded(a),A("viewloaded",a)}n.compiled&&n.compiled(n.data),A("viewcompiled",n.data)}function I(e){return j(t.extend(!0,{id:"",isSelf:!1,deepView:i.deepView,loaded:null,compiled:null},e)),this}function j(n){var r=t.extend(!0,{id:"",isSelf:!0,deepView:i.deepView,loaded:null,compiled:null},n),a=null;a=""===r.id?e.$(i.viewTag):r.isSelf?e.$(r.id):e.$(r.id).find(i.viewTag);for(var o=[],l=[],c=loader.map().modules,s=0;s<a.length;s++){var u=a[s],d=u.getAttribute("name"),f=u.getAttribute("delay"),p=c[d],h="true"===u.getAttribute("rendered"),g=e.guid();if(!u.id&&u.setAttribute("id",g),"true"!==f){var m=u.innerHTML,v=p&&p.template?p.template:d+".html";p&&"function"==typeof p.template?l.push({id:u.id,el:u,name:d,cacheHtml:h,template:p.template.call(p)||"",url:v,slot:m}):o.push({id:u.id,el:u,name:d,cacheHtml:h,url:v,slot:m})}}return l.length&&(l.forEach((function(e,t){e.el.innerHTML=e.template,window.store&&window.store.$mount&&window.store.$mount(r.id)})),r.data=l,P(r)),function e(t){if(t==o.length)return r.data=o,void P(r);o[t]&&E(o[t].url,(function(n){o[t].template=n,e(t+1)}),(function(n){o[t].template="",e(t+1)}))}(0),this}function S(n,r,a){return new Promise((function(i,o){if("string"==typeof n)(n=e.unit.resolvePath(n)).indexOf(".css")>-1?(r&&r(n),R(n).then((function(e){i(n)}))):n.indexOf(".html")>-1||n.indexOf(".htm")>-1?E(n).then((function(e){if("function"!=typeof r)return t(r).html(e),a&&a(e),void i(e);r&&r(e),i(e)}),(function(e){a&&a(e),o(e)})):N(n).then((function(e){r&&r(e),i(e)}),(function(e){a&&a(e),o(e)}));else if(n&&"array"===e.typeof(n)){var l=n.map((function(t,n){return(t=e.unit.resolvePath(t)).indexOf(".css")>-1?R(t):t.indexOf(".html")>-1||t.indexOf(".htm")>-1?E(t):N(t)}));Promise.all(l).then((function(e){r&&r(e),i(e)}),(function(e){a&&a(e),o(e)}))}}))}function T(t,n,r){return new Promise((function(a,i){if("string"==typeof t)S(t,n,r);else if(t&&"array"===e.typeof(t)){var o=[];!function r(i){if(i==t.length)return n&&n(o),void a(o);var l=e.unit.resolvePath(t[i]);return l.indexOf(".css")>-1?R(l,(function(e){o.push(e),r(i+1)})):l.indexOf(".html")>-1||l.indexOf(".htm")>-1?E(l,(function(e){o.push(e),r(i+1)}),(function(e){r(i+1)})):N(l,(function(e){o.push(e),r(i+1)}),(function(e){r(i+1)}))}(0)}}))}function E(t,n,r){return new Promise((function(a,o){var l="function"==typeof n;if(t=e.hasRouter?t:e.unit.relativePath(t,i.relativePath),s.hasOwnProperty(t))return l?n&&n.call(f,s[t],200):"string"==typeof n&&e.$(n).html(s[t]),a(s[t],200),this;"string"==typeof t&&bui.ajax({baseUrl:i.baseUrl,url:t,dataType:"html",contentType:"text/html;charset=UTF-8",mimeType:"html",processData:!1,needNative:i.needNative,cache:i.cache,data:null,success:function(i,o,c){s[t]=i,l?n&&n.call(f,i,o,c):"string"==typeof n&&(e.$(n).html(i),r&&r.call(f,i,o,c)),a(i,o)},error:function(e,t,n){l&&r&&r.call(f,e,t,n),o(e,t,n)}})}))}function N(n,r,a){return new Promise((function(o,c){var s;if(d=u.modules,void 0===n||""==n)return a&&a.call(this,n),c(n),this;if(n in d)s=n,n=d[n].script||s+i.scriptSuffix;else{var f=n.indexOf(i.scriptSuffix);f>-1?s=(n=n).substr(0,f):(s=n,n+=i.scriptSuffix)}n=e.hasRouter?n:e.unit.relativePath(n,i.relativePath);var p=document.createElement("script")||{},h=i.cache?"":"?t="+(new Date).getTime(),g=n.indexOf("http://")>-1||n.indexOf("https://")>-1;p.type="text/javascript",p.async=!1,p.src=g?n+h:u.baseUrl+n+h,p.setAttribute("name",s),p.onload=function(){i.log&&console.log("create "+n),r&&r(n),o(n)},p.onerror=function(e){i.log&&console.log("createError "+n),a&&a(n),c(n)};var m=e.array.index(l,n);return d[s]&&d[s].isDefined?(r&&r(n),o(n)):(m>-1&&d.hasOwnProperty(s)&&t('script[name="'+s+'"]').remove(),m>-1&&!d.hasOwnProperty(s)&&t('script[name="'+s+'"]').remove(),document.body&&document.body.appendChild(p),i.cache&&l.push(n)),p=null,this}))}function C(t){return new Promise((function(n,r){if(t.length,"array"===e.typeof(t)){var a=t.map((function(e){return R(e)}));return Promise.all(a)}return R(t)}))}function R(t,n){return new Promise((function(r,a){if("string"==typeof t){if(e.array.index(c,t)<0){var o=e.hasRouter?t:e.unit.relativePath(t,i.relativePath),l=document.createElement("link")||{};l.href=o+(i.cache?"":"?t="+(new Date).getTime()),l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),document.head&&document.head.appendChild(l),l=null,c.push(t)}r(t,n)}else e.showLog(t+"的格式不正确")}))}function A(t){f.self=this==window||this==f?null:this;var n=e.history.getLast("id");arguments[0]=n+"-"+t,o.trigger.apply(f,arguments)}return f},window.loader=e.loader(),e.define=loader.define,e.require=loader.require,e.map=loader.map,e.import=loader.import,e.checkLoad=loader.checkLoad,e.checkDefine=loader.checkDefine,e.checkImport=loader.checkImport}(window.bui||{},window.libs),function(e,t){e.toggle=function(n){if("string"==typeof n){var r=n||"";(n={}).id=r}var a,i,o={show:function(t,n){if(s)return;if(d=e.objId(l.id),!f&&!p)return!1;f=!1,"function"==typeof t?(t=t,n=n||i||""):(n=t||i||"",t=null);d[0]&&"none"==d[0].style.display&&d.css("display",c);d.addClass("animated "+n),"showIn"==n||"showOut"==n||"none"==n?(l.revert&&d.removeClass("animated "+n),t&&t.call(o,this),h=!0,f=!0):d.one("webkitAnimationEnd",(function(){try{!h&&d.css("display",c),l.revert&&d.removeClass("animated "+n),t&&t.call(o,this),h=!0,f=!0}catch(t){e.showLog(t,"toggle show method")}}));return this},hide:function(t,n){if(s)return;if(d=e.objId(l.id),!f&&!p)return;p=!1,"function"==typeof t?(t=t,n=n||a||""):(n=t||a||"",t=null);d.css("display",c).addClass("animated "+n),"showIn"==n||"showOut"==n||"none"==n?(d.css("display","none"),l.revert&&d.removeClass("animated "+n),t&&t.call(o,this),h=!1,p=!0):d.one("webkitAnimationEnd",(function(){try{d.css("display","none"),l.revert&&d.removeClass("animated "+n),t&&t.call(o,this),h=!1,p=!0}catch(t){e.showLog(t,"toggle hide method")}}));return this},remove:function(){return d.remove(),this},isShow:function(){return h},destroy:function(e){e=1==e;d&&(d.off(),e&&d.remove());s=!0},widget:function(t){return e.widget.call({},t)},option:function(t,n){return e.option.call(o,t,n)},config:l,init:g},l=o.config=t.extend(!0,{},{id:"",effect:"fadeIn",useBox:!1,revert:!0,inOrder:!1},n),c=l.useBox?"-webkit-box":"block",s=!1,u={show:["fadeIn","fadeInLeft","fadeInRight","fadeInDown","fadeInUp","fadeInLeftBig","fadeInRightBig","fadeInUpBig","fadeInDownBig","zoomIn","bounceIn","rotateIn","rollIn","flipInX","flipInY","lightSpeedIn","showIn","slideInRight","slideInLeft","coverInLeft","coverInRight","zoomSlideInLeft","zoomSlideInRight","pushInLeft","pushInRight"],hide:["fadeOut","fadeOutLeft","fadeOutRight","fadeOutUp","fadeOutDown","fadeOutLeftBig","fadeOutRightBig","fadeOutDownBig","fadeOutUpBig","zoomOut","bounceOut","rotateOut","rollOut","flipOutX","flipOutY","lightSpeedOut","showOut","slideOutRight","slideOutLeft","coverOutLeft","coverOutRight","zoomSlideOutLeft","zoomSlideOutRight","pushOutLeft","pushOutRight"],hideInOrder:["fadeOut","fadeOutRight","fadeOutLeft","fadeOutDown","fadeOutUp","fadeOutRightBig","fadeOutLeftBig","fadeOutUpBig","fadeOutDownBig","zoomOut","bounceOut","rotateOut","rollOut","flipOutX","flipOutY","lightSpeedOut","showOut","slideOutLeft","slideOutRight","coverOutRight","coverOutLeft","zoomSlideOutRight","zoomSlideOutLeft","pushOutRight","pushOutLeft"]},d=null,f=!0,p=!0,h=!1;function g(t){if(s=!1,(t=t||l).id){d=e.objId(t.id),l=o.config=t,d.attr("class");var n=t.effect,r=t.inOrder?e.array.index(u.hideInOrder,n):e.array.index(u.hide,n),c=n&&(e.array.index(u.show,n)>-1?e.array.index(u.show,n):r);return h=!(d[0]&&"none"==d[0].style.display||"none"==d.css("display")),c<0?(i=u.show[0],a=t.inOrder?u.hideInOrder[0]:u.hide[0]):(i=u.show[c],a=t.inOrder?u.hideInOrder[c]:u.hide[c]),this}e.showLog("toggle id不能为空","bui.toggle")}return l.id&&g(l),o}}(window.bui||{},window.libs),function(e,t){e.unit={},e.unit.remToPx=function(e){var t=window&&window.viewport&&window.viewport.fontSize||100;return e=(parseFloat(e)*t).toFixed(2)},e.unit.pxToRem=function(e){var t=window&&window.viewport&&window.viewport.fontSize||100;return e=(parseFloat(e)/t).toFixed(2)},e.unit.pxToRemZoom=function(e){return e=(parseFloat(e)/100).toFixed(2)},e.unit.debounce=function(e,t,n){var r;return function(){var a=n||this,i=arguments,o=function(){r=null,e.apply(a,i)};clearTimeout(r),r=setTimeout(o,t)}},e.unit.throttle=function(e,t,n){var r,a;return t||(t=250),function(){var i=n||this,o=+new Date,l=arguments;r&&o<r+t?(clearTimeout(a),a=setTimeout((function(){r=o,e.apply(i,l)}),t)):(r=o,e.apply(i,l))}},e.unit.startWithCss=function(e){var t=new RegExp("^\\.|^#");return"string"==typeof e&&t.test(e)},e.unit.startWithStr=function(e,t){var n=new RegExp("^"+t);return"string"==typeof e&&n.test(e)},e.unit.startWithId=function(e){var t=new RegExp("^#");return"string"==typeof e&&t.test(e)},e.unit.startWithClass=function(e){var t=new RegExp("^\\.");return"string"==typeof e&&t.test(e)},e.unit.endWithImage=function(e){var t=new RegExp("(.png|.jpg|.gif)$");return"string"==typeof e&&t.test(e)},e.unit.tel=function(t){var n,r="tel:";return 0==(t=String(t)).indexOf("+")&&(r="wtai://wp/mc;"),n=t,window.location.href=r+n,e},e.unit.sms=function(t,n){var r=navigator.userAgent,a=/(iPhone|iPad|iOS)/i.test(r)?"&":"?";return window.location.href="sms:"+t+a+"body="+n,e},e.unit.mailto=function(t){return"string"==typeof(t="email"in t?t:{}).email&&t.email.indexOf("@")>0?window.location.href="mailto:"+t.email+"?subject="+(t.subject||"")+"&body="+(t.body||"")+"&cc="+(t.cc||""):e.showLog(email+"格式不正确"),e},e.unit.openExtral=function(t){var n=[],r="";if((t=String(t)).indexOf("mailto:")>=0)if((r=(n=t.split("mailto:"))[1]).indexOf("?")>-1){var a=r.split("?"),i=e.unit.keyStringToObject(a[1]);i.email=a[0],e.unit.mailto(i)}else e.unit.mailto({email:r});if(t.indexOf("tel:")>=0&&(n=t.split("tel:"),r=parseInt(n[1]),e.unit.tel(r)),t.indexOf("sms:")>=0)if(r=(n=t.split("sms:"))[1],t.indexOf("=")>=0){var o=t.split("=")[1];e.unit.sms(r,o)}else e.unit.sms(r);return e},e.unit.objectToKeyString=function(e,t){var n="";for(var r in e){n+="&"+r+"="+(t?encodeURIComponent(e[r]):e[r])}return n.substr(1)},e.unit.keyStringToObject=function(t,n){var r,a={},i=[];try{for(i=t.split("&"),r=0;r<i.length;r++){var o=n?decodeURIComponent(i[r].split("=")[1]):i[r].split("=")[1];a[i[r].split("=")[0]]=o}}catch(t){e.showLog(t)}return a},e.unit.checkTargetInclude=function(e,n){var r=n,a=[];if(r.indexOf(",")>-1){var i,o=(a=r.split(",")).length;for(i=0;i<o;i++){var l=a[i];l.indexOf(".")>-1&&(a[i]=l.substr(1))}}else r.indexOf(".")>-1?a[0]=r.substr(1):a[0]=r;var c,s=a.length;for(c=0;c<s;c++)if(t(e).hasClass(a[c])||t(e).closest("."+a[c]).length)return!0;return!1},e.unit.jsonToString=function(t){return"object"===_typeof(t)?function(t){var n;if("object"===e.typeof(t)){for(var r in t)t[r]=a(t,r);n=JSON.stringify(t)}else"array"===e.typeof(t)?(t.forEach((function(e,n){t[n]=a(t,n)})),n=JSON.stringify(t)):n=t;function a(t,n){var r=t[n];return r&&"object"===e.typeof(r)?t[n]=function(t){if(t&&"object"===e.typeof(t)){for(var n in t){var r=t[n];"object"===_typeof(r)&&(t[n]=JSON.stringify(r))}return t}}(r):r&&"array"===e.typeof(r)?t[n]=function(t){if(t&&"array"===e.typeof(t))return t.forEach((function(e,n){"object"===_typeof(e)&&(t[n]=JSON.stringify(e))})),t}(r):t[n]=r,t[n]}return n}(t):t},e.unit.stringToJson=function(t){return t&&function t(n){var r,a;try{if(r="object"===_typeof(n)?n:JSON.parse(n),"array"===e.typeof(r))r.forEach((function(e,n){r[n]=t(e)}));else if("object"===e.typeof(r))for(var i in r){var o=r[i];r[i]=t(o)}a=r}catch(e){a=n}return a}(t)},e.unit.stringToArray=function(t){var n=e.typeof(t);return"array"===n?t:"string"===n&&t.indexOf(",")>-1?t.split(","):[t]},e.unit.setKeyValue=function(e,t,n){var r=e&&e.indexOf(".")>-1?e.split("."):[e];return function e(n,a){if(r.length)return e(r.shift(),a[n]||{});a[n]=t}(r.shift(),n)},e.unit.getKeyValue=function(e,t){var n=e&&e.indexOf(".")>-1?e.split("."):[e];return function e(t,r){var a=r[t];if(a&&"string"==typeof a&&a.indexOf("{")>-1&&a.indexOf("}")>-1)try{r[t]=JSON.parse(a)}catch(e){r[t]=a}return void 0!==a&&n.length?e(n.shift(),a):a}(n.shift(),t)},e.unit.getKeyObj=function(e,t){var n=e&&e.indexOf(".")>-1?e.split("."):[e];return function e(t,r){var a=r[t];return!a instanceof Array&&a instanceof Object?e(n.shift(),a):a}(n.shift(),t)},e.unit.getKeyName=function(e){var t=field&&field.indexOf(".")>-1?field.split("."):[field];return function e(n,r){var a=r[n];return!a instanceof Array&&a instanceof Object?e(t.shift(),a):a}(t.shift(),e)},e.unit.delKey=function(e,t){var n=e&&e.indexOf(".")>-1?e.split("."):[e];return function e(r,a){return n.length?e(n.shift(),a[r]):(delete a[r],t)}(n.shift(),t)},e.unit.calcHeight=function(e,n){var r=t(e);r[0]&&(r[0].style.height="calc(100% - "+n+")")},e.unit.resolvePath=function(t){if(!e.hasRouter)return t;var n=t=t||"",r=(router&&router.history&&router.history.getLast()||{url:n}).url||"";if("function"==typeof r)return n;var a=r.lastIndexOf("/"),i=r.substr(0,a);return t.indexOf("../")>-1?(t=t.replace(/\..\//g,(function(e){var t=i.lastIndexOf("/");return i=i.substr(0,t),""})),n=i?i+"/"+t:t):t.indexOf("./")>-1&&(n=i+"/"+t.replace(/\.\//g,"")),n},e.unit.filterField=function(t,n){var r={};if("object"===_typeof(n)){var a="object"===e.typeof(t),i="object"===e.typeof(n),o="array"===e.typeof(t),l="array"===e.typeof(n);if(a){if(i)for(var c in n)r[c]=n[c]?t[n[c]]:t[c];else l&&n.forEach((function(e,n){r[e]=t[e]}));return r}return o?(r=[],l?t.forEach((function(e,t){var a={};n.forEach((function(t,n){a[t]=e[t]})),r.push(a)})):i&&t.forEach((function(e,t){var a={};for(var i in n)a[i]=n[i]?e[n[i]]:e[i];r.push(a)})),r):void 0}},e.unit.fixZero=function(e){return e<10?"0"+e:e},e.unit.getAttributes=function(t){if("object"!==_typeof(t))return null;var n={},r=/\{.+\}$/g,a=/\[.+\]$/g;return t.attributes&&Object.keys(t.attributes).forEach((function(i,o){var l=t.attributes[i],c=l.value;if(r.test(c)||a.test(c))try{c=JSON.parse(c)}catch(t){c=c,e.showLog(t)}n[l.name]=c})),n},e.unit.resolvePathname=function(e,t){t=t||0;var n=e.lastIndexOf("/"),r=e.substring(t,n);return r.indexOf("/")>-1?r.split("/"):[r]},e.unit.relativeUrl=function(e,t){var n=[];return t.length>=e.length?t.forEach((function(t,r){var a=e[r];a&&t===a||(a&&t!==a?(n.unshift(".."),n.push(t)):n.push(t))})):e.forEach((function(e,r){var a=t[r];a&&e===a||(a&&e!==a?(n.unshift(".."),n.push(a)):n.unshift(".."))})),n},e.unit.relativePath=function(t,n){n=n||"pages";var r=window.self.location.href;if(r.indexOf("source.html?url=")>-1&&r.indexOf("code=")>-1)return t;if(0===t.indexOf("http://")||0===t.indexOf("https://"))return t;var a=window.location.href,i=a.indexOf(n),o=t&&t.indexOf("/")>-1?t.split("/"):[t],l=[];if(i<0){var c=window.location.pathname.toLocaleLowerCase(),s=c.indexOf("www"),u=c.indexOf("src"),d=c.indexOf("dist");if(s>-1){var f=e.unit.resolvePathname(c,s+4);l=e.unit.relativeUrl(f,o)}else if(d>-1){var p=e.unit.resolvePathname(c,d+5);l=e.unit.relativeUrl(p,o)}else{if(!(u>-1))return 0==t.indexOf("/")?t.replace("/",""):t;var h=e.unit.resolvePathname(c,u+4);l=e.unit.relativeUrl(h,o)}}else{var g=e.unit.resolvePathname(a,i);l=e.unit.relativeUrl(g,o)}return l.join("/")},e.unit.between=function(t,n,r){var a=!0,i=new Date;if(n=n||0,r=r||e.date.convert(i.getFullYear+"/12/31").getTime(),"number"==typeof t)(t<n||t>r)&&(a=!1);else{n||e.showLog("bui.unit.between 第2个参数为最小日期");try{n=e.date.convert(n).getTime(),r=e.date.convert(r).getTime(),((t=e.date.convert(t).getTime())<n||t>r)&&(a=!1)}catch(t){e.showLog("bui.unit.between 用来检测数字或者日期,请检查参数格式是否正确")}}return a},e.unit.numberunit=function(e){var t=+e,n=t;return t>1e4&&(n=parseFloat(t/1e4).toFixed(1)+"万"),n}}(window.bui||{},window.libs),function(e,t){var n,r,a,i;e.history=(a=[],i={get:function(t,n){if(void 0===t)return a;var r=n||"name";return e.array.get(a,t,r)},getLast:function(e){var t=a.length-1,n=a[t]||{};return e?n[e]:n},getPrev:function(e){var t=a.length-2,n=a[t]||{};return e?n[e]:n},getParams:function(e){var t=this.getLast(),n={};switch(e){case"page":n=this.getPageParam()||n;break;case"part":case"component":n=this.getComponentParam()||n;break;case"url":n=t.param||bui.getUrlParams();break;default:n=this.getComponentParam(e)||this.getPageParam(e)||t.param||bui.getUrlParams()}return n},setComponent:function(e){return this.getLast().component[e.id]=e,e},getComponentParam:function(e){var t=this.getLast(),n=e||t.currentComponent;return n&&t.component[n]&&t.component[n].param||null},getComponent:function(t,n){if(void 0!==t){n=n||"exports";var r=this.getLast();return r.component[t]&&r.component[t][n]||null}e.showLog("必须传component id才能获取实例")},getParentComponent:function(){var e=this.getComponentParam();return e&&e.parentId&&this.getComponent(e.parentId)||this.getLast("exports")},getParentParams:function(){var e=this.getComponentParam();return this.getParams(e.parentId)||this.getLast("param")||null},getPage:function(t,n){if(void 0!==t){n=n||"exports";var r=this.getLast(),a=null,i=r.page;if(i.hasOwnProperty(t))a=i[t]&&i[t][n]||{};else if(t)for(var o=Object.keys(i),l=0;l<o.length;l++){var c=i[o[l]]||{};if(c.name===t)return c[n]}else{var s=r.currentPage;a=i[s]&&i[s][n]||{}}return a}e.showLog("必须传page id 或者 模块名才能获取实例")},getPageDialog:function(t){if(void 0!==t){var n=this.getLast();return n.page[t]&&n.page[t].dialog||null}e.showLog("必须传page id才能获取对话框信息")},setPage:function(n){var r=this.getLast();if("object"!==_typeof(n))return n;if(n&&n.hasOwnProperty("id")){var a,i=t.extend(!0,{},r.page[n.id],n);for(a in i.param)i.param[a]&&"array"==e.typeof(i.param[a])&&(i.param[a]=n.param[a]||[]);return r.page[n.id]=i,n}},getPageParam:function(e){var t=this.getLast(),n=e||t.currentPage;return n&&t.page[n]&&t.page[n].param||null},add:function(n){var r=t.extend(!0,{id:"",name:"",url:"",replace:!1,syncHistory:!0,component:{},param:{},part:{},page:{},toggle:null,effect:"push"},n),i=a;if(n.toggle){var o=t.extend(!0,{},r,n);r.toggle=null,i.push(o)}else i.push(r);var l=window.location.origin+window.location.pathname+"#"+r.name,c=e.setUrlParams(l,r.param);return r.syncHistory&&"pushState"in window.history&&window.history.pushState(r,null,c),i},replace:function(n){n=t.extend(!0,{id:"",name:"",url:"",replace:!1,syncHistory:!0,param:{},part:{},page:{},toggle:null,effect:"push"},opts);var r=a,i=r.length-1,o=window.location.origin+window.location.pathname+"#"+n.name,l=e.setUrlParams(o,n.param);if(i>-1){if(opts.toggle){var c=t.extend(!0,{},n,opts);n.toggle=null,r.splice(i,1,c)}else r.splice(i,1,n);n.syncHistory&&"replaceState"in window.history&&window.history.replaceState(n,null,l)}return r},refresh:function(){if(e.hasRouter){var n=i.getLast(),r=loader.get(n.name);loader.import(n.url,(function(a){t("#"+n.id).html(a),e.config.init.auto&&e.init(),router.config.needView&&loader.views(),r.loaded(),router.config.needComponent&&loader.components()}))}else window.location.reload(!0)},removeNext:function(t){var n=a,r=t.index;if(parseInt(r)<0)return e.showLog("index 必须大于或者等于0"),n;var i=n.length-r;n.splice(r,i);var o=this.getLast(),l=window.location.origin+window.location.pathname+"#"+o.name,c=e.setUrlParams(l,o.param);return t.syncHistory&&"replaceState"in window.history&&window.history.replaceState(o.param,null,c),n},removeLast:function(e){var t=a.length-1;return this.removeNext({index:t,syncHistory:!1!==e})},check:function(t){var n=a;return e.array.compare(n,t,"name")||e.array.compare(n,t,"url")||e.array.compare(n,t,"id")},checkComponent:function(t){var n=this.getLast(),r=Object.keys(n.component);return e.array.compare(r,t)},checkPage:function(e,t){for(var n=this.getLast(),r=Object.keys(n.page),a=0;a<r.length;a++){var i=r[a],o=n.page[i];if(o.name===e||o.id===e)return!0}return!1},epmty:function(e){return a=[]}},n=function(t){var n=(t=t&&t.replace(window.location.origin,"")||window.location.pathname).indexOf(".html"),r=t.indexOf("?"),a="",i="",o="",l=null,c=loader.map().modules;if(r>-1){var s=t.substr(r+1);l=e.unit.keyStringToObject(s,!0)}return n>-1?(i=(a=0==t.indexOf("/")?t.substr(1,n-1):t.substr(0,n-1))+".html",o=a+".js"):(i=c[a=t]&&c[a].template||"",o=c[a]&&c[a].script||""),{pid:a,name:a,url:i,src:o,param:l}}(window.location.href),r=e.guid(),t(document).ready((function(){document.body.setAttribute("id",r)})),a.push({id:e.guid(),pid:n.pid,name:n.pid,url:n.url,src:n.src,param:n.param,page:{},component:{}}),i)}(window.bui||{},window.libs),function(e,t){e.router=function(n){var r,a,i,o=t.extend({},{id:"",progress:!1,syncHistory:!0,autoInit:!0,firstAnimate:!1,path:"",indexModule:{moduleName:"main",template:"pages/main/main.html",script:"pages/main/main.js"},repairPath:!0,parseurl:!0,errorPage:"",hash:!1,cache:!0,reloadCache:!1,reload:!1,swipe:!1,swipeBack:!1,distance:100,startDistance:5,swipeDistance:50,onSwipeRight:null,onSwipeLeft:null,onSwipeUp:null,onSwipeDown:null,onBeforeSwipeRight:null,onSwipeCancel:null,pageMove:!0,needNative:!1,needView:!1,needComponent:!0,useScroll:"main,.bui-tab-main>ul>li,.bui-dialog-main,.bui-scroll,.bui-scroll-x",beforeBack:null,beforeLoad:null,loaded:null,store:null,width:0,height:0,async:!0,effect:"push",hashPrefix:"#",scriptSuffix:".js",pageSuffix:".html"},e.config.router,n),l=null,c=this,s=null,u=null,d=null,f="",p="",h=!0,g=!0,m=!1,v=!1,y={none:{inRight:"showIn",inLeft:"showIn"},fadein:{inRight:"fadeIn",inLeft:"fadeIn"},fadeinslide:{inRight:"fadeInRight",inLeft:"fadeInLeft"},slide:{inRight:"slideInRight",inLeft:"slideInLeft"},push:{inRight:"pushInRight",inLeft:"pushInLeft"},zoom:{inRight:"zoomIn",inLeft:"zoomIn"},cover:{inRight:"coverInRight",inLeft:"coverInLeft"},zoomslide:{inRight:"zoomSlideInRight",inLeft:"zoomSlideInLeft"},fadeinslideback:{inRight:"fadeInLeft",inLeft:"fadeInRight"},slideback:{inRight:"slideInLeft",inLeft:"slideInRight"},pushback:{inRight:"pushInLeft",inLeft:"pushInRight"},coverback:{inRight:"coverInLeft",inLeft:"coverInRight"},zoomslideback:{inRight:"zoomSlideInLeft",inLeft:"zoomSlideInRight"}},b={},w={},x={},k={},O=!1,L={},P={},I=loader.map(o.indexModule),j=e.history.epmty(),S=I.modules,T=e.storage({local:!1});function E(e){var t=window.location.hash||window.location.search,n=window.location.search,r=n&&n.indexOf("?"),a=(e=0!=e,t&&t.indexOf("?")),i=a>-1?t&&t.substr(1,a-1):window.location.hash.substr(1),l=i&&i.indexOf(o.pageSuffix),c=l>-1?i.substr(0,l):i,s=l>-1?i:i+o.pageSuffix,u={};function d(t,n){for(var r=t&&t.substr(n+1),a=r&&r.split("&"),i=0;i<a.length;i++){var o=e?decodeURIComponent(a[i].split("=")[1]):a[i].split("=")[1];u[a[i].split("=")[0]]=o}}return a>-1&&(d(n,r),d(t,a)),{pid:c,url:s,param:u}}function N(n){var r={id:"",url:"",param:{},effect:"",command:"html",path:o.path,repairPath:o.repairPath,firstAnimate:o.firstAnimate,progress:o.progress,reload:o.reload,autoInit:o.autoInit,needView:o.needView,needComponent:o.needComponent,replace:!1,iframe:!1,decode:!1,part:!1,cache:o.cache,callback:null,beforeLoad:o.beforeLoad,loaded:o.loaded},c=t.extend(!0,{},r,n),f=t.Deferred(),g=w.getLast()||null;j[j.length-2],c.url.indexOf("./")>-1&&(c.url=function(e,t){var n=e,r=t.url.lastIndexOf("/"),a=t.url.substr(0,r);e.indexOf("../")>-1?(e=e.replace(/\..\//g,(function(e){var t=a.lastIndexOf("/");return a=a.substr(0,t),""})),n=a?a+"/"+e:e):e.indexOf("./")>-1&&(n=a+"/"+e.replace(/\.\//g,""));return n}(c.url,g)),c.repairPath&&0===c.url.indexOf("/")&&(c.url=c.url.substr(1)),c.path&&(c.path="/"==c.path[c.path.length-1]?c.path:c.path+"/"),c.url=c.url in S||c.iframe||c.url.indexOf("http:")>-1?c.url:c.path+c.url,document.activeElement.blur();var v=null,y={};c.id=(c.id&&c.id.indexOf("#")>-1?c.id.substr(1):c.id)||"";var k=c.replace||c.part?g.id:c.id||e.guid(),I=e.objId(k);if(!c.url)return e.showLog("url 不能为空","bui.router.load"),f.promise();if(c.url=c.decode?decodeURIComponent(c.url):c.url,c.url.indexOf("tel:")>=0||c.url.indexOf("mailto:")>=0||c.url.indexOf("sms:")>=0)return e.unit.openExtral(c.url),f.promise();if(c.url&&c.url.indexOf("?")>-1){var T=c.url.split("?");y=e.unit.keyStringToObject(T[1]),c.url=T[0]}v=t.extend(!0,{},y,c.param),"wechat_redirect"==c.url?c.url="main":"undefined"==c.url&&(c.url=o.errorPage||"main"),c.iframe=Boolean(c.iframe)||"true"==v.iframe,1==c.iframe&&(v.iframe=!0);var E=C(c.url),R=E.pid||params.errorPage||"main",A=c.iframe?c.url:E.url,V={id:k,pid:R,name:R,url:"function"==typeof A?c.url:A,replace:c.replace,param:v,component:{},page:{},toggle:null,exports:{},effect:n.effect||o.effect,syncHistory:o.syncHistory},B="function"==typeof c.beforeLoad?c.beforeLoad.call(M,{prevTarget:g,target:V}):c.beforeLoad;if(H.call(M,"loadbefore",{prevTarget:g,target:V}),H.call(M,"beforeload",{prevTarget:g,target:V}),!1===B)return h=!1,this;if(c.part,i&&i.show(),c.progress&&a&&a.show(),loader.map({moduleName:R,id:k}),loader.get(V.pid),j.length&&c.effect){var z=j.length-1;j[z].effect=c.effect}!m&&!c.part&&!c.replace&&w.add(V),c.replace&&w.replace(V);var q=V;if(c.part&&(e.history.setComponent({id:k,pid:R,url:A,param:v}),q.currentComponent=k,j.splice(j.length-1,1,q)),c.part||V,x[R])!function(e){Y(L.get(e.pid,"template")),e.part?Z(e):(J(),!m&&X((function(){e.firstAnimate&&(Z(e),e.loaded&&e.loaded({prevTarget:g,target:V}),e.callback&&e.callback({prevTarget:g,target:V})),e.progress&&a&&a.hide()})),!e.firstAnimate&&Z(e))}({pid:R,progress:c.progress,part:c.part,firstAnimate:c.firstAnimate}),H.call(M,"complete",{prevTarget:g,target:V}),o.needComponent&&loader.components(),c.firstAnimate||(c.loaded&&c.loaded({prevTarget:g,target:V}),c.callback&&c.callback({prevTarget:g,target:V}));else{if(c.iframe)return function(t){var n=function(t){var n=t.url.indexOf(".html")>-1||0==t.url.indexOf("http")?t.url:t.url+".html",r=t.param?e.setUrlParams(n,t.param):n,a="",i=e.platform.isIos()?'scrolling="no"':"";return a+='<div id="'+t.id+'" class="bui-router-item bui-router-fixiframe" data-page="'+t.pid+'">',a+='<iframe class="bui-router-iframe" src="'+r+'" '+i+' name="'+t.pid+'"></iframe>',a+="</div>"}({id:t.id,pid:t.pid,url:t.url,param:t.param});s&&s.attr("data-main",t.id).append(n),X((function(){c.progress&&a&&a.hide()}))}({id:k,pid:R,url:c.url,param:v}),f.promise();if(c.part)return _(A,(function(t,n,r){e.objId(k)[c.command](t),W(Q),c.cache&&L.add(R,{id:k,pid:R,template:t}),i&&i.hide(),c.progress&&a&&a.hide()}),(function(e,t,n){K(A,e),H.call(M,"loadfail",e,t,n)})),f.promise();_(A,(function(e,t,n){if("object"===_typeof(e))return K(A,e),!1;Y(e),c.cache&&L.add(R,{id:k,pid:R,template:e}),J(),c.firstAnimate?X((function(){W(Q),c.progress&&a&&a.hide(),P.add(R,{id:k,pid:R,param:v})})):(X((function(){c.progress&&a&&a.hide()})),W(Q),P.add(R,{id:k,pid:R,param:v}))}),(function(e,t,n){K(A,e),H.call(M,"loadfail",e,t,n)}))}function K(t,n,r,l){if(i&&i.hide(),c.progress&&a&&a.hide(),w.removeLast(),f.reject(t),"object"===_typeof(n))return e.showLog("找不到页面"+t,"bui.router.load"),o.errorPage&&function(e){!function(e){var t,n=window.location.href,r=(t=(t=n.indexOf(o.hashPrefix))>-1?t:0)>-1?n.substr(0,t):n;N({url:o.errorPage||r,param:{error:e}}),H.call(M,"error",{target:e,status:404})}(e)}(t),!1}function W(t){m||b[R]?(q.exports=b[R],Z({pid:R}),O&&X(),t&&t(),o.needComponent&&loader.components()):(loader.checkLoad(R)?(Z({pid:R}),o.needComponent&&loader.components(),t&&t()):(o.needComponent&&loader.components(),loader.require(R,(function(n){try{if(c.firstAnimate&&c.progress&&a&&a.hide(),b[R]=n||null,V.exports=n,f.resolve(n),h||c.firstAnimate||c.replace){var r=loader.get(R);r&&r.show&&r.show({type:"firstload",target:V})}t&&t(),c.loaded&&c.loaded({prevTarget:g,target:V}),c.callback&&c.callback({prevTarget:g,target:V})}catch(t){e.showLog(t,"bui.router.load"),f.reject()}}))),H.call(M,"complete",{prevTarget:g,target:V}))}function J(){var t=(l=e.objId(q.id))&&l.find(".bui-page");t&&t.length&&c.autoInit&&e.init({id:t,height:p})}function X(t){l=e.objId(k),F(),D();try{if(h||m||c.replace||c.part){t&&t(),!c.firstAnimate&&c.progress&&a&&a.hide(),i&&i.hide(),l&&l.css("zIndex",5);var n="pageshow-"+w.getLast().pid;H.call(M,"pageshow",{type:"load",target:w.getLast()}),H.call(M,n,{type:"load",target:w.getLast()})}else u&&u.hide(),d&&d.show((function(){t&&t(),!c.firstAnimate&&c.progress&&a&&a.hide(),l&&l.css("zIndex",5),i&&i.hide();var e=j[j.length-2]||{},n=w.getLast(),r=loader.get(n.pid),o=e&&e.pid&&loader.get(e.pid)||null,s="pageshow-"+n.pid,u="pagehide-"+e.pid;H.call(M,u,{type:"load",target:j[j.length-2]}),H.call(M,s,{type:"load",target:w.getLast()}),H.call(M,"pagehide",{type:"load",target:j[j.length-2]}),H.call(M,"pageshow",{type:"load",target:w.getLast()}),o&&o.hide&&o.hide({type:"load",target:j[j.length-2]}),r&&r.show&&r.show({type:"load",target:w.getLast()})}))}catch(t){e.showLog(t,"bui.router.doAnimate")}}function Y(t){var n="";M.store&&(t=M.store.compileHtml(t));var r=e.history.getLast();if(t=t.replace(/#module\.id/g,"#"+r.id),c.part)n=U({content:t}),c.id?I.html(n):e.showLog("id 不能为空","router.loadPart");else if(c.replace){var a=w.getLast();I=j.length?e.objId(a.id):s,a.pid=R,a.url=A,a.param=v,e.array.index(j,R,"pid"),n=R in x?L.get(R,"template"):U({content:t}),I.html(n).attr("data-page",R)}else m||(n=$({id:k,content:t,pid:R}),s&&s.attr("data-main",k).append(n));return o.needView&&loader.views({compiled:function(){M.store&&!M.store.config.isPublic&&M.store.config.needCompile&&M.store.compile("#"+k)}}),!M.store||o.needView||M.store.config.isPublic||M.store.config.needCompile&&M.store.compile("#"+k),n}function Z(e){var t=w.getLast(),n=S[e.pid]&&S[e.pid]||{},r=n.loaded,a=r&&r.apply(n,n.dependExports)||n.exports;b[e.pid]=a||null,n.exports=a,t.exports=a,m&&H.call(M,"refresh",{prevTarget:g,target:t}),i&&i.hide(),f.resolve(a),m=!1,h=!1}function Q(){var e=j[j.length-2]||null,t=w.getLast();h&&!c.part&&(H.call(M,"firstload",{prevTarget:e,target:t}),h=!1),c.part?H.call(M,"loadpart",{prevTarget:e,target:t}):H.call(M,"load",{prevTarget:e,target:t})}return f.promise()}function C(e){var t="",n=e;I=loader.map(),S=I.modules;var r=n.indexOf(o.pageSuffix);return r>-1?(n=(t=n).substr(0,r),S.hasOwnProperty(n)&&(t=S[n]&&S[n].template||t||"")):t=S[n=n]&&S[n].template||n+o.pageSuffix||"",{pid:n,url:t}}function R(n){var r=this,a={};"function"==typeof n?a.callback=n:a=n||{};var i=t.extend(!0,{index:-1,name:"",beforeBack:o.beforeBack,callback:null,loaded:o.backed},a),l=parseInt(i.index),c=j.length;if(I=loader.map(),S=I.modules,!(l>0)){var f=w.getLast(),p=c-1,h=f.toggle;if(h)return h.hide(),void F();var m="function"==typeof i.beforeBack?i.beforeBack.call(M,{prevTarget:null,target:f}):a.beforeBack;H.call(M,"beforeback",{prevTarget:null,target:f});var v=loader.get(f.pid);return v&&v.beforeDestroy&&v.beforeDestroy(),!1===m?this:(i.name&&(l=A(i.name)),Math.abs(l)>p&&(l=-p),c>1&&g&&(l<-1&&D(l),g=!1,a.effect&&(u.option({effect:a.effect}),d.option({effect:a.effect})),u&&u.show(),d&&d.hide((function(){var n=c+l;!function(e){s.children().each((function(n,r){n>=e&&t(r).remove()}))}(n),w.removeNext(n),D();var a=F(),o=a.pid;e.objId(a.id).css("zIndex",5),function(){var e;e=b[o]||{};var t=loader.get(a.pid);i.callback&&i.callback.call(r,e,a),i.backed&&i.backed.call(M,{prevTarget:f,target:a}),H.call(M,"back",{prevTarget:f,target:a}),a;var n="pageshow-"+a.pid,l="pagehide-"+f.pid;v&&v.hide&&v.hide({type:"back",target:f}),t&&t.show&&t.show({type:"back",target:a}),H.call(M,l,{type:"back",target:f}),H.call(M,n,{type:"back",target:a}),H.call(M,"pageshow",{type:"back",target:a}),H.call(M,"pagehide",{type:"back",target:f}),v&&v.destroyed&&v.destroyed(),g=!0}()}))),this)}e.showLog("index 参数只能是负数","bui.router.back")}function A(t){var n,r=e.array.indexs(j,t,"pid"),a=r.length;if(a){var i=-(j.length-r[a-1]-1);n=0==i?-1:i}else n=-1;return n}function _(t,n,r){if("string"==typeof t){loader.importHtml(t,(function(t,r,a){t=function(e){var t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,n=/<body[^>]*>([\s\S]*)<\/body>/.exec(e);if(n&&2===n.length)return n[1].replace(t,"");return e}(t),e.history.getLast(),n&&n(t,r,a),H.call(M,"success",t,r,a)}),(function(e,t,n){r&&r(e,t,n),H.call(M,"fail",e,t,n)}))}else if("function"==typeof t){var a=t&&t();n&&n(a,200,{}),H.call(M,"success",a,200,{})}else e.showLog("url 不能为空","bui.router.requestUrl")}function F(){var t=w.getLast(),n=t.id||"",r=t.effect||o.effect;return n&&(H.call(M,"beforepageshow",{target:t}),d=null,d=e.toggle({id:document.getElementById(n),effect:y[r]&&y[r].inRight||""}),s&&s.attr("data-main",n)),t}function D(t){t=t||-1;var n=j.length+t-1,r=j[n],a=r&&r.id||"",i=r&&r.effect||o.effect;return a&&(H.call(M,"beforepagehide",{target:r}),u=null,u=e.toggle({id:document.getElementById(a),effect:y[i]&&y[i].inLeft||""})),r}function $(e){var t="";return t+='<div id="'+e.id+'" class="bui-router-item" data-page="'+e.pid+'">',t+=e.content||"",t+="</div>"}function U(e){var t="";return t+=e.content}function V(t,n){return e.on.apply(M,arguments),this}function H(t){M.self=this==window||this==M?null:this,e.trigger.apply(M,arguments)}e.hasRouter=!0,w.get=function(){return j},w.add=function(n){if((n=n||{}).toggle){var r=t.extend(!0,{},n);n.toggle=null,j.push(r)}else j.push(n);var a=window.location.origin+window.location.pathname+"#"+n.pid,i=e.setUrlParams(a,n.param);if(!h)return o.syncHistory&&"pushState"in window.history&&window.history.pushState(n,null,i),j;o.syncHistory&&"replaceState"in window.history&&window.history.replaceState(n,null,i)},w.prepend=function(t){t=t||{};var n=window.location.origin+window.location.pathname+"#"+t.pid;return e.setUrlParams(n,t.param),j.unshift(t),j},w.replace=function(t){t=t||{};var n=j.length-1,r=window.location.origin+window.location.pathname+"#"+t.pid,a=e.setUrlParams(r,t.param);return n>-1&&(j.splice(n,1,t),o.syncHistory&&"replaceState"in window.history&&window.history.replaceState(t,null,a)),j},w.getLast=function(e){var t=j.length-1,n=j[t]||{};return e?n[e]:n},w.removeNext=function(t){var n=j.length-t;j.splice(t,n);var r=w.getLast(),a=window.location.origin+window.location.pathname+"#"+r.pid,i=e.setUrlParams(a,r.param);o.syncHistory&&"replaceState"in window.history&&window.history.replaceState(r.param,null,i)},w.removeLast=function(){var e=j.length-1;w.removeNext(e)},w.checkLoad=function(t){return e.array.compare(j,t,"pid")||e.array.compare(j,t,"url")||e.array.compare(j,t,"id")},L.add=function(e,t){return x[e]=t||{},x[e]},L.del=function(e){delete x[e]},L.get=function(e,t){return t?(x[e]||{})[t]:x[e]},L.save=function(){if(j.length>1){var e=r.html();T.set("cacheHtml",e),T.set("cacheHistory",j),T.set("hasCache","true")}},L.load=function(){var t=T.get("cacheHtml",0),n=T.get("cacheHistory",0),a=[];if(n.length>1){r.html(t),s=r.children(".bui-router-main"),R({name:E().pid});try{n.forEach((function(e,t){var n="string"==typeof e?JSON.parse(e):e;a.push(n)}));var i=a[a.length-1];i,loader.require(i.pid,(function(e){b[i.pid]=e||null})),V("back",(function(e){loader.require(e.target.pid,(function(t){b[e.target.pid]=t||null}))}))}catch(t){e.showLog(t)}j=a,F(),D(),h=!1,O=!0,L.clear()}},L.clear=function(){T.remove("cacheHistory"),T.remove("cacheHtml"),T.remove("hasCache")},P.add=function(e,t){return k[e]=t||{},k[e]},P.get=function(e,t){return t?(k[e]||{})[t]:k[e]};var M={init:function(n){M.store=n.store||null,delete n.store,n=t.extend(!0,{},o,e.config.router,n),o=M.config=n;var l,u=e.history.getParams("url");if(u.module&&n.parseurl){var d=u.module;delete u.module;var h=e.setUrlParams(d,u);return window.location.href=window.location.origin+window.location.pathname+"#"+h,this}if("pages/main/main.html"===n.indexModule.template&&"pages/main/main.js"===n.indexModule.script||(I=loader.map(n.indexModule)),v&&"effect"in n&&j.forEach((function(e,t){e.effect=n.effect})),!n.id)return e.showLog("id 不能为空","bui.router.init"),!1;if(r=e.objId(n.id),i=bui.mask({appendTo:r,opacity:0,autoClose:!1}),a=e.loading({display:"block",width:30,height:30,opacity:0}),s=r.children(".bui-router-main"),f=n.width||window&&window.viewport&&window.viewport.width()||document.documentElement.clientWidth||"100%",p=n.height||window&&window.viewport&&window.viewport.height()||document.documentElement.clientHeight||"100%",!s.length){var g=(l="",String(f).indexOf("%"),String(p).indexOf("%"),l+='<div class="bui-router-main">',l+="</div>");r.html(g),s=r.children(".bui-router-main")}return(n.width>0||String(n.width).indexOf("%")>-1)&&s.width(n.width),(n.height>0||String(n.height).indexOf("%")>-1)&&s.height(n.height),function(n){if(function(){var t=T.get("hasCache",0);Boolean(t)&&o.reloadCache?L.load():function(t){try{var n=E();if(n.pid){if(n.pid.indexOf("http://")>-1||n.pid.indexOf("https://")>-1)return n.param.iframe=!0,void N({url:n.pid,param:n.param,iframe:!0});N({url:n.pid,param:n.param})}else N({url:o.indexModule.moduleName,param:n.param||{}})}catch(t){e.showLog(t,"bui.router.loadUrl")}}()}(),n.swipe&&function(n){var a=/hp-tablet/gi.test(navigator.appVersion),i="ontouchstart"in window&&!a,l=0,c=0,s=!1,u=null,d=null,f={x1:0,x2:0,y1:0,y2:0,direction:""};r.on("touchstart",(function(r){var a=r.originalEvent&&r.originalEvent.targetTouches||r.targetTouches,l=i?a[0]:r;f.x1=l.pageX,f.y1=l.pageY,s=t(r.target).closest(o.useScroll).length,j.length>1&&f.x1>0&&f.x1<n.distance&&(u=t("#".concat(w.getLast().id)),d=e.history.getPrev().id?t("#".concat(e.history.getPrev().id)):null)})),r.on("touchmove",(function(r){var a=r.originalEvent&&r.originalEvent.targetTouches||r.targetTouches,p=i?a[0]:r;f.x2=p.pageX,f.y2=p.pageY,a.length>1||r.scale&&1!==r.scale||(s=t(r.target).closest(o.useScroll).length,f.x2-f.x1>0&&!s&&r.preventDefault(),f.direction||(f.direction=e.swipeDirection(f.x1,f.x2,f.y1,f.y2)),"swipeleft"!==f.direction&&"swiperight"!==f.direction||(r.preventDefault(),r.stopPropagation()),l=Math.abs(f.x2-f.x1),c=Math.abs(f.y2-f.y1),"swiperight"===f.direction&&l>n.startDistance&&n.swipeBack&&(d&&d.css("display","block"),n.pageMove&&u&&u.css("transform","translateX(".concat(l,"px)")),r.preventDefault()))})),r.on("touchend",(function(e){(s=t(e.target).closest(o.useScroll).length,"swiperight"===f.direction&&f.x1>n.distance&&n.swipeBack&&(l=0),"swiperight"===f.direction&&l>n.swipeDistance)&&(!1!==(n.onBeforeSwipeRight&&n.onBeforeSwipeRight())&&n.swipeBack&&bui.back(),n.onSwipeRight&&n.onSwipeRight(e),H.call(M,"swiperight"));"swipeleft"===f.direction&&l>n.swipeDistance&&(n.onSwipeLeft&&n.onSwipeLeft(e),H.call(M,"swipeleft")),"swipeup"===f.direction&&c>n.swipeDistance&&!s&&(n.onSwipeUp&&n.onSwipeUp(e),H.call(M,"swipeup")),"swipedown"===f.direction&&c>n.swipeDistance&&!s&&(n.onSwipeDown&&n.onSwipeDown(e),H.call(M,"swipedown")),l<n.swipeDistance&&(d&&d.css("display","none"),u&&u.css("transform","translateX(0)")),l=0,s=!1,f={x1:0,x2:0,y1:0,y2:0,direction:""},u=null,d=null,e.stopPropagation()}))}(n),window.addEventListener("beforeunload",(function(e){o.reloadCache&&L.save(),H.call(c,"beforeunload",{target:j[j.length-1]})})),n.hash)return window.addEventListener("hashchange",(function(t){var n=E(),r=""==n.pid||"undefined"==n.pid?"main":n.pid,a=e.array.indexs(j,r,"pid"),i=a[a.length-1];r="wechat_redirect"==n.pid?"main":r,i>-1?(R({index:-(j.length-i-1||1)}),H.call(c,"popstate",{type:"back",prevTarget:j[i-1],target:j[i]})):(N({url:r,param:n.param,iframe:"true"==n.param.iframe,replace:!0}),H.call(c,"popstate",{type:"load",prevTarget:j[j.length-2],target:j[j.length-1]}))})),this;o.syncHistory&&"pushState"in window.history&&window.addEventListener("popstate",(function(t){var n=E(),r=""==n.pid?o.indexModule.moduleName:n.pid,a=A(r);e.array.index(j,r,"pid")>-1?(R({index:a,param:n.param}),H.call(c,"popstate",{type:"back",prevTarget:j[a-1],target:j[a]})):(N({url:r,param:n.param,iframe:"true"==n.param.iframe}),H.call(c,"popstate",{type:"load",prevTarget:j[j.length-2],target:j[j.length-1]}))}))}(n),H.call(this,"init",{target:r[0]}),M},option:function(t,n){return v=!0,e.option.call(M,t,n)},config:o,data:{},on:V,off:function(t,n){return e.off.apply(M,arguments),this},trigger:H,load:N,resize:function(e){return(e=e||{}).width=e.width||o.width,e.height=e.height||o.height,window.viewport=bui.viewport(),f=e.width||window&&window.viewport&&window.viewport.width()||document.documentElement.clientWidth||"100%",p=e.height||window&&window.viewport&&window.viewport.height()||document.documentElement.clientHeight||"100%",s.css({width:f,height:p}),H.call(this,"resize",{target:j[j.length-1]}),this},destroy:function(t){return"string"==typeof t&&"main"!==t?(loader.destroy(t),L.del(t),t in b&&delete b[t]):e.showLog("参数只能是字符串"),this},loadPart:function(e){var n=t.Deferred(),r=t.extend(!0,{},{id:"",url:"",param:{},loaded:null},e);return r.loaded=function(t){e.loaded&&e.loaded.call(M,t),n.resolve(t),H.call(M,"loadpart",t)},loader.load(r),n.promise()},replace:function(e){return N({url:(e=e||{}).url||"",param:e.param||{},replace:!0}),this},refresh:function(){var t=j.length-1,n=j[t],r=j.length>1?j[j.length-2]:null;return e.history.refresh(),H.call(M,"refresh",{prevTarget:r,target:n}),this},back:R,isLoad:function(e){var t;return e&&(t=e in b),t},$:function(t){var n=w.getLast(),r=document.getElementById(n.id)||document;return e.obj(t,r)},currentId:function(e){return w.getLast().id},currentPage:function(){var e=w.getLast();return document.getElementById(e.id)},currentModule:function(){return w.getLast()},getPageParams:function(){return w.getLast().param},getPartParams:function(t){return e.history.getComponentParam(t)},getHistory:w.get,preload:function(n){var r=t.Deferred(),a=function(t,a){return _(t.url,(function(r){var i=e.guid(),o=C(t.url).pid;$({id:i,content:r,pid:o});var l=[];L.add(o,{id:i,pid:o,template:r}),l.push(o),t.style&&"array"===e.typeof(t.style)?t.style.forEach((function(e,t){l.push(e)})):t.style&&"string"===e.typeof(t.style)&&l.push(t.style),t.script&&"array"===e.typeof(t.script)?t.script.forEach((function(e,t){l.push(e)})):t.script&&"string"===e.typeof(t.script)&&l.push(t.script),loader.import(l,(function(){H.call(M,"preloadafter",{prevTarget:null,target:null}),a&&a(n)}),(function(){H.call(M,"preloadafter",{prevTarget:null,target:null}),a&&a(n)}))}),(function(n){e.showLog(t.url+"请求失败"),r.reject(t.url)})),r.promise()};return n&&"object"===e.typeof(n)?"url"in n&&a(n,(function(){r.resolve(n)})):n&&"array"===e.typeof(n)&&n.forEach((function(e,t){t==n.length-1?"url"in e&&a(e,(function(){r.resolve(n)})):"url"in e&&a(e)})),r},initScroll:function(n){var r=w.getLast(),a=e.objId(r.id),i="object"===_typeof(n)?t(n):a.find(".bui-page");return i.length&&e.init({id:i,height:p}),this},history:{get:w.get,check:w.checkLoad,getLast:w.getLast,add:w.add,removeLast:w.removeLast,replace:w.replace}};return M}}(window.bui||{},window.libs),function(e,t){var n=function(){function n(r){_classCallCheck(this,n),this._default={log:!1,hasLife:!0,onBeforeInit:null,onInited:null},this._plugin=r||{name:"",depend:null,config:null,param:null,callback:null};var a=e.config.hasOwnProperty(this._plugin.name)?e.config[this._plugin.name]:null;this.config=t.extend(!0,{},this._default,a,this._plugin.config,this._plugin.param),this.initStatus=!1,this.reinitStatus=!1,this.widgets=Object.create(null),this.init()}return _createClass(n,[{key:"widget",value:function(e){return e&&e in this.widgets?this.widgets[e]:this.widgets}},{key:"init",value:function(e){var n=this,r=e||null;n.config=t.extend(!0,this.config,r);var a=n.config,i=a.hasLife&&a.onBeforeInit&&a.onBeforeInit.call(n,a);return a.log&&console.log("".concat(n._plugin.name," before init")),!1===i||(n._plugin.callback&&n._plugin.callback.call(n,a),a.log&&console.log("".concat(n._plugin.name," init")),a.hasLife&&a.onInited&&a.onInited.call(n,a),a.log&&console.log("".concat(n._plugin.name," after inited")),this.initStatus=!0),n}},{key:"reinit",value:function(){return this.destroy(),this.init(),this.config.log&&console.log("".concat(this._plugin.name," reinit")),this}},{key:"destroy",value:function(e){return this.beforeDestroy&&this.beforeDestroy(),this.beforeDestroy=null,this.widgets={},this.off(),this.initStatus=!1,e&&e.call(this),this.config.log&&console.log("".concat(this._plugin.name," destroyed")),this}},{key:"prefix",value:function(t){return e.config.classNamePrefix+t}},{key:"showLog",value:function(t,n){n=n||"";var r="";return"object"==_typeof(t)&&"message"in t&&"name"in t?r=t.message+":"+t.name+"&&stack:"+t.stack:"string"==typeof t&&(r=t),e.log&&console.error(n+" "+r),e.trace&&console.trace&&console.trace(),this}},{key:"option",value:function(n,r){if("object"!==e.typeof(n)&&void 0===r)return"string"==typeof n?this.config[n]:this.config;var a=this;if("id"==n)return e.showLog("不允许修改控件的ID参数"),this;if(n&&"object"===e.typeof(n)){var i=t.extend(this.config,n);return a&&a.init(i)}if(this.config.hasOwnProperty(n)){var o={};o[n]=r;var l=t.extend(this.config,o);return a&&a.init(l)}return this}},{key:"emitter",get:function(){return e.emitter()}},{key:"on",get:function(){return this.emitter.on}},{key:"off",get:function(){return this.emitter.off}},{key:"trigger",get:function(){return this.emitter.trigger}}]),n}();e.extend=function(t){new(function(){function r(e){_classCallCheck(this,r),this.init(e)}return _createClass(r,[{key:"init",value:function(r){var a=r.name;return this.checkName(a)?(e[a]=function(e){return t.param=e,new n(t)},this):this}},{key:"checkName",value:function(e){return e?(this.name=e,!0):(console.warn("插件名字不能为空"),!1)}}]),r}())(t)}}(window.bui||{},window.libs),function(e){!function(t,n){var r;t.extend({name:"page",config:(r={dialogid:"",url:"",param:null,script:"",appendTo:"",className:"bui-dialog-page",effect:"",pageSuffix:".html",height:0,width:0,iframe:!1,openFirst:!0,closeFirst:!1,autoClose:!1,needRemove:!1,useBox:!0,syncHistory:!1,title:"",buttons:null,mask:!1,life:!0,scroll:!1,needView:!1,needComponent:!0,cache:!0,close:!1,autoload:!0,fullscreen:!0},_defineProperty(r,"effect","fadeInRight"),_defineProperty(r,"onError",null),_defineProperty(r,"beforeClose",null),_defineProperty(r,"closed",null),_defineProperty(r,"beforeOpen",null),_defineProperty(r,"opened",null),_defineProperty(r,"beforeLoad",null),_defineProperty(r,"loaded",null),r),callback:function(r){var a=this,i=a.config,o="body"==a.appendTo?n:t.obj,l="",c=!1,s=(loader.map().modules,a.widgets.dialog=t.dialog({autoinit:!1,needRemove:r.needRemove})),u=null,d=!1;function f(e,n){var r="",a=n.close?'<div class="bui-dialog-close"><i class="'+t.config.icon.close+'"></i></div>':"",i=n.title?'<div class="bui-dialog-head">'.concat(n.title,"</div>"):"";return r+="".concat(i,'<div class="bui-dialog-main">').concat(e,"</div>").concat(a)}function p(e){var n=loader.map().modules[u.module]||{};if(n.hide&&i.life){var r=t.hasRouter?t.history.getLast():{};n.hide({type:"page",target:r})}"function"==typeof e&&e.call(a,n),i.closed&&i.closed.call(a,n)}function h(n,r){var o=t.history.getLast(),l=(loader.map().modules||{})[n];if(i.cache&&c&&!d)return!i.openFirst&&s.open(),"function"==typeof r&&r.call(a,l.exports),a;if(t.history.setPage({id:s.config.id,name:n,url:i.url,dialog:s,param:i.param}),d=!1,l&&"function"==typeof l.loaded){var u=l.loaded&&l.loaded.call(e,l.exports)||l.exports;t.history.setPage({id:s.config.id,name:n,url:i.url,dialog:s,exports:u,param:i.param});var f=loader.map().modules[n]||{};return f.show&&i.life&&f.show({type:"page",target:o}),"function"==typeof r&&r.call(a,u),a.compile({id:s.config.id}),i.opened&&i.opened.call(a,u),!i.openFirst&&s.open(),this}loader.require(n,(function(e){var l=loader.map().modules[n]||{};t.history.setPage({id:s.config.id,name:n,url:i.url,dialog:s,exports:e,param:i.param}),l.show&&i.life&&l.show({type:"page",target:o}),"function"==typeof r&&r.call(a,e),a.compile({id:s.config.id}),i.opened&&i.opened.call(a,e)})),c=!0}function g(e){var t=loader.map().modules,n={},r=e.indexOf(i.pageSuffix);return r>-1?(n.url=e,n.module=e.substr(0,r)):(n.url=t[e]&&t[e].template||e+i.pageSuffix,n.module=e),n}a.init=function(e){var r=n.extend(!0,{},a.config,e);if(r.onClose=function(){t.hasRouter&&r.syncHistory&&bui.back(),p()},u=g(r.url),r.iframe){var i=t.platform.isIos()?'scrolling="no"':"";return r.content='<iframe class="bui-router-iframe" src="'.concat(r.url,'" ').concat(i," ></iframe>"),s.create(r),r.autoload&&s.open(),r.loaded&&r.loaded.call(a,u),a}if(r.script){var c=r.script.indexOf(".js");u.module=r.script.substr(0,c)}return!1===(r.beforeLoad&&r.beforeLoad.call(a,u))?this:(loader.import(u.url,(function(e){"object"!==_typeof(e)?(l=f(e,r),r.id?(s.init(r),o(r.id).html(e)):(r.content=e,s=s.create(r)),r.autoload&&a.open(),r.loaded&&r.loaded.call(a,u)):r.onError&&r.onError.call(a,e)})),a)},a.compile=function(e){var t=n.extend(!0,{id:s.config.id,cacheHtml:!1,cache:!1,needComponent:i.needComponent,needView:i.needView},e);t.needView&&loader.views(t),t.needComponent&&loader.components(t)},a.reload=function(e){var t=i=n.extend(!1,a.config,i,e);if(t.param=e.param||{},d=!0,u=g(t.url),t.script){var r=t.script.indexOf(".js");u.module=t.script.substr(0,r)}if(!1===(t.beforeLoad&&t.beforeLoad.call(a,u)))return this;loader.import(u.url,(function(e){"object"!==_typeof(e)?(l=f(e,t),o("#"+(s.config.id||t.dialogid)).html(l),h(u.module),t.loaded&&t.loaded.call(a,u)):t.onError&&t.onError.call(a,e)}))},a.toggle=function(e,t){return a.isOpen()?a.close(t):a.open(e),a},a.isOpen=s.isOpen,a.close=function(e){return!1===(r.beforeClose&&i.beforeClose.call(a))?this:(t.hasRouter&&i.syncHistory&&t.history.removeLast(i.syncHistory),i.closeFirst?(s.close((function(){a.trigger("close"),p(e)})),a):(p(e),s.close(),a.trigger("close"),a))},a.remove=function(e){return s.remove(e),a.trigger("remove"),a},a.open=function(e){if(!1===(i.beforeOpen&&i.beforeOpen.call(a)))return this;if(i.iframe)return s.open(e),a;var n={hide:a.close,show:a.open};return t.hasRouter&&i.syncHistory&&t.history.add({id:s.config.id,name:u.module,url:i.url,replace:!1,param:i.param||{},part:{},page:{},effect:"push",toggle:n,syncHistory:i.syncHistory}),loader.map({moduleName:u.module,id:s.config.id}),t.history.getLast().currentPage=s.config.id,i.openFirst?(s.open((function(){a.trigger("open"),h(u.module,e)})),a):(h(u.module,e),s.open(),a.trigger("open"),a)},a.setParam=function(e){var r=n.extend(!1,{},i.param,e);t.history.setPage({id:s.config.id,param:r})},a.init(i)}})}(window.bui||{},window.libs)}(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports,function(e,t){e.setUrlParams=function(t,n,r){r=0!=r,n="object"==_typeof(n)?n:{};var a=e.unit.objectToKeyString(n,r);return""==a?t:t+"?"+a},e.getUrlParams=function(t){t=0!=t;var n=window.location.href,r=n.indexOf("?"),a={};if(r>-1){var i=n.substr(r+1);a=e.unit.keyStringToObject(i,t)}return a},e.getUrlParam=function(e){var t=window.location.href,n=new RegExp("(^|&|.)"+e+"=([^&]*)(&|$)","i"),r=t.substr(1).match(n);return null!=r?decodeURIComponent(r[2]):null},e.typeof=function(e){var t=Object.prototype.toString.call(e).slice(8,-1);return t=t.toLowerCase()},e.setting=function(t,n){return"string"==typeof t&&"object"===_typeof(n)?e.config[t]=n:"string"==typeof t&&void 0===n?e.config[t]:e.config}}(window.bui||{}),function(e,t){e.array={},e.array.index=e.inArray=function(e,t,n){var r,a;e instanceof Array?(r=e||[],a=t):(r=t||[],a=e);for(var i=0;i<r.length;i++){var o=r[i];if((o&&o[n]||o)===a)return parseInt(i)}return-1},e.array.compare=e.compareArray=function(e,t,n){var r,a;e instanceof Array?(r=e||[],a=t):(r=t||[],a=e);for(var i=0;i<r.length;i++){var o=r[i];if((o&&o[n]||o)===a)return!0}return!1},e.array.remove=e.removeArray=function(t,n,r){var a,i;return t instanceof Array?(a=t||[],i=n):(a=n||[],i=t||[]),e.array.delete(a,i,r),a},e.array.filter=e.filterArray=function(t,n,r){var a,i;t instanceof Array?(a=t||[],i=n):(a=n||[],i=t);var o=[];for(var l in a)try{var c=a[l]&&a[l][r]||a[l];new RegExp(i).test(c)&&o.push(a[l])}catch(t){e.showLog(t)}return o},e.array.indexs=e.indexArray=function(e,t,n){var r,a;e instanceof Array?(r=e||[],a=t):(r=t||[],a=e);var i=[];for(var o in r){(r[o]&&r[o][n]||r[o])===a&&i.push(+o)}return i},e.array.excess=e.excessArray=function(e,t,n){var r;r=e instanceof Array?e||[]:t||[];var a={},i=[];for(var o in r)try{var l=r[o]&&r[o][n]||r[o];a[l]!==l&&(a[l]=l,i.push(r[o]))}catch(e){}return i},e.array.uniq=function(t,n){for(var r=[],a=0;a<t.length;a++){var i=void 0===n,o=t[a],l=i?o:o[n]||o;e.array.index(r,l,n)<0&&r.push(o)}return r},e.array.copy=e.copyArray=function(t,n,r){var a=[];if(n=n||0,r=r||t&&t.length,!t||"array"===e.typeof(t))return t.forEach((function(e,t){a.push(e)})),a.splice(n,r)||[]},e.array.empty=function(t){if(!t||"array"===e.typeof(t))return t.splice(0,t.length)},e.array.replace=function(t,n){if(!(t&&"array"!==e.typeof(t)||n&&"array"!==e.typeof(n))){var r=[0,t.length].concat(n);return t.splice.apply(t,r)}},e.array.merge=function(t){var n;if(!t||"array"===e.typeof(t)){var r=arguments,a=r.length-1,i=r[a],o="string"==typeof i;if(o&&r.length>1){for(var l,c=a,s=[],u=function(e){var n=Array.prototype.slice.call(r[e],0);t.forEach((function(e,t){var r=e[i]||e;n instanceof Array&&n.forEach((function(t,a){var o=t[i]||t;if(r===o){for(var l in t)e[l]=t[l];n.splice(a,1)}}))})),s.push(n)},d=0;d<c;d++)u(d);return(l=e.array).merge.apply(l,[t].concat(s))}var f=(n=[t.length,0]).concat.apply(n,_toConsumableArray(Array.prototype.slice.call(arguments,1)));return t.splice.apply(t,f),t}},e.array.get=function(t,n,r){if(!t||"array"===e.typeof(t)){for(var a,i=null,o=0;o<t.length;o++){((i=t[o])&&i[r]||i)===n&&(a=i)}return a}},e.array.getAll=function(e,t,n){e=e||[];var r=[],a=null;for(var i in e)try{var o=(a=e[i])&&a[n]||a;t&&t instanceof Array?t.forEach((function(e,t){o===e&&r.push(a)})):o===t&&r.push(a)}catch(e){}return r},e.array.set=function(t,n,r,a){if(!t||"array"===e.typeof(t)){var i=/\d/.test(n)&&"number"==typeof n;if(i&&r){var o=t[n];if(!0===a)return t.splice(n,1,r),t;if("object"===e.typeof(r))for(var l in r)o[l]=r[l];else"object"!==e.typeof(r)&&"string"==typeof a&&(o[a]=r);return t.splice(n,1,o),t}for(var c=0;c<t.length;c++){var s=t[c],u=void 0===a?s:s[a]||s;if(i?c===n:u===n){if(a){if(r&&"object"===e.typeof(r))for(var d in r)s[d]=r[d];else s[a]=r;t.splice(c,1,s)}else t.splice(c,1,r);return t}}return t}},e.array.setAll=function(t,n,r,a){if(!t||"array"===e.typeof(t))return t.filter((function(i,o){var l=void 0===a?i:i[a]||i;if(o==n||l===n)if(a){if(r&&"object"===e.typeof(r))for(var c in r)i[c]=r[c];else i[a]=r;t.splice(o,1,i)}else t.splice(o,1,r)})),t},e.array.delete=function(t,n,r){if(!t||"array"===e.typeof(t)){var a=[],i=e.array.copy(t);return n&&"array"===e.typeof(n)?n.forEach((function(e,t){o(void 0!==r&&e[r]||e)})):o(n),a}function o(e){for(var n=0,o=0;o<i.length;o++){var l=o-n,c=t.length!==i.length,s=c?t[l]||{}:t[o]||{},u=void 0!==r?s[r]:s,d="function"==typeof u?u.name.replace("bound ",""):u,f="function"==typeof e?e.name:e;if(u===e||d===f)return c?t.splice(l,1):t.splice(o,1),a.push(o),void++n}}},e.array.deleteIndex=function(t,n){if(!t||"array"===e.typeof(t)){var r=[];return n&&"array"===e.typeof(n)?n.forEach((function(n,a){r.push(t[n]),e.array.remove(t,t[n])})):(r.push(t[n]),e.array.remove(t,t[n])),r}}}(window.bui||{}),function(e,t){e.storage=function(t){var n=1,r=!0,a="",i=!1,o=!0;"number"==typeof t||"string"==typeof t?n=0==parseInt(t)?0:parseInt(t)||1:"object"===_typeof(t)&&(n=t&&0==t.size?0:t.size||1,o=!t||0!=t.local,r=!t||0!=t.reverse,i=!(!t||1!=t.deep),a=t.prefix||"");var l=r?"push":"unshift",c=o?localStorage:sessionStorage;function s(t,n,r){t=a+t;var o,l=c.getItem(t)||"";try{o=i?l&&e.unit.stringToJson(l):l&&JSON.parse(l)}catch(t){o=l,e.showLog(t.name+": "+t.message,"bui.storage.get")}if("number"==typeof n&&r)o=o&&o[n]&&o[n][r]||void 0;else if("string"==typeof n){var s=e.array.index(o,n,r);o=o&&o[s]}else o="number"==typeof n?o&&o[n]||void 0:o;return o}return{get:s,getAll:function(e){for(var t={},n=parseInt(e)||0,r=0;r<localStorage.length;r++){var i=localStorage.key(r);if(i.substr(a.length),a&&0===i.indexOf(a))try{var o=JSON.parse(c.getItem(i));t[i]=void 0!==e?o[n]:o}catch(e){t[i]=c.getItem(i)}if(""===a)try{t[i]=JSON.parse(c.getItem(i))}catch(e){t[i]=c.getItem(i)}}return t},set:function(t,r,i){t=a+t;var o=1==n?null:c.getItem(t),s=[],u="",d=i?r[i]:r;if(null===o){s.push(r),u=JSON.stringify(s);try{c.setItem(t,u)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}else{var f=JSON.parse(o);if(e.array.compare(f,d,i)){e.array.remove(f,d,i),f[l](r);try{u=JSON.stringify(f),c.setItem(t,u)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}else{f[l](r),f.length>n&&0!=n&&("unshift"==l?f.pop():f.shift());try{u=JSON.stringify(f),c.setItem(t,u)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}}return this},remove:function(t,n,r){if("string"==typeof(t=a+t)){var i=s(t)||[];if("number"==typeof n){var o="number"==typeof r?r:1;i.splice(n,o);try{var l=JSON.stringify(i)||"";c.setItem(t,l)}catch(t){e.showLog(t.name+": "+t.message,"bui.storage.remove")}}else if("string"==typeof n){var u=e.array.remove(i,n,r);try{l=JSON.stringify(u)||"";c.setItem(t,l)}catch(t){e.showLog(t.name+": "+t.message,"bui.storage.remove")}}else c.removeItem(t);return this}e.showLog("要删除的字段名只能是字符串","bui.storage.remove")},clear:function(){if(a)for(var e=0;e<localStorage.length;e++){var t=localStorage.key(e);0===t.indexOf(a)&&c.removeItem(t)}else c.clear();return this}}}}(window.bui||{}),function(e,t){e.platform=function(){var e=navigator.userAgent;function t(){return n()||r()||a()}function n(t){return/(Android|Linux)/i.test(e)}function r(t){return/(iPhone)/i.test(e)}function a(t){return/(iPad)/i.test(e)}return{isAndroid:n,isIphone:r,isIpad:a,isIos:function(t){return/(iPhone|iPad|iOS)/i.test(e)},isWeiXin:function(t){return/(micromessenger)/i.test(e)},isPC:function(){return!t()},isMobile:t,isWeiXinMini:function(e){return"miniprogram"===window.__wxjs_environment},isBingotouch:function(t){return/(crosswalk)/i.test(e)},isMac:function(){return/macintosh;.+mac os x/i.test(e)},isIphoneX:function(e){var t=!1,n=3==window.devicePixelRatio&&375==window.screen.width&&812==window.screen.height,r=2==window.devicePixelRatio&&414==window.screen.width&&896==window.screen.height,a=3==window.devicePixelRatio&&414==window.screen.width&&896==window.screen.height;return(n||r||a)&&(t=!0),t},isWindow:function(t){return/Windows NT/i.test(e)}}}()}(window.bui||{}),function(e,t){e.date={},e.date.format=function(e,t){if(null==e)return"";var n=this.convert(e);t=t||"yyyy-MM-dd";var r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[a]:("00"+r[a]).substr((""+r[a]).length)));return t},e.date.convert=function(e,t){if(e&&e.constructor==Date)return e;if("number"==typeof e&&13===String(e).length)return new Date(e);e=String(e);var n=new Date,r=n.getFullYear(),a=n.getMonth()+1,i=n.getDate();if((e=e.replace(/[-|年|月]/gim,"/").replace(/[时|分|秒|小时|分钟]/gim,":").replace(/^(\d{4}\/\d+?)($|\s)/,(function(e,t){return t+"/1"})).replace(/[日|号]/gim,"").replace(/^(\d{1,2}\/\d{1,2}?)($|\s)/,(function(e,t){return n.getFullYear()+"/"+t}))).indexOf("T")>-1&&-1==e.indexOf("GMT")){var o=(e=e.replace("T"," ")).indexOf(".")>-1?e.split("."):[e];return new Date(o[0])}if(e.indexOf("GMT")>-1){var l=(o=e.split(" "))[3]+"/"+{Jan:"1",Feb:"2",Mar:"3",Apr:"4",May:"5",Jun:"6",Jul:"7",Aug:"8",Sep:"9",Oct:"10",Nov:"11",Dec:"12"}[o[1]]+"/"+o[2]+" "+o[4];return new Date(l)}return e.indexOf("/")<0&&e.indexOf(":")>-1&&(e=r+"/"+a+"/"+i+" "+e),4===e.length?e+="/1/1 00:00:00":"MM"===t||"M"===t?e=r+"/"+e+"/1 00:00:00":"dd"!==t&&"d"!==t||(e=r+"/"+a+"/"+e+" 00:00:00"),new Date(e)},e.date.after=function(e,t,n){t=0===t?0:t||1;var r=this.convert(e).getTime()+1e3*parseInt(t)*3600*24;return this.format(r,n||"yyyy-MM-dd")},e.date.afterTime=function(e,t,n){var r=0===t?0:t||30,a=this.format(new Date,"yyyy/MM/dd")+" "+e,i=new Date(a).getTime()+1e3*r*60;return this.format(i,n||"hh:mm")},e.date.count=function(t,n,r){var a,i;switch(r){case"number":a=t,i=n;break;case"hour":var o=this.format(new Date,"yyyy/MM/dd"),l=o+" "+t,c=this.convert(l),s=o+" "+n,u=this.convert(s);a=c.getTime(),i=u.getTime();break;case"date":default:a=this.convert(t).getTime(),i=this.convert(n).getTime()}var d=a-i;d=Math.abs(d);var f=parseInt(d/1e3/3600/24,10),p=parseInt(d/1e3/3600%24,10),h=parseInt(d/1e3/60%60,10),g=parseInt(d/1e3%60,10);return{value:d,day:f,hour:p,minute:h,second:g,tip:"".concat(f,"天 ").concat(e.unit.fixZero(p),":").concat(e.unit.fixZero(h),":").concat(e.unit.fixZero(g))}},e.date.countMonth=function(e){var t=this.convert(e),n=t.getMonth()+1;return t.setMonth(n),t.setDate(0),t.getDate()},e.date.toWeek=function(e,t){var n=this.convert(e),r=null;switch(t){case 1:r=["周日","周一","周二","周三","周四","周五","周六"];break;default:r=t||["星期天","星期一","星期二","星期三","星期四","星期五","星期六"]}return r[n.getDay()]},e.date.today=function(e){return e=e||"M-d",this.format(new Date,e)},e.date.fromnow=function(e){var t=+new Date,n=this.convert(e).getTime(),r="",a=this.count(t,n,"date"),i=t>n?"前":"后";return a.day?r=a.day+"天"+i:a.hour?r=a.hour+"小时"+i:a.minute?r=a.minute+"分钟"+i:a.second&&(r=a.second+"秒"+i),r}}(window.bui||{}),function(e,t){e.ajax=function(n){var r=t.Deferred(),a=null,i=t.extend(!0,{},{baseUrl:"",data:{},method:"GET",dataType:"json",timeout:6e4,headers:{},processData:!0,mimeType:"none",cache:!0,async:!0,needJsonString:!1,contentType:null,localData:null,transformRequest:null,transformResponse:null,native:!0,needNative:!1},e.config.ajax,n),o=i.success,l=i.fail||i.error;if(null===i.contentType&&"get"==i.method.toLocaleLowerCase()?i.contentType="text/html;charset=UTF-8":null===i.contentType&&"post"==i.method.toLocaleLowerCase()?i.contentType="application/x-www-form-urlencoded":i.contentType=i.contentType,"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,i.needJsonString)try{i.data="object"===_typeof(i.data)?JSON.stringify(i.data):i.data}catch(e){i.data=i.data}if(i.data=i.transformRequest&&i.transformRequest.call(r,i.data)||i.data,!i.url)return e.showLog("url不能为空","bui.ajax"),r;if(i.url.indexOf("://")>-1?i.url=i.url:i.url.indexOf("./")>-1||i.url.indexOf("../")>-1?i.url=bui.unit.resolvePath(i.url):i.url=i.baseUrl+i.url,i.proxy){var c=i.url.indexOf(i.proxy),s=c>-1?c+1:-1;i.url=i.url.substr(s)}if(r.abort=function(){a&&a.abort()},i.localData)return i.localData=i.transformResponse&&i.transformResponse.call(r,i.localData)||i.localData,o&&o(i.localData,200),r.resolve(i.localData,200),r;if(i.needNative){if(void 0===e.native.ajax)return u(i),r;try{r=e.native.ajax&&e.native.ajax(i)||r}catch(e){}}else u(i);function u(e){e.success=function(t,n,a){var i=null;if("string"==typeof t&&"json"==e.dataType)try{i=JSON.parse(t)}catch(e){i=t}else i=t||{};i=e.transformResponse&&e.transformResponse.call(r,i)||i,o&&o(i,n,a),r.resolve(i,n,a)},e.error=function(t,n,a){var i;if("string"==typeof t&&"json"==e.dataType)try{i=JSON.parse(t)}catch(e){i=t}else i=t||{};l&&l(i,n,a),r.reject(i,n,a)};var n=e.type&&e.type.toUpperCase();e.type=n||e.method.toUpperCase(),a=t.ajax(e)}return r},e.get=function(n,r,a){var i={method:"GET"};i.url=n,i.data=r||{};var o=null,l=a&&a[0];return o=a&&"array"===e.typeof(a)&&"object"==e.typeof(l)?t.extend(!0,{},e.config.get,i,l):i,bui.ajax(o)},e.post=function(n,r,a){var i={method:"POST",contentType:"application/x-www-form-urlencoded"};i.url=n,i.data=r||{};var o=null,l=a&&a[0];return(o=a&&"array"===e.typeof(a)&&"object"==e.typeof(l)?t.extend(!0,{},e.config.post,i,l):i).contentType.indexOf("application/json")>-1&&(o.data="object"===_typeof(o.data)?JSON.stringify(o.data):o.data),bui.ajax(o)},e.put=function(n,r,a){var i={method:"PUT",contentType:"application/json"};i.url=n,i.data=r||{};var o=null,l=a&&a[0];return(o=a&&"array"===e.typeof(a)&&"object"==e.typeof(l)?t.extend(!0,{},e.config.put,i,l):i).contentType.indexOf("application/json")>-1&&(o.data="object"===_typeof(o.data)?JSON.stringify(o.data):o.data),bui.ajax(o)},e.delete=function(n,r,a){var i={method:"DELETE",contentType:"application/json"};i.url=n,i.data=r||{};var o=null,l=a&&a[0];return(o=a&&"array"===e.typeof(a)&&"object"==e.typeof(l)?t.extend(!0,{},e.config.delete,i,l):i).contentType.indexOf("application/json")>-1&&(o.data="object"===_typeof(o.data)?JSON.stringify(o.data):o.data),bui.ajax(o)},e.all=function(n){var r=null;return r=n&&"array"===e.typeof(n)?n:Array.prototype.slice.apply(arguments),t.when.apply(null,r)}}(window.bui||{},window.libs),function(e,t){e.load=function(n){var r,a={url:"",param:{},reload:!!e.hasRouter&&router.config.reload,replace:!1,native:!0,needNative:!1},i=t.extend(!0,{},a,e.config.load,n),o={},l=i.url;if(i.url)if(document.activeElement.blur(),l.indexOf("tel:")>=0||l.indexOf("mailto:")>=0||l.indexOf("sms:")>=0)e.unit.openExtral(l);else{if(l&&l.indexOf("?")>-1){var c=l.split("?");o=e.unit.keyStringToObject(c[1]),i.url=c[0]}try{var s="string"==typeof i.param&&JSON.parse(i.param)||i.param||{};i.param=t.extend(!0,{},o,s)}catch(t){return void e.showLog("param 参数值必须是一个{}对象","bui.load:web")}n&&n.needNative||e.nativeRouter?e.native.load&&e.native.load(i):(r=e.setUrlParams(i.url,i.param),i.reload?window.location.href=e.hasRouter?"index.html#"+r:r:!i.replace||e.hasRouter?e.hasRouter?window.router.load(i):window.location.href=r:window.location.replace(r))}else e.showLog("url 不能为空!","bui.load:web")}}(window.bui||{},window.libs),function(e,t){e.getPageParams=function(n){var r=t.Deferred(),a={callback:null,native:!0,needNative:!1};n=n||{};var i=t.extend(!0,{},a,e.config.getPageParams);if("function"==typeof n?i.callback=n:n&&"object"===e.typeof(n)&&(i=t.extend(!0,{},a,e.config.getPageParams,n)),"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,n&&n.needNative||e.nativeRouter)return r=e.native.getPageParams&&e.native.getPageParams(i)||r;if(e.hasRouter){var o=window.router.getPageParams&&window.router.getPageParams()||e.getUrlParams();i.callback&&i.callback(o),r.resolve(o)}else{var l=e.getUrlParams();i.callback&&i.callback(l),r.resolve(l)}return r}}(window.bui||{},window.libs),function(e,t){e.back=function(n){var r,a={index:-1,name:"",delay:!0,param:null,native:!0,beforeBack:!0,callback:null};"function"==typeof n?(a.callback=n,r=t.extend(!0,{},a,e.config.back)):r=n&&"object"===e.typeof(n)?t.extend(!0,{},a,e.config.back,n):t.extend(!0,{},a,e.config.back),"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp;var i=e.hasRouter&&router.history&&router.history.getLast()||null;if(!1!==("function"==typeof r.beforeBack?r.beforeBack.call(this,{prevTarget:null,target:i}):r.beforeBack))if(n&&n.needNative||e.nativeRouter)e.native.back&&e.native.back(r);else{if(e.hasRouter)if(window.router.config.syncHistory){var o=e.history.get(),l=o.length-1;if(r.name){var c=e.array.indexs(o,r.name,"name"),s=c.length;r.index=s?-(o.length-c[s-1]-1):-1}if(Math.abs(r.index)>=o.length&&(r.index=-l),Math.abs(r.index)>=window.history.length&&window.router.config.hash&&(r.index=window.router.config.reloadCache?-l:-(window.history.length-1)),0==r.index&&(r.index=-1),window.router.config.hash&&!window.router.config.reloadCache)return void d();(o.length>1||window.history.length>1)&&d()}else window.router.back&&window.router.back(r);else d();var u=null}function d(){var t=e.hasRouter&&e.history.getPrev()||{},n=t.exports||{};if(window.history.go(r.index),e.hasRouter&&r.param){t.param=r.param;var a=window.location.origin+window.location.pathname+"#"+t.pid,i=e.setUrlParams(a,t.param);t.component={},t.page={},window.history.hasOwnProperty("replaceState")&&window.history.replaceState(t,null,i)}u&&clearTimeout(u),r.delay&&r.callback?u=setTimeout((function(){e.hasRouter?r.callback.call(router,n):r.callback.call(e,{})}),500):r.callback&&r.callback()}}}(window.bui||{},window.libs),function(e,t){e.refresh=e.history.refresh}(window.bui||{}),function(e,t){e.run=function(n){var r={};"string"==typeof n?r.id=n:n&&"object"===e.typeof(n)&&(r=t.extend(!0,{},{id:"",name:"",data:null,onFail:null,native:!0,needNative:!0},e.config.run,n));var a=String(r.id);if("object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,n.needNative)e.native.run&&e.native.run(r);else if(a.indexOf("http://")>-1||a.indexOf("https://")>-1){var i=e.setUrlParams(r.id,r.data);if(e.platform.isIos())return void(window.location.href=i);(window.open("","_blank")||window.open("","_newtab")).location.href=i}}}(window.bui||{},window.libs),function(e,t){e.fileselect=function(n){var r,a,i,o=t.extend(!0,{},{native:!0,needNative:!1,needCompress:!1,appendTo:"",quality:.8,from:"camera",width:800,height:800,duration:10,onSuccess:null,onFail:null,mediaType:"picture"},e.config.fileselect,n),l=this,c={add:function(n){s=null;var r=t.extend(!0,{needChangeData:!0,needCompress:!1,name:"resize.jpg"},o,n);(u=r).mimeType=n.mimeType?n.mimeType:"",f?(n.from?"picture"===n.from||"photo"===n.from||"savephoto"===n.from?a.removeAttr("capture"):a.attr("capture",n.from):a.removeAttr("capture"),e.platform.isIos()&&"function"==typeof FastClick?a[0].dispatchEvent(new Event("click")):a.trigger("click")):i.add(r);return this},remove:function(t,n){n=n||"name";if(!f)return d=i.remove(t,n);if("string"==typeof t){d.length&&e.array.remove(d,t,n);var r=d.length?d[d.length-1].data:null;return s=r,a[0].value="",d}return this},clear:function(){d=[],s=null,f?a[0].value="":i.clear();return d},value:function(){s=f?s:i.value();return s},data:function(){d=f?d:i.data();return d},toFile:x,toBase64:function(n){var r=t.extend(!0,{needCompress:!1,destinationType:"data",mimeType:"",needChangeData:!1},n);if(r.data=r.data||s,r.mimeType=n.mimeType?n.mimeType:r.data&&r.data.type||"image/jpeg",f)try{w(r)}catch(t){e.showLog(t)}else i.toBase64(r);return this},resize:w,toBlob:k,currentIndex:function(){var e="";e=f?d.length-1:i.data().length-1;return e},currentName:function(){var e="";e=f?d[d.length-1].name:i.value().name;return e},init:b},s=null,u=null,d=[],f="object"===_typeof(n)&&void 0!==n.needNative?!n.needNative:e.isWebapp,p="*",h=!1,g=null,m=null,v=null,y=null;function b(n){var b=t.extend(!0,o,n);switch(o.appendTo=b.appendTo||e.hasRouter&&router.currentPage()||"body",b.mediaType){case"allmedeia":p="*";break;case"picture":case"image":p="image/*";break;case"video":p="video/*";break;case"audio":p="audio/*";break;default:p=b.mediaType}return d=[],g=new Image,m=new FileReader,v=document.createElement("canvas"),y=v.getContext("2d"),f?(!function(){if(null==a){r=bui.guid();var e=o.from?'capture="'+o.from+'"':"",n='<input type="file" accept="'+p+'" name="uploadFiles" id="'+r+'" '+e+' style="display:none"/>';t(o.appendTo).append(n),a=t("#"+r)||t('input[name="uploadFiles"]')}}(),h||(a.on("change",(function(t){var n=this.files;if(!(n.length<1)){n.length>1&&e.showLog("一次只能选一张图片","bui.fileselect:web");var r=n[0];s=r;var a={name:r.name,data:r,type:r.type,size:r.size};d.push(a),u.needCompress?(u.data=r,u.mimeType=u.mimeType?u.mimeType:r.type,w(u)):u.onSuccess&&u.onSuccess.call(l,r,d),this.value=""}})),h=!0)):i=e.native.fileselect&&e.native.fileselect.call(this,n,{module:c})||{},this}function w(n){var r=t.extend(!0,{destinationType:"file",data:null,mimeType:"",quality:.8,width:800,height:800,needCompress:!0,needChangeData:!1,onSuccess:null,onFail:null},o,n);g.onload=function(){var t=this.width,n=this.height,a=null,i=r.width,o=r.height,c=t,u=n;r.needCompress&&(t>i||n>o)&&(t/n>i/o?(c=i,u=Math.round(i*(n/t))):(u=o,c=Math.round(o*(t/n)))),v.width=c,v.height=u,y.clearRect(0,0,c,u),y.drawImage(g,0,0,c,u);var f=v.toDataURL(r.mimeType||r.data&&r.data.type||"image/jpeg",r.quality),p=function(e){return e.indexOf(".png")>-1||e.indexOf(".jpg")>-1||e.indexOf(".gif")>-1||e.indexOf(".jpeg")>-1?e.substr(0,e.lastIndexOf(".")):e}(r.data.name)||"";switch(r.destinationType){case"file":a=x(f,p);break;case"blob":a=k(f);break;case"data":a=f}if(r.needChangeData){s=a;var h=e.array.index(d,r.data.name,"name");h>-1&&(d[h].data=a,a.size&&(d[h].size=a.size),a.type&&(d[h].type=a.type))}return r.onSuccess&&r.onSuccess.call(l,a,d),a},g.onerror=function(){r.onFail&&r.onFail.call(l,g.src)},m.onload=function(e){g.src=e.target.result};try{var a=r.data&&r.data.type||"";a="object"===_typeof(a)?a.type||"":a||"",r.data&&0==a.indexOf("image")&&m.readAsDataURL(n.data)}catch(t){e.showLog(t)}}function x(t,n){try{n=n||"file";for(var r=t.split(","),a=(r[0].match(/:(.*?);/)||[])[1]||"image/jpeg",i=a.split("/")[1],o=atob(r[1]),l=o.length,c=new Uint8Array(l);l--;)c[l]=o.charCodeAt(l);return new File([c],n+"."+i,{type:a})}catch(t){e.showLog(t)}}function k(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],r=atob(t[1]),a=r.length,i=new Uint8Array(a);a--;)i[a]=r.charCodeAt(a);return new Blob([i],{type:n})}return b(o),c}}(bui||{},libs),function(e,t){e.file=function(n){var r,a,i,o,l,c={getFolder:d,removeFolder:function(e){var n=t.extend(!0,{},e);s.needNative?l.removeFolder(n):d({root:n.root,folderName:n.folderName,create:n.create,onSuccess:function(e,t){e.removeRecursively((function(){n.onSuccess&&n.onSuccess.call(c,e,t)}),(function(t){var r={msg:"删除 "+n.folderName+" 文件失败"};n.onFail&&n.onFail.call(c,r,e)}))},onFail:function(e){var t={msg:"删除 "+n.folderName+" 文件失败"};n.onFail&&n.onFail.call(c,t)}});return this},getFile:h,getFileName:p,removeFile:function(e){var n=t.extend(!0,{},e);s.needNative?l.removeFile(n):h({root:n.root,create:n.create,folderName:n.folderName,fileName:n.fileName,onSuccess:function(e,t){e.remove((function(){n.onSuccess&&n.onSuccess.call(c,e,t)}),(function(t){var r={msg:"删除 "+n.fileName+" 文件失败"};n.onFail&&n.onFail.call(c,r,e)}))},onFail:function(e){var t={msg:"删除 "+n.fileName+" 文件失败"};n.onFail&&n.onFail.call(c,t)}});return this},toBase64:function(e){return o.toBase64(e),this},open:function(t){var n=t||{};if(!n.url)return;s.needNative?l.open(n):e.showLog("web暂不支持open方法","bui.file.open:web");return this},init:u},s=c.config=t.extend(!0,{},{size:10,native:!0,needNative:!1},e.config.file,n);function u(n){return o=e.fileselect(n),a=function(n){var a=t.Deferred();n.needNative?l=e.native.file&&e.native.file(n,{fileselect:o,module:c})||{}:(r="bui.app",i=1024*parseInt(s.size)*1024,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,navigator.webkitPersistentStorage&&navigator.webkitPersistentStorage.requestQuota(i,(function(e){window.requestFileSystem(window.PERSISTENT,e,(function(e){a.resolve(e)}),u)})));function u(e){var t="";try{switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:t="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:t="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:t="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:t="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:t="INVALID_STATE_ERR";break;default:t="Unknown Error"}}catch(e){}var n={msg:t};a.reject(n)}return a}(n),!n.needNative&&d({root:!0,create:!0}),this}function d(e){var n={folderName:r,root:!1,create:!1,msg:"",param:{create:!1,exclusive:!1},onSuccess:null,onFail:null},i=t.extend({},n,e),o="";if(i.create?(o="创建 ",i.param.create=!0):(o="获取 ",i.param.create=!1),s.needNative)l.getFolder(i);else{var u=f(i.folderName);u=i.root?u:r+"/"+u,a.done((function(e){e.root.getDirectory(u,i.param,(function(t){i.onSuccess&&i.onSuccess.call(c,t,e)}),(function(e){var t={msg:o+u+" 文件夹失败"};i.onFail&&i.onFail.call(c,t)}))})).fail((function(e){i.onFail&&i.onFail.call(c,{msg:"文件系统还没准备好."})}))}return this}function f(e){return"."==e[0]||"/"==e[0]||" "==e[0]?f(e.slice(1)):"."!=e[0]&&"/"!=e[0]&&" "!=e[0]?e:void 0}function p(e){return e&&e.indexOf("/")>-1?e.slice(e.lastIndexOf("/")+1,e.indexOf("?")>-1?e.indexOf("?"):void 0):e}function h(e){var n=t.extend({},{fileName:"",folderName:"",root:!1,create:!1,param:{create:!1,exclusive:!1},onSuccess:null,onFail:null},e),a="";if(n.create?(a="创建 ",n.param.create=!0):(a="获取 ",n.param.create=!1),n.fileName&&!(n.fileName.indexOf(".")<0)){if(s.needNative)l.getFile(n);else{var i=p(n.fileName);d({root:n.root,folderName:n.folderName,create:!0,onSuccess:function(e,t){var o=e.name==r?e.name+"/"+i:r+"/"+e.name+"/"+i;t.root.getFile(o,n.param,(function(e){n.onSuccess&&n.onSuccess.call(c,e,t)}),(function(e){var t={msg:a+i+" 文件失败"};n.onFail&&n.onFail.call(c,t)}))},onFail:function(e){n.onFail&&n.onFail(e)}})}return this}n.onFail&&n.onFail()}return"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,u(s),c}}(window.bui||{},window.libs),function(e,t){e.upload=function(n){var r,a,i,o,l,c,s,u={url:"",data:null,headers:{},showProgress:!0,timeout:6e4,contentType:!1,processData:!1,autoClose:!0,native:!0,needNative:!1,method:"POST",fileKey:"file",dataType:"json",mediaType:"picture",from:"picture",onProgress:null,onMask:function(){b()},onSuccess:null,onFail:null},d=t.extend(!0,{},u,e.config.upload,n),f=t.Deferred(),p={init:m,add:function(e){return e.onSuccess=e.onSuccess?e.onSuccess.bind(p):null,e.onFail=e.onFail?e.onFail.bind(p):null,a.add(e),this},remove:function(e,t){var n=v(),r=n.length;if(r<1)return this;/\d/.test(e)&&e.indexOf(".")<0?a.remove(n[e].name,t):"string"==typeof e?a.remove(e,t):a.remove(n[r-1].name,t);return this},resize:function(e){return a.resize(e),this},currentIndex:function(){return a.currentIndex()},currentName:function(){return a.currentName()},clear:function(){return a.clear(),this},data:v,start:y,startAll:function(e){var n=t.extend(!0,{needFileinfo:!1},d,e),r=n[n.fileKey]||a.data();n.data||(n.data={});for(var i=[],o=0;o<r.length;o++)r[o],function(e){if(!(e>r.length-1)){if(n.data[n.fileKey]=r[e]&&r[e].data,n.needFileinfo)for(var t in r[e])"data"!==t&&(n.data[t]=r[e]&&r[e][t]);var a=n.onSuccess,o=n.onFail;n.onSuccess=function(t){a&&a.call(p,t),i[e]=t,e==r.length-1&&n.onEnd&&n.onEnd.call(p,i)},n.onFail=function(t){o&&o.call(p,t),i[e]=t,e==r.length-1&&n.onEnd&&n.onEnd.call(p,i)},y(n)}}(o);return f},stop:b,toBase64:function(e){return a.toBase64(e),this},widget:function(t){var n={loading:r,fileselect:a,ajax:i};return e.widget.call(n,t)}},h=d.showProgress,g=d.onProgress;function m(t){return r=e.loading({display:"block",width:30,height:30,opacity:0,autoClose:t.autoClose,callback:t.onMask}),a=e.fileselect.call(p,{native:t.native,needNative:t.needNative,from:t.from,mediaType:t.mediaType}),t&&t.needNative&&(o=e.native.upload&&e.native.upload(t,{loading:r,fileselect:a,module:p})||{}),t.data?(y(t),this):this}function v(){return a.data()}function y(e){var n=t.extend(!0,{},d,e);if(c=n.url,l=a.value(),h=n.showProgress,l){if(h&&r.show(),n&&n.needNative)return o.start(n)||f;var s=n.data,u=Object.keys(s),g=new FormData,m=!1;return u.forEach((function(e,t){n.fileKey===e&&(m=!0),g.append(e,s[e])})),!m&&g.append(n.fileKey,l),n.data=g,function(e){var n=e.onSuccess,r=e.onFail;return i=t.ajax({url:c,type:e.method,data:e.data,cache:e.cache,headers:e.headers,dataType:e.dataType,contentType:e.contentType,processData:e.processData,timeout:e.timeout,xhr:function(){var e=t.ajaxSettings.xhr();if(w&&e.upload)return e.upload.addEventListener("progress",w,!1),e},success:function(e){x(),n&&n.call(p,e),f.resolve(e)},error:function(e,t,n){x(),r&&r.call(p,e,t),f.reject(e,t,n)}}),f}(n)}}function b(e){return d&&d.needNative?o.stop(e):(r&&r.stop(),i&&i.abort(),e&&e.call(p,r,i)),this}function w(e){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,window.requestAnimationFrame((function(){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);s=t.toString()+"%",t<100?(n=s,h&&r&&r.show({text:n})):x(),g&&g.call(p,s)}var n}))}function x(){return r&&r.stop(),this}return"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,m(d),p}}(window.bui||{},window.libs),function(e,t){e.download=function(n){var r,a,i,o,l,c={open:function(e){return a.open(e),this},getFile:function(e){var n=t.extend(!0,{autoDown:!0},s,e),r=e.fileName||a.getFileName(n.url);a.getFile({fileName:r,folderName:n.folderName,onSuccess:function(e,t){n.onSuccess&&n.onSuccess.call(c,e.fullPath||e,e,t)},onFail:function(e){n.autoDown=v(n)}})},removeFile:function(t){if(!t.fileName)return e.showLog("请告诉我们你要删除哪个文件, fileName "),this;return t.folderName=t.folderName||s.folderName,a.removeFile(t),this},removeFolder:function(e){return e.folderName=e.folderName||s.folderName,a.removeFolder(e),this},start:v,stop:y,toBase64:function(e){return a.toBase64(e),this},init:m,widget:function(t){var n={loading:h,file:a,ajax:r};return e.widget.call(n,t)}},s=c.config=t.extend(!0,{},{url:"",data:{},headers:{},method:"GET",showProgress:!0,timeout:6e4,fileName:"",folderName:"download",native:!0,needNative:!0,onProgress:null,onSuccess:null,onFail:null},e.config.download,n),u="object"===_typeof(n)&&void 0!==n.needNative?!n.needNative:e.isWebapp,d=s.showProgress,f=s.onProgress,p=s.onFail,h=null,g=null;function m(t){return h=t.showProgress&&e.loading({display:"block",width:30,height:30,opacity:0,callback:function(){y()}}),a=e.file({native:t.native,needNative:t.needNative}),t.needNative?i=e.native.download&&e.native.download(t,{file:a,loading:h,module:c})||{}:function(e){if(a.getFolder({folderName:e.folderName,create:!1,onSuccess:function(e,t){e.fullPath},onFail:function(t){a.getFolder({folderName:e.folderName,create:!0,onSuccess:function(e,t){e.fullPath},onFail:function(e){p&&p.call(c,e)}})}}),!e.url)return;v(e)}(t),this}function v(e){var n=t.extend(!0,{},s,e);o=n.needEncode?encodeURI(n.url):n.url,f=n.onProgress,(d=n.showProgress)&&h&&h.show({text:"0%"}),e.fileName||a.getFileName(n.url),n.needNative?i.start(n):(n.cache=!1,n.contentType=!1,n.processData=!1,r=t.ajax({url:o,type:n.method,data:n.data,cache:n.cache,headers:n.headers,contentType:n.contentType,processData:n.processData,timeout:n.timeout,xhr:function(){var e=t.ajaxSettings.xhr();if(b&&e)return e.addEventListener("progress",b,!1),e},success:function(t){var r=e.fileName||a.getFileName(n.url);a.getFile({fileName:r,folderName:n.folderName,create:!0,onSuccess:function(e,t){n.onSuccess&&n.onSuccess.call(c,e.fullPath,t)}})},fail:function(e){w(),n.onFail&&n.onFail.call(c,e)}}))}function y(e){u?(w(),r&&r.abort(),g&&window.cancelAnimationFrame(g)):i.stop(),e&&e.call(c,h,r)}function b(e){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,g=window.requestAnimationFrame((function(){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);l=t.toString()+"%",t<100?(n=l,d&&h&&h.show({text:n})):w(),f&&f.call(c,l)}var n}))}function w(){d&&h&&h.stop()}return m(s),c}}(window.bui||{},window.libs),function(e,t){e.currentPlatform="webapp",e.on("pagereadybefore",(function(){e.platform.isPC()?window.viewport=e.viewport(40):window.viewport=e.viewport(),e.config.init.auto&&e.init(),!e.hasRouter&&e.config.component.auto&&loader.components({id:"body"})})),e.webready=function(n){t(document).ready((function(){e.trigger.call(e,"pagereadybefore"),n&&n.call(e),e.trigger.call(e,"pageready")}))},e.ready=function(n){e.isWebapp=void 0===e.isWebapp?e.debug:e.isWebapp;var r=t.Deferred();if(e.isWebapp)t(document).ready((function(){e.trigger.call(e,"pagereadybefore"),n&&n.call(e),e.trigger.call(e,"pageready"),r.resolve()}));else{if(void 0===e.native.ready)return e.showLog("当前 bui.isWebapp = false; 但bui.js为webapp版本,不支持原生方法,请使用 buijs update -p xxx, 更换bui.js为对应xxx平台版本;"),e.webready(n),r;r=e.native.ready&&e.native.ready(n)||r}return r}}(window.bui||{},window.libs),function(e,t){e.mask=function(n){var r={id:"",appendTo:"",className:"",opacity:.3,background:"",zIndex:100,autoTrigger:!1,autoClose:!1,onBeforeInit:null,onInited:null,callback:null},a={name:"mask",handle:{},on:function(t,n){return e.on.apply(a,arguments),this},off:b,hide:y,show:function(t){if(h)return;(d=e.objId(l))&&d.length?(d.css("display","block"),!p&&u.css("position","relative"),s=!0):m(i);return w.call(a,"show"),this},isShow:function(){return s},remove:v,destroy:function(e){v(),u&&u.off("click.mask");b("show"),b("hide"),h=!0},widget:function(t){return e.widget.call({},t)},option:function(t,n){return e.option.call(a,t,n)},config:i,init:g},i=a.config=t.extend(!0,{},r,e.config.mask,n),o=e.guid(),l=i.id?i.id.indexOf("#")>-1?i.id.substring(1):i.id:o;t("body");var c,s,u=e.objId(i.appendTo),d=null,f=!1,p=!1,h=!1;function g(n){h=!1;var o=t.extend(!0,r,i,n);return o.onBeforeInit&&o.onBeforeInit.call(a,o),o.appendTo=o.appendTo||"body",u=e.objId(o.appendTo),p=u[0]&&"COMPONENT"===u[0].tagName,i=a.config=o,c=u.css("position"),o.autoTrigger&&m(o),d=e.objId(o.id),o.onInited&&o.onInited.call(a,o),this}function m(n){if(!h){var o=t.extend(!0,{},r,i,n),c=function(t){var n=t.background?t.background:"rgba(0,0,0,"+t.opacity+")",r="";return r+'<div id="'+l+'" class="'+e.prefix("mask")+" "+t.className+'" style="background:'+n+";z-index:"+t.zIndex+'"></div>'}(o);return(d=e.objId(l))&&d.length?d.css("display","block"):(u.append(c),!p&&u.css("position","relative"),d=e.objId(l)),s=!0,w.call(a,"show"),f||function(e){d.off("click.bui").on("click.bui",(function(t){e.callback&&e.callback.call(a,t),e.autoClose&&y(),t.stopPropagation()})),f=!0}(o),this}}function v(){if(!h)return d&&d.remove(),d=null,u.css("position",c||"static"),s=!1,f=!1,w.call(a,"hide"),this}function y(){if(!h)return d&&d.css("display","none"),!p&&u.css("position","relative"),s=!1,w.call(a,"hide"),this}function b(t,n){return e.off.apply(a,arguments),this}function w(t){a.self=this==window||this==a?null:this,e.trigger.apply(a,arguments)}return g(i),a}}(window.bui||{},window.libs),function(e,t){e.loading=function(n){var r={name:"loading",handle:{},on:function(t,n){return e.on.apply(r,arguments),this},off:k,start:y,stop:w,isLoading:function(){return f},pause:function(){if(d)return;return s&&s.addClass("bui-loading-pause"),O.call(this,"pause"),this},text:b,showRing:function(){if(d)return;return s=e.objId(l),s.children(".bui-loading-cell").css("display","inline-block"),s.removeClass("bui-loading-pause"),this},hideRing:function(){if(d)return;return s=e.objId(l),s.children(".bui-loading-cell").css("display","none"),s.addClass("bui-loading-pause"),this},show:function(n){var r=n||{};if(d)return;var i=t.extend(!0,a,r);(s=e.objId(i.id))&&s.length?(b(i.text),s[0].style.display="-webkit-box",m&&m.show(),i.callback&&o.off("click.bui","#"+l).on("click.bui","#"+l,i.callback),O.call(this,"show")):y(i);a.timeout&&(p&&clearTimeout(p),p=setTimeout((function(e){x()}),a.timeout));return f=!0,this},hide:x,destroy:function(e){e=1==e;w(),o&&o.off("click.bui");k("show"),k("hide"),k("start"),k("stop"),k("pause"),k("remove"),m&&m.destroy(e),d=!0},widget:function(t){var n={mask:m||{}};return e.widget.call(n,t)},option:function(t,n){return e.option.call(r,t,n)},config:a,init:v},a=r.config=t.extend(!0,{},{appendTo:"",width:30,height:30,text:"",onlyText:!1,mask:!0,zIndex:"",autoTrigger:!1,autoClose:!0,timeout:0,opacity:0,display:"block",template:null,onBeforeInit:null,onInited:null,callback:null},e.config.loading,n);t("body");var i,o=null,l=e.guid(),c=l+"-mask",s=e.objId(l),u=!1,d=!1,f=!1,p=null;a.id=l;var h=a.callback;a.callback=function(e){a.autoClose&&w(),h&&h.call(r,e)};var g=t.extend(!0,{},a,{id:c}),m=a.mask?e.mask(g):null;function v(i){d=!1;var c=t.extend(!0,{},a,i);return c.onBeforeInit&&c.onBeforeInit.call(r,n),c.appendTo=c.appendTo||"body",o=t(c.appendTo),a=r.config=c,c.autoTrigger&&s.length<1&&y(c),s=e.objId(l),c.onInited&&c.onInited.call(r,c),this}function y(n){if(!d){var i=t.extend(!0,{},a,n);if(s=e.objId(l),s.children(".bui-loading-cell"),s.hasClass("bui-loading-pause"))s.removeClass("bui-loading-pause"),O.call(this,"start");else{s.length&&s.remove();var c=function(t){var n=(t=t||{}).text,a=o.width()||document.documentElement.clientWidth,i=n&&"block"==t.display?parseInt(t.height)+30:parseInt(t.height),c=-a/2,s=-i/2,u="block"==t.display?e.prefix("loading-block"):e.prefix("loading-inline"),d="";return d+='<div id="'+l+'" class="'+e.prefix("loading")+" "+u+'" style="width:'+a+"px;height:"+i+"px;line-height:"+i+"px;margin-left:"+c+"px;margin-top:"+s+"px;"+(t.zIndex?"z-index:"+t.zIndex:"")+'" >',t.onlyText||(d+='<div class="'+e.prefix("loading-cell")+'" style="width:'+parseFloat(t.width)+"px;height:"+parseFloat(t.height)+'px;"></div>'),d+='<div class="'+e.prefix("loading-text")+'">'+t.text+"</div>",d+="</div>",t&&t.template?t.template.call(r,t):d}(i);o.append(c),m&&m.show(),O.call(this,"show")}return i.timeout&&(p&&clearTimeout(p),p=setTimeout((function(){w()}),i.timeout)),u||function(e){var t=e||a;o.off("click.bui","#"+l).on("click.bui","#"+l,(function(e){t.callback&&t.callback.call(r,e),e.stopPropagation()})),u=!0}(i),f=!0,this}}function b(t){if(!d)return s=e.objId(l),i=s.children(".bui-loading-text"),void 0===t?i&&i.text():(i&&i.html(t),this)}function w(){if(!d)return(s=e.objId(l))&&s.remove(),s=null,m&&m.remove(),u=!1,f=!1,O.call(this,"remove"),O.call(this,"hide"),this}function x(){if(!d)return s=e.objId(l),(a.appendTo||s&&s.length)&&(s.css("display","none"),m&&m.hide()),f=!1,O.call(this,"hide"),this}function k(t,n){return e.off.apply(r,arguments),this}function O(t){r.self=this==window||this==r?null:this,e.trigger.apply(r,arguments)}return v(a),r}}(window.bui||{},window.libs),function(e,t){e.init=function(n){var r,a={id:".bui-page",height:0,header:"header",main:"main",footer:"footer",reduceRem:0};if("object"==e.typeof(n))r=t.extend({},a,e.config.init,n);else{var i={};i.height=n,r=t.extend({},a,i)}var o=r.height||document.documentElement.clientHeight||t("body").height()||t("#bui-router").height()||t(".bui-page").height();if(!(e.obj(r.main).length<1)){try{var l=e.obj(r.id),c=r.header.indexOf("#")>-1?e.obj(r.header)[0]:l.children(r.header)[0],s=r.footer.indexOf("#")>-1?e.obj(r.footer)[0]:l.children(r.footer)[0],u=r.main.indexOf("#")>-1?e.obj(r.main):l.children(r.main),d=c?c.offsetHeight:0,f=s?s.offsetHeight:0,p=r.reduceRem>0?e.unit.remToPx(r.reduceRem):0,h=o-d-f-p;if(parseInt(h)>0)u.height(h);else{var g=d+f+p+"px";e.unit.calcHeight(u,g)}}catch(t){e.showLog(t,"bui.init")}return h}},window.addEventListener?window.addEventListener("load",(function(t){e.trigger.call(e,"onload")}),!1):window.attachEvent("onload",(function(t){e.trigger.call(e,"onload")})),t(document).ready((function(){e.isWebapp=void 0===e.isWebapp?e.debug:e.isWebapp,e.trigger.call(e,"pagebefore"),"function"==typeof FastClick&&FastClick.attach(document.body),e.trigger.call(e,"pageinit")}));try{var n="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"",r=n.replace(/hidden/i,"visibilitychange");document.addEventListener(r,(function(t){document[n]?e.trigger.call(e,"pagehide",t):e.trigger.call(e,"pageshow",t)}))}catch(e){}try{navigator.control.gesture(!1),navigator.control.longpressMenu(!1)}catch(e){}}(window.bui||{},window.libs)}));
