function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/* @preserve 
 * @name: BUI v1.6.6  
 * @detail: BUI 是一个免费的UI交互框架, 用于快速定制开发WebApp,微信,混合移动应用(Bingotouch,Link,Dcloud,Apicloud,Appcan等).
 * @site: http://www.easybui.com/ 
 * Copyright © 2017-2021 BUI. All Rights Reserved. 
 */!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e,t,n;window.libs=window.Zepto||window.jQuery||{},window.bui={},window.router={},(e=window.bui).debug=!0,e.hasRouter=!1,e.nativeRouter=!1,e.isWebapp,e.currentPlatform="",e.log=!0,e.trace=!1,e.native={},e.config={},e.config.namespace="bui",e.config.classNamePrefix=e.config.namespace+"-",e.config.version="1.6.6",e.config.versionCode=20210802,e.version=e.config.version,e.versionCode=e.config.versionCode,e.config.icon={close:"icon-close",minus:"icon-minus",plus:"icon-plus",search:"icon-search",remove:"icon-removefill"},e.config.viewport={},e.config.init={auto:!0},e.config.ready={},e.config.ajax={},e.config.get={},e.config.put={},e.config.delete={},e.config.post={},e.config.back={},e.config.load={},e.config.getPageParams={},e.config.refresh={},e.config.run={},e.config.checkVersion={},e.config.component={auto:!0},e.config.dialog={},e.config.confirm={},e.config.alert={},e.config.hint={},e.config.prompt={},e.config.loading={},e.config.mask={},e.config.list={},e.config.listview={},e.config.scroll={},e.config.pullrefresh={},e.config.select={},e.config.sidebar={},e.config.slide={},e.config.actionsheet={},e.config.dropdown={},e.config.accordion={},e.config.stepbar={},e.config.rating={},e.config.number={},e.config.file={},e.config.fileselect={},e.config.upload={},e.config.download={},e.config.swipe={},e.config.router={},e.config.loader={},e.config.loader.define={},e.config.loader.load={},e.config.loader.component={},e.config.store={},e.config.floor={},function(e,t){e.prefix=function(t){return e.config.classNamePrefix+t},e.showLog=function(t,n){n=n||"";var a="";"object"==_typeof(t)&&"message"in t&&"name"in t?a=t.message+":"+t.name+"&&stack:"+t.stack:"string"==typeof t&&(a=t),e.log&&console.error(n+" "+a),e.trace&&console.trace&&console.trace(),e.trigger("catcherror",t,n)},e.guid=function(e){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(e=void 0===e?"bui":e||"")+t().substr(e.length)+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},e.swipeDirection=function(e,t,n,a){var i=t-e,r=a-n,o=Math.abs(i),l=Math.abs(r);return!(o<9&&l<9)&&(o/l>3?i>0?"swiperight":"swipeleft":r>0?"swipedown":"swipeup")},e.obj=function(n,a){var i=null;a=a||null;var r=e.hasRouter&&router.currentPage()||"html",o=t(r=a||r),l="string"==typeof n;if("object"===_typeof(n))return i=t(n);if(l&&/^(\d)/.test(n))return i=o.find("[id='"+n+"']");if(l&&/^[a-zA-z]/.test(n)){var c=/^(html|head|body|header|main|footer|ul|li|section|dt|dd|div|span|img|article|i|strong|input|textarea|select|h1|h2|h3|h4|h5|h6|p|view|component|components|iframe)$/gi.test(n)||/^\[.+\]$/.test(n)||n.indexOf("[")>-1?n:"#"+n;return i=o.find(c)}return/^#\d/.test(n)?i=o.find("[id='"+n.substr(1)+"']"):/^\.\d/.test(n)?i=o.find("[class='"+n.substr(1)+"']"):n&&(i=o.find(n)),i},e.$=e.obj,e.objId=function(t){return e.obj(t,"html")},e.selector=function(e){return void 0===e?this:t(e,this)},e.widget=function(e){return e&&e in this?this[e]:this},e.option=function(n,a){if("object"!==e.typeof(n)&&void 0===a)return"string"==typeof n?this.config[n]:this.config;if("id"==n)return e.showLog("不允许修改控件的ID参数"),this;if(n&&"object"===e.typeof(n)){var i=t.extend(this.config,n);return this.init(i)}if(this.config.hasOwnProperty(n)){var r={};r[n]=a;i=t.extend(this.config,r);return this.init(i)}return this}}(window.bui||{},window.libs),function(e,t){e.emitter=function(){function t(){this.handle=Object.create(null)}return t.prototype.on=function(t,n,a){return"function"==typeof n?(a=n,n=this):(a=a,n=n||this),n.handle=n.handle||{},e.unit.stringToArray(t).forEach((function(e,t){void 0===n.handle[e]&&(n.handle[e]=[]),n.handle[e].push(a)})),n},t.prototype.off=function(t,n,a){"function"==typeof n?(a=n,n=this):"function"==typeof a?(a=a,n=n||this):n=this;var i=e.typeof(t);if(void 0===t)n.handle=Object.create(null);else if("string"===i&&"function"==typeof a){var r=n.handle[t]||[];e.array.remove(r,a)}else if("string"===i||"array"===i){"object"!==_typeof(n.handle)&&(n.handle={}),e.unit.stringToArray(t).forEach((function(e,t){n.handle[e]=[]}))}return n},t.prototype.one=function(e,t){var n=this;return this.on(e,(function a(){t&&t.apply(n,arguments),n.off(e,a)})),this},t.prototype.wait=function(t,n){var a=this,i=e.unit.stringToArray(t),r=[],o=!0;return i.forEach((function(t,l){a.on(t,(function(t){r[l]=t,r.length===i.length&&o&&(i.forEach((function(t,n){r[n]=e.history.getLast().component[t]||{}})),n&&n.apply(a,r),o=!1)}))})),this},t.prototype.waited=function(t,n){var a=this,i=e.unit.stringToArray(t),r=[],o=!0;return i.forEach((function(t,l){a.on(t,(function(t){r[l]=t.exports||t,r.length===i.length&&o&&(i.forEach((function(t,n){var a=e.history.getLast().component[t];r[n]=a?a.exports:{}})),n&&n.apply(a,r),o=!1)}))})),this},t.prototype.trigger=function(e){try{if(this.handle[arguments[0]]instanceof Array){var t=this.handle[arguments[0]],n=[].slice.apply(arguments);n.shift();for(var a=0,i=t.length;a<i;a++)t[a]&&t[a].apply(this.self||this,n)}}catch(e){}return this},t.prototype.notify=function(){try{for(var e in this.handle)if(this.handle[e]instanceof Array)for(var t=this.handle[e],n=0,a=t.length;n<a;n++)t[n]&&t[n].apply(this.self||this)}catch(e){}return this},function(e){return new t}}();var n=e.emitter();e.on=n.on,e.off=n.off,e.trigger=n.trigger,e.one=n.one}(window.bui||{}),function(e,t){e.store=function(n){var a={el:null,uid:"",scope:"",data:null,extends:null,mixins:[],beforeMounts:[],beforeCompiles:[],compileds:[],beforeUpdates:[],mounteds:[],updateds:[],beforeDestroys:[],destroyeds:[],computed:null,methods:null,watch:null,templates:null,beforeMount:null,mounted:null,beforeCompile:null,compiled:null,beforeUpdate:null,updated:null,beforeDestroy:null,destroyed:null,isPublic:!1,modelEvent:"input",scopeSplit:".",paramSplit:"|",delayInput:200,needStatic:!1,needView:!0,needComponent:!1,needCompile:!0,needNative:!1,deep:!0,log:!1,autoinit:!0},i=null,r=!1;function o(n){var i=null,r=n&&n.extends?[n.extends]:[];e.array.merge(a.mixins,r,n.mixins||[],[n]);var o=t.extend(!0,{},a,e.config.store);return function e(n){var r=0;for(r=0;r<n.length;r++){var l=n[r];l.beforeMount&&a.beforeMounts.push(l.beforeMount),l.beforeCompile&&a.beforeCompiles.push(l.beforeCompile),l.beforeUpdate&&a.beforeUpdates.push(l.beforeUpdate),l.updated&&a.updateds.push(l.updated),l.compiled&&a.compileds.push(l.compiled),l.mounted&&a.mounteds.push(l.mounted),l.beforeDestroy&&a.beforeDestroys.push(l.beforeDestroy),l.destroyed&&a.destroyeds.push(l.destroyed),i=t.extend(!0,o,l),l.mixins&&l.mixins.length&&r<n.length-1&&e(l.mixins)}}(a.mixins),i=t.extend(!0,a,i)}var l="function"==typeof(i=o(n)).data?i.data.call(H):i.data,c=i.scope||e.guid(),s=i.computed,u=i.scopeSplit,d=i.methods,f=i.templates,p=i.watch||a.watch;i.delayInput;var h,g=i.isPublic,m=i.modelEvent,v=i.needStatic,y="",b=!1,w=!0,x={},k={},O={},L=!1,I={},P=e.emitter(),j={target:null};i.el?i.el=i.el:i.el=g?"body":".bui-page",h=i.el,y=0==h.indexOf(".")||0==h.indexOf("#")?h.substr(1):h;var S=null,T=null,E=null,N=null,C=[],R=!0,A=l,_=void 0===i.log?a.log:i.log,F=/b-text|b-html|b-value|b-show|b-hide|b-checked|b-src|b-href|b-bind|b-style|b-class|b-model|b-id|b-data|b-title|b-visible/gim,D={"b-text":function(t){var n="b-text",a=ie.call(this,t,n),i=ae.call(this,n),r="",o=e.typeof(t.value),l=a.attr(n),c=ue.call(this,n);c[0].keyname;var s=c[0].param;switch(o){case"array":r=re(t,l);break;case"function":r=t.value.apply(H,s);break;default:r=t.value}r=i?!r:r,a.text(r),C=[]},"b-html":function(t){var n="b-html",a=ie.call(this,t,n),i=ae.call(this,n),r="",o=e.typeof(t.value),l=a.attr(n),c=ue.call(this,n);c[0].keyname;var s=c[0].param;switch(o){case"array":r=re(t,l);break;case"function":r=t.value.apply(H,s);break;default:r=t.value}r=i?!r:r,a.html(r),C=[]},"b-value":function(e){var t=ie.call(this,e,"b-value");g?t.each((function(t,n){oe.call(this,e)})):oe.call(t[0],e);C=[]},"b-show":function(e){var t=ie.call(this,e,"b-show");e.value&&e.value.length||"object"!==_typeof(e.value)&&1==Boolean(e.value)?this.removeAttribute("style"):(""===e.value||e.value&&!e.value.length||0==Boolean(e.value))&&t.css("display","none");C=[]},"b-visible":function(e){var t=ie.call(this,e,"b-visible");e.value&&e.value.length&&"object"!==_typeof(e.value)&&1==Boolean(e.value)?this.removeAttribute("style"):(""===e.value||e.value&&!e.value.length||0==Boolean(e.value))&&t.css("visibility","hidden");C=[]},"b-hide":function(n){var a="!"+c+u+n.keyname,i=g?t('[b-show="'.concat(a,'"]')):S(this);"array"===e.typeof(n.value)&&n.value.length||"object"!==_typeof(n.value)&&1==Boolean(n.value)?i.css("display","none"):(""===n.value||n.value&&!n.value.length||0==Boolean(n.value))&&i.removeAttr("style")},"b-checked":function(e){this.checked=!!e.value,C=[]},"b-bind":function(e){var t=ie.call(this,e,"b-bind"),n=this,a=e.keyname,i=e.value;if("object"===_typeof(i)){var r=function(r){ye(a+"."+r,(function(t){ce(ie.call(n,e,"b-bind"),r,t.value)})),ce(t,r,i[r])};for(var o in i)r(o)}else{var l="string"==typeof a&&a.split("."),c=l[l.length-1];ce(t,c,i)}},"b-src":function(e){ie.call(this,e,"b-src").attr("src",e.value),C=[]},"b-title":function(e){ie.call(this,e,"b-title").attr("title",e.value),C=[]},"b-data":function(e){ie.call(this,e,"b-data").attr("data",e.value),C=[]},"b-id":function(e){ie.call(this,e,"b-id").attr("id",e.value),C=[]},"b-href":function(e){ie.call(this,e,"b-href").attr("href",e.value),C=[]},"b-class":function(n){var a=ie.call(this,n,"b-class"),i=this;this.classList;var r=n.keyname||"";if("object"===_typeof(n.value))if("array"===e.typeof(n.value)){n.value.length||a.attr("class",""),n.value.forEach((function(e,t){!a.hasClass(e)&&a.addClass(e)}));var o=r.indexOf(".$index");o>-1?ye(r.substr(0,o)+"."+t(a).index(),(function(e){var t=ie.call(i,n,"b-class");se(t,e.value[t.index()],e.value)})):ye(r,(function(e){var t=ie.call(i,n,"b-class");se(t,e.value[t.index()],e.value)}))}else{var l=function(e){var t=n.value[e],o=n.preValue&&n.preValue[e]||"";ye(r+"."+e,(function(t){se(ie.call(i,n,"b-class"),e,t.value)})),se(a,e,t,o)};for(var c in n.value)l(c)}else if("function"==typeof n.value){var s=ue.call(this,"b-class"),u=s[0].keyname,d=s[0].param,f=n.value.apply(H,d);se(a,u,f,n.preValue)}else{var p="string"==typeof n.keyname&&n.keyname.split("."),h=p[p.length-1];se(a,h,n.value,n.preValue)}C=[]},"b-model":function(e){var t=ie.call(this,e,"b-model");g?t.each((function(t,n){le.call(this,e)})):le.call(t[0],e)},"b-style":function(e){var t=ie.call(this,e,"b-style"),n=this;if("object"===_typeof(e.value)){var a=function(a){ye(e.keyname+"."+a,(function(t){ie.call(n,e,"b-style").css(a,t.value)})),t.css(e.value)};for(var i in e.value)a(i)}else t.css(e.keyname,e.value);C=[]}},$={"b-text":[],"b-html":[],"b-value":[],"b-show":[],"b-hide":[],"b-checked":[],"b-bind":[],"b-src":[],"b-title":[],"b-data":[],"b-id":[],"b-href":[],"b-class":[],"b-model":[],"b-style":[]},U={},V=t.extend(!0,{},l,d,p,s,f),H={$methods:d,$refs:I,mixin:o,$options:i,$templates:f,config:i,watch:z,nextTick:function(t){return ye("nexttick",(function(n){try{t&&t.call(H,n)}catch(n){e.showLog(n)}})),this},oneTick:function(t,n){var a="nexttick-"+t;if(O.hasOwnProperty(a))return this;return O[a]=n,ye("nexttick",(function(n){if(n.keyname===t)try{k[t].pop(),0==k[t].length&&O[a]&&O[a].call(H,n)}catch(n){e.showLog(n)}})),this},get:function(t){if(void 0===t)return A=A;if("string"==typeof t){var n=e.unit.getKeyValue(t,A);return C=[],n}return A},set:ge,setState:function(n,a){var o="string"==typeof n,s=a,d="",f=null,p=/\.\d$/.test(n);C=[];var h=e.unit.getKeyValue(n,A);if(r=!0,o&&void 0!==a){if(_&&console.log("set ".concat(n," ")),L=!0,xe.call(H,"beforeupdate",{target:null,value:s,preValue:h,action:"setState",keyname:n,origin:A}),i.beforeUpdates.forEach((function(e,t){e.call(H,{target:null,value:s,preValue:h,action:"setState",keyname:n,origin:A})})),s=a&&"object"===e.typeof(a)?t.extend(!0,{},h,a):a,p&&(d=n.replace(/\.\d$/,""),f=e.unit.getKeyValue(d,A)),e.unit.setKeyValue(n,s,l),e.unit.setKeyValue(n,s,A),p){var g=e.unit.getKeyValue(d,A);xe.call(H,d,{target:null,value:g,preValue:f,action:"setState",keyname:n,origin:A})}xe.call(H,n,{target:null,value:s,preValue:h,action:"setState",keyname:n,origin:A}),a&&"object"===e.typeof(a)?Object.keys(a).forEach((function(e,t){var a=n+"."+e;xe.call(H,a,{target:null,value:s[e],preValue:h[e],action:"setState",keyname:a,origin:A})})):a&&"array"===e.typeof(a)&&!p&&a.forEach((function(t,a){var i=n+"."+a;xe.call(H,i,{target:null,value:t,preValue:h[a],action:"setState",keyname:i,origin:A}),t&&"object"===e.typeof(t)&&Object.keys(t).forEach((function(e,n){var a=i+"."+e;xe.call(H,a,{target:null,value:t[e],preValue:t[e],action:"setState",keyname:a,origin:A})}))}));var m=p?T.find('[b-template*="'.concat(c,".").concat(d,'"]')):T.find('[b-template*="'.concat(c,".").concat(n,'"]'));m.length&&m.each((function(e,n){t(n).length&&X({el:t(n),action:"setState"})})),xe.call(H,"updated",{target:null,value:s,preValue:h,action:"setState",keyname:n,origin:A}),i.updateds.forEach((function(e,t){e.call(H,{target:null,value:s,preValue:h,action:"setState",keyname:n,origin:A})})),"object"===_typeof(a)&&(a instanceof Array?fe(l,n.split(u)):fe(a)),C=[]}return this},delete:me,del:me,observer:fe,compile:q,$mount:q,compileHtml:W,clearKey:function(){return C=[],b=!1,w=!0,L=!1,this},destroy:function(){return C=[],i.beforeDestroys.forEach((function(e,t){e.call(H)})),b=!1,w=!0,L=!1,we(),i.beforeMounts=[],i.beforeCompiles=[],i.compileds=[],i.mounteds=[],i.beforeUpdates=[],i.updateds=[],i.destroyeds.forEach((function(e,t){e.call(H)})),this},init:M,connect:function(t,n,a){if("object"!==_typeof(t)||!t.hasOwnProperty("$refs"))return H;var i=this;if("string"==typeof n){he(t,n);var r=e.unit.getKeyValue(n,i.$data);"object"===e.typeof(r)?d(n,r,a||n):u(a||n,r,n)}else for(var o=Object.keys(A),l=0;l<o.length;l++){var c=o[l];if(e.array.compare(pe,c,"field"))break;if(he(t,c),t.$data.hasOwnProperty(c)){t.$data[c];var s=i.$data[c];"object"===e.typeof(s)?d(c,s):u(c,s)}}function u(n,a,i){"array"===e.typeof(a)?t[n].$replace(a):t.set(n,a);var r=null;i&&(r=z(i,(function(a){"array"===e.typeof(a)?t[n].$replace(a):t.set(n,a)}))),n&&(r=z(n,(function(a){"array"===e.typeof(a)?t[n].$replace(a):t.set(n,a)})));var o=e.array.index(pe,n,"field");(o<0||pe[o]&&t.$options.el!==pe[o].el)&&pe.push({field:i||n,el:t.$options.el,disconnect:r})}function d(n,r,o){for(var l,c=Object.keys(r),s=function(r){var o=c[r],l=n+"."+o,s=void 0===a,u=s||""==a?o:a+"."+o;he(t,l);var f=e.unit.getKeyValue(l,i.$data);s?t.set(l,f):t.set(u,f);var p=z(l,(function(e){void 0!==a?t.set(u,e):t.set(l,e)}));((d=e.array.index(pe,l,"field"))<0||pe[d]&&t.$options.el!==pe[d].el)&&pe.push({field:l,el:t.$options.el,disconnect:p})},u=0;u<c.length;u++){var d;s(u)}t.trigger.call(t,o||n,(_defineProperty(l={action:"set",target:null,value:A[n],preValue:null},"action","set"),_defineProperty(l,"keyname",n),_defineProperty(l,"origin",A),l))}return H},disconnect:function(t){if("string"==typeof t){var n=e.array.get(pe,t,"field");n&&n.disconnect()}else pe.forEach((function(e,t){e.disconnect()}));return H},on:ye,off:we,one:be,trigger:xe,emitter:P};try{i.autoinit&&M()}catch(t){e.showLog(t)}function M(){var n,a=(S=e.hasRouter?router.$:t)(i.el);for(var r in T="object"===_typeof(i.el)?t(i.el):a.length?a:t(i.el),E=T&&T.parent(),N=T&&T.children(),H.$el=T,H.$parent=E,H.$children=N,H.$data=l,d)d[r]=d[r].bind(H);return H.$methods=d,d&&function(){try{Object.keys(d).forEach((function(t){l.hasOwnProperty(t)?e.showLog("不能跟data的键值相同:"+t):Object.defineProperty(H,t,{get:function(){return d[t].bind(this)},set:function(){}})}))}catch(t){e.showLog(t)}}(),f&&function(){try{Object.keys(f).forEach((function(t){l.hasOwnProperty(t)?e.showLog("不能跟data的键值相同:"+t):Object.defineProperty(H,t,{get:function(){return f[t].bind(this)},set:function(){}})}))}catch(t){e.showLog(t)}}(),xe.call(H,"beforemount"),i.beforeMounts.forEach((function(e,t){e.call(H)})),fe(l),function(){var e=function(e){Object.defineProperty(H,e,{configurable:!0,get:function(){_&&console.log("1. module getting ".concat(e),C),this===H||!b&&w?(b=!0,w=!1,C=[]):(b=!1,w=!1);var t=l[e];return Array.isArray(t)&&j.target&&(Array.isArray(x[e])||(x[e]=[]),x[e].push(j.target)),t},set:function(t){_&&console.log("2. module setting ".concat(e),C),C=[],l[e]=t,A[e]=t}})};for(var t in l)e(t)}(),p&&function(t){try{B(t)}catch(t){e.showLog(t)}}(p),s&&function(){try{Object.keys(s).forEach((function(t){if(l.hasOwnProperty(t))e.showLog("不能跟data的键值相同:"+t);else{var n=s[t];Object.defineProperty(H,t,{get:function(){var e,a="function"==typeof n?n.bind(this):n.get.bind(this);return j.target&&(x[t]=[],x[t].push(j.target)),j.target=function(){var e=a();x[t]&&x[t].forEach((function(e){return e()})),xe(t,{target:null,value:e,action:"set",keyname:t,param:[],origin:A}),j.target=null,C=[]},e=a(),j.target=null,C=[],e},set:n&&"object"===e.typeof(n)&&n.set||function(){}})}}))}catch(t){e.showLog(t)}}(),g?i.needCompile&&router&&router.on("complete",(function(e){i.needCompile&&q(),R&&i.mounteds.forEach((function(t,n){t.call(H,e)})),A=t.extend(!0,{},l),b=!1,w=!0,xe.call(H,"mounted",e),R=!1,C=[]})):(R||we(),v&&(n=W(n=T.html()),T.html(n)),i.needView?function(e){loader.views({id:e.id,loaded:function(e){q(e.el)},compiled:e.compiled})}({id:T,compiled:function(){i.needCompile&&q(),i.mounteds.forEach((function(e,t){e.call(H)}))}}):(i.needCompile&&q(),i.mounteds.forEach((function(e,t){e.call(H)}))),A=t.extend(!0,{},l),b=!1,w=!0,C=[],xe.call(H,"mounted"),R=!1),i.uid&&e.history.setUI&&e.history.setUI({uid:i.uid,ui:H}),this}function B(t,n,a){t=t||p;try{var i=Object.keys(t),r=[];i.forEach((function(i,o){var c=a||("object"===_typeof(t[i])?t[i].handler:t[i]);r.push(i),n&&r.unshift(n);var s=r.join("."),u=t[i];if("object"===e.typeof(u)){var d=u.deep?Object.keys(l[i]):Object.keys(t[i]),f=e.unit.getKeyValue(i,l);d.forEach((function(t,n){var a=s+"."+t,i=f[t];"object"===e.typeof(i)&&B(i,a,c),z(a,c),r=[]})),u.immediate&&u.handler&&u.handler.call(H,l[i],A[i])}z(s,c),r=[]}))}catch(t){e.showLog(t)}}function z(t,n){var a=function(t){try{var a=[t.value,t.preValue||"",t];if("init"!==t.action){var i=n;switch(e.typeof(i)){case"function":i.apply(H,a);break;case"array":i.forEach((function(e,t){e.apply(H,a)}));break;case"string":new Function(i+"(".concat(t.value,",").concat(t.preValue||"",")"))();break;default:i.apply(H,a)}}}catch(t){e.showLog(t)}};return ye(t,a),we.bind(this,t,a)}function q(n){try{var a=null,r=null;void 0===n?(a=T,r=i):"string"==typeof n?(a=S(n),r=i):n&&"object"===_typeof(n)&&(a=S(n)||t(n),r=t.extend(!0,{},i,n));var o=!0;if(r.beforeCompiles.forEach((function(e,t){if(!1===(o=e.call(H,r)))return!1})),!1===o)return C=[],!1;if(te(a),X({el:a,action:"first"}),function(t){var n=t,a=n.find("[b-watch*=".concat(c,"]")),i=n.find("[b-one*=".concat(c,"]"));if(a.length)try{ne(a,"b-watch",ye)}catch(t){e.showLog(t)}if(i.length)try{ne(i,"b-one",be)}catch(t){e.showLog(t)}}(a),r.needComponent)return loader.components({id:a,compiled:function(){Z(a),G(a),Q(a),!0,K(),C=[],r.compileds.forEach((function(e,t){e.call(H,r)}))}}),this;Z(a),G(a),Q(a),!0,K(),C=[],r.compileds.forEach((function(e,t){e.call(H,r)}))}catch(t){e.showLog(t)}return this}function K(){return T.find("[ref]").each((function(){var t=this.getAttribute("ref"),n=I.hasOwnProperty(t),a=null;n&&"htmldivelement"===e.typeof(I[t])?((a=[I[t]]).push(this),I[t]=a):n&&"array"===e.typeof(I[t])?I[t].push(this):I[t]=this})),this}function W(n){try{var a=this,i="string"==typeof n?n:"",r=new RegExp("{{[\\s]?"+c+u+"(.*?)}}","mg");return i=i.replace(r,(function(n,i){var r=i.split(c+u);""===t.trim(r[0])&&r.shift();var o=r.length>0&&e.unit.getKeyValue(r.join("."),A)||"";return"function"==typeof o?o.call(a):o}))}catch(t){e.showLog(t)}}function J(t,n){var a;return U&&U.hasOwnProperty(t)?a=U[t]:(void 0===(a=e.unit.getKeyValue(t,n))&&_&&console.warn("请检查 ".concat(t," 在bui.store scope:").concat(c," 中有没有声明定义")),U[t]=a),a}function X(n){var a=1==n.replace;try{var i="object"===e.typeof(n)?n.el:n,r=[],o=(i.prop("outerHTML")||i.html()||"").match(F)||[],l=e.array.uniq(o);l.length&&l.forEach((function(o,l){var s=i.find("[".concat(o,"*=").concat(c,"]"));s.length<1&&(s=i.closest("[".concat(o,"*=").concat(c,"]"))),s.length&&s.each((function(l,s){var d=this,f="",p=ue.call(this,"".concat(o)),h=p[0]&&p[0].keyname||"",m=h.indexOf(".length"),v=m>-1?h.substr(0,m):h,y=p[0]&&p[0].param;J(v,H);var x=ue.call(this,"b-linked");if(x.length&&x.forEach((function(t,n){ye(t.keyname,(function(t){xe(h,{target:null,value:e.unit.getKeyValue(h,H),action:"set",keyname:h,param:y,origin:A})}))})),"b-show"===o)switch(p[0]&&p[0].rule){case"!":f="b-hide";break;default:f="b-show"}else f=o;if(g){var k=e.array.compare($[f],v);!k&&$[f].push(v),!k&&ye(v,D[f].bind(d))}else{var O=function(a){try{if(I.indexOf("$index")>-1){var r=v.match(/([0-9]+)/g),l=r[r.length-1],c=i.find("[".concat(o,'="').concat(L,'"]')),s=c.attr("b-target");c.each((function(e,n){s=t(n).attr("b-target")}));var u=s?i.find(s).eq(l):null,p=arguments;return void(s&&u&&u.length?(u.find("[".concat(o,'="').concat(L,'"]')).each((function(e,t){var n=t||d;D[f].apply(n,p)})),u.closest("[".concat(o,'="').concat(L,'"]')).each((function(e,t){var n=t||d;D[f].apply(n,p)}))):(c.each((function(e,t){var a=t||d;e!=l||"first"!==n.action?"first"!==n.action&&D[f].apply(a,p):D[f].apply(a,p)})),i.closest("[".concat(o,'="').concat(L,'"]')).each((function(e,t){var n=t||d;D[f].apply(n,p)}))))}D[f].apply(d,arguments)}catch(t){e.showLog(t)}};!R&&0===l&&we(v,O),a&&we(v,O);var L=this.getAttribute(o)||"",I=L.replace(c+u,"");ye(v,O.bind(d))}e.array.compare(r,v)||r.push(v),C=[],b=!1,w=!0}))})),Y(r,n)}catch(t){e.showLog(t)}}function Y(t,n){t.forEach((function(t,a){var i=e.unit.getKeyValue(t,H);xe(t,{target:null,action:"object"===e.typeof(n)&&n.action||"init",value:i,param:null,keyname:t,origin:A}),C=[]}))}function Z(n){var a=n,r='[type="text"][b-model*='.concat(c,'],\n                                [type="search"][b-model*=').concat(c,'],\n                                [type="password"][b-model*=').concat(c,'],\n                                [type="url"][b-model*=').concat(c,'],\n                                [type="number"][b-model*=').concat(c,'],\n                                [type="email"][b-model*=').concat(c,'],\n                                [type="range"][b-model*=').concat(c,'],\n                                [type="tel"][b-model*=').concat(c,"],\n                                textarea[b-model*=").concat(c,"]");if("input"===i.modelEvent){var o=!1;a.off("input compositionstart compositionend",r).on(m,r,(function(e){o||l.call(e.target,e)})).on("compositionstart",r,(function(e){o=!0,e.stopPropagation()})).on("compositionend",r,(function(e){o=!1,l.call(e.target,e),e.stopPropagation()}))}else a.off(m,r).on(m,r,l);function l(t){var n=t.target.value,a=ue.call(this,"b-model"),i=a[0]&&a[0].keyname||"";if(""===i)return e.showLog("b-model的值不能为空"),!1;ge(i,n),C=[],t.stopPropagation()}var s='[type="checkbox"][b-model*='.concat(c,'],\n                                [type="radio"][b-model*=').concat(c,"]");a.off("change",s).on("change",s,(function(t){try{var n,i=this,r=this.getAttribute("value")||this.checked,o=this.getAttribute("type"),l=ue.call(this,"b-model")[0].keyname,s=this.getAttribute("check-value"),u=this.getAttribute("uncheck-value"),d=this.getAttribute("check"),f=this.getAttribute("uncheck");(d||f||s||u)&&(r=this.checked?s||this.value||d:u||f||""),n=J(l,H);var p=/\{.+\}$/g.test(r)?null:a.find('[type="checkbox"][b-model="'.concat(c+"."+l,'"][value="').concat(r,'"],\n                [type="radio"][b-model="').concat(c+"."+l,'"][value="').concat(r,'"]'));switch(o){case"checkbox":this.checked&&(n&&"array"===e.typeof(n)?!e.array.compare(n,r)&&e.unit.getKeyValue(l,H).push(r):ge(l,r),this.checked=!0),this.checked||(n&&"array"===e.typeof(n)?e.array.remove(e.unit.getKeyValue(l,H),r):ge(l,r),this.checked=!1),p&&p.each((function(e,t){this.checked=i.checked}));break;case"radio":default:ge(l,r)}C=[],t.stopPropagation()}catch(t){e.showLog(t)}}));var u="select[b-model*=".concat(c,"]");a.off("change",u).on("change",u,(function(n){try{var a=t(this).val(),i=(this.selectedIndex,this.multiple),r=ue.call(this,"b-model")[0].keyname,o=null;switch(o=J(r,H),i){case!0:"array"!==e.typeof(o)&&e.showLog("".concat(r,"的类型必须为数组")),a.splice(0,0,0,a.length+1),o.splice.apply(o,a);break;default:ge(r,a)}C=[],n.stopPropagation()}catch(n){e.showLog(n)}}))}function Q(e){e.off("change","[b-checked*=".concat(c,"]")).on("change","[b-checked*=".concat(c,"]"),(function(e){var t=this.checked;ge(ue.call(this,"b-checked")[0].keyname,t),C=[],e.stopPropagation()}))}function G(e){var t=e;["b-click","b-mousedown","b-mouseover","b-mouseup","b-touchstart","b-touchmove","b-touchend","b-submit","b-change","b-scroll","b-keydown","b-keyup","b-keypress","b-focus","b-blur"].forEach((function(e,n){var a=e.substr(2);t.off(a,"[".concat(e,"*=").concat(c,"]")).on(a,"[".concat(e,"*=").concat(c,"]"),(function(t){var n=ee.call(this,t,e);if(!1===n)return!1;void 0===n&&t.stopPropagation()}))}))}function ee(t,n){var a=ue.call(this,n),i=a[0].keyname,r=a[0].param,o=null;r.push(t);try{var l="function"==typeof(o=J(i,H))&&o.apply(H,r);return C=[],xe(i,{target:this,value:o,action:"set",keyname:i,param:r,origin:A}),l}catch(t){e.showLog(t)}}function te(t){var n=t.find("[b-template*=".concat(c,"]")),a=[];if(k={},n.length)try{n.each((function(t,n){var i=S(this),r=ue.call(this,"b-template"),o=r[0].keyname,l=r[0].param,s=c+u;l[0]||console.error('b-template 没有找到数据源, 格式为: b-template="page.template(page.sources)"');var d="string"==typeof l[0]&&l[0].replace(new RegExp(s),"")||"",p=i.attr("b-command")||"html",h=i.attr("b-children")||i.children()[0]&&i.children()[0].tagName;J(d,H);g&&we(d),k.hasOwnProperty(d)?k[d].push(d):k[d]=[d],ye(d,(function(t){try{var n,a=t.param;switch(t.action){case"push":case"unshift":n=a;break;case"splice":n=a.slice(2)||"";break;default:n=t.value}if(f&&f.hasOwnProperty(o)){(l=l.map((function(e,t){return"string"==typeof e&&0==e.indexOf(c+u)&&t>0?J(e.replace(new RegExp(s),""),A):e})))[0]=n;var r=void 0!==n&&"undefined"!==n&&f[o]&&f[o].apply(H,l);void 0===r&&(r="",e.showLog("".concat(o,"模板方法需要返回内容，例如：return html;"))),g&&(i=S('[b-template*="'.concat(s+d,'"]')));var m=t.preValue||[];0==m.length&&"html"==p&&i.empty();var v=h?i.children(h):i.children(),y=v,b=a&&a.length||0;switch(R=!0,t.action){case"push":if(i.append(r),v=i.children(h),b&&b==v.length)X({el:v,action:"push"});else if(b>1)for(var w=y.length,x=w;x<v.length;x++)X({el:v.eq(w+x-1),action:"push"});else X({el:v.last(),action:"push"});break;case"unshift":if(i.prepend(r),v=i.children(h),b&&b==v.length)X({el:v,action:"unshift"});else if(b>1)for(x=0;x<b;x++)X({el:v.eq(x),action:"unshift"});else X({el:v.first(),action:"unshift"});break;case"pop":v.last().remove(),X({el:(v=i.children(h)).last(),action:"pop"});break;case"shift":v.first().remove(),X({el:(v=i.children(h)).first(),action:"shift"});break;case"length":break;case"splice":var k=parseInt(a[0]),O=parseInt(a[1]);O>=m.length&&(i.empty(),v=i.children(h));var L=v.length,I=L>0,P=!1;if(0==O)if(I&&L-1>=k){v.eq(k).before(r),v=i.children(h);for(x=0;x<n.length;x++)X({el:v.eq(k+x),action:"splice"})}else{i.append(r),v=i.children(h);for(x=0;x<n.length;x++)X({el:v.eq(L+x),action:"splice"})}else if(O>0){var j=e.unit.getKeyValue(t.keyname,t.origin);if(a[1]-a[0]>=(j&&j.length)&&(P=!0),void 0!==a[2])if(I&&L-1>=k){v.eq(k).before(r),v=i.children(h);for(x=0;x<n.length;x++)X({el:v.eq(k+x),action:"splice",replace:P})}else{i.append(r),v=i.children(h);for(x=0;x<n.length;x++)X({el:v.eq(L+x),action:"splice",replace:P})}var T=0;switch(p){case"append":T=v.length-t.preValue.length||0;break;case"prepend":case"html":default:T=0}for(x=0;x<O;x++)v.eq(k+n.length+x+T).remove();r&&!t.value.length&&i.html(r)}break;case"reverse":case"sort":i.html(r),X({el:i,action:t.action});break;default:i[p](r)}!function(t){("string"==typeof t?e.$(t).find("component"):t.find("component")).each((function(e,t){loader.component({id:t})}))}(i),i.find("[b-template*=".concat(c,"]")).length?te(i):xe.call(H,"nexttick",t)}else e.showLog("找不到对应的模板,请检查下 scope:".concat(c," 的templates是否存在").concat(o),"bui.store")}catch(t){e.showLog(t)}})),e.array.compare(a,d)||a.push(d),C=[]})),Y(a)}catch(t){e.showLog(t)}}function ne(e,t,n){e.each((function(e,a){S(this);var i=ue.call(this,t);i[0].keyname;var r=i[0].param,o=c+u;r[0]||console.error("".concat(t," 没有找到数据源, 格式为: ").concat(t,'="page.doit(page.sources)"')),J("string"==typeof r[0]&&r[0].replace(new RegExp(o),"")||"",H);var l=this;function s(e){var n=ue.call(l,t),a=n[0].keyname,i=n[0].param;i.push(e),V[a].apply(H,i)}i[0].paramKeyname.forEach((function(e,t){n(e,s)}))}))}function ae(e){return 0==this.getAttribute(e).indexOf("!")}function ie(e,n){var a=c+u+e.keyname;return g?t("[".concat(n,'="').concat(a,'"]')):S(this)}function re(e,t){return t.indexOf(".length")>-1?e.value.length||0:e.value instanceof Array?e.value.join(","):e.value}function oe(t){var n=this.getAttribute("type"),a=this.value,i=this,r=this.getAttribute("b-value");switch(n){case"radio":a==t.value?this.checked=!0:this.checked=!1;break;case"checkbox":"array"===e.typeof(t.value)&&t.value.forEach((function(e,t){a==e&&(i.checked=!0)}));break;default:this.value=re(t,r)}}function le(e){var n=this.getAttribute("type"),a=this.value;e.param;var i=this;if("SELECT"===this.nodeName&&this.multiple)e.value.length>1?e.value.forEach((function(e,n){"string"==typeof e?t(i).find("option[value=".concat(e,"]")).attr("selected",!0):t(i).find("option[value=".concat(e.value,"]")).attr("selected",!0)})):this.value=e.value[0];else{switch(n){case"radio":a==e.value?this.checked=!0:this.checked=!1;break;case"checkbox":if(a&&e.value instanceof Array)switch(e.action){case"push":case"unshift":e.param&&e.param.filter((function(e,t){a!==e||(i.checked=!0)}));break;case"pop":case"shift":e.param&&e.param.filter((function(e,t){a===e&&(i.checked=!1)}));break;case"splice":var r=e.param,o=r&&r[1]&&parseInt(r[1]),l=r&&r.slice(2);0==o?l.forEach((function(e,t){a===e&&(i.checked=!0)})):o>0&&(e.preValue.forEach((function(t,n){n<=e.param[1]&&(i.checked=!1)})),e.value.forEach((function(e,t){a===e&&(i.checked=!0)})));break;case"length":break;default:e.value.filter((function(e,t){a==e&&(i.checked=!0)}))}else e.value===a||1==e.value?this.checked=!0:this.checked=!1;break;default:if(event&&event.target&&"INPUT"===event.target.nodeName)break;this.value=e.value}C=[]}}function ce(e,t,n){switch(t){case"disabled":n?e.attr(t,n):e.removeAttr(t);break;case"checked":e.prop(t,n);break;default:var a="object"===_typeof(n)?JSON.stringify(n):n;e.attr(t,a)}C=[]}function se(e,t,n,a){"boolean"==typeof n?(n&&e.addClass(t),!n&&e.removeClass(t)):"string"==typeof n?(g&&e.removeClass(n),a&&e.removeClass(a),n&&!e.hasClass(n)&&e.addClass(n),void 0!==a&&""===n&&e.removeClass(a)):(Boolean(n)&&e.addClass(t),!Boolean(n)&&e.removeClass(t))}function ue(t){var n=[],a=this,r=this.getAttribute(t)||"",o=r.indexOf(i.paramSplit)>-1?r.split(i.paramSplit):r&&[r]||[];try{o.forEach((function(e,i){var r={},o=de.call(a,e,t);r.scope=c,r.rule=o.rule,r.keyname=o.name,r.param=o.param,r.paramKeyname=o.paramKeyname,r.eventType=o.eventType,r.eventProperty=o.eventProperty,n.push(r)}))}catch(t){e.showLog("参数处理出错")}return n}function de(n,a){try{var i=n?n.match(/([^\(|\)]+)/g):[],r=[],o="",l="",s=null,d=[],f=null,p=this,h="",g=(I=t(p).attr("b-target"))&&t(p).parents(I)[0]||p,m=null,v="",y="";if(h=(h=(s=i[0]&&i[0].indexOf(c+u)>-1?i[0].split(c+u):[c,i[0]])[0].split(c))[0]||h[1]||"",o=c,(l=s[1]||"").indexOf("$index")>-1){var b=t(g).index();l=l.replace("$index",b)}else if(l.indexOf("$id")>-1){var w=g.id;l=l.replace("$id",w)}else if(l.indexOf("$parentIndex")>-1){var x=t(g).parent().index();l=l.replace("$parentIndex",x)}var k=null,O="";if(n.indexOf("$item")>-1||n.indexOf("$itemIndex")>-1||n.indexOf("$itemId")>-1){O=(k=t(p).closest("[b-template]"))?k.attr("b-children")||k.children()[0].nodeName:"";var L=(m=t(p).closest(O)).index();l=l.replace("$itemIndex",L)}if(void 0!==i[1]){var I,P=(I=t(g).attr("b-target"))&&t(g).closest(I)[0]||g,j=i[1].replace(/\$index/g,t(P).index())||"";try{var S=/\{.+\}$/g,T=/\[.+\]$/g,E=j?j.match(/(\'(.*?)\'.*?)|(\"(.*?)\".*?)|(\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14})|(^((https|http|ftp|rtsp|mms)?:\/\/)[^\,]+)|([a-zA-Z0-9][-a-zA-Z0-9\._]{0,62})|(\{.+\})|(\[.+])|([$\w\.]+)|([\d\.]+)|([\u4e00-\u9fa5|\w|\d]+)/g):[];i[1].split(",").forEach((function(e,n){e.indexOf(c+u)>-1&&r.push(e.replace(c+u,"").replace(/\$index/g,t(P).index()))})),d=E.map((function(n,i){var r=n.replace(/^\"|^\'|\"$|\'$/g,"");switch(n){case"$this":r=P;break;case"$index":r=t(P).index();break;case"$itemIndex":r=m.index();break;case"$itemId":r=m.attr("id");break;case"$itemText":r=m.text();break;case"$itemHtml":r=m.html();break;case"$item":r=m[0];break;case"$parentIndex":r=t(P).parent().index();break;case"$parent":r=P.parentNode;break;case"$children":r=t(P).children();break;case"$id":r=P.id;break;case"$text":r=P.textContent;break;case"$value":r=P.value;break;case"$html":r=P.innerHTML}if("b-template"!==a){var o=c+u;e.unit.startWithStr(r,o)&&(r=e.unit.getKeyValue(r.split(o)[1],H)||r)}return r=/^\d+$/.test(r)&&r.length<17?parseFloat(r):r,S.test(n)||T.test(n)?JSON.parse(n):r}))}catch(t){e.showLog(t,"getArguments"),d=[]}}void 0!==i[2]&&(v=(f=i[2].indexOf(".")>-1?i[2].split("."):[i[2]])[0],y=f[1]||"")}catch(t){e.showLog("参数格式错误:"+n)}return{scope:o,rule:h,name:l,param:d,paramKeyname:r,eventType:v,eventProperty:y}}function fe(n,a){if(!n||!n.hasOwnProperty("widget")||"function"!=typeof n.widget)return function(n,a){if(a&&"array"===e.typeof(a)){if(a.length>1){var o=a.pop();s(e.unit.getKeyValue(a.join("."),n),o)}else s(n,a[0]);return}function s(n,a){var o=n[a];if(function(n,a){var o=n[a],s="function"==typeof o?o.call(H):o,u=[];Object.defineProperty(n,a,{enumerable:!0,configurable:!0,get:function(){return _&&console.log("3. data getting ".concat(a,":"),s),P.target=this,(b||!b&&w)&&C.push(a),j.target&&u.push(j.target),s},set:function(n){if(n===s)return C=[],L=!1,r=!1,b=!1,w=!0,!0;P.target===this&&(C=[]),P.target=this,(!w||!b&&w)&&C.push(a);var o=C.join(".");!L&&xe.call(H,"beforeupdate",{action:"set",value:n,preValue:s,keyname:o,origin:A}),!L&&i.beforeUpdates.forEach((function(e,t){e.call(H,{action:"set",value:n,preValue:s,keyname:o,origin:A})})),_&&console.log("4. data setting ".concat(o),n);var d=e.unit.getKeyValue(o,A);s=n,u.forEach((function(e){return e()})),!L&&xe(o,{action:"set",value:s,preValue:d,keyname:o,origin:A}),e.unit.setKeyValue(o,s,A),s instanceof Array?fe(l,C):"object"===e.typeof(s)&&(i.deep&&fe(n),s&&Object.keys(s).forEach((function(e,t){var n=a+"."+e;C=[],xe(n,{target:null,value:s[e],preValue:d&&d[e],action:"set",keyname:n,origin:A})}))),!L&&xe.call(H,"updated",{action:"set",value:s,preValue:d,keyname:o,origin:A}),!L&&i.updateds.forEach((function(e,t){e.call(H,{action:"set",value:s,preValue:d,keyname:o,origin:A})}));var f=T.find('[b-template*="'.concat(c,".").concat(o,'"]'));return f.length&&!r&&f.each((function(e,n){X({el:t(n),action:"set"})})),C=[],L=!1,r=!1,b=!1,w=!0,!0}})}(n,a),o instanceof Array&&function(t,n){var a=[],r=Array.prototype,o=Object.create(r);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(t){var s=r[t];Object.defineProperty(o,t,{enumerable:!0,configurable:!0,value:function(r){var o=Array.prototype.slice.call(arguments);xe.call(H,"beforeupdate",{target:null,action:t,param:o,value:this,prevValue:[],keyname:n,origin:A}),a.push(n),l.hasOwnProperty(n)||a.unshift(C.join("."));var u=a.join("."),d=this.slice(0),f=s.apply(this,o);switch(_&&console.log("5. ".concat(u," action ").concat(t,", param:").concat(o," ")),t){case"pop":case"shift":o=[f]}e.unit.setKeyValue(u,this,A);var p=T.find('[b-template*="'.concat(c,".").concat(u,'"]'));return xe(u,{target:p,action:t,param:o,value:this,preValue:d,keyname:u,origin:A}),x[a[0]]&&"array"===e.typeof(x[a[0]])&&x[a[0]].forEach((function(e){return e()})),a=[],C=[],b=!1,w=!0,xe.call(H,"updated",{target:p,action:t,param:o,value:this,preValue:d,keyname:n,origin:A}),i.updateds.forEach((function(e,a){e.call(H,{target:p,action:t,param:o,value:this,preValue:d,keyname:n,origin:A})})),f}})})),o.$index=function(t,n){return e.array.index(this,t,n)},o.$include=function(t,n){return e.array.compare(this,t,n)},o.$filter=function(t,n){return e.array.filter(this,t,n)},o.$empty=function(){return e.array.empty(this)},o.$replace=function(t){return e.array.replace(this,t)},o.$merge=function(){var t;return(t=e.array).merge.apply(t,[this].concat(Array.prototype.slice.call(arguments)))},o.$get=function(t,n){return e.array.get(this,t,n)},o.$set=function(t,n,a){return e.array.set(this,t,n,a)},o.$delete=function(t,n){return e.array.delete(this,t,n)},o.$deleteIndex=function(t){return e.array.deleteIndex(this,t)},t.__proto__=o}(o,a),o&&"object"===e.typeof(o))return fe(o)}n&&Object.keys(n).forEach((function(e){s(n,e)}))}(n,a)}var pe=[];function he(t,n){var a=e.array.index(pe,n,"field");return!!(a>-1&&pe[a]&&t.$options.el===pe[a].el)&&(pe[a].disconnect&&pe[a].disconnect(),!0)}function ge(n,a){var r="string"==typeof n,o=a;C=[];var c,s,d=e.unit.getKeyValue(n,A);r&&void 0!==a?(_&&console.log("set ".concat(n," ")),L=!0,xe.call(H,"beforeupdate",(_defineProperty(c={action:"set",target:null,value:o,preValue:d},"action","set"),_defineProperty(c,"keyname",n),_defineProperty(c,"origin",A),c)),i.beforeUpdates.forEach((function(e,t){var a;e.call(H,(_defineProperty(a={action:"set",target:null,value:o,preValue:d},"action","set"),_defineProperty(a,"keyname",n),_defineProperty(a,"origin",A),a))})),a&&"object"===e.typeof(a)?(o=t.extend(!0,{},d,a),Object.keys(a).forEach((function(e,t){var i=n+"."+e;xe.call(H,i,{target:null,value:a[e],preValue:d,action:"set",keyname:i,origin:A})}))):o=a,e.unit.setKeyValue(n,o,l),e.unit.setKeyValue(n,o,A),xe.call(H,n,{target:null,value:o,preValue:d,action:"set",keyname:n,origin:A}),xe.call(H,"updated",(_defineProperty(s={action:"set",target:null,value:o,preValue:d},"action","set"),_defineProperty(s,"keyname",n),_defineProperty(s,"origin",A),s)),i.updateds.forEach((function(e,t){var a;e.call(H,(_defineProperty(a={action:"set",target:null,value:o,preValue:d},"action","set"),_defineProperty(a,"keyname",n),_defineProperty(a,"origin",A),a))})),"object"===_typeof(a)&&(a instanceof Array?fe(l,n.split(u)):fe(a)),C=[]):n&&"object"===e.typeof(n)&&(A=t.extend(!0,{},A,n),ve(n));return A}function me(t,n){return function(t,n){"string"==typeof t&&(e.unit.delKey(t,A),n&&n.call(H,t))}(t,(function(e){xe(t)})),A}function ve(t,n){for(var a in t){var i=void 0===n?a:n+a,r=t[a];xe(i,{target:null,value:r,preValue:A[a]||"undefined",action:"set",param:null,keyname:i,origin:A}),r&&"object"===e.typeof(r)&&ve(r,a+".")}}function ye(t,n){var a="";return a=t&&"array"===e.typeof(t)?t.map((function(e,t){return y+"_"+c+u+e})):y+"_"+c+u+t,P.on.call(H,a,n),this}function be(e,t){return O.hasOwnProperty(e)||(ye(e,t),O[e]=t),this}function we(e,t){if(e){var n=y+"_"+c+u+e;P.off.call(H,n,t)}else H.handle={};return this}function xe(e){var t=y+"_"+c+u+e;arguments[0]=t;var n=arguments[1]&&arguments[1].value||arguments[1];return _&&console.warn(t,n,"trigger"),P.trigger.apply(H,arguments),b=!1,w=!0,this}return H}}(window.bui||{},window.libs),function(e,t){e.viewport=function(n,a){e.trigger.call(e,"viewportbefore");var i,r=t.extend(!0,{uid:"",width:"device-width",initScale:1,maxScale:1,minScale:1,fit:"cover",scalable:"no",zoom:!0,base:750,size:0,create:!1},e.config.viewport),o="object"==_typeof(n)?t.extend(!0,r,n):r,l=document.querySelector("meta[name=viewport]"),c="width=".concat(o.width,", initial-scale=").concat(o.initScale,", maximum-scale=").concat(o.maxScale,", minimum-scale=").concat(o.minScale,", user-scalable=").concat(o.scalable,",viewport-fit=").concat(o.fit),s=window.devicePixelRatio,u=document.documentElement.clientWidth,d=document.documentElement.clientHeight,f=parseInt(u)*parseInt(s),p=parseInt(d)*parseInt(s);if(u=u>d?d+24:u,o.size="number"==typeof n?n:o.size||(u/o.base*100).toFixed(2),l)o.create&&(l.content=c);else{var h=document.createElement("meta");h.name="viewport",h.content=c,document.head.appendChild(h),h=null}var g=e.array.index([240,320,360,375,384,393,412,414,435,480,512,540,768,1024,1080,1536,2048,2732,534,854,750],document.documentElement.clientWidth);g>-1&&void 0===n?i=[32,42.67,48,50,51.2,52.4,54.93,55.2,58,64,68.27,60,60,60,60,60,60,60,60,60,60][g]:v(o);var m={width:function(e){return u||t("body").width()||t("#bui-router").width()||t(".bui-page").width()},height:function(e){return d||t("body").height()||t("#bui-router").height()||t(".bui-page").height()},fontSize:i,screenWidth:function(e){return f},screenHeight:function(e){return p},ratio:function(e){return s},init:v};function v(t){var n=document.head.parentNode,a=t.size;return i=a||48,o.zoom&&(n.style.fontSize=i+"px"),o.uid&&e.history.setUI&&e.history.setUI({uid:o.uid,ui:m}),e.trigger.call(e,"viewportinit"),this}return m}}(window.bui||{},window.libs),function(e,t){e.loader=function(n){var i,r=t.extend({},{cache:!0,log:!1,baseUrl:"",relativePath:"pages",needNative:!1,deepView:!1,viewTag:"view",componentTag:"component",deepComponent:!0,scriptSuffix:".js"},e.config.loader,n),o=e.emitter(),l=[],c=[],s={},u={baseUrl:"",modules:{},globals:{}},d={},f={init:function(e){return e=e||{},r=t.extend({},r,e),f.config=r,this},config:r,define:function(n,a,i){var o={moduleName:"",template:"",script:"",path:"",props:null,isComponent:!1,params:null,data:null,depend:[],beforeCreate:null,created:null,beforeLoad:null,loaded:null,hide:null,exports:null,show:null,beforeDestroy:null,destroyed:null},l={},c="";try{var s=v().name?v():function(e){var t=window.location.pathname,n=t.indexOf(".html"),a="",i="";i=n>-1?(a=t.substr(1,n))+".js":(a=t.substr(1))+".js";return{name:a,src:i}}(),f=s.name}catch(e){}var h=[];if(void 0===n)return e.showLog("define第1个参数不能为空"),this;"function"==typeof n?(i=n,c=f,a=[]):"object"===e.typeof(n)?(c=f,a=n.depend||[],i=n.loaded,l=t.extend(!0,{},o,n)):"array"===e.typeof(n)?(i=a,a=n,c=f):"function"==typeof a?(c=n,i=a,a=[]):(c=n,a=a,i=i);var g=d.hasOwnProperty(c)&&d[c].script||s.src,b=window.location.href.substr(0,window.location.href.indexOf("#")).replace("index.html","");g=g.replace(b,""),r.log&&console.log("define "+c),a.length&&(h=m(a,g));if("string"==typeof c&&"function"==typeof i){(l=n&&"object"===e.typeof(n)?t.extend(!0,{},o,d[c],e.config.loader.define,n):t.extend(!0,{},o,d[c],e.config.loader.define)).moduleName=c,l.depend=h,l.style=[],l.script=g,l.path=g.substr(0,g.lastIndexOf("/")+1),l.loaded=function(){var e=[y,d[f]&&d[f].exports,d[f],u.globals],t=[];h.length&&h.forEach((function(e,n){d[e]&&t.push(d[e].exports)}));var n=t.concat(e);return i&&i.apply(this,n)},l.isDefined=!0,p(l)}else e.showLog("define "+c+"模块的参数格式不对");return l},global:function(e){if("object"===_typeof(e))p({globals:e});else{if("function"!=typeof e)return p().globals;p({globals:e.call(f,u.globals)})}return f},require:y,destroy:function(n){r.log&&console.log("destroy "+n);var a="string"==typeof n?d[n]:null;if(a){a.beforeDestroy&&a.beforeDestroy.call(a);var i=t('script[name="'+n+'"]').attr("src");l=e.array.remove(l,i),t('script[name="'+n+'"]').remove(),delete u.modules[n],d=u.modules,a.destroyed&&a.destroyed.call(a)}},map:p,import:S,importCss:function(t,n){return new Promise((function(a,i){if("string"==typeof t){var o=e.hasRouter?t:e.unit.relativePath(t,r.relativePath),l=document.createElement("link")||{};l.href=o+(r.cache?"":"?t="+(new Date).getTime()),l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),n&&l.setAttribute("id",n),document.head&&document.head.appendChild(l),l=null,a(t,n)}else e.showLog(t+"的格式不正确")}))},importSync:T,importHtml:E,load:w,checkLoad:function(t){var n=!0,a=[];if(d=u.modules,"string"==typeof t){t.indexOf(",")>-1?a=t.split(","):a.push(t)}else t&&"array"===e.typeof(t)&&(a=t||[]);if(a.length)a.forEach((function(e,t){d.hasOwnProperty(e)||(n=!1),d[e]&&!1===d[e].isLoaded&&(n=!1)}));else for(var i in d)d[i]&&!1===d[i].isLoaded&&(n=!1);return n},components:O,component:k,delay:function(n){for(var a=t.extend(!0,{id:"",deepView:r.deepView,deepComponent:r.deepComponent,delay:!1,everytime:!1,param:null,beforeLoad:null,loaded:null,compiled:null},n),i=e.$(a.id),o=0;o<i.length;o++){var l=i[o],c=l&&l.getAttribute("delay"),s=l&&l.tagName.toLowerCase();("true"===c||a.everytime)&&("true"===c&&s===r.componentTag||a.everytime?(a.isSelf=!0,a.id=l,a.everytime?l.removeAttribute("delay"):l.setAttribute("delay","false"),k(a)):"true"===c&&s===r.viewTag||a.everytime?(a.isSelf=!0,a.id=l,l.removeAttribute("delay"),j(a)):(a.isSelf=!1,s=t(l).find('[delay="true"]')[0]&&t(l).find('[delay="true"]')[0].tagName.toLowerCase(),t(l).find('[delay="true"]').removeAttr("delay"),s===r.componentTag&&k(a),s===r.viewTag&&j(a)))}return this},views:P,view:j,get:function(e){if("string"==typeof e)return u.modules[e]||null},set:h,one:function(e,t){return o.one.apply(f,arguments),this},wait:function(e,t){return o.wait.apply(f,arguments),this},waited:function(e,t){return o.waited.apply(f,arguments),this},on:function(t,n){var a=e.history.getLast("id"),i=arguments,r=e.unit.stringToArray(t);return r.forEach((function(e,t){i[0]=a+"-"+e,o.on.apply(f,i)})),this},off:function(t,n){var a=e.history.getLast("id"),i=arguments,r=e.unit.stringToArray(t);return r.forEach((function(e,t){i[0]=a+"-"+e,o.off.apply(f,i)})),this},trigger:A};function p(n){if(void 0===n)return u;if("object"===_typeof(n)&&(n.hasOwnProperty("modules")||n.hasOwnProperty("baseUrl")||n.hasOwnProperty("globals")))u=t.extend(!0,{},u,n),d=u.modules;else if("object"===_typeof(n)&&n.hasOwnProperty("moduleName")){var a=function(n){var a={id:"",moduleName:"",template:"",data:null,props:null,isComponent:!1,params:null,depend:[],script:"",style:[],isDefined:!1,isLoaded:!1,beforeCreate:null,created:null,beforeLoad:null,loaded:null,show:null,hide:null,beforeDestroy:null,destroyed:null,path:"",exports:{},dependExports:[]},i={};d.hasOwnProperty(n.moduleName)&&(i=t.extend(!0,{},d[n.moduleName]));var r=t.extend(!0,{},a,i,n);n.props&&(r.props=n.props);return r.params=e.history.getParams("url"),r}(n);d[n.moduleName]=a||{},u=t.extend(!0,u,{modules:d}),d=u.modules}return u}function h(t,n){if(n&&"object"===e.typeof(n)){if(n.moduleName=t,n.hasOwnProperty("loaded")&&"function"==typeof n.loaded){var a=n.loaded;n.loaded=function(){d=u.modules;var e=n.moduleName,t=d[e].depend,i=[y,d[e]&&d[e].exports,d[e],u.globals],r=[];t.length&&t.forEach((function(e,t){d[e]&&r.push(d[e].exports)}));var o=r.concat(i);return a&&a.apply(this,o)},n.script=n.moduleName+".js",n.path=n.script.substr(0,n.script.lastIndexOf("/")+1)}n.depend&&n.depend.length&&(n.depend=m(n.depend,n.script)),p(n)}return this}function g(e,t){var n=e,a=t.lastIndexOf("/"),i=t.substr(0,a);return e.indexOf("../")>-1?(e=e.replace(/\..\//g,(function(e){var t=i.lastIndexOf("/");return i=i.substr(0,t),""})),n=i?i+"/"+e:e):e.indexOf("./")>-1&&(n=i+"/"+e.replace(/\.\//g,"")),n}function m(e,t){for(var n=[],a=0;a<e.length;a++){var i=e[a],r=i.indexOf("./")>-1?g(i,t):i;if(r.indexOf(".css")>-1)r.indexOf("css!")>-1?styles.push(r.substr(4)):styles.push(r);else{var o=r.indexOf(".js");o>-1&&(r=r.substr(0,o)),n.push(r),d.hasOwnProperty(r)||p({moduleName:r})}}return n}function v(){var e,n=window.location.href,o=[],l=document.currentScript;if(n.indexOf("#")>-1?o=n.split("#"):o.push(n),i=o[0].replace("/index.html","")+"/",l)return e=l.src.replace(i,""),{name:l.getAttribute("name")||e.substr("0",e.indexOf(r.scriptSuffix)),src:e};try{a()}catch(e){var c=(c=(e.stack||e.sourceURL||e.stacktrace||"").split(/[@ ]/g).pop().replace(/(:\d+)?:\d+$/i,"")).replace(new RegExp(i,"g"),"");return{name:(l=t('script[src="'+c+'"]')[0])?l.getAttribute("name"):c.replace(r.scriptSuffix,""),src:c}}}function y(t,n,a){if(r.log&&console.log("require "+t),a=1==a,"boolean"==typeof n&&(a=n,n=function(){}),t&&"string"==typeof t){if(t.indexOf(".css")>-1)return S(t,n);if(t.indexOf(".html")>-1)return S(t,n);t=[t]}if(n&&"function"!=typeof n&&"boolean"!=typeof n)return e.showLog("require第2个参数格式为函数或布尔值","bui.loader.require"),this;try{return function(t,n,a){var i=[];function o(t,n){t=t||[],d=u.modules;var a=e.array.uniq(t);a.length>1&&a.forEach((function(e,t){var n=d[e];(n&&1==n.isLoaded||n.loaded)&&a.splice(t,1)})),a.forEach((function(t,l){var c=d[t];if(d[t]&&d[t].style&&d[t]&&d[t].style.length&&C(d[t].style),e.array.compare(i,t)||i.unshift(t),c&&c.isLoaded){if(!1===(c&&c.beforeLoad&&c.beforeLoad.call(c,c.depend)))return!1;l==a.length-1&&(n&&n.apply(c),i=[])}else if(c&&c.loaded){if(s(t,l),!1===(d[t].beforeCreate&&d[t].beforeCreate.call(d[t])))return!1;d[t].created&&d[t].created.call(d[t])}else N(t,(function(){var e=d[t];if(!1===(e&&e.beforeCreate&&e.beforeCreate.call(d[t])))return!1;e&&e.style&&e.style.length&&C(e.style),e&&e.created&&e.created.call(d[t]),s(t,l)}),(function(){l==a.length-1&&(n&&n.apply(null),i=[])}));function s(e,t){var i=d[e];return i&&(i.isDefined=!0),i.id=c?c.id:"",i.props=c?c.props:{},!1!==(i&&i.beforeLoad&&i.beforeLoad.call(i,i.depend))&&(i&&i.depend&&i.depend.length?(r.log&&console.warn(i.moduleName+" depend:"),r.log&&console.log(i.depend),void o(i.depend,n)):void(t==a.length-1&&n&&n.apply(i)))}}))}return new Promise((function(l,c){o(t,(function(){if(function(e){var t=!0,n=e||[];if(d=u.modules,n.length)for(var a=0;a<n.length;a++){var i=n[a],o=d[i];if(o&&!1===o.isDefined)return t=!1,r.log&&console.warn("check defined false:"+o.moduleName),r.log&&console.warn("wait modules:"),r.log&&console.warn(n),t}else for(var l in d)if(d[l]&&!1===d[l].isDefined)return t=!1,r.log&&console.warn("check defined false:"+o.moduleName),t;return t}(i)){var o=[];t.forEach((function(i,r){h(i,{params:e.history.getParams("url")}),b(i,a),o.push(d[i]&&d[i].exports),r===t.length-1&&(n&&n.apply(f,o||[]),l.apply(f,o||[]))}))}}))}))}(t=t.map((function(t,n){return e.unit.resolvePath(t)})),n,a)}catch(t){e.showLog(t,"bui.loader.require")}return this}function b(t,n){d=u.modules;var a="string"==typeof t?d[t]||{}:t,i=a.depend||[],o=null,l=[];a.dependExports=[];try{if(i.length)for(var c=0;c<i.length;c++){var s=i[c],f=d[s];f.isLoaded?l[c]=f.exports:l[c]=b(f)||f.exports,f.exports=l[c],a.dependExports.push(l[c]),f.isLoaded=!0}o=a.isLoaded&&!a.isComponent||a.isLoaded&&!n?a.exports:a.loaded&&a.loaded.apply(a,l),a.exports=o||d[a.moduleName]&&d[a.moduleName].exports,a.isLoaded=!0,A(a.moduleName,a,a.exports),r.log&&console.log("execute "+a.moduleName)}catch(t){e.showLog(t,"bui.loader.execute")}return o}function w(n){var a=t.extend(!0,{id:"",cacheHtml:!1,cache:!1,url:"",script:"",param:null,template:null,beforeLoad:null,reload:!0,loaded:null},e.config.loader.load,n),i=t.Deferred();if(a.id){if(a.url){if(!1===("function"==typeof a.beforeLoad?a.beforeLoad.call(f):a.beforeLoad))return this;var r=function(e){var t=d,n={},a=e&&e.indexOf(".html");a>-1?(n.url=e,n.module=e.substr(0,a)):(n.url=t[e]&&t[e].template||e+".html",n.module=e);return n}(a.url);if(a.script){var o=a.script.indexOf(".js");r.module=a.script.substr(0,o)}var l="string"==typeof a.id&&(a.id.indexOf("#")>-1||a.id.indexOf(".")>-1)?a.id.substr(1):a.id;a.id=l,a.name=r.module,a.url=r.url,p({id:l,moduleName:r.module,props:a.param}),e.history.getLast().currentComponent=l,e.history.setComponent({id:a.id,name:a.name,url:a.url,param:a.param||null});var c=p().modules[a.name];if(c&&"function"==typeof c.template){var s=c.template.call(c)||"";return!a.cacheHtml&&e.obj(a.id).html(s),x(a),this}if(a.cacheHtml)return x(a),this;if("function"==typeof r.url){var u=r.url(a)||"";return!a.cacheHtml&&e.obj(a.id).html(u),x(a),this}return S(r.url,(function(t){!a.cacheHtml&&e.obj(a.id).html(t),x(a)}),(function(e){a.onFail&&a.onFail.call(this,r),i.reject.call(this,r)})),this}e.showLog("url不能为空")}else e.showLog("id不能为空")}function x(n){var a=p().modules[n.name];if(!1===(a.beforeLoad&&a.beforeLoad.call(a,a.depend)))return!1;if(h(n.name,{id:n.id,props:n.param||null,isComponent:!0,$:function(e){return t("#"+n.id).find(e)}}),a.isLoaded&&"function"==typeof a.loaded&&!n.cache){a.id=n.id,a.exports=a.loaded&&a.loaded.call(a,a.exports)||a.exports;var i={id:n.id,name:n.name,url:n.url,param:n.param||null,exports:a.exports||{}};return e.history.setComponent(i),window.store&&window.store.$mount&&window.store.$mount(n.id),n.loaded&&n.loaded.call(a,a.exports),A(n.id,i),f}e.checkLoad(n.name),y(n.name,(function(t){var i={id:n.id,name:n.name,url:n.url,param:n.param||null,exports:t||{}};e.history.setComponent(i),window.store&&window.store.$mount&&window.store.$mount(n.id),n.loaded&&n.loaded.call(a,t),A(n.id,i)}),n.reload)}function k(n){var a=t.extend(!0,{id:"",isSelf:!0,deepComponent:r.deepComponent,cache:!1,cacheHtml:!1,delay:!0,param:null,beforeLoad:null,loaded:null,compiled:null},e.config.loader.component,n),i=null;i=""===a.id?e.$(r.componentTag):a.isSelf?e.$(a.id):e.$(a.id).find(r.componentTag);for(var o=[],l=[],c=[],s=[],u=p().modules,d=0;d<i.length;d++){var f=i[d],h=e.guid();!f.id&&f.setAttribute("id",h);var g=e.unit.getAttributes(f),m=g.parentId=a&&a.id||e.history.getLast().id||"bui-page",v=e.$(m).parents("component"),y=a.isSelf?v[0]&&v[0].id:a.id;"array"===e.typeof(m)?y=a.isSelf?v&&v[0].id:m[0].id:"object"==_typeof(g.parentId)&&e.typeof(g.parentId).indexOf("element")>-1&&(y=a.isSelf?v[0]&&v[0].id:m.id);var b=y&&e.history.getComponent(y,"name");if(b)g.parentId=y,g.parentName=b;else{var x=e.history.getLast();g.parentId=x.id,g.parentName=x.name}var k=g.name||f.getAttribute("name"),O="true"===g.rendered||a.cacheHtml;if(k&&(!g.delay||!a.delay)){g=t.extend(!0,{},g,a.param);var I=u[k],P=f.innerHTML,j=I&&"string"==typeof I.template?I.template:k+".html",S=I&&I.script?I.script:k+".js";j=j||k+".html",I&&"function"==typeof I.template?o.push({id:f.id,el:f,name:k,cacheHtml:O,cache:a.cache,deepComponent:a.deepComponent,template:I.template||"",url:j,srcript:S,slot:P,param:g}):(c.push(j),s.push(S),l.push({id:f.id,el:f,name:k,cacheHtml:O,cache:a.cache,deepComponent:a.deepComponent,url:j,srcript:S,slot:P,param:g}))}}return o.length&&(o.forEach((function(e,t){w({id:e.id,url:e.url,param:e.param||null,template:e.template,cacheHtml:e.cacheHtml,cache:e.cache,beforeLoad:a.beforeLoad})})),a.data=o,L(a)),l.length?(T(e.array.merge(c,s),(function(e){!function t(n){var i=l[n];return n==l.length?(a.data=l,L(a),this):i?(i.template=e[n],void w({id:i.id,url:i.url,param:i.param||null,cacheHtml:i.cacheHtml,cache:i.cache,beforeLoad:a.beforeLoad,loaded:function(e){t(n+1)},onFail:function(){t(n+1)}})):this}(0)})),this):(a.compiled&&a.compiled(a.data),A("componentcompiled",a.data),!1)}function O(e){return k(t.extend(!0,{id:"",isSelf:!1,deepComponent:r.deepComponent,cache:!1,cacheHtml:!1,beforeLoad:null,loaded:null,compiled:null},e)),this}function L(t){for(var n=0;n<t.data.length;n++){var a=t.data[n];new RegExp("<".concat(r.viewTag,".+name="),"gi").test(a.template)&&P({id:a.id});var i=new RegExp("<".concat(r.componentTag,".+name="),"gi");new RegExp("<".concat(r.componentTag,'.+name="').concat(a.name,'"'),"gi").test(a.template)?e.showLog("请检查代码, <".concat(r.componentTag,' name="').concat(a.name,'"></').concat(r.componentTag,">的模板里面存在循环嵌套")):(t.deepComponent&&i.test(a.template)&&O({id:a.id}),t.loaded&&t.loaded(a),A("componentloaded",a))}t.compiled&&t.compiled(t.data),A("componentcompiled",t.data)}function I(n){for(var a=0;a<n.data.length;a++){var i=n.data[a];if(!i.cacheHtml){i.el.innerHTML=i.template;var o=new RegExp("<".concat(r.componentTag,".+name"),"gi");new RegExp("<".concat(r.componentTag,'.+name="').concat(i.name,'"'),"gi"),o.test(i.template)&&O({id:i.id});var l=new RegExp("<".concat(r.viewTag,'.+name="').concat(i.name,'"'),"gi"),c=new RegExp("<".concat(r.viewTag,'.+name="').concat(i.name,'"'),"gi");if(c.test(i.template)){e.showLog("请检查代码, <".concat(r.viewTag,' name="').concat(i.name,'"></').concat(r.viewTag,">的模板里面存在循环嵌套"));continue}n.deepView&&l.test(i.template)&&!c.test(i.template)&&P({id:t(i.el)})}n.loaded&&n.loaded(i),A("viewloaded",i)}n.compiled&&n.compiled(n.data),A("viewcompiled",n.data)}function P(e){return j(t.extend(!0,{id:"",isSelf:!1,deepView:r.deepView,loaded:null,compiled:null},e)),this}function j(n){var a=t.extend(!0,{id:"",isSelf:!0,deepView:r.deepView,loaded:null,compiled:null},n),i=null;i=""===a.id?e.$(r.viewTag):a.isSelf?e.$(a.id):e.$(a.id).find(r.viewTag);for(var o=[],l=[],c=loader.map().modules,s=0;s<i.length;s++){var u=i[s],d=u.getAttribute("name"),f=u.getAttribute("delay"),p=c[d],h="true"===u.getAttribute("rendered"),g=e.guid();if(!u.id&&u.setAttribute("id",g),"true"!==f){var m=u.innerHTML,v=p&&p.template?p.template:d+".html";p&&"function"==typeof p.template?l.push({id:u.id,el:u,name:d,cacheHtml:h,template:p.template.call(p)||"",url:v,slot:m}):o.push({id:u.id,el:u,name:d,cacheHtml:h,url:v,slot:m})}}return l.length&&(l.forEach((function(e,t){e.el.innerHTML=e.template,window.store&&window.store.$mount&&window.store.$mount(a.id)})),a.data=l,I(a)),function e(t){if(t==o.length)return a.data=o,void I(a);o[t]&&E(o[t].url,(function(n){o[t].template=n,e(t+1)}),(function(n){o[t].template="",e(t+1)}))}(0),this}function S(n,a,i){return new Promise((function(r,o){if("string"==typeof n)(n=e.unit.resolvePath(n)).indexOf(".css")>-1?(a&&a(n),R(n).then((function(e){r(n)}))):n.indexOf(".html")>-1||n.indexOf(".htm")>-1?E(n).then((function(e){if("function"!=typeof a)return t(a).html(e),i&&i(e),void r(e);a&&a(e),r(e)}),(function(e){i&&i(e),o(e)})):N(n).then((function(e){a&&a(e),r(e)}),(function(e){i&&i(e),o(e)}));else if(n&&"array"===e.typeof(n)){var l=n.map((function(t,n){return(t=e.unit.resolvePath(t)).indexOf(".css")>-1?R(t):t.indexOf(".html")>-1||t.indexOf(".htm")>-1?E(t):N(t)}));Promise.all(l).then((function(e){a&&a(e),r(e)}),(function(e){i&&i(e),o(e)}))}}))}function T(t,n,a){return new Promise((function(i,r){if("string"==typeof t)S(t,n,a);else if(t&&"array"===e.typeof(t)){var o=[];!function a(r){if(r==t.length)return n&&n(o),void i(o);var l=e.unit.resolvePath(t[r]);return l.indexOf(".css")>-1?R(l,(function(e){o.push(e),a(r+1)})):l.indexOf(".html")>-1||l.indexOf(".htm")>-1?E(l,(function(e){o.push(e),a(r+1)}),(function(e){a(r+1)})):N(l,(function(e){o.push(e),a(r+1)}),(function(e){a(r+1)}))}(0)}}))}function E(t,n,a){return new Promise((function(i,o){var l="function"==typeof n;if(t=e.hasRouter?t:e.unit.relativePath(t,r.relativePath),s.hasOwnProperty(t))return l?n&&n.call(f,s[t],200):"string"==typeof n&&e.$(n).html(s[t]),i(s[t],200),this;"string"==typeof t&&bui.ajax({baseUrl:r.baseUrl,url:t,dataType:"html",contentType:"text/html;charset=UTF-8",mimeType:"html",processData:!1,needNative:r.needNative,cache:r.cache,data:null,success:function(r,o,c){s[t]=r,l?n&&n.call(f,r,o,c):"string"==typeof n&&(e.$(n).html(r),a&&a.call(f,r,o,c)),i(r,o)},error:function(e,t,n){l&&a&&a.call(f,e,t,n),o(e,t,n)}})}))}function N(n,a,i){return new Promise((function(o,c){var s;if(d=u.modules,void 0===n||""==n)return i&&i.call(this,n),c(n),this;if(n in d)s=n,n=d[n].script||s+r.scriptSuffix;else{var f=n.indexOf(r.scriptSuffix);f>-1?s=(n=n).substr(0,f):(s=n,n+=r.scriptSuffix)}n=e.hasRouter?n:e.unit.relativePath(n,r.relativePath);var p=document.createElement("script")||{},h=r.cache?"":"?t="+(new Date).getTime(),g=n.indexOf("http://")>-1||n.indexOf("https://")>-1;p.type="text/javascript",p.async=!1,p.src=g?n+h:u.baseUrl+n+h,p.setAttribute("name",s),p.onload=function(){r.log&&console.log("create "+n),a&&a(n),o(n)},p.onerror=function(e){r.log&&console.log("createError "+n),i&&i(n),c(n)};var m=e.array.index(l,n);return d[s]&&d[s].isDefined?(a&&a(n),o(n)):(m>-1&&d.hasOwnProperty(s)&&t('script[name="'+s+'"]').remove(),m>-1&&!d.hasOwnProperty(s)&&t('script[name="'+s+'"]').remove(),document.body&&document.body.appendChild(p),r.cache&&l.push(n)),p=null,this}))}function C(t){return new Promise((function(n,a){if(t.length,"array"===e.typeof(t)){var i=t.map((function(e){return R(e)}));return Promise.all(i)}return R(t)}))}function R(t,n){return new Promise((function(a,i){if("string"==typeof t){if(e.array.index(c,t)<0){var o=e.hasRouter?t:e.unit.relativePath(t,r.relativePath),l=document.createElement("link")||{};l.href=o+(r.cache?"":"?t="+(new Date).getTime()),l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),document.head&&document.head.appendChild(l),l=null,c.push(t)}a(t,n)}else e.showLog(t+"的格式不正确")}))}function A(t){f.self=this==window||this==f?null:this;var n=e.history.getLast("id");arguments[0]=n+"-"+t,o.trigger.apply(f,arguments)}return f},window.loader=e.loader(),e.define=loader.define,e.require=loader.require,e.map=loader.map,e.import=loader.import,e.checkLoad=loader.checkLoad,e.checkDefine=loader.checkDefine,e.checkImport=loader.checkImport}(window.bui||{},window.libs),function(e,t){e.toggle=function(n){if("string"==typeof n){var a=n||"";(n={}).id=a}var i,r,o={show:function(t,n){if(s)return;if(d=e.objId(l.id),!f&&!p)return!1;f=!1,"function"==typeof t?(t=t,n=n||r||""):(n=t||r||"",t=null);d[0]&&"none"==d[0].style.display&&d.css("display",c);d.addClass("animated "+n),"showIn"==n||"showOut"==n||"none"==n?(l.revert&&d.removeClass("animated "+n),t&&t.call(o,this),h=!0,f=!0):d.one("webkitAnimationEnd",(function(){try{!h&&d.css("display",c),l.revert&&d.removeClass("animated "+n),t&&t.call(o,this),h=!0,f=!0}catch(t){e.showLog(t,"toggle show method")}}));return this},hide:function(t,n){if(s)return;if(d=e.objId(l.id),!f&&!p)return;p=!1,"function"==typeof t?(t=t,n=n||i||""):(n=t||i||"",t=null);d.css("display",c).addClass("animated "+n),"showIn"==n||"showOut"==n||"none"==n?(d.css("display","none"),l.revert&&d.removeClass("animated "+n),t&&t.call(o,this),h=!1,p=!0):d.one("webkitAnimationEnd",(function(){try{d.css("display","none"),l.revert&&d.removeClass("animated "+n),t&&t.call(o,this),h=!1,p=!0}catch(t){e.showLog(t,"toggle hide method")}}));return this},remove:function(){return d.remove(),this},isShow:function(){return h},destroy:function(e){e=1==e;d&&(d.off(),e&&d.remove());s=!0},widget:function(t){return e.widget.call({},t)},option:function(t,n){return e.option.call(o,t,n)},config:l,init:g},l=o.config=t.extend(!0,{},{id:"",uid:"",effect:"fadeIn",useBox:!1,revert:!0,inOrder:!1},n),c=l.useBox?"-webkit-box":"block",s=!1,u={show:["fadeIn","fadeInLeft","fadeInRight","fadeInDown","fadeInUp","fadeInLeftBig","fadeInRightBig","fadeInUpBig","fadeInDownBig","zoomIn","bounceIn","rotateIn","rollIn","flipInX","flipInY","lightSpeedIn","showIn","slideInRight","slideInLeft","coverInLeft","coverInRight","zoomSlideInLeft","zoomSlideInRight","pushInLeft","pushInRight"],hide:["fadeOut","fadeOutLeft","fadeOutRight","fadeOutUp","fadeOutDown","fadeOutLeftBig","fadeOutRightBig","fadeOutDownBig","fadeOutUpBig","zoomOut","bounceOut","rotateOut","rollOut","flipOutX","flipOutY","lightSpeedOut","showOut","slideOutRight","slideOutLeft","coverOutLeft","coverOutRight","zoomSlideOutLeft","zoomSlideOutRight","pushOutLeft","pushOutRight"],hideInOrder:["fadeOut","fadeOutRight","fadeOutLeft","fadeOutDown","fadeOutUp","fadeOutRightBig","fadeOutLeftBig","fadeOutUpBig","fadeOutDownBig","zoomOut","bounceOut","rotateOut","rollOut","flipOutX","flipOutY","lightSpeedOut","showOut","slideOutLeft","slideOutRight","coverOutRight","coverOutLeft","zoomSlideOutRight","zoomSlideOutLeft","pushOutRight","pushOutLeft"]},d=null,f=!0,p=!0,h=!1;function g(t){if(s=!1,(t=t||l).id){d=e.objId(t.id),l=o.config=t,d.attr("class");var n=t.effect,a=t.inOrder?e.array.index(u.hideInOrder,n):e.array.index(u.hide,n),c=n&&(e.array.index(u.show,n)>-1?e.array.index(u.show,n):a);return h=!(d[0]&&"none"==d[0].style.display||"none"==d.css("display")),c<0?(r=u.show[0],i=t.inOrder?u.hideInOrder[0]:u.hide[0]):(r=u.show[c],i=t.inOrder?u.hideInOrder[c]:u.hide[c]),t.uid&&e.history.setUI&&e.history.setUI({uid:t.uid,ui:o}),this}e.showLog("toggle id不能为空","bui.toggle")}return l.id&&g(l),o}}(window.bui||{},window.libs),function(e,t){e.unit={},e.unit.remToPx=function(e){var t=window&&window.viewport&&window.viewport.fontSize||100;return e=(parseFloat(e)*t).toFixed(2)},e.unit.pxToRem=function(e){var t=window&&window.viewport&&window.viewport.fontSize||100;return e=(parseFloat(e)/t).toFixed(2)},e.unit.pxToRemZoom=function(e){return e=(parseFloat(e)/100).toFixed(2)},e.unit.debounce=function(e,t,n){var a;return function(){var i=n||this,r=arguments,o=function(){a=null,e.apply(i,r)};clearTimeout(a),a=setTimeout(o,t)}},e.unit.throttle=function(e,t,n){var a,i;return t||(t=250),function(){var r=n||this,o=+new Date,l=arguments;a&&o<a+t?(clearTimeout(i),i=setTimeout((function(){a=o,e.apply(r,l)}),t)):(a=o,e.apply(r,l))}},e.unit.startWithCss=function(e){var t=new RegExp("^\\.|^#");return"string"==typeof e&&t.test(e)},e.unit.startWithStr=function(e,t){var n=new RegExp("^"+t);return"string"==typeof e&&n.test(e)},e.unit.startWithId=function(e){var t=new RegExp("^#");return"string"==typeof e&&t.test(e)},e.unit.startWithClass=function(e){var t=new RegExp("^\\.");return"string"==typeof e&&t.test(e)},e.unit.endWithImage=function(e){var t=new RegExp("(.png|.jpg|.gif)$");return"string"==typeof e&&t.test(e)},e.unit.tel=function(t){var n,a="tel:";return 0==(t=String(t)).indexOf("+")&&(a="wtai://wp/mc;"),n=t,window.location.href=a+n,e},e.unit.sms=function(t,n){var a=navigator.userAgent,i=/(iPhone|iPad|iOS)/i.test(a)?"&":"?";return window.location.href="sms:"+t+i+"body="+n,e},e.unit.mailto=function(t){return"string"==typeof(t="email"in t?t:{}).email&&t.email.indexOf("@")>0?window.location.href="mailto:"+t.email+"?subject="+(t.subject||"")+"&body="+(t.body||"")+"&cc="+(t.cc||""):e.showLog(email+"格式不正确"),e},e.unit.openExtral=function(t){var n=[],a="";if((t=String(t)).indexOf("mailto:")>=0)if((a=(n=t.split("mailto:"))[1]).indexOf("?")>-1){var i=a.split("?"),r=e.unit.keyStringToObject(i[1]);r.email=i[0],e.unit.mailto(r)}else e.unit.mailto({email:a});if(t.indexOf("tel:")>=0&&(n=t.split("tel:"),a=parseInt(n[1]),e.unit.tel(a)),t.indexOf("sms:")>=0)if(a=(n=t.split("sms:"))[1],t.indexOf("=")>=0){var o=t.split("=")[1];e.unit.sms(a,o)}else e.unit.sms(a);return e},e.unit.objectToKeyString=function(e,t){var n="";for(var a in e){n+="&"+a+"="+(t?encodeURIComponent(e[a]):e[a])}return n.substr(1)},e.unit.keyStringToObject=function(t,n){var a,i={},r=[];try{for(r=t.split("&"),a=0;a<r.length;a++){var o=n?decodeURIComponent(r[a].split("=")[1]):r[a].split("=")[1];i[r[a].split("=")[0]]=o}}catch(t){e.showLog(t)}return i},e.unit.checkTargetInclude=function(e,n){var a=n,i=[];if(a.indexOf(",")>-1){var r,o=(i=a.split(",")).length;for(r=0;r<o;r++){var l=i[r];l.indexOf(".")>-1&&(i[r]=l.substr(1))}}else a.indexOf(".")>-1?i[0]=a.substr(1):i[0]=a;var c,s=i.length;for(c=0;c<s;c++)if(t(e).hasClass(i[c])||t(e).closest("."+i[c]).length)return!0;return!1},e.unit.jsonToString=function(t){return"object"===_typeof(t)?function(t){var n;if("object"===e.typeof(t)){for(var a in t)t[a]=i(t,a);n=JSON.stringify(t)}else"array"===e.typeof(t)?(t.forEach((function(e,n){t[n]=i(t,n)})),n=JSON.stringify(t)):n=t;function i(t,n){var a=t[n];return a&&"object"===e.typeof(a)?t[n]=function(t){if(t&&"object"===e.typeof(t)){for(var n in t){var a=t[n];"object"===_typeof(a)&&(t[n]=JSON.stringify(a))}return t}}(a):a&&"array"===e.typeof(a)?t[n]=function(t){if(t&&"array"===e.typeof(t))return t.forEach((function(e,n){"object"===_typeof(e)&&(t[n]=JSON.stringify(e))})),t}(a):t[n]=a,t[n]}return n}(t):t},e.unit.stringToJson=function(t){return t&&function t(n){var a,i;try{if(a="object"===_typeof(n)?n:JSON.parse(n),"array"===e.typeof(a))a.forEach((function(e,n){a[n]=t(e)}));else if("object"===e.typeof(a))for(var r in a){var o=a[r];a[r]=t(o)}i=a}catch(e){i=n}return i}(t)},e.unit.stringToArray=function(t){var n=e.typeof(t);return"array"===n?t:"string"===n&&t.indexOf(",")>-1?t.split(","):[t]},e.unit.setKeyValue=function(e,t,n){var a=e&&e.indexOf(".")>-1?e.split("."):[e];return function e(n,i){if(a.length)return e(a.shift(),i[n]||{});i[n]=t}(a.shift(),n)},e.unit.getKeyValue=function(e,t){var n=e&&e.indexOf(".")>-1?e.split("."):[e];return function e(t,a){var i=a[t];if(i&&"string"==typeof i&&i.indexOf("{")>-1&&i.indexOf("}")>-1)try{a[t]=JSON.parse(i)}catch(e){a[t]=i}return i&&void 0!==i&&n.length?e(n.shift(),i):i}(n.shift(),t)},e.unit.getKeyObj=function(e,t){var n=e&&e.indexOf(".")>-1?e.split("."):[e];return function e(t,a){var i=a[t];return!i instanceof Array&&i instanceof Object?e(n.shift(),i):i}(n.shift(),t)},e.unit.getKeyName=function(e){var t=field&&field.indexOf(".")>-1?field.split("."):[field];return function e(n,a){var i=a[n];return!i instanceof Array&&i instanceof Object?e(t.shift(),i):i}(t.shift(),e)},e.unit.delKey=function(e,t){var n=e&&e.indexOf(".")>-1?e.split("."):[e];return function e(a,i){return n.length?e(n.shift(),i[a]):(delete i[a],t)}(n.shift(),t)},e.unit.calcHeight=function(e,n){var a=t(e);a[0]&&(a[0].style.height="calc(100% - "+n+")")},e.unit.resolvePath=function(t){if(!e.hasRouter)return t;var n=t=t||"",a=(router&&router.history&&router.history.getLast()||{url:n}).url||"";if("function"==typeof a)return n;var i=a.lastIndexOf("/"),r=a.substr(0,i);return t.indexOf("../")>-1?(t=t.replace(/\..\//g,(function(e){var t=r.lastIndexOf("/");return r=r.substr(0,t),""})),n=r?r+"/"+t:t):t.indexOf("./")>-1&&(n=r+"/"+t.replace(/\.\//g,"")),n},e.unit.filterField=function(t,n){var a={};if("object"===_typeof(n)){var i="object"===e.typeof(t),r="object"===e.typeof(n),o="array"===e.typeof(t),l="array"===e.typeof(n);if(i){if(r)for(var c in n)a[c]=n[c]?t[n[c]]:t[c];else l&&n.forEach((function(e,n){a[e]=t[e]}));return a}return o?(a=[],l?t.forEach((function(e,t){var i={};n.forEach((function(t,n){i[t]=e[t]})),a.push(i)})):r&&t.forEach((function(e,t){var i={};for(var r in n)i[r]=n[r]?e[n[r]]:e[r];a.push(i)})),a):void 0}},e.unit.fixZero=function(e){return e<10?"0"+e:e},e.unit.getAttributes=function(t){if("object"!==_typeof(t))return null;var n={},a=/\{.+\}$/g,i=/\[.+\]$/g;return t.attributes&&Object.keys(t.attributes).forEach((function(r,o){var l=t.attributes[r],c=l.value;if(a.test(c)||i.test(c))try{c=JSON.parse(c)}catch(t){c=c,e.showLog(t)}n[l.name]=c})),n},e.unit.resolvePathname=function(e,t){t=t||0;var n=e.lastIndexOf("/"),a=e.substring(t,n);return a.indexOf("/")>-1?a.split("/"):[a]},e.unit.relativeUrl=function(e,t){var n=[];return t.length>=e.length?t.forEach((function(t,a){var i=e[a];i&&t===i||(i&&t!==i?(n.unshift(".."),n.push(t)):n.push(t))})):e.forEach((function(e,a){var i=t[a];i&&e===i||(i&&e!==i?(n.unshift(".."),n.push(i)):n.unshift(".."))})),n},e.unit.relativePath=function(t,n){n=n||"pages";var a=window.self.location.href;if(a.indexOf("source.html?url=")>-1&&a.indexOf("code=")>-1)return t;if(0===t.indexOf("http://")||0===t.indexOf("https://"))return t;var i=window.location.href,r=i.indexOf(n),o=t&&t.indexOf("/")>-1?t.split("/"):[t],l=[];if(r<0){var c=window.location.pathname.toLocaleLowerCase(),s=c.indexOf("www"),u=c.indexOf("src"),d=c.indexOf("dist");if(s>-1){var f=e.unit.resolvePathname(c,s+4);l=e.unit.relativeUrl(f,o)}else if(d>-1){var p=e.unit.resolvePathname(c,d+5);l=e.unit.relativeUrl(p,o)}else{if(!(u>-1))return 0==t.indexOf("/")?t.replace("/",""):t;var h=e.unit.resolvePathname(c,u+4);l=e.unit.relativeUrl(h,o)}}else{var g=e.unit.resolvePathname(i,r);l=e.unit.relativeUrl(g,o)}return l.join("/")},e.unit.between=function(t,n,a){var i=!0,r=new Date;if(n=n||0,a=a||e.date.convert(r.getFullYear+"/12/31").getTime(),"number"==typeof t)(t<n||t>a)&&(i=!1);else{n||e.showLog("bui.unit.between 第2个参数为最小日期");try{n=e.date.convert(n).getTime(),a=e.date.convert(a).getTime(),((t=e.date.convert(t).getTime())<n||t>a)&&(i=!1)}catch(t){e.showLog("bui.unit.between 用来检测数字或者日期,请检查参数格式是否正确")}}return i},e.unit.numberunit=function(e){var t=+e,n=t;return t>1e4&&(n=parseFloat(t/1e4).toFixed(1)+"万"),n}}(window.bui||{},window.libs),function(e,t){var n,a,i,r;e.history=(i=[],r={get:function(t,n){if(void 0===t)return i;var a=n||"name";return e.array.get(i,t,a)},getLast:function(e){var t=i.length-1,n=i[t]||{};return e?n[e]:n},getPrev:function(e){var t=i.length-2,n=i[t]||{};return e?n[e]:n},getParams:function(e){var t=this.getLast(),n={};switch(e){case"page":n=this.getPageParam()||n;break;case"part":case"component":n=this.getComponentParam()||n;break;case"url":n=t.param||bui.getUrlParams();break;default:n=this.getComponentParam(e)||this.getPageParam(e)||t.param||bui.getUrlParams()}return n},setComponent:function(e){return this.getLast().component[e.id]=e,e},setUI:function(e){var t=this.getLast(),n=e.uid;return t.ui[n]=e.ui,r},getUI:function(t){return t?this.getLast().ui[t]||null:e.showLog("uid不能为空，指ui自定义唯一的名字")},getComponentParam:function(e){var t=this.getLast(),n=e||t.currentComponent;return n&&t.component[n]&&t.component[n].param||null},getComponent:function(t,n){if(void 0!==t){n=n||"exports";var a=this.getLast();return a.component[t]&&a.component[t][n]||null}e.showLog("必须传component id才能获取实例")},getParentComponent:function(){var e=this.getComponentParam();return e&&e.parentId&&this.getComponent(e.parentId)||this.getLast("exports")},getParentParams:function(){var e=this.getComponentParam();return this.getParams(e.parentId)||this.getLast("param")||null},getPage:function(t,n){if(void 0!==t){n=n||"exports";var a=this.getLast(),i=null,r=a.page;if(r.hasOwnProperty(t))i=r[t]&&r[t][n]||{};else if(t)for(var o=Object.keys(r),l=0;l<o.length;l++){var c=r[o[l]]||{};if(c.name===t)return c[n]}else{var s=a.currentPage;i=r[s]&&r[s][n]||{}}return i}e.showLog("必须传page id 或者 模块名才能获取实例")},getPageDialog:function(t){if(void 0!==t){var n=this.getLast();return n.page[t]&&n.page[t].dialog||null}e.showLog("必须传page id才能获取对话框信息")},setPage:function(n){var a=this.getLast();if("object"!==_typeof(n))return n;if(n&&n.hasOwnProperty("id")){var i,r=t.extend(!0,{},a.page[n.id],n);for(i in r.param)r.param[i]&&"array"==e.typeof(r.param[i])&&(r.param[i]=n.param[i]||[]);return a.page[n.id]=r,n}},getPageParam:function(e){var t=this.getLast(),n=e||t.currentPage;return n&&t.page[n]&&t.page[n].param||null},add:function(n){var a=t.extend(!0,{id:"",name:"",url:"",replace:!1,syncHistory:!0,component:{},param:{},ui:{},part:{},page:{},toggle:null,effect:"push"},n),r=i;if(n.toggle){var o=t.extend(!0,{},a,n);a.toggle=null,r.push(o)}else r.push(a);var l=window.location.origin+window.location.pathname+"#"+a.name,c=e.setUrlParams(l,a.param);return a.syncHistory&&"pushState"in window.history&&window.history.pushState(a,null,c),r},replace:function(n){n=t.extend(!0,{id:"",name:"",url:"",replace:!1,syncHistory:!0,param:{},part:{},ui:{},page:{},toggle:null,effect:"push"},opts);var a=i,r=a.length-1,o=window.location.origin+window.location.pathname+"#"+n.name,l=e.setUrlParams(o,n.param);if(r>-1){if(opts.toggle){var c=t.extend(!0,{},n,opts);n.toggle=null,a.splice(r,1,c)}else a.splice(r,1,n);n.syncHistory&&"replaceState"in window.history&&window.history.replaceState(n,null,l)}return a},refresh:function(){if(e.hasRouter){var n=r.getLast(),a=loader.get(n.name);loader.import(n.url,(function(i){t("#"+n.id).html(i),e.config.init.auto&&e.init(),router.config.needView&&loader.views(),a.loaded(),router.config.needComponent&&loader.components()}))}else window.location.reload(!0)},removeNext:function(t){var n=i,a=t.index;if(parseInt(a)<0)return e.showLog("index 必须大于或者等于0"),n;var r=n.length-a;n.splice(a,r);var o=this.getLast(),l=window.location.origin+window.location.pathname+"#"+o.name,c=e.setUrlParams(l,o.param);return t.syncHistory&&"replaceState"in window.history&&window.history.replaceState(o.param,null,c),n},removeLast:function(e){var t=i.length-1;return this.removeNext({index:t,syncHistory:!1!==e})},check:function(t){var n=i;return e.array.compare(n,t,"name")||e.array.compare(n,t,"url")||e.array.compare(n,t,"id")},checkComponent:function(t){var n=this.getLast(),a=Object.keys(n.component);return e.array.compare(a,t)},checkPage:function(e,t){for(var n=this.getLast(),a=Object.keys(n.page),i=0;i<a.length;i++){var r=a[i],o=n.page[r];if(o.name===e||o.id===e)return!0}return!1},epmty:function(e){return i=[]}},n=function(t){var n=(t=t&&t.replace(window.location.origin,"")||window.location.pathname).indexOf(".html"),a=t.indexOf("?"),i="",r="",o="",l=null,c=loader.map().modules;if(a>-1){var s=t.substr(a+1);l=e.unit.keyStringToObject(s,!0)}return n>-1?(r=(i=0==t.indexOf("/")?t.substr(1,n-1):t.substr(0,n-1))+".html",o=i+".js"):(r=c[i=t]&&c[i].template||"",o=c[i]&&c[i].script||""),{pid:i,name:i,url:r,src:o,param:l}}(window.location.href),a=e.guid(),t(document).ready((function(){document.body.setAttribute("id",a)})),i.push({id:e.guid(),pid:n.pid,name:n.pid,url:n.url,src:n.src,param:n.param,page:{},ui:{},component:{}}),r)}(window.bui||{},window.libs),function(e,t){e.router=function(n){var a,i,r,o=t.extend({},{id:"",uid:"",progress:!1,syncHistory:!0,autoInit:!0,firstAnimate:!1,path:"",indexModule:{moduleName:"main",template:"pages/main/main.html",script:"pages/main/main.js"},repairPath:!0,parseurl:!0,errorPage:"",hash:!1,cache:!0,reloadCache:!1,reload:!1,swipe:!1,swipeBack:!1,distance:100,startDistance:5,swipeDistance:50,onSwipeRight:null,onSwipeLeft:null,onSwipeUp:null,onSwipeDown:null,onBeforeSwipeRight:null,onSwipeCancel:null,pageMove:!0,needNative:!1,needView:!1,needComponent:!0,useScroll:"main,.bui-tab-main>ul>li,.bui-dialog-main,.bui-scroll,.bui-scroll-x",beforeBack:null,beforeLoad:null,loaded:null,store:null,width:0,height:0,async:!0,effect:"push",hashPrefix:"#",scriptSuffix:".js",pageSuffix:".html"},e.config.router,n),l=null,c=this,s=null,u=null,d=null,f="",p="",h=!0,g=!0,m=!1,v=!1,y={none:{inRight:"showIn",inLeft:"showIn"},fadein:{inRight:"fadeIn",inLeft:"fadeIn"},fadeinslide:{inRight:"fadeInRight",inLeft:"fadeInLeft"},slide:{inRight:"slideInRight",inLeft:"slideInLeft"},push:{inRight:"pushInRight",inLeft:"pushInLeft"},zoom:{inRight:"zoomIn",inLeft:"zoomIn"},cover:{inRight:"coverInRight",inLeft:"coverInLeft"},zoomslide:{inRight:"zoomSlideInRight",inLeft:"zoomSlideInLeft"},fadeinslideback:{inRight:"fadeInLeft",inLeft:"fadeInRight"},slideback:{inRight:"slideInLeft",inLeft:"slideInRight"},pushback:{inRight:"pushInLeft",inLeft:"pushInRight"},coverback:{inRight:"coverInLeft",inLeft:"coverInRight"},zoomslideback:{inRight:"zoomSlideInLeft",inLeft:"zoomSlideInRight"}},b={},w={},x={},k={},O=!1,L={},I={},P=loader.map(o.indexModule),j=e.history.epmty(),S=P.modules,T=e.storage({local:!1});function E(e){var t=window.location.hash||window.location.search,n=window.location.search,a=n&&n.indexOf("?"),i=(e=0!=e,t&&t.indexOf("?")),r=i>-1?t&&t.substr(1,i-1):window.location.hash.substr(1),l=r&&r.indexOf(o.pageSuffix),c=l>-1?r.substr(0,l):r,s=l>-1?r:r+o.pageSuffix,u={};function d(t,n){for(var a=t&&t.substr(n+1),i=a&&a.split("&"),r=0;r<i.length;r++){var o=e?decodeURIComponent(i[r].split("=")[1]):i[r].split("=")[1];u[i[r].split("=")[0]]=o}}return i>-1&&(d(n,a),d(t,i)),{pid:c,url:s,param:u}}function N(n){var a={id:"",url:"",param:{},effect:"",command:"html",path:o.path,repairPath:o.repairPath,firstAnimate:o.firstAnimate,progress:o.progress,reload:o.reload,autoInit:o.autoInit,needView:o.needView,needComponent:o.needComponent,replace:!1,iframe:!1,decode:!1,part:!1,cache:o.cache,callback:null,beforeLoad:o.beforeLoad,loaded:o.loaded},c=t.extend(!0,{},a,n),f=t.Deferred(),g=w.getLast()||null;j[j.length-2],c.url.indexOf("./")>-1&&(c.url=function(e,t){var n=e,a=t.url.lastIndexOf("/"),i=t.url.substr(0,a);e.indexOf("../")>-1?(e=e.replace(/\..\//g,(function(e){var t=i.lastIndexOf("/");return i=i.substr(0,t),""})),n=i?i+"/"+e:e):e.indexOf("./")>-1&&(n=i+"/"+e.replace(/\.\//g,""));return n}(c.url,g)),c.repairPath&&0===c.url.indexOf("/")&&(c.url=c.url.substr(1)),c.path&&(c.path="/"==c.path[c.path.length-1]?c.path:c.path+"/"),c.url=c.url in S||c.iframe||c.url.indexOf("http:")>-1?c.url:c.path+c.url,document.activeElement.blur();var v=null,y={};c.id=(c.id&&c.id.indexOf("#")>-1?c.id.substr(1):c.id)||"";var k=c.replace||c.part?g.id:c.id||e.guid(),P=e.objId(k);if(!c.url)return e.showLog("url 不能为空","bui.router.load"),f.promise();if(c.url=c.decode?decodeURIComponent(c.url):c.url,c.url.indexOf("tel:")>=0||c.url.indexOf("mailto:")>=0||c.url.indexOf("sms:")>=0)return e.unit.openExtral(c.url),f.promise();if(c.url&&c.url.indexOf("?")>-1){var T=c.url.split("?");y=e.unit.keyStringToObject(T[1]),c.url=T[0]}v=t.extend(!0,{},y,c.param),"wechat_redirect"==c.url?c.url="main":"undefined"==c.url&&(c.url=o.errorPage||"main"),c.iframe=Boolean(c.iframe)||"true"==v.iframe,1==c.iframe&&(v.iframe=!0);var E=C(c.url),R=E.pid||params.errorPage||"main",A=c.iframe?c.url:E.url,V={id:k,pid:R,name:R,url:"function"==typeof A?c.url:A,replace:c.replace,param:v,component:{},page:{},part:{},ui:{},toggle:null,exports:{},effect:n.effect||o.effect,syncHistory:o.syncHistory},B="function"==typeof c.beforeLoad?c.beforeLoad.call(M,{prevTarget:g,target:V}):c.beforeLoad;if(H.call(M,"loadbefore",{prevTarget:g,target:V}),H.call(M,"beforeload",{prevTarget:g,target:V}),!1===B)return h=!1,this;if(c.part,r&&r.show(),c.progress&&i&&i.show(),loader.map({moduleName:R,id:k}),loader.get(V.pid),j.length&&c.effect){var z=j.length-1;j[z].effect=c.effect}!m&&!c.part&&!c.replace&&w.add(V),c.replace&&w.replace(V);var q=V;if(c.part&&(e.history.setComponent({id:k,pid:R,url:A,param:v}),q.currentComponent=k,j.splice(j.length-1,1,q)),c.part||V,x[R])!function(e){Y(L.get(e.pid,"template")),e.part?Z(e):(J(),!m&&X((function(){e.firstAnimate&&(Z(e),e.loaded&&e.loaded({prevTarget:g,target:V}),e.callback&&e.callback({prevTarget:g,target:V})),e.progress&&i&&i.hide()})),!e.firstAnimate&&Z(e))}({pid:R,progress:c.progress,part:c.part,firstAnimate:c.firstAnimate}),H.call(M,"complete",{prevTarget:g,target:V}),o.needComponent&&loader.components(),c.firstAnimate||(c.loaded&&c.loaded({prevTarget:g,target:V}),c.callback&&c.callback({prevTarget:g,target:V}));else{if(c.iframe)return function(t){var n=function(t){var n=t.url.indexOf(".html")>-1||0==t.url.indexOf("http")?t.url:t.url+".html",a=t.param?e.setUrlParams(n,t.param):n,i="",r=e.platform.isIos()?'scrolling="no"':"";return i+='<div id="'+t.id+'" class="bui-router-item bui-router-fixiframe" data-page="'+t.pid+'">',i+='<iframe class="bui-router-iframe" src="'+a+'" '+r+' name="'+t.pid+'"></iframe>',i+="</div>"}({id:t.id,pid:t.pid,url:t.url,param:t.param});s&&s.attr("data-main",t.id).append(n),X((function(){c.progress&&i&&i.hide()}))}({id:k,pid:R,url:c.url,param:v}),f.promise();if(c.part)return _(A,(function(t,n,a){e.objId(k)[c.command](t),W(Q),c.cache&&L.add(R,{id:k,pid:R,template:t}),r&&r.hide(),c.progress&&i&&i.hide()}),(function(e,t,n){K(A,e),H.call(M,"loadfail",e,t,n)})),f.promise();_(A,(function(e,t,n){if("object"===_typeof(e))return K(A,e),!1;Y(e),c.cache&&L.add(R,{id:k,pid:R,template:e}),J(),c.firstAnimate?X((function(){W(Q),c.progress&&i&&i.hide(),I.add(R,{id:k,pid:R,param:v})})):(X((function(){c.progress&&i&&i.hide()})),W(Q),I.add(R,{id:k,pid:R,param:v}))}),(function(e,t,n){K(A,e),H.call(M,"loadfail",e,t,n)}))}function K(t,n,a,l){if(r&&r.hide(),c.progress&&i&&i.hide(),w.removeLast(),f.reject(t),"object"===_typeof(n))return e.showLog("找不到页面"+t,"bui.router.load"),o.errorPage&&function(e){!function(e){var t,n=window.location.href,a=(t=(t=n.indexOf(o.hashPrefix))>-1?t:0)>-1?n.substr(0,t):n;N({url:o.errorPage||a,param:{error:e}}),H.call(M,"error",{target:e,status:404})}(e)}(t),!1}function W(n){loader.set(R,{$:function(e){return t("#"+k).find(e)}}),m||b[R]?(q.exports=b[R],Z({pid:R}),O&&X(),n&&n(),o.needComponent&&loader.components()):(loader.checkLoad(R)?(Z({pid:R}),o.needComponent&&loader.components(),n&&n()):(o.needComponent&&loader.components(),loader.require(R,(function(t){try{if(c.firstAnimate&&c.progress&&i&&i.hide(),b[R]=t||null,V.exports=t,f.resolve(t),h||c.firstAnimate||c.replace){var a=loader.get(R);a&&a.show&&a.show({type:"firstload",target:V})}n&&n(),c.loaded&&c.loaded({prevTarget:g,target:V}),c.callback&&c.callback({prevTarget:g,target:V})}catch(t){e.showLog(t,"bui.router.load"),f.reject()}}))),H.call(M,"complete",{prevTarget:g,target:V}))}function J(){var t=(l=e.objId(q.id))&&l.find(".bui-page");t&&t.length&&c.autoInit&&e.init({id:t,height:p})}function X(t){l=e.objId(k),F(),D();try{if(h||m||c.replace||c.part){t&&t(),!c.firstAnimate&&c.progress&&i&&i.hide(),r&&r.hide(),l&&l.css("zIndex",5);var n="pageshow-"+w.getLast().pid;H.call(M,"pageshow",{type:"load",target:w.getLast()}),H.call(M,n,{type:"load",target:w.getLast()})}else u&&u.hide(),d&&d.show((function(){t&&t(),!c.firstAnimate&&c.progress&&i&&i.hide(),l&&l.css("zIndex",5),r&&r.hide();var e=j[j.length-2]||{},n=w.getLast(),a=loader.get(n.pid),o=e&&e.pid&&loader.get(e.pid)||null,s="pageshow-"+n.pid,u="pagehide-"+e.pid;H.call(M,u,{type:"load",target:j[j.length-2]}),H.call(M,s,{type:"load",target:w.getLast()}),H.call(M,"pagehide",{type:"load",target:j[j.length-2]}),H.call(M,"pageshow",{type:"load",target:w.getLast()}),o&&o.hide&&o.hide({type:"load",target:j[j.length-2]}),a&&a.show&&a.show({type:"load",target:w.getLast()})}))}catch(t){e.showLog(t,"bui.router.doAnimate")}}function Y(t){var n="";M.store&&(t=M.store.compileHtml(t));var a=e.history.getLast();if(t=t.replace(/#module\.id/g,"#"+a.id),c.part)n=U({content:t}),c.id?P.html(n):e.showLog("id 不能为空","router.loadPart");else if(c.replace){var i=w.getLast();P=j.length?e.objId(i.id):s,i.pid=R,i.url=A,i.param=v,e.array.index(j,R,"pid"),n=R in x?L.get(R,"template"):U({content:t}),P.html(n).attr("data-page",R)}else m||(n=$({id:k,content:t,pid:R}),s&&s.attr("data-main",k).append(n));return o.needView&&loader.views({compiled:function(){M.store&&!M.store.config.isPublic&&M.store.config.needCompile&&M.store.compile("#"+k)}}),!M.store||o.needView||M.store.config.isPublic||M.store.config.needCompile&&M.store.compile("#"+k),n}function Z(e){var t=w.getLast(),n=S[e.pid]&&S[e.pid]||{},a=n.loaded,i=a&&a.apply(n,n.dependExports)||n.exports;b[e.pid]=i||null,n.exports=i,t.exports=i,m&&H.call(M,"refresh",{prevTarget:g,target:t}),r&&r.hide(),f.resolve(i),m=!1,h=!1}function Q(){var e=j[j.length-2]||null,t=w.getLast();h&&!c.part&&(H.call(M,"firstload",{prevTarget:e,target:t}),h=!1),c.part?H.call(M,"loadpart",{prevTarget:e,target:t}):H.call(M,"load",{prevTarget:e,target:t})}return f.promise()}function C(e){var t="",n=e;P=loader.map(),S=P.modules;var a=n.indexOf(o.pageSuffix);return a>-1?(n=(t=n).substr(0,a),S.hasOwnProperty(n)&&(t=S[n]&&S[n].template||t||"")):t=S[n=n]&&S[n].template||n+o.pageSuffix||"",{pid:n,url:t}}function R(n){var a=this,i={};"function"==typeof n?i.callback=n:i=n||{};var r=t.extend(!0,{index:-1,name:"",beforeBack:o.beforeBack,callback:null,loaded:o.backed},i),l=parseInt(r.index),c=j.length;if(P=loader.map(),S=P.modules,!(l>0)){var f=w.getLast(),p=c-1,h=f.toggle;if(h)return h.hide(),void F();var m="function"==typeof r.beforeBack?r.beforeBack.call(M,{prevTarget:null,target:f}):i.beforeBack;H.call(M,"beforeback",{prevTarget:null,target:f});var v=loader.get(f.pid);return v&&v.beforeDestroy&&v.beforeDestroy(),!1===m?this:(r.name&&(l=A(r.name)),Math.abs(l)>p&&(l=-p),c>1&&g&&(l<-1&&D(l),g=!1,i.effect&&(u.option({effect:i.effect}),d.option({effect:i.effect})),u&&u.show(),d&&d.hide((function(){var n=c+l;!function(e){s.children().each((function(n,a){n>=e&&t(a).remove()}))}(n),w.removeNext(n),D();var i=F(),o=i.pid;e.objId(i.id).css("zIndex",5),function(){var e;e=b[o]||{};var t=loader.get(i.pid);r.callback&&r.callback.call(a,e,i),r.backed&&r.backed.call(M,{prevTarget:f,target:i}),H.call(M,"back",{prevTarget:f,target:i}),i;var n="pageshow-"+i.pid,l="pagehide-"+f.pid;v&&v.hide&&v.hide({type:"back",target:f}),t&&t.show&&t.show({type:"back",target:i}),H.call(M,l,{type:"back",target:f}),H.call(M,n,{type:"back",target:i}),H.call(M,"pageshow",{type:"back",target:i}),H.call(M,"pagehide",{type:"back",target:f}),v&&v.destroyed&&v.destroyed(),g=!0}()}))),this)}e.showLog("index 参数只能是负数","bui.router.back")}function A(t){var n,a=e.array.indexs(j,t,"pid"),i=a.length;if(i){var r=-(j.length-a[i-1]-1);n=0==r?-1:r}else n=-1;return n}function _(t,n,a){if("string"==typeof t){loader.importHtml(t,(function(t,a,i){t=function(e){var t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,n=/<body[^>]*>([\s\S]*)<\/body>/.exec(e);if(n&&2===n.length)return n[1].replace(t,"");return e}(t),e.history.getLast(),n&&n(t,a,i),H.call(M,"success",t,a,i)}),(function(e,t,n){a&&a(e,t,n),H.call(M,"fail",e,t,n)}))}else if("function"==typeof t){var i=t&&t();n&&n(i,200,{}),H.call(M,"success",i,200,{})}else e.showLog("url 不能为空","bui.router.requestUrl")}function F(){var t=w.getLast(),n=t.id||"",a=t.effect||o.effect;return n&&(H.call(M,"beforepageshow",{target:t}),d=null,d=e.toggle({id:document.getElementById(n),effect:y[a]&&y[a].inRight||""}),s&&s.attr("data-main",n)),t}function D(t){t=t||-1;var n=j.length+t-1,a=j[n],i=a&&a.id||"",r=a&&a.effect||o.effect;return i&&(H.call(M,"beforepagehide",{target:a}),u=null,u=e.toggle({id:document.getElementById(i),effect:y[r]&&y[r].inLeft||""})),a}function $(e){var t="";return t+='<div id="'+e.id+'" class="bui-router-item" data-page="'+e.pid+'">',t+=e.content||"",t+="</div>"}function U(e){var t="";return t+=e.content}function V(t,n){return e.on.apply(M,arguments),this}function H(t){M.self=this==window||this==M?null:this,e.trigger.apply(M,arguments)}e.hasRouter=!0,w.get=function(){return j},w.add=function(n){if((n=n||{}).toggle){var a=t.extend(!0,{},n);n.toggle=null,j.push(a)}else j.push(n);var i=window.location.origin+window.location.pathname+"#"+n.pid,r=e.setUrlParams(i,n.param);if(!h)return o.syncHistory&&"pushState"in window.history&&window.history.pushState(n,null,r),j;o.syncHistory&&"replaceState"in window.history&&window.history.replaceState(n,null,r)},w.prepend=function(t){t=t||{};var n=window.location.origin+window.location.pathname+"#"+t.pid;return e.setUrlParams(n,t.param),j.unshift(t),j},w.replace=function(t){t=t||{};var n=j.length-1,a=window.location.origin+window.location.pathname+"#"+t.pid,i=e.setUrlParams(a,t.param);return n>-1&&(j.splice(n,1,t),o.syncHistory&&"replaceState"in window.history&&window.history.replaceState(t,null,i)),j},w.getLast=function(e){var t=j.length-1,n=j[t]||{};return e?n[e]:n},w.removeNext=function(t){var n=j.length-t;j.splice(t,n);var a=w.getLast(),i=window.location.origin+window.location.pathname+"#"+a.pid,r=e.setUrlParams(i,a.param);o.syncHistory&&"replaceState"in window.history&&window.history.replaceState(a.param,null,r)},w.removeLast=function(){var e=j.length-1;w.removeNext(e)},w.checkLoad=function(t){return e.array.compare(j,t,"pid")||e.array.compare(j,t,"url")||e.array.compare(j,t,"id")},L.add=function(e,t){return x[e]=t||{},x[e]},L.del=function(e){delete x[e]},L.get=function(e,t){return t?(x[e]||{})[t]:x[e]},L.save=function(){if(j.length>1){var e=a.html();T.set("cacheHtml",e),T.set("cacheHistory",j),T.set("hasCache","true")}},L.load=function(){var t=T.get("cacheHtml",0),n=T.get("cacheHistory",0),i=[];if(n.length>1){a.html(t),s=a.children(".bui-router-main"),R({name:E().pid});try{n.forEach((function(e,t){var n="string"==typeof e?JSON.parse(e):e;i.push(n)}));var r=i[i.length-1];r,loader.require(r.pid,(function(e){b[r.pid]=e||null})),V("back",(function(e){loader.require(e.target.pid,(function(t){b[e.target.pid]=t||null}))}))}catch(t){e.showLog(t)}j=i,F(),D(),h=!1,O=!0,L.clear()}},L.clear=function(){T.remove("cacheHistory"),T.remove("cacheHtml"),T.remove("hasCache")},I.add=function(e,t){return k[e]=t||{},k[e]},I.get=function(e,t){return t?(k[e]||{})[t]:k[e]};var M={init:function(n){M.store=n.store||null,delete n.store,n=t.extend(!0,{},o,e.config.router,n),o=M.config=n;var l,u=e.history.getParams("url");if(u.module&&n.parseurl){var d=u.module;delete u.module;var h=e.setUrlParams(d,u);return window.location.href=window.location.origin+window.location.pathname+"#"+h,this}if("pages/main/main.html"===n.indexModule.template&&"pages/main/main.js"===n.indexModule.script||(P=loader.map(n.indexModule)),v&&"effect"in n&&j.forEach((function(e,t){e.effect=n.effect})),!n.id)return e.showLog("id 不能为空","bui.router.init"),!1;if(a=e.objId(n.id),r=bui.mask({appendTo:a,opacity:0,autoClose:!1}),i=e.loading({display:"block",width:30,height:30,opacity:0}),s=a.children(".bui-router-main"),f=n.width||window&&window.viewport&&window.viewport.width()||document.documentElement.clientWidth||"100%",p=n.height||window&&window.viewport&&window.viewport.height()||document.documentElement.clientHeight||"100%",!s.length){var g=(l="",String(f).indexOf("%"),String(p).indexOf("%"),l+='<div class="bui-router-main">',l+="</div>");a.html(g),s=a.children(".bui-router-main")}return(n.width>0||String(n.width).indexOf("%")>-1)&&s.width(n.width),(n.height>0||String(n.height).indexOf("%")>-1)&&s.height(n.height),function(n){if(function(){var t=T.get("hasCache",0);Boolean(t)&&o.reloadCache?L.load():function(t){try{var n=E();if(n.pid){if(n.pid.indexOf("http://")>-1||n.pid.indexOf("https://")>-1)return n.param.iframe=!0,void N({url:n.pid,param:n.param,iframe:!0});N({url:n.pid,param:n.param})}else N({url:o.indexModule.moduleName,param:n.param||{}})}catch(t){e.showLog(t,"bui.router.loadUrl")}}()}(),n.swipe&&function(n){var i=/hp-tablet/gi.test(navigator.appVersion),r="ontouchstart"in window&&!i,l=0,c=0,s=!1,u=null,d=null,f={x1:0,x2:0,y1:0,y2:0,direction:""};a.on("touchstart",(function(a){var i=a.originalEvent&&a.originalEvent.targetTouches||a.targetTouches,l=r?i[0]:a;f.x1=l.pageX,f.y1=l.pageY,s=t(a.target).closest(o.useScroll).length,j.length>1&&f.x1>0&&f.x1<n.distance&&(u=t("#".concat(w.getLast().id)),d=e.history.getPrev().id?t("#".concat(e.history.getPrev().id)):null)})),a.on("touchmove",(function(a){var i=a.originalEvent&&a.originalEvent.targetTouches||a.targetTouches,p=r?i[0]:a;f.x2=p.pageX,f.y2=p.pageY,i.length>1||a.scale&&1!==a.scale||(s=t(a.target).closest(o.useScroll).length,f.x2-f.x1>0&&!s&&a.preventDefault(),f.direction||(f.direction=e.swipeDirection(f.x1,f.x2,f.y1,f.y2)),"swipeleft"!==f.direction&&"swiperight"!==f.direction||(a.preventDefault(),a.stopPropagation()),l=Math.abs(f.x2-f.x1),c=Math.abs(f.y2-f.y1),"swiperight"===f.direction&&l>n.startDistance&&n.swipeBack&&(d&&d.css("display","block"),n.pageMove&&u&&u.css("transform","translateX(".concat(l,"px)")),a.preventDefault()))})),a.on("touchend",(function(e){(s=t(e.target).closest(o.useScroll).length,"swiperight"===f.direction&&f.x1>n.distance&&n.swipeBack&&(l=0),"swiperight"===f.direction&&l>n.swipeDistance)&&(!1!==(n.onBeforeSwipeRight&&n.onBeforeSwipeRight())&&n.swipeBack&&bui.back(),n.onSwipeRight&&n.onSwipeRight(e),H.call(M,"swiperight"));"swipeleft"===f.direction&&l>n.swipeDistance&&(n.onSwipeLeft&&n.onSwipeLeft(e),H.call(M,"swipeleft")),"swipeup"===f.direction&&c>n.swipeDistance&&!s&&(n.onSwipeUp&&n.onSwipeUp(e),H.call(M,"swipeup")),"swipedown"===f.direction&&c>n.swipeDistance&&!s&&(n.onSwipeDown&&n.onSwipeDown(e),H.call(M,"swipedown")),l<n.swipeDistance&&(d&&d.css("display","none"),u&&u.css("transform","translateX(0)")),l=0,s=!1,f={x1:0,x2:0,y1:0,y2:0,direction:""},u=null,d=null,e.stopPropagation()}))}(n),window.addEventListener("beforeunload",(function(e){o.reloadCache&&L.save(),H.call(c,"beforeunload",{target:j[j.length-1]})})),n.hash)return window.addEventListener("hashchange",(function(t){var n=E(),a=""==n.pid||"undefined"==n.pid?"main":n.pid,i=e.array.indexs(j,a,"pid"),r=i[i.length-1];a="wechat_redirect"==n.pid?"main":a,r>-1?(R({index:-(j.length-r-1||1)}),H.call(c,"popstate",{type:"back",prevTarget:j[r-1],target:j[r]})):(N({url:a,param:n.param,iframe:"true"==n.param.iframe,replace:!0}),H.call(c,"popstate",{type:"load",prevTarget:j[j.length-2],target:j[j.length-1]}))})),this;o.syncHistory&&"pushState"in window.history&&window.addEventListener("popstate",(function(t){var n=E(),a=""==n.pid?o.indexModule.moduleName:n.pid,i=A(a);e.array.index(j,a,"pid")>-1?(R({index:i,param:n.param}),H.call(c,"popstate",{type:"back",prevTarget:j[i-1],target:j[i]})):(N({url:a,param:n.param,iframe:"true"==n.param.iframe}),H.call(c,"popstate",{type:"load",prevTarget:j[j.length-2],target:j[j.length-1]}))}))}(n),n.uid&&e.history.setUI&&e.history.setUI({uid:n.uid,ui:M}),H.call(this,"init",{target:a[0]}),M},option:function(t,n){return v=!0,e.option.call(M,t,n)},config:o,data:{},on:V,off:function(t,n){return e.off.apply(M,arguments),this},trigger:H,load:N,resize:function(e){return(e=e||{}).width=e.width||o.width,e.height=e.height||o.height,window.viewport=bui.viewport(),f=e.width||window&&window.viewport&&window.viewport.width()||document.documentElement.clientWidth||"100%",p=e.height||window&&window.viewport&&window.viewport.height()||document.documentElement.clientHeight||"100%",s.css({width:f,height:p}),H.call(this,"resize",{target:j[j.length-1]}),this},destroy:function(t){return"string"==typeof t&&"main"!==t?(loader.destroy(t),L.del(t),t in b&&delete b[t]):e.showLog("参数只能是字符串"),this},loadPart:function(e){var n=t.Deferred(),a=t.extend(!0,{},{id:"",url:"",param:{},loaded:null},e);return a.loaded=function(t){e.loaded&&e.loaded.call(M,t),n.resolve(t),H.call(M,"loadpart",t)},loader.load(a),n.promise()},replace:function(e){return N({url:(e=e||{}).url||"",param:e.param||{},replace:!0}),this},refresh:function(){var t=j.length-1,n=j[t],a=j.length>1?j[j.length-2]:null;return e.history.refresh(),H.call(M,"refresh",{prevTarget:a,target:n}),this},back:R,isLoad:function(e){var t;return e&&(t=e in b),t},$:function(t){var n=w.getLast(),a=document.getElementById(n.id)||document;return e.obj(t,a)},currentId:function(e){return w.getLast().id},currentPage:function(){var e=w.getLast();return document.getElementById(e.id)},currentModule:function(){return w.getLast()},getPageParams:function(){return w.getLast().param},getPartParams:function(t){return e.history.getComponentParam(t)},getHistory:w.get,preload:function(n){var a=t.Deferred(),i=function(t,i){return _(t.url,(function(a){var r=e.guid(),o=C(t.url).pid;$({id:r,content:a,pid:o});var l=[];L.add(o,{id:r,pid:o,template:a}),l.push(o),t.style&&"array"===e.typeof(t.style)?t.style.forEach((function(e,t){l.push(e)})):t.style&&"string"===e.typeof(t.style)&&l.push(t.style),t.script&&"array"===e.typeof(t.script)?t.script.forEach((function(e,t){l.push(e)})):t.script&&"string"===e.typeof(t.script)&&l.push(t.script),loader.import(l,(function(){H.call(M,"preloadafter",{prevTarget:null,target:null}),i&&i(n)}),(function(){H.call(M,"preloadafter",{prevTarget:null,target:null}),i&&i(n)}))}),(function(n){e.showLog(t.url+"请求失败"),a.reject(t.url)})),a.promise()};return n&&"object"===e.typeof(n)?"url"in n&&i(n,(function(){a.resolve(n)})):n&&"array"===e.typeof(n)&&n.forEach((function(e,t){t==n.length-1?"url"in e&&i(e,(function(){a.resolve(n)})):"url"in e&&i(e)})),a},initScroll:function(n){var a=w.getLast(),i=e.objId(a.id),r="object"===_typeof(n)?t(n):i.find(".bui-page");return r.length&&e.init({id:r,height:p}),this},history:{get:w.get,check:w.checkLoad,getLast:w.getLast,add:w.add,removeLast:w.removeLast,replace:w.replace}};return M}}(window.bui||{},window.libs),function(e,t){var n=function(){function n(a){_classCallCheck(this,n),this._default={log:!1,hasLife:!0,onBeforeInit:null,onInited:null},this._plugin=a||{name:"",depend:null,config:null,param:null,callback:null};var i=e.config.hasOwnProperty(this._plugin.name)?e.config[this._plugin.name]:null;this.config=t.extend(!0,{},this._default,i,this._plugin.config,this._plugin.param),this.initStatus=!1,this.reinitStatus=!1,this.widgets=Object.create(null),this.init()}return _createClass(n,[{key:"widget",value:function(e){return e&&e in this.widgets?this.widgets[e]:this.widgets}},{key:"init",value:function(n){var a=this,i=n||null;a.config=t.extend(!0,this.config,i);var r=a.config,o=r.hasLife&&r.onBeforeInit&&r.onBeforeInit.call(a,r);return r.log&&console.log("".concat(a._plugin.name," before init")),!1===o||(a._plugin.callback&&a._plugin.callback.call(a,r),r.log&&console.log("".concat(a._plugin.name," init")),r.hasLife&&r.onInited&&r.onInited.call(a,r),r.log&&console.log("".concat(a._plugin.name," after inited")),this.initStatus=!0,a.config.uid&&e.history.setUI&&e.history.setUI({uid:a.config.uid,ui:a})),a}},{key:"reinit",value:function(){return this.destroy(),this.init(),this.config.log&&console.log("".concat(this._plugin.name," reinit")),this}},{key:"destroy",value:function(t){this.beforeDestroy&&this.beforeDestroy(),this.beforeDestroy=null,this.widgets={},this.off(),this.initStatus=!1,t&&t.call(this);var n=this.config.uid;n&&(e.history.getLast().ui[n]=null);return this.config.log&&console.log("".concat(this._plugin.name," destroyed")),this}},{key:"prefix",value:function(t){return e.config.classNamePrefix+t}},{key:"showLog",value:function(t,n){n=n||"";var a="";return"object"==_typeof(t)&&"message"in t&&"name"in t?a=t.message+":"+t.name+"&&stack:"+t.stack:"string"==typeof t&&(a=t),e.log&&console.error(n+" "+a),e.trace&&console.trace&&console.trace(),this}},{key:"option",value:function(n,a){if("object"!==e.typeof(n)&&void 0===a)return"string"==typeof n?this.config[n]:this.config;if("id"==n)return e.showLog("不允许修改控件的ID参数"),this;if(n&&"object"===e.typeof(n)){var i=t.extend(this.config,n);return this&&this.init(i)}if(this.config.hasOwnProperty(n)){var r={};r[n]=a;var o=t.extend(this.config,r);return instance&&instance.init(o)}return this}},{key:"emitter",get:function(){return e.emitter()}},{key:"on",get:function(){return this.emitter.on}},{key:"off",get:function(){return this.emitter.off}},{key:"trigger",get:function(){return this.emitter.trigger}}]),n}();e.extend=function(t){new(function(){function a(e){_classCallCheck(this,a),this.init(e)}return _createClass(a,[{key:"init",value:function(a){var i=a.name;return this.checkName(i)?(e[i]=function(e){return t.param=e,new n(t)},this):this}},{key:"checkName",value:function(e){return e?(this.name=e,!0):(console.warn("插件名字不能为空"),!1)}}]),a}())(t)}}(window.bui||{},window.libs),function(e){!function(t,n){var a;t.extend({name:"page",config:(a={uid:"",dialogid:"",url:"",param:null,script:"",appendTo:"",className:"bui-dialog-page",effect:"",pageSuffix:".html",height:0,width:0,iframe:!1,openFirst:!0,closeFirst:!1,autoClose:!1,needRemove:!1,useBox:!1,syncHistory:!1,title:"",buttons:null,mask:!1,life:!0,scroll:!1,needView:!1,needComponent:!0,cache:!0,close:!1,autoload:!0,fullscreen:!0},_defineProperty(a,"effect","fadeInRight"),_defineProperty(a,"onError",null),_defineProperty(a,"beforeClose",null),_defineProperty(a,"closed",null),_defineProperty(a,"beforeOpen",null),_defineProperty(a,"opened",null),_defineProperty(a,"beforeLoad",null),_defineProperty(a,"loaded",null),a),callback:function(a){var i=this,r=i.config,o="body"==i.appendTo?n:t.obj,l="",c=!1,s=(loader.map().modules,i.widgets.dialog=t.dialog({autoinit:!1,needRemove:a.needRemove})),u=null,d=!1;function f(e,n){var a="",i=n.close?'<div class="bui-dialog-close"><i class="'+t.config.icon.close+'"></i></div>':"",r=n.title?'<div class="bui-dialog-head">'.concat(n.title,"</div>"):"";return a+="".concat(r,'<div class="bui-dialog-main">').concat(e,"</div>").concat(i)}function p(e){var n=loader.map().modules[u.module]||{};if(n.hide&&r.life){var a=t.hasRouter?t.history.getLast():{};n.hide({type:"page",target:a})}"function"==typeof e&&e.call(i,n),r.closed&&r.closed.call(i,n)}function h(n,a){var o=t.history.getLast(),l=(loader.map().modules||{})[n];if(r.cache&&c&&!d)return!r.openFirst&&s.open(),"function"==typeof a&&a.call(i,l.exports),i;if(t.history.setPage({id:s.config.id,name:n,url:r.url,dialog:s,param:r.param}),d=!1,l&&"function"==typeof l.loaded){var u=l.loaded&&l.loaded.call(e,l.exports)||l.exports;t.history.setPage({id:s.config.id,name:n,url:r.url,dialog:s,exports:u,param:r.param});var f=loader.map().modules[n]||{};return f.show&&r.life&&f.show({type:"page",target:o}),"function"==typeof a&&a.call(i,u),i.compile({id:s.config.id}),r.opened&&r.opened.call(i,u),!r.openFirst&&s.open(),this}loader.require(n,(function(e){var l=loader.map().modules[n]||{};t.history.setPage({id:s.config.id,name:n,url:r.url,dialog:s,exports:e,param:r.param}),l.show&&r.life&&l.show({type:"page",target:o}),"function"==typeof a&&a.call(i,e),i.compile({id:s.config.id}),r.opened&&r.opened.call(i,e)})),c=!0}function g(e){var t=loader.map().modules,n={},a=e.indexOf(r.pageSuffix);return a>-1?(n.url=e,n.module=e.substr(0,a)):(n.url=t[e]&&t[e].template||e+r.pageSuffix,n.module=e),n}i.init=function(e){var a=n.extend(!0,{},i.config,e);if(a.onClose=function(){t.hasRouter&&a.syncHistory&&bui.back(),p()},u=g(a.url),a.iframe){var r=t.platform.isIos()?'scrolling="no"':"";return a.content='<iframe class="bui-router-iframe" src="'.concat(a.url,'" ').concat(r," ></iframe>"),s.create(a),a.autoload&&s.open(),a.loaded&&a.loaded.call(i,u),i}if(a.script){var c=a.script.indexOf(".js");u.module=a.script.substr(0,c)}return!1===(a.beforeLoad&&a.beforeLoad.call(i,u))?this:(loader.import(u.url,(function(e){"object"!==_typeof(e)?(l=f(e,a),a.id?(s.init(a),o(a.id).html(e)):(a.content=e,s=s.create(a)),a.autoload&&i.open(),a.loaded&&a.loaded.call(i,u)):a.onError&&a.onError.call(i,e)})),i)},i.compile=function(e){var t=n.extend(!0,{id:s.config.id,cacheHtml:!1,cache:!1,needComponent:r.needComponent,needView:r.needView},e);t.needView&&loader.views(t),t.needComponent&&loader.components(t)},i.reload=function(e){var t=r=n.extend(!1,i.config,r,e);if(t.param=e.param||{},d=!0,u=g(t.url),t.script){var a=t.script.indexOf(".js");u.module=t.script.substr(0,a)}if(!1===(t.beforeLoad&&t.beforeLoad.call(i,u)))return this;loader.import(u.url,(function(e){"object"!==_typeof(e)?(l=f(e,t),o("#"+(s.config.id||t.dialogid)).html(l),h(u.module),t.loaded&&t.loaded.call(i,u)):t.onError&&t.onError.call(i,e)}))},i.toggle=function(e,t){return i.isOpen()?i.close(t):i.open(e),i},i.isOpen=s.isOpen,i.close=function(e){return!1===(a.beforeClose&&r.beforeClose.call(i))?this:(t.hasRouter&&r.syncHistory&&t.history.removeLast(r.syncHistory),r.closeFirst?(s.close((function(){i.trigger("close"),p(e)})),i):(p(e),s.close(),i.trigger("close"),i))},i.remove=function(e){return s.remove(e),i.trigger("remove"),i},i.open=function(e){if(!1===(r.beforeOpen&&r.beforeOpen.call(i)))return this;if(r.iframe)return s.open(e),i;var n={hide:i.close,show:i.open};return t.hasRouter&&r.syncHistory&&t.history.add({id:s.config.id,name:u.module,url:r.url,replace:!1,param:r.param||{},part:{},page:{},effect:"push",toggle:n,syncHistory:r.syncHistory}),loader.map({moduleName:u.module,id:s.config.id}),t.history.getLast().currentPage=s.config.id,r.openFirst?(s.open((function(){i.trigger("open"),h(u.module,e)})),i):(h(u.module,e),s.open(),i.trigger("open"),i)},i.setParam=function(e){var a=n.extend(!1,{},r.param,e);t.history.setPage({id:s.config.id,param:a})},i.init(r)}})}(window.bui||{},window.libs)}(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports,function(e,t){e.setUrlParams=function(t,n,a){a=0!=a,n="object"==_typeof(n)?n:{};var i=e.unit.objectToKeyString(n,a);return""==i?t:t+"?"+i},e.getUrlParams=function(t){t=0!=t;var n=window.location.href,a=n.indexOf("?"),i={};if(a>-1){var r=n.substr(a+1);i=e.unit.keyStringToObject(r,t)}return i},e.getUrlParam=function(e){var t=window.location.href,n=new RegExp("(^|&|.)"+e+"=([^&]*)(&|$)","i"),a=t.substr(1).match(n);return null!=a?decodeURIComponent(a[2]):null},e.typeof=function(e){var t=Object.prototype.toString.call(e).slice(8,-1);return t=t.toLowerCase()},e.setting=function(t,n){return"string"==typeof t&&"object"===_typeof(n)?e.config[t]=n:"string"==typeof t&&void 0===n?e.config[t]:e.config},e.cmd=function(t){var n=t.split(":")||[],a=e.history.getUI(n[0]);if(n.length>1){var i=[].slice.apply(arguments);i.shift();var r=a[n[1]];return r?r.apply(a,i):void e.showLog("找不到该实例的".concat(n[1],"方法"))}return a}}(window.bui||{}),function(e,t){e.array={},e.array.index=e.inArray=function(e,t,n){var a,i;e instanceof Array?(a=e||[],i=t):(a=t||[],i=e);for(var r=0;r<a.length;r++){var o=a[r];if((o&&o[n]||o)===i)return parseInt(r)}return-1},e.array.compare=e.compareArray=function(e,t,n){var a,i;e instanceof Array?(a=e||[],i=t):(a=t||[],i=e);for(var r=0;r<a.length;r++){var o=a[r];if((o&&o[n]||o)===i)return!0}return!1},e.array.remove=e.removeArray=function(t,n,a){var i,r;return t instanceof Array?(i=t||[],r=n):(i=n||[],r=t||[]),e.array.delete(i,r,a),i},e.array.filter=e.filterArray=function(t,n,a){var i,r;t instanceof Array?(i=t||[],r=n):(i=n||[],r=t);var o=[];for(var l in i)try{var c=i[l]&&i[l][a]||i[l];new RegExp(r).test(c)&&o.push(i[l])}catch(t){e.showLog(t)}return o},e.array.indexs=e.indexArray=function(e,t,n){var a,i;e instanceof Array?(a=e||[],i=t):(a=t||[],i=e);var r=[];for(var o in a){(a[o]&&a[o][n]||a[o])===i&&r.push(+o)}return r},e.array.excess=e.excessArray=function(e,t,n){var a;a=e instanceof Array?e||[]:t||[];var i={},r=[];for(var o in a)try{var l=a[o]&&a[o][n]||a[o];i[l]!==l&&(i[l]=l,r.push(a[o]))}catch(e){}return r},e.array.uniq=function(t,n){for(var a=[],i=0;i<t.length;i++){var r=void 0===n,o=t[i],l=r?o:o[n]||o;e.array.index(a,l,n)<0&&a.push(o)}return a},e.array.copy=e.copyArray=function(t,n,a){var i=[];if(n=n||0,a=a||t&&t.length,!t||"array"===e.typeof(t))return t.forEach((function(e,t){i.push(e)})),i.splice(n,a)||[]},e.array.empty=function(t){if(!t||"array"===e.typeof(t))return t.splice(0,t.length)},e.array.replace=function(t,n){if(!(t&&"array"!==e.typeof(t)||n&&"array"!==e.typeof(n))){var a=[0,t.length].concat(n);return t.splice.apply(t,a)}},e.array.merge=function(t){var n;if(!t||"array"===e.typeof(t)){var a=arguments,i=a.length-1,r=a[i],o="string"==typeof r;if(o&&a.length>1){for(var l,c=i,s=[],u=function(e){var n=Array.prototype.slice.call(a[e],0);t.forEach((function(e,t){var a=e[r]||e;n instanceof Array&&n.forEach((function(t,i){var o=t[r]||t;if(a===o){for(var l in t)e[l]=t[l];n.splice(i,1)}}))})),s.push(n)},d=0;d<c;d++)u(d);return(l=e.array).merge.apply(l,[t].concat(s))}var f=(n=[t.length,0]).concat.apply(n,_toConsumableArray(Array.prototype.slice.call(arguments,1)));return t.splice.apply(t,f),t}},e.array.get=function(t,n,a){if(!t||"array"===e.typeof(t)){for(var i,r=null,o=0;o<t.length;o++){((r=t[o])&&r[a]||r)===n&&(i=r)}return i}},e.array.getAll=function(e,t,n){e=e||[];var a=[],i=null;for(var r in e)try{var o=(i=e[r])&&i[n]||i;t&&t instanceof Array?t.forEach((function(e,t){o===e&&a.push(i)})):o===t&&a.push(i)}catch(e){}return a},e.array.set=function(t,n,a,i){if(i=i||!0,!t||"array"===e.typeof(t)){var r=/\d/.test(n)&&"number"==typeof n;if(r&&void 0!==a){var o=t[n]||{};if(!0===i)return t.splice(n,1,a),t;if("object"===e.typeof(a))for(var l in a)o[l]=a[l];else"object"!==e.typeof(a)&&"string"==typeof i&&(o[i]=a);return t.splice(n,1,o),t}for(var c=0;c<t.length;c++){var s=t[c],u=void 0===i?s:s[i]||s;if(r?c===n:u===n){if("string"==typeof i){if(a&&"object"===e.typeof(a))for(var d in a)s[d]=a[d];else s[i]=a;t.splice(c,1,s)}else t.splice(c,1,a);return t}}return t}},e.array.setAll=function(t,n,a,i){if(!t||"array"===e.typeof(t))return t.filter((function(r,o){var l=void 0===i?r:r[i]||r;if(o==n||l===n)if(i){if(a&&"object"===e.typeof(a))for(var c in a)r[c]=a[c];else r[i]=a;t.splice(o,1,r)}else t.splice(o,1,a)})),t},e.array.delete=function(t,n,a){if(!t||"array"===e.typeof(t)){var i=[],r=e.array.copy(t);return n&&"array"===e.typeof(n)?n.forEach((function(e,t){o(void 0!==a&&e[a]||e)})):o(n),i}function o(e){for(var n=0,o=0;o<r.length;o++){var l=o-n,c=t.length!==r.length,s=c?t[l]||{}:t[o]||{},u=void 0!==a?s[a]:s,d="function"==typeof u?u.name.replace("bound ",""):u,f="function"==typeof e?e.name:e;if(u===e||d===f)return c?t.splice(l,1):t.splice(o,1),i.push(o),void++n}}},e.array.deleteIndex=function(t,n){if(!t||"array"===e.typeof(t)){var a=[];return n&&"array"===e.typeof(n)?n.forEach((function(n,i){a.push(t[n]),e.array.remove(t,t[n])})):(a.push(t[n]),e.array.remove(t,t[n])),a}}}(window.bui||{}),function(e,t){e.storage=function(n){var a=1,i="",r="",o=null,l=null,c={size:a,reverse:!0,deep:!1,local:!0,uid:"",prefix:""},s={init:u,get:d,getAll:function(e){for(var t={},n=parseInt(e)||0,a=0;a<localStorage.length;a++){var i=localStorage.key(a);if(i.substr(r.length),r&&0===i.indexOf(r))try{var o=JSON.parse(l.getItem(i));t[i]=void 0!==e?o[n]:o}catch(e){t[i]=l.getItem(i)}if(""===r)try{t[i]=JSON.parse(l.getItem(i))}catch(e){t[i]=l.getItem(i)}}return t},set:function(t,n,o){t=r+t;var c=1==a?null:l.getItem(t),s=[],u="",d=o?n[o]:n;if(null===c){s.push(n),u=JSON.stringify(s);try{l.setItem(t,u)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}else{var f=JSON.parse(c);if(e.array.compare(f,d,o)){e.array.remove(f,d,o),f[i](n);try{u=JSON.stringify(f),l.setItem(t,u)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}else{f[i](n),f.length>a&&0!=a&&("unshift"==i?f.pop():f.shift());try{u=JSON.stringify(f),l.setItem(t,u)}catch(e){"QuotaExceededError"==e.name&&console.log("超出本地存储限额！")}}}return this},remove:function(t,n,a){if("string"!=typeof(t=r+t))return void e.showLog("要删除的字段名只能是字符串","bui.storage.remove");var i=d(t)||[];if("number"==typeof n){var o="number"==typeof a?a:1;i.splice(n,o);try{var c=JSON.stringify(i)||"";l.setItem(t,c)}catch(t){e.showLog(t.name+": "+t.message,"bui.storage.remove")}}else if("string"==typeof n){var s=e.array.remove(i,n,a);try{c=JSON.stringify(s)||"";l.setItem(t,c)}catch(t){e.showLog(t.name+": "+t.message,"bui.storage.remove")}}else l.removeItem(t);return this},clear:function(){if(r)for(var e=0;e<localStorage.length;e++){var t=localStorage.key(e);0===t.indexOf(r)&&l.removeItem(t)}else l.clear();return this}};function u(n){var u;return"number"!=typeof n&&"string"!=typeof n||(n={size:n}),u=o=t.extend(!0,c,n),a=+u.size,r=u.prefix||"",i=u.reverse?"push":"unshift",l=u.local?localStorage:sessionStorage,u.uid&&e.history.setUI&&e.history.setUI({uid:u.uid,ui:s}),this}function d(t,n,a){t=r+t;var i,c=l.getItem(t)||"";try{i=o.deep?c&&e.unit.stringToJson(c):c&&JSON.parse(c)}catch(t){i=c,e.showLog(t.name+": "+t.message,"bui.storage.get")}if("number"==typeof n&&a)i=i&&i[n]&&i[n][a]||void 0;else if("string"==typeof n){var s=e.array.index(i,n,a);i=i&&i[s]}else i="number"==typeof n?i&&i[n]||void 0:i;return i}return u(n),s}}(window.bui||{},window.libs),function(e,t){e.platform=function(){var e=navigator.userAgent;function t(){return n()||a()||i()}function n(t){return/(Android|Linux)/i.test(e)}function a(t){return/(iPhone)/i.test(e)}function i(t){return/(iPad)/i.test(e)}return{isAndroid:n,isIphone:a,isIpad:i,isIos:function(t){return/(iPhone|iPad|iOS)/i.test(e)},isWeiXin:function(t){return/(micromessenger)/i.test(e)},isPC:function(){return!t()},isMobile:t,isWeiXinMini:function(e){return"miniprogram"===window.__wxjs_environment},isBingotouch:function(t){return/(crosswalk)/i.test(e)},isMac:function(){return/macintosh;.+mac os x/i.test(e)},isIphoneX:function(e){var t=!1,n=3==window.devicePixelRatio&&375==window.screen.width&&812==window.screen.height,a=2==window.devicePixelRatio&&414==window.screen.width&&896==window.screen.height,i=3==window.devicePixelRatio&&414==window.screen.width&&896==window.screen.height;return(n||a||i)&&(t=!0),t},isWindow:function(t){return/Windows NT/i.test(e)}}}()}(window.bui||{}),function(e,t){e.date={},e.date.format=function(e,t){if(null==e)return"";var n=this.convert(e);t=t||"yyyy-MM-dd";var a={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return t},e.date.convert=function(e,t){if(e&&e.constructor==Date)return e;if("number"==typeof e&&13===String(e).length)return new Date(e);e=String(e);var n=new Date,a=n.getFullYear(),i=n.getMonth()+1,r=n.getDate();if((e=e.replace(/[-|年|月]/gim,"/").replace(/[时|分|秒|小时|分钟]/gim,":").replace(/^(\d{4}\/\d+?)($|\s)/,(function(e,t){return t+"/1"})).replace(/[日|号]/gim,"").replace(/^(\d{1,2}\/\d{1,2}?)($|\s)/,(function(e,t){return n.getFullYear()+"/"+t}))).indexOf("T")>-1&&-1==e.indexOf("GMT")){var o=(e=e.replace("T"," ")).indexOf(".")>-1?e.split("."):[e];return new Date(o[0])}if(e.indexOf("GMT")>-1){var l=(o=e.split(" "))[3]+"/"+{Jan:"1",Feb:"2",Mar:"3",Apr:"4",May:"5",Jun:"6",Jul:"7",Aug:"8",Sep:"9",Oct:"10",Nov:"11",Dec:"12"}[o[1]]+"/"+o[2]+" "+o[4];return new Date(l)}return e.indexOf("/")<0&&e.indexOf(":")>-1&&(e=a+"/"+i+"/"+r+" "+e),4===e.length?e+="/1/1 00:00:00":"MM"===t||"M"===t?e=a+"/"+e+"/1 00:00:00":"dd"!==t&&"d"!==t||(e=a+"/"+i+"/"+e+" 00:00:00"),new Date(e)},e.date.after=function(e,t,n){t=0===t?0:t||1;var a=this.convert(e).getTime()+1e3*parseInt(t)*3600*24;return this.format(a,n||"yyyy-MM-dd")},e.date.afterTime=function(e,t,n){var a=0===t?0:t||30,i=this.format(new Date,"yyyy/MM/dd")+" "+e,r=new Date(i).getTime()+1e3*a*60;return this.format(r,n||"hh:mm")},e.date.count=function(t,n,a){var i,r;switch(a){case"number":i=t,r=n;break;case"hour":var o=this.format(new Date,"yyyy/MM/dd"),l=o+" "+t,c=this.convert(l),s=o+" "+n,u=this.convert(s);i=c.getTime(),r=u.getTime();break;case"date":default:i=this.convert(t).getTime(),r=this.convert(n).getTime()}var d=i-r;d=Math.abs(d);var f=parseInt(d/1e3/3600/24,10),p=parseInt(d/1e3/3600%24,10),h=parseInt(d/1e3/60%60,10),g=parseInt(d/1e3%60,10);return{value:d,day:f,hour:p,minute:h,second:g,tip:"".concat(f,"天 ").concat(e.unit.fixZero(p),":").concat(e.unit.fixZero(h),":").concat(e.unit.fixZero(g))}},e.date.countMonth=function(e){var t=this.convert(e),n=t.getMonth()+1;return t.setMonth(n),t.setDate(0),t.getDate()},e.date.toWeek=function(e,t){var n=this.convert(e),a=null;switch(t){case 1:a=["周日","周一","周二","周三","周四","周五","周六"];break;default:a=t||["星期天","星期一","星期二","星期三","星期四","星期五","星期六"]}return a[n.getDay()]},e.date.today=function(e){return e=e||"M-d",this.format(new Date,e)},e.date.fromnow=function(e){var t=+new Date,n=this.convert(e).getTime(),a="",i=this.count(t,n,"date"),r=t>n?"前":"后";return i.day?a=i.day+"天"+r:i.hour?a=i.hour+"小时"+r:i.minute?a=i.minute+"分钟"+r:i.second&&(a=i.second+"秒"+r),a}}(window.bui||{}),function(e,t){e.ajax=function(n){var a=t.Deferred(),i=null,r=t.extend(!0,{},{baseUrl:"",data:{},method:"GET",dataType:"json",timeout:6e4,headers:{},processData:!0,mimeType:"none",cache:!0,async:!0,needJsonString:!1,contentType:null,localData:null,transformRequest:null,transformResponse:null,native:!0,needNative:!1},e.config.ajax,n),o=r.success,l=r.fail||r.error;if(null===r.contentType&&"get"==r.method.toLocaleLowerCase()?r.contentType="text/html;charset=UTF-8":null===r.contentType&&"post"==r.method.toLocaleLowerCase()?r.contentType="application/x-www-form-urlencoded":r.contentType=r.contentType,"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,r.needJsonString)try{r.data="object"===_typeof(r.data)?JSON.stringify(r.data):r.data}catch(e){r.data=r.data}if(r.data=r.transformRequest&&r.transformRequest.call(a,r.data)||r.data,!r.url)return e.showLog("url不能为空","bui.ajax"),a;if(r.url.indexOf("://")>-1?r.url=r.url:r.url.indexOf("./")>-1||r.url.indexOf("../")>-1?r.url=bui.unit.resolvePath(r.url):r.url=r.baseUrl+r.url,r.proxy){var c=r.url.indexOf(r.proxy),s=c>-1?c+1:-1;r.url=r.url.substr(s)}if(a.abort=function(){i&&i.abort()},r.localData)return r.localData=r.transformResponse&&r.transformResponse.call(a,r.localData)||r.localData,o&&o(r.localData,200),a.resolve(r.localData,200),a;if(r.needNative){if(void 0===e.native.ajax)return u(r),a;try{a=e.native.ajax&&e.native.ajax(r)||a}catch(e){}}else u(r);function u(e){e.success=function(t,n,i){var r=null;if("string"==typeof t&&"json"==e.dataType)try{r=JSON.parse(t)}catch(e){r=t}else r=t||{};r=e.transformResponse&&e.transformResponse.call(a,r)||r,o&&o(r,n,i),a.resolve(r,n,i)},e.error=function(t,n,i){var r;if("string"==typeof t&&"json"==e.dataType)try{r=JSON.parse(t)}catch(e){r=t}else r=t||{};l&&l(r,n,i),a.reject(r,n,i)};var n=e.type&&e.type.toUpperCase();e.type=n||e.method.toUpperCase(),i=t.ajax(e)}return a},e.get=function(n,a,i){var r={method:"GET"};r.url=n,r.data=a||{};var o=null,l=i&&i[0];return o=i&&"array"===e.typeof(i)&&"object"==e.typeof(l)?t.extend(!0,{},e.config.get,r,l):r,bui.ajax(o)},e.post=function(n,a,i){var r={method:"POST",contentType:"application/x-www-form-urlencoded"};r.url=n,r.data=a||{};var o=null,l=i&&i[0];return(o=i&&"array"===e.typeof(i)&&"object"==e.typeof(l)?t.extend(!0,{},e.config.post,r,l):r).contentType.indexOf("application/json")>-1&&(o.data="object"===_typeof(o.data)?JSON.stringify(o.data):o.data),bui.ajax(o)},e.put=function(n,a,i){var r={method:"PUT",contentType:"application/json"};r.url=n,r.data=a||{};var o=null,l=i&&i[0];return(o=i&&"array"===e.typeof(i)&&"object"==e.typeof(l)?t.extend(!0,{},e.config.put,r,l):r).contentType.indexOf("application/json")>-1&&(o.data="object"===_typeof(o.data)?JSON.stringify(o.data):o.data),bui.ajax(o)},e.delete=function(n,a,i){var r={method:"DELETE",contentType:"application/json"};r.url=n,r.data=a||{};var o=null,l=i&&i[0];return(o=i&&"array"===e.typeof(i)&&"object"==e.typeof(l)?t.extend(!0,{},e.config.delete,r,l):r).contentType.indexOf("application/json")>-1&&(o.data="object"===_typeof(o.data)?JSON.stringify(o.data):o.data),bui.ajax(o)},e.all=function(n){var a=null;return a=n&&"array"===e.typeof(n)?n:Array.prototype.slice.apply(arguments),t.when.apply(null,a)}}(window.bui||{},window.libs),function(e,t){e.load=function(n){var a,i={url:"",param:{},reload:!!e.hasRouter&&router.config.reload,replace:!1,native:!0,needNative:!1},r=t.extend(!0,{},i,e.config.load,n),o={},l=r.url;if(r.url)if(document.activeElement.blur(),l.indexOf("tel:")>=0||l.indexOf("mailto:")>=0||l.indexOf("sms:")>=0)e.unit.openExtral(l);else{if(l&&l.indexOf("?")>-1){var c=l.split("?");o=e.unit.keyStringToObject(c[1]),r.url=c[0]}try{var s="string"==typeof r.param&&JSON.parse(r.param)||r.param||{};r.param=t.extend(!0,{},o,s)}catch(t){return void e.showLog("param 参数值必须是一个{}对象","bui.load:web")}n&&n.needNative||e.nativeRouter?e.native.load&&e.native.load(r):(a=e.setUrlParams(r.url,r.param),r.reload?window.location.href=e.hasRouter?"index.html#"+a:a:!r.replace||e.hasRouter?e.hasRouter?window.router.load(r):window.location.href=a:window.location.replace(a))}else e.showLog("url 不能为空!","bui.load:web")}}(window.bui||{},window.libs),function(e,t){e.getPageParams=function(n){var a=t.Deferred(),i={callback:null,native:!0,needNative:!1};n=n||{};var r=t.extend(!0,{},i,e.config.getPageParams);if("function"==typeof n?r.callback=n:n&&"object"===e.typeof(n)&&(r=t.extend(!0,{},i,e.config.getPageParams,n)),"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,n&&n.needNative||e.nativeRouter)return a=e.native.getPageParams&&e.native.getPageParams(r)||a;if(e.hasRouter){var o=window.router.getPageParams&&window.router.getPageParams()||e.getUrlParams();r.callback&&r.callback(o),a.resolve(o)}else{var l=e.getUrlParams();r.callback&&r.callback(l),a.resolve(l)}return a}}(window.bui||{},window.libs),function(e,t){e.back=function(n){var a,i={index:-1,name:"",delay:!0,param:null,native:!0,beforeBack:!0,callback:null};"function"==typeof n?(i.callback=n,a=t.extend(!0,{},i,e.config.back)):a=n&&"object"===e.typeof(n)?t.extend(!0,{},i,e.config.back,n):t.extend(!0,{},i,e.config.back),"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp;var r=e.hasRouter&&router.history&&router.history.getLast()||null;if(!1!==("function"==typeof a.beforeBack?a.beforeBack.call(this,{prevTarget:null,target:r}):a.beforeBack))if(n&&n.needNative||e.nativeRouter)e.native.back&&e.native.back(a);else{if(e.hasRouter)if(window.router.config.syncHistory){var o=e.history.get(),l=o.length-1;if(a.name){var c=e.array.indexs(o,a.name,"name"),s=c.length;a.index=s?-(o.length-c[s-1]-1):-1}if(Math.abs(a.index)>=o.length&&(a.index=-l),Math.abs(a.index)>=window.history.length&&window.router.config.hash&&(a.index=window.router.config.reloadCache?-l:-(window.history.length-1)),0==a.index&&(a.index=-1),window.router.config.hash&&!window.router.config.reloadCache)return void d();(o.length>1||window.history.length>1)&&d()}else window.router.back&&window.router.back(a);else d();var u=null}function d(){var t=e.hasRouter&&e.history.getPrev()||{},n=t.exports||{};if(window.history.go(a.index),e.hasRouter&&a.param){t.param=a.param;var i=window.location.origin+window.location.pathname+"#"+t.pid,r=e.setUrlParams(i,t.param);t.component={},t.page={},window.history.hasOwnProperty("replaceState")&&window.history.replaceState(t,null,r)}u&&clearTimeout(u),a.delay&&a.callback?u=setTimeout((function(){e.hasRouter?a.callback.call(router,n):a.callback.call(e,{})}),500):a.callback&&a.callback()}}}(window.bui||{},window.libs),function(e,t){e.refresh=e.history.refresh}(window.bui||{}),function(e,t){e.run=function(n){var a={};"string"==typeof n?a.id=n:n&&"object"===e.typeof(n)&&(a=t.extend(!0,{},{id:"",name:"",data:null,onFail:null,native:!0,needNative:!0},e.config.run,n));var i=String(a.id);if("object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,n.needNative)e.native.run&&e.native.run(a);else if(i.indexOf("http://")>-1||i.indexOf("https://")>-1){var r=e.setUrlParams(a.id,a.data);if(e.platform.isIos())return void(window.location.href=r);(window.open("","_blank")||window.open("","_newtab")).location.href=r}}}(window.bui||{},window.libs),function(e,t){e.fileselect=function(n){var a,i,r,o=t.extend(!0,{},{uid:"",native:!0,needNative:!1,needCompress:!1,appendTo:"",quality:.8,from:"camera",width:800,height:800,duration:10,onSuccess:null,onFail:null,mediaType:"picture"},e.config.fileselect,n),l=this,c={add:function(n){s=null;var a=t.extend(!0,{needChangeData:!0,needCompress:!1,name:"resize.jpg"},o,n);(u=a).mimeType=n.mimeType?n.mimeType:"",f?(n.from?"picture"===n.from||"photo"===n.from||"savephoto"===n.from?i.removeAttr("capture"):i.attr("capture",n.from):i.removeAttr("capture"),e.platform.isIos()&&"function"==typeof FastClick?i[0].dispatchEvent(new Event("click")):i.trigger("click")):r.add(a);return this},remove:function(t,n){n=n||"name";if(!f)return d=r.remove(t,n);if("string"==typeof t){d.length&&e.array.remove(d,t,n);var a=d.length?d[d.length-1].data:null;return s=a,i[0].value="",d}return this},clear:function(){d=[],s=null,f?i[0].value="":r.clear();return d},value:function(){s=f?s:r.value();return s},data:function(){d=f?d:r.data();return d},toFile:x,toBase64:function(n){var a=t.extend(!0,{needCompress:!1,destinationType:"data",mimeType:"",needChangeData:!1},n);if(a.data=a.data||s,a.mimeType=n.mimeType?n.mimeType:a.data&&a.data.type||"image/jpeg",f)try{w(a)}catch(t){e.showLog(t)}else r.toBase64(a);return this},resize:w,toBlob:k,currentIndex:function(){var e="";e=f?d.length-1:r.data().length-1;return e},currentName:function(){var e="";e=f?d[d.length-1].name:r.value().name;return e},init:b},s=null,u=null,d=[],f="object"===_typeof(n)&&void 0!==n.needNative?!n.needNative:e.isWebapp,p="*",h=!1,g=null,m=null,v=null,y=null;function b(n){var b=t.extend(!0,o,n);switch(o.appendTo=b.appendTo||e.hasRouter&&router.currentPage()||"body",b.mediaType){case"allmedeia":p="*";break;case"picture":case"image":p="image/*";break;case"video":p="video/*";break;case"audio":p="audio/*";break;default:p=b.mediaType}return d=[],g=new Image,m=new FileReader,v=document.createElement("canvas"),y=v.getContext("2d"),f?(!function(){if(null==i){a=bui.guid();var e=o.from?'capture="'+o.from+'"':"",n='<input type="file" accept="'+p+'" name="uploadFiles" id="'+a+'" '+e+' style="display:none"/>';t(o.appendTo).append(n),i=t("#"+a)||t('input[name="uploadFiles"]')}}(),h||(i.on("change",(function(t){var n=this.files;if(!(n.length<1)){n.length>1&&e.showLog("一次只能选一张图片","bui.fileselect:web");var a=n[0];s=a;var i={name:a.name,data:a,type:a.type,size:a.size};d.push(i),u.needCompress?(u.data=a,u.mimeType=u.mimeType?u.mimeType:a.type,w(u)):u.onSuccess&&u.onSuccess.call(l,a,d),this.value=""}})),h=!0)):r=e.native.fileselect&&e.native.fileselect.call(this,n,{module:c})||{},b.uid&&e.history.setUI&&e.history.setUI({uid:b.uid,ui:c}),this}function w(n){var a=t.extend(!0,{destinationType:"file",data:null,mimeType:"",quality:.8,width:800,height:800,needCompress:!0,needChangeData:!1,onSuccess:null,onFail:null},o,n);g.onload=function(){var t=this.width,n=this.height,i=null,r=a.width,o=a.height,c=t,u=n;a.needCompress&&(t>r||n>o)&&(t/n>r/o?(c=r,u=Math.round(r*(n/t))):(u=o,c=Math.round(o*(t/n)))),v.width=c,v.height=u,y.clearRect(0,0,c,u),y.drawImage(g,0,0,c,u);var f=v.toDataURL(a.mimeType||a.data&&a.data.type||"image/jpeg",a.quality),p=function(e){return e.indexOf(".png")>-1||e.indexOf(".jpg")>-1||e.indexOf(".gif")>-1||e.indexOf(".jpeg")>-1?e.substr(0,e.lastIndexOf(".")):e}(a.data.name)||"";switch(a.destinationType){case"file":i=x(f,p);break;case"blob":i=k(f);break;case"data":i=f}if(a.needChangeData){s=i;var h=e.array.index(d,a.data.name,"name");h>-1&&(d[h].data=i,i.size&&(d[h].size=i.size),i.type&&(d[h].type=i.type))}return a.onSuccess&&a.onSuccess.call(l,i,d),i},g.onerror=function(){a.onFail&&a.onFail.call(l,g.src)},m.onload=function(e){g.src=e.target.result};try{var i=a.data&&a.data.type||"";i="object"===_typeof(i)?i.type||"":i||"",a.data&&0==i.indexOf("image")&&m.readAsDataURL(n.data)}catch(t){e.showLog(t)}}function x(t,n){try{n=n||"file";for(var a=t.split(","),i=(a[0].match(/:(.*?);/)||[])[1]||"image/jpeg",r=i.split("/")[1],o=atob(a[1]),l=o.length,c=new Uint8Array(l);l--;)c[l]=o.charCodeAt(l);return new File([c],n+"."+r,{type:i})}catch(t){e.showLog(t)}}function k(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],a=atob(t[1]),i=a.length,r=new Uint8Array(i);i--;)r[i]=a.charCodeAt(i);return new Blob([r],{type:n})}return b(o),c}}(bui||{},libs),function(e,t){e.file=function(n){var a,i,r,o,l,c={getFolder:d,removeFolder:function(e){var n=t.extend(!0,{},e);s.needNative?l.removeFolder(n):d({root:n.root,folderName:n.folderName,create:n.create,onSuccess:function(e,t){e.removeRecursively((function(){n.onSuccess&&n.onSuccess.call(c,e,t)}),(function(t){var a={msg:"删除 "+n.folderName+" 文件失败"};n.onFail&&n.onFail.call(c,a,e)}))},onFail:function(e){var t={msg:"删除 "+n.folderName+" 文件失败"};n.onFail&&n.onFail.call(c,t)}});return this},getFile:h,getFileName:p,removeFile:function(e){var n=t.extend(!0,{},e);s.needNative?l.removeFile(n):h({root:n.root,create:n.create,folderName:n.folderName,fileName:n.fileName,onSuccess:function(e,t){e.remove((function(){n.onSuccess&&n.onSuccess.call(c,e,t)}),(function(t){var a={msg:"删除 "+n.fileName+" 文件失败"};n.onFail&&n.onFail.call(c,a,e)}))},onFail:function(e){var t={msg:"删除 "+n.fileName+" 文件失败"};n.onFail&&n.onFail.call(c,t)}});return this},toBase64:function(e){return o.toBase64(e),this},open:function(t){var n=t||{};if(!n.url)return;s.needNative?l.open(n):e.showLog("web暂不支持open方法","bui.file.open:web");return this},init:u},s=c.config=t.extend(!0,{},{uid:"",size:10,native:!0,needNative:!1},e.config.file,n);function u(n){return o=e.fileselect(n),i=function(n){var i=t.Deferred();n.needNative?l=e.native.file&&e.native.file(n,{fileselect:o,module:c})||{}:(a="bui.app",r=1024*parseInt(s.size)*1024,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,navigator.webkitPersistentStorage&&navigator.webkitPersistentStorage.requestQuota(r,(function(e){window.requestFileSystem(window.PERSISTENT,e,(function(e){i.resolve(e)}),u)})));function u(e){var t="";try{switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:t="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:t="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:t="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:t="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:t="INVALID_STATE_ERR";break;default:t="Unknown Error"}}catch(e){}var n={msg:t};i.reject(n)}return i}(n),!n.needNative&&d({root:!0,create:!0}),n.uid&&e.history.setUI&&e.history.setUI({uid:n.uid,ui:c}),this}function d(e){var n={folderName:a,root:!1,create:!1,msg:"",param:{create:!1,exclusive:!1},onSuccess:null,onFail:null},r=t.extend({},n,e),o="";if(r.create?(o="创建 ",r.param.create=!0):(o="获取 ",r.param.create=!1),s.needNative)l.getFolder(r);else{var u=f(r.folderName);u=r.root?u:a+"/"+u,i.done((function(e){e.root.getDirectory(u,r.param,(function(t){r.onSuccess&&r.onSuccess.call(c,t,e)}),(function(e){var t={msg:o+u+" 文件夹失败"};r.onFail&&r.onFail.call(c,t)}))})).fail((function(e){r.onFail&&r.onFail.call(c,{msg:"文件系统还没准备好."})}))}return this}function f(e){return"."==e[0]||"/"==e[0]||" "==e[0]?f(e.slice(1)):"."!=e[0]&&"/"!=e[0]&&" "!=e[0]?e:void 0}function p(e){return e&&e.indexOf("/")>-1?e.slice(e.lastIndexOf("/")+1,e.indexOf("?")>-1?e.indexOf("?"):void 0):e}function h(e){var n=t.extend({},{fileName:"",folderName:"",root:!1,create:!1,param:{create:!1,exclusive:!1},onSuccess:null,onFail:null},e),i="";if(n.create?(i="创建 ",n.param.create=!0):(i="获取 ",n.param.create=!1),n.fileName&&!(n.fileName.indexOf(".")<0)){if(s.needNative)l.getFile(n);else{var r=p(n.fileName);d({root:n.root,folderName:n.folderName,create:!0,onSuccess:function(e,t){var o=e.name==a?e.name+"/"+r:a+"/"+e.name+"/"+r;t.root.getFile(o,n.param,(function(e){n.onSuccess&&n.onSuccess.call(c,e,t)}),(function(e){var t={msg:i+r+" 文件失败"};n.onFail&&n.onFail.call(c,t)}))},onFail:function(e){n.onFail&&n.onFail(e)}})}return this}n.onFail&&n.onFail()}return"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,u(s),c}}(window.bui||{},window.libs),function(e,t){e.upload=function(n){var a,i,r,o,l,c,s,u={uid:"",url:"",data:null,headers:{},showProgress:!0,timeout:6e4,contentType:!1,processData:!1,autoClose:!0,native:!0,needNative:!1,method:"POST",fileKey:"file",dataType:"json",mediaType:"picture",from:"picture",onProgress:null,onMask:function(){b()},onSuccess:null,onFail:null},d=t.extend(!0,{},u,e.config.upload,n),f=t.Deferred(),p={init:m,add:function(e){return e.onSuccess=e.onSuccess?e.onSuccess.bind(p):null,e.onFail=e.onFail?e.onFail.bind(p):null,i.add(e),this},remove:function(e,t){var n=v(),a=n.length;if(a<1)return this;/\d/.test(e)&&e.indexOf(".")<0?i.remove(n[e].name,t):"string"==typeof e?i.remove(e,t):i.remove(n[a-1].name,t);return this},resize:function(e){return i.resize(e),this},currentIndex:function(){return i.currentIndex()},currentName:function(){return i.currentName()},clear:function(){return i.clear(),this},data:v,start:y,startAll:function(e){var n=t.extend(!0,{needFileinfo:!1},d,e),a=n[n.fileKey]||i.data();n.data||(n.data={});for(var r=[],o=0;o<a.length;o++)a[o],function(e){if(!(e>a.length-1)){if(n.data[n.fileKey]=a[e]&&a[e].data,n.needFileinfo)for(var t in a[e])"data"!==t&&(n.data[t]=a[e]&&a[e][t]);var i=n.onSuccess,o=n.onFail;n.onSuccess=function(t){i&&i.call(p,t),r[e]=t,e==a.length-1&&n.onEnd&&n.onEnd.call(p,r)},n.onFail=function(t){o&&o.call(p,t),r[e]=t,e==a.length-1&&n.onEnd&&n.onEnd.call(p,r)},y(n)}}(o);return f},stop:b,toBase64:function(e){return i.toBase64(e),this},widget:function(t){var n={loading:a,fileselect:i,ajax:r};return e.widget.call(n,t)}},h=d.showProgress,g=d.onProgress;function m(t){return a=e.loading({display:"block",width:30,height:30,opacity:0,autoClose:t.autoClose,callback:t.onMask}),i=e.fileselect.call(p,{native:t.native,needNative:t.needNative,from:t.from,mediaType:t.mediaType}),t&&t.needNative&&(o=e.native.upload&&e.native.upload(t,{loading:a,fileselect:i,module:p})||{}),t.data?(y(t),t.uid&&e.history.setUI&&e.history.setUI({uid:t.uid,ui:p}),this):this}function v(){return i.data()}function y(e){var n=t.extend(!0,{},d,e);if(c=n.url,l=i.value(),h=n.showProgress,l){if(h&&a.show(),n&&n.needNative)return o.start(n)||f;var s=n.data,u=s&&"object"===_typeof(s)?Object.keys(s):[],g=new FormData,m=!1;return u.forEach((function(e,t){n.fileKey===e&&(m=!0),g.append(e,s[e])})),!m&&g.append(n.fileKey,l),n.data=g,function(e){var n=e.onSuccess,a=e.onFail;return r=t.ajax({url:c,type:e.method,data:e.data,cache:e.cache,headers:e.headers,dataType:e.dataType,contentType:e.contentType,processData:e.processData,timeout:e.timeout,xhr:function(){var e=t.ajaxSettings.xhr();if(w&&e.upload)return e.upload.addEventListener("progress",w,!1),e},success:function(e){x(),n&&n.call(p,e),f.resolve(e)},error:function(e,t,n){x(),a&&a.call(p,e,t),f.reject(e,t,n)}}),f}(n)}}function b(e){return d&&d.needNative?o.stop(e):(a&&a.stop(),r&&r.abort(),e&&e.call(p,a,r)),this}function w(e){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,window.requestAnimationFrame((function(){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);s=t.toString()+"%",t<100?(n=s,h&&a&&a.show({text:n})):x(),g&&g.call(p,s)}var n}))}function x(){return a&&a.stop(),this}return"object"===_typeof(n)&&void 0!==n.needNative?n.needNative:e.isWebapp,m(d),p}}(window.bui||{},window.libs),function(e,t){e.download=function(n){var a,i,r,o,l,c={open:function(e){return i.open(e),this},getFile:function(e){var n=t.extend(!0,{autoDown:!0},s,e),a=e.fileName||i.getFileName(n.url);i.getFile({fileName:a,folderName:n.folderName,onSuccess:function(e,t){n.onSuccess&&n.onSuccess.call(c,e.fullPath||e,e,t)},onFail:function(e){n.autoDown=v(n)}})},removeFile:function(t){if(!t.fileName)return e.showLog("请告诉我们你要删除哪个文件, fileName "),this;return t.folderName=t.folderName||s.folderName,i.removeFile(t),this},removeFolder:function(e){return e.folderName=e.folderName||s.folderName,i.removeFolder(e),this},start:v,stop:y,toBase64:function(e){return i.toBase64(e),this},init:m,widget:function(t){var n={loading:h,file:i,ajax:a};return e.widget.call(n,t)}},s=c.config=t.extend(!0,{},{uid:"",url:"",data:{},headers:{},method:"GET",showProgress:!0,timeout:6e4,fileName:"",folderName:"download",native:!0,needNative:!0,onProgress:null,onSuccess:null,onFail:null},e.config.download,n),u="object"===_typeof(n)&&void 0!==n.needNative?!n.needNative:e.isWebapp,d=s.showProgress,f=s.onProgress,p=s.onFail,h=null,g=null;function m(t){return h=t.showProgress&&e.loading({display:"block",width:30,height:30,opacity:0,callback:function(){y()}}),i=e.file({native:t.native,needNative:t.needNative}),t.needNative?r=e.native.download&&e.native.download(t,{file:i,loading:h,module:c})||{}:function(e){if(i.getFolder({folderName:e.folderName,create:!1,onSuccess:function(e,t){e.fullPath},onFail:function(t){i.getFolder({folderName:e.folderName,create:!0,onSuccess:function(e,t){e.fullPath},onFail:function(e){p&&p.call(c,e)}})}}),!e.url)return;v(e)}(t),t.uid&&e.history.setUI&&e.history.setUI({uid:t.uid,ui:c}),this}function v(e){var n=t.extend(!0,{},s,e);o=n.needEncode?encodeURI(n.url):n.url,f=n.onProgress,(d=n.showProgress)&&h&&h.show({text:"0%"}),e.fileName||i.getFileName(n.url),n.needNative?r.start(n):(n.cache=!1,n.contentType=!1,n.processData=!1,a=t.ajax({url:o,type:n.method,data:n.data,cache:n.cache,headers:n.headers,contentType:n.contentType,processData:n.processData,timeout:n.timeout,xhr:function(){var e=t.ajaxSettings.xhr();if(b&&e)return e.addEventListener("progress",b,!1),e},success:function(t){var a=e.fileName||i.getFileName(n.url);i.getFile({fileName:a,folderName:n.folderName,create:!0,onSuccess:function(e,t){n.onSuccess&&n.onSuccess.call(c,e.fullPath,t)}})},fail:function(e){w(),n.onFail&&n.onFail.call(c,e)}}))}function y(e){u?(w(),a&&a.abort(),g&&window.cancelAnimationFrame(g)):r.stop(),e&&e.call(c,h,a)}function b(e){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,g=window.requestAnimationFrame((function(){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);l=t.toString()+"%",t<100?(n=l,d&&h&&h.show({text:n})):w(),f&&f.call(c,l)}var n}))}function w(){d&&h&&h.stop()}return m(s),c}}(window.bui||{},window.libs),function(e,t){e.currentPlatform="webapp",e.on("pagereadybefore",(function(){e.platform.isPC()?window.viewport=e.viewport(40):window.viewport=e.viewport(),e.config.init.auto&&e.init(),!e.hasRouter&&e.config.component.auto&&loader.components({id:"body"})})),e.webready=function(n){t(document).ready((function(){e.trigger.call(e,"pagereadybefore"),n&&n.call(e),e.trigger.call(e,"pageready")}))},e.ready=function(n){e.isWebapp=void 0===e.isWebapp?e.debug:e.isWebapp;var a=t.Deferred();if(e.isWebapp)t(document).ready((function(){e.trigger.call(e,"pagereadybefore"),n&&n.call(e),e.trigger.call(e,"pageready"),a.resolve()}));else{if(void 0===e.native.ready)return e.showLog("当前 bui.isWebapp = false; 但bui.js为webapp版本,不支持原生方法,请使用 buijs update -p xxx, 更换bui.js为对应xxx平台版本;"),e.webready(n),a;a=e.native.ready&&e.native.ready(n)||a}return a}}(window.bui||{},window.libs),function(e,t){e.mask=function(n){var a={id:"",uid:"",appendTo:"",className:"",opacity:.3,background:"",zIndex:100,autoTrigger:!1,autoClose:!1,onBeforeInit:null,onInited:null,callback:null},i={name:"mask",handle:{},on:function(t,n){return e.on.apply(i,arguments),this},off:b,hide:y,show:function(t){if(h)return;(d=e.objId(l))&&d.length?(d.css("display","block"),!p&&u.css("position","relative"),s=!0):m(r);return w.call(i,"show"),this},isShow:function(){return s},remove:v,destroy:function(e){v(),u&&u.off("click.mask");b("show"),b("hide"),h=!0},widget:function(t){return e.widget.call({},t)},option:function(t,n){return e.option.call(i,t,n)},config:r,init:g},r=i.config=t.extend(!0,{},a,e.config.mask,n),o=e.guid(),l=r.id?r.id.indexOf("#")>-1?r.id.substring(1):r.id:o;t("body");var c,s,u=e.objId(r.appendTo),d=null,f=!1,p=!1,h=!1;function g(n){h=!1;var o=t.extend(!0,a,r,n);return o.onBeforeInit&&o.onBeforeInit.call(i,o),o.appendTo=o.appendTo||"body",u=e.objId(o.appendTo),p=u[0]&&"COMPONENT"===u[0].tagName,r=i.config=o,c=u.css("position"),o.autoTrigger&&m(o),d=e.objId(o.id),o.uid&&e.history.setUI&&e.history.setUI({uid:o.uid,ui:i}),o.onInited&&o.onInited.call(i,o),this}function m(n){if(!h){var o=t.extend(!0,{},a,r,n),c=function(t){var n=t.background?t.background:"rgba(0,0,0,"+t.opacity+")",a="";return a+'<div id="'+l+'" class="'+e.prefix("mask")+" "+t.className+'" style="background:'+n+";z-index:"+t.zIndex+'"></div>'}(o);return(d=e.objId(l))&&d.length?d.css("display","block"):(u.append(c),!p&&u.css("position","relative"),d=e.objId(l)),s=!0,w.call(i,"show"),f||function(e){d.off("click.bui").on("click.bui",(function(t){e.callback&&e.callback.call(i,t),e.autoClose&&y(),t.stopPropagation()})),f=!0}(o),this}}function v(){if(!h)return d&&d.remove(),d=null,u.css("position",c||"static"),s=!1,f=!1,w.call(i,"hide"),this}function y(){if(!h)return d&&d.css("display","none"),!p&&u.css("position","relative"),s=!1,w.call(i,"hide"),this}function b(t,n){return e.off.apply(i,arguments),this}function w(t){i.self=this==window||this==i?null:this,e.trigger.apply(i,arguments)}return g(r),i}}(window.bui||{},window.libs),function(e,t){e.loading=function(n){var a={name:"loading",handle:{},on:function(t,n){return e.on.apply(a,arguments),this},off:k,start:y,stop:w,isLoading:function(){return f},pause:function(){if(d)return;return s&&s.addClass("bui-loading-pause"),O.call(this,"pause"),this},text:b,showRing:function(){if(d)return;return s=e.objId(l),s.children(".bui-loading-cell").css("display","inline-block"),s.removeClass("bui-loading-pause"),this},hideRing:function(){if(d)return;return s=e.objId(l),s.children(".bui-loading-cell").css("display","none"),s.addClass("bui-loading-pause"),this},show:function(n){var a=n||{};if(d)return;var r=t.extend(!0,i,a);(s=e.objId(r.id))&&s.length?(b(r.text),s[0].style.display="-webkit-box",m&&m.show(),r.callback&&o.off("click.bui","#"+l).on("click.bui","#"+l,r.callback),O.call(this,"show")):y(r);i.timeout&&(p&&clearTimeout(p),p=setTimeout((function(e){x()}),i.timeout));return f=!0,this},hide:x,destroy:function(e){e=1==e;w(),o&&o.off("click.bui");k("show"),k("hide"),k("start"),k("stop"),k("pause"),k("remove"),m&&m.destroy(e),d=!0},widget:function(t){var n={mask:m||{}};return e.widget.call(n,t)},option:function(t,n){return e.option.call(a,t,n)},config:i,init:v},i=a.config=t.extend(!0,{},{uid:"",appendTo:"",width:30,height:30,text:"",onlyText:!1,mask:!0,zIndex:"",autoTrigger:!1,autoClose:!0,timeout:0,opacity:0,display:"block",template:null,onBeforeInit:null,onInited:null,callback:null},e.config.loading,n);t("body");var r,o=null,l=e.guid(),c=l+"-mask",s=e.objId(l),u=!1,d=!1,f=!1,p=null;i.id=l;var h=i.callback;i.callback=function(e){i.autoClose&&w(),h&&h.call(a,e)};var g=t.extend(!0,{},i,{id:c}),m=i.mask?e.mask(g):null;function v(r){d=!1;var c=t.extend(!0,{},i,r);return c.onBeforeInit&&c.onBeforeInit.call(a,n),c.appendTo=c.appendTo||"body",o=t(c.appendTo),i=a.config=c,c.autoTrigger&&s.length<1&&y(c),s=e.objId(l),c.uid&&e.history.setUI&&e.history.setUI({uid:c.uid,ui:a}),c.onInited&&c.onInited.call(a,c),this}function y(n){if(!d){var r=t.extend(!0,{},i,n);if(s=e.objId(l),s.children(".bui-loading-cell"),s.hasClass("bui-loading-pause"))s.removeClass("bui-loading-pause"),O.call(this,"start");else{s.length&&s.remove();var c=function(t){var n=(t=t||{}).text,i=o.width()||document.documentElement.clientWidth,r=n&&"block"==t.display?parseInt(t.height)+30:parseInt(t.height),c=-i/2,s=-r/2,u="block"==t.display?e.prefix("loading-block"):e.prefix("loading-inline"),d="";return d+='<div id="'+l+'" class="'+e.prefix("loading")+" "+u+'" style="width:'+i+"px;height:"+r+"px;line-height:"+r+"px;margin-left:"+c+"px;margin-top:"+s+"px;"+(t.zIndex?"z-index:"+t.zIndex:"")+'" >',t.onlyText||(d+='<div class="'+e.prefix("loading-cell")+'" style="width:'+parseFloat(t.width)+"px;height:"+parseFloat(t.height)+'px;"></div>'),d+='<div class="'+e.prefix("loading-text")+'">'+t.text+"</div>",d+="</div>",t&&t.template?t.template.call(a,t):d}(r);o.append(c),m&&m.show(),O.call(this,"show")}return r.timeout&&(p&&clearTimeout(p),p=setTimeout((function(){w()}),r.timeout)),u||function(e){var t=e||i;o.off("click.bui","#"+l).on("click.bui","#"+l,(function(e){t.callback&&t.callback.call(a,e),e.stopPropagation()})),u=!0}(r),f=!0,this}}function b(t){if(!d)return s=e.objId(l),r=s.children(".bui-loading-text"),void 0===t?r&&r.text():(r&&r.html(t),this)}function w(){if(!d)return(s=e.objId(l))&&s.remove(),s=null,m&&m.remove(),u=!1,f=!1,O.call(this,"remove"),O.call(this,"hide"),this}function x(){if(!d)return s=e.objId(l),(i.appendTo||s&&s.length)&&(s.css("display","none"),m&&m.hide()),f=!1,O.call(this,"hide"),this}function k(t,n){return e.off.apply(a,arguments),this}function O(t){a.self=this==window||this==a?null:this,e.trigger.apply(a,arguments)}return v(i),a}}(window.bui||{},window.libs),function(e,t){e.init=function(n){var a,i={id:".bui-page",height:0,header:"header",main:"main",footer:"footer",reduceRem:0};if("object"==e.typeof(n))a=t.extend({},i,e.config.init,n);else{var r={};r.height=n,a=t.extend({},i,r)}var o=a.height||document.documentElement.clientHeight||t("body").height()||t("#bui-router").height()||t(".bui-page").height();if(!(e.obj(a.main).length<1)){try{var l=e.obj(a.id),c=a.header.indexOf("#")>-1?e.obj(a.header)[0]:l.children(a.header)[0],s=a.footer.indexOf("#")>-1?e.obj(a.footer)[0]:l.children(a.footer)[0],u=a.main.indexOf("#")>-1?e.obj(a.main):l.children(a.main),d=c?c.offsetHeight:0,f=s?s.offsetHeight:0,p=a.reduceRem>0?e.unit.remToPx(a.reduceRem):0,h=o-d-f-p;if(parseInt(h)>0)u.height(h);else{var g=d+f+p+"px";e.unit.calcHeight(u,g)}}catch(t){e.showLog(t,"bui.init")}return h}},window.addEventListener?window.addEventListener("load",(function(t){e.trigger.call(e,"onload")}),!1):window.attachEvent("onload",(function(t){e.trigger.call(e,"onload")})),t(document).ready((function(){e.isWebapp=void 0===e.isWebapp?e.debug:e.isWebapp,e.trigger.call(e,"pagebefore"),"function"==typeof FastClick&&FastClick.attach(document.body),e.trigger.call(e,"pageinit")}));try{var n="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"",a=n.replace(/hidden/i,"visibilitychange");document.addEventListener(a,(function(t){document[n]?e.trigger.call(e,"pagehide",t):e.trigger.call(e,"pageshow",t)}))}catch(e){}try{navigator.control.gesture(!1),navigator.control.longpressMenu(!1)}catch(e){}}(window.bui||{},window.libs)}));
